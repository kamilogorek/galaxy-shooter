define("game",[],function(){var e=new Engine.Timer({type:Engine.Timer.VSYNC,loop:!0,autoplay:!0});return e}),define("scene",[],function(){var e=new Engine.Scene;return e}),define("camera",["scene"],function(e){var t=new Engine.Camera({lookAt:e});return t}),define("viewport",["camera"],function(e){var t=new Engine.Viewport({width:600,height:800,background:"black",id:"game",cameras:[e]});return t}),define("background",["game","scene","viewport"],function(e,t,n){var r={};return r.sparkles=[],r.sparklesNumber=500,r.init=function(){var t=this;this.generateSparkles(),e.on("step",function(){for(var e=0;e<5;e++)t.sparkles[Math.floor(Math.random()*t.sparklesNumber)].setOpacity(Math.random())})},r.generateSparkle=function(){var e=new Engine.Geometry.Rectangle({width:2,height:2,left:Math.round(Math.random()*n.width)-n.width/2,top:Math.round(Math.random()*n.height)-n.height/2,fill:"white",opacity:Math.random()});this.sparkles.push(e),t.appendChild(e)},r.generateSparkles=function(){for(var e=0;e<this.sparklesNumber;e++)this.generateSparkle()},r}),define("config",[],function(){var e={};return e.viewport={width:600,height:800},e.ship={width:99,height:75,assets:{"default":"image(images/player.png)",left:"image(images/player-left.png)",right:"image(images/player-right.png)"},lastPosition:{x:-38,y:e.viewport.height/2-90},speed:{x:0,y:0,acc:10},bulletAcc:20,lives:3},e.bullet={width:9,height:33,asset:"image(images/laser-red.png)",acc:20},e.asteroid={width:44,height:42,asset:"image(images/meteor-small.png)",top:-e.viewport.height/2-20,spacing:15},e.ui={life:{width:35,height:27,asset:"image(images/life.png)",y:20,x:20}},e}),define("ui",["config","game","scene"],function(e,t,n){var r={};return r.init=function(){this.livesIcons=[],this.livesLeft=e.ship.lives,this.score=0,this.updateScore(0),this.drawLives(),this.eventsBound||this.bindEvents()},r.bindEvents=function(){var e=this;this.eventsBound=!0,t.on("shipDestroyed",function(){this.livesLeft?e.drawLives():e.livesIcons.pop().destroy()}),t.on("updateScore",function(t){e.updateScore(t)})},r.drawLives=function(){while(this.livesIcons.length)this.livesIcons.pop().destroy();for(var t=0;t<this.livesLeft;t++)this.livesIcons.push(new Engine.Geometry.Rectangle({parent:n,width:e.ui.life.width,height:e.ui.life.height,left:-e.viewport.width/2+(e.ui.life.x+t*(e.ui.life.width+10)),top:-e.viewport.height/2+e.ui.life.y,fill:e.ui.life.asset}))},r.updateScore=function(e){var t=document.querySelector(".score");this.score+=e,t.innerText=this.score},r}),define("sounds",[],function(){return{shootBullet:new Engine.Sound({src:"sounds/laser4"}),pressButton:new Engine.Sound({src:"sounds/switch6"}),shipDestroyed:new Engine.Sound({src:"sounds/spaceTrash2"}),shipCreated:new Engine.Sound({src:"sounds/threeTone2"}),asteroidDestroyed:new Engine.Sound({src:"sounds/tone1"})}}),define("asteroids",["config","game","scene","viewport","sounds"],function(e,t,n,r,i){var s={};return s.instances=[],s.init=function(){while(this.instances.length)this.instances.pop().destroy();this.generateAsteroids(Math.floor(Math.random()*3)+3),this.eventsBound||this.bindEvents()},s.generateAsteroids=function(t){for(var i=0;i<t;i++){var s=Math.random()*e.viewport.width-e.viewport.width/2+e.asteroid.spacing;if(s+e.asteroid.width+e.asteroid.spacing>r.width/2){var o=s+e.asteroid.width-r.width/2;s=s-o-e.asteroid.spacing}var u=new Engine.Geometry.Rectangle({parent:n,fill:e.asteroid.asset,left:s,top:e.asteroid.top,width:e.asteroid.width,height:e.asteroid.height});u.acc=Math.floor(Math.random()*4)+2,this.instances.push(u)}},s.checkOverflow=function(t){t.top>e.viewport.height/2&&(this.instances.remove(t),t.destroy())},s.bindEvents=function(){var e=this;this.eventsBound=!0,t.on("step",function(){e.instances.some(function(t){t.setPosition(t.left,t.top+t.acc),e.checkOverflow(t)})});var r=0;t.on("loop",function(){++r,r===3&&(e.generateAsteroids(Math.floor(Math.random()*3)+3),r=0)}),t.on("asteroidDestroyed",function(e){i.asteroidDestroyed.stop(),i.asteroidDestroyed.play(),new Engine.Particles({parent:n,iterations:10,emitDelay:0,width:e.width,height:e.height,left:e.left,top:e.top,amount:15,fill:"rgb(152, 112, 87) 3px 3px",originX:e.width/2,originY:e.height/2,on:{beforecreateparticle:function(){this.lifetime=Math.random()*2e3,this.dx=Math.random()*e.width*10,this.dy=Math.random()*e.height*10}}})}),t.on("asteroidOverflow",function(e){e.destroy()})},s}),define("player",["config","game","scene","viewport","ui","asteroids","sounds"],function(e,t,n,r,i,s,o){var u={};return u.bullets=[],u.init=function(){this.lastPosition={x:e.ship.lastPosition.x,y:e.ship.lastPosition.y},this.create(),this.eventsBound||this.bindEvents(),this.keysBound||this.bindKeys()},u.create=function(){o.shipCreated.play(),e.ship.speed.x=0,e.ship.speed.y=0,t.trigger("stopShooting"),new Engine.Geometry.Rectangle({parent:n,name:"ship",width:e.ship.width,height:e.ship.height,left:this.lastPosition.x,top:this.lastPosition.y,fill:e.ship.assets.default}),new Engine.Timer({autoplay:!0,loop:!0,duration:150,iterations:10,on:{play:function(){n.ship.setOpacity(0),n.ship.invincible=!0},loop:function(){this.count%2?n.ship.setOpacity(1):n.ship.setOpacity(0)},stop:function(){n.ship.setOpacity(1),n.ship.invincible=!1}}})},u.checkBulletOverflow=function(t){t.top<-e.viewport.height/2&&(this.bullets.remove(t),t.destroy())},u.bulletAsteroidCollision=function(e,n){Engine.Box.overlap(n.left,n.top,n.width,n.height,e.left,e.top,e.width,e.height)&&(this.bullets.remove(e),e.destroy(),s.instances.remove(n),n.destroy(),t.trigger("asteroidDestroyed",n),t.trigger("updateScore",200))},u.playerAsteroidCollision=function(e){if(n.ship===undefined)return;if(n.ship.invincible)return;Engine.Box.overlap(e.left,e.top,e.width,e.height,n.ship.left,n.ship.top,n.ship.width,n.ship.height)&&(this.lastPosition={x:n.ship.left,y:n.ship.top},t.trigger("shipDestroyed",n.ship))},u.bindEvents=function(){var u=this;this.eventsBound=!0,t.on("step",function(){if(n.ship===undefined)return;var t=n.ship.left+r.width/2<0,i=n.ship.left+n.ship.width+r.width/2>r.width,s=n.ship.top+r.height/2<0,o=n.ship.top+n.ship.height+r.height/2>r.height;t?n.ship.setPosition(++n.ship.left,n.ship.top):i?n.ship.setPosition(--n.ship.left,n.ship.top):s?n.ship.setPosition(n.ship.left,++n.ship.top):o?n.ship.setPosition(n.ship.left,--n.ship.top):n.ship.setPosition(n.ship.left+e.ship.speed.x,n.ship.top+e.ship.speed.y)}),t.on("step",function(){u.bullets.some(function(t){t.setPosition(t.left,t.top-e.bullet.acc),s.instances.some(function(e){u.bulletAsteroidCollision(t,e)}),u.checkBulletOverflow(t)})}),t.on("step",function(){s.instances.some(function(e){u.playerAsteroidCollision(e)})}),t.on("startShooting",function(){u.generateBullet(),u.shootingInterval=setInterval(function(){u.generateBullet()},200)}),t.on("stopShooting",function(){clearInterval(u.shootingInterval)}),t.on("shipDestroyed",function(e){o.shipDestroyed.play(),i.livesLeft-=1,e.destroy(),new Engine.Particles({parent:n,iterations:10,emitDelay:0,width:e.width,height:e.height,left:e.left,top:e.top,amount:20,fill:"rgb(185, 75, 75) 3px 3px",originX:e.width/2,originY:e.height/2,lifetime:5e3,on:{beforecreateparticle:function(){this.dx=Math.random()*e.width*1e3,this.dy=Math.random()*e.height*1e3}}}),i.livesLeft?setTimeout(function(){t.trigger("respawnPlayer")},2e3):t.trigger("gameover")}),t.on("respawnPlayer",function(){u.create()})},u.generateBullet=function(){if(n.ship===undefined)return;var t=new Engine.Geometry.Rectangle({parent:n,fill:e.bullet.asset,left:n.ship.left+n.ship.width/2-4,top:n.ship.top-35,width:e.bullet.width,height:e.bullet.height});this.bullets.push(t),n.appendChild(t),o.shootBullet.stop(),o.shootBullet.play()},u.bindKeys=function(){this.keysBound=!0,Engine.Input.on("keydown",function(r){if(n.ship===undefined)return;switch(r.key){case"ARROW_LEFT":e.ship.speed.x-=e.ship.speed.acc,n.ship.setImage(e.ship.assets.left);break;case"ARROW_RIGHT":e.ship.speed.x+=e.ship.speed.acc,n.ship.setImage(e.ship.assets.right);break;case"ARROW_UP":e.ship.speed.y-=e.ship.speed.acc;break;case"ARROW_DOWN":e.ship.speed.y+=e.ship.speed.acc;break;case"SPACE":t.trigger("startShooting")}}),Engine.Input.on("keyup",function(r){if(n.ship===undefined)return;switch(r.key){case"ARROW_LEFT":e.ship.speed.x+=e.ship.speed.acc,n.ship.setImage(e.ship.assets.default);break;case"ARROW_RIGHT":e.ship.speed.x-=e.ship.speed.acc,n.ship.setImage(e.ship.assets.default);break;case"ARROW_UP":e.ship.speed.y+=e.ship.speed.acc;break;case"ARROW_DOWN":e.ship.speed.y-=e.ship.speed.acc;break;case"SPACE":t.trigger("stopShooting")}})},u}),require(["game","background","player","ui","asteroids","sounds"],function(e,t,n,r,i,s){function h(){s.pressButton.play(),n.init(),r.init(),i.init()}var o=document.querySelector(".start-screen"),u=document.querySelector(".ui"),a=document.querySelector(".end-screen"),f=document.querySelector(".start-game"),l=document.querySelector(".restart-game"),c=document.querySelector(".end-score");t.init(),f.addEventListener("click",function(){o.style.display="none",u.style.display="block",h()}),l.addEventListener("click",function(){u.style.display="block",a.style.display="none",h()}),e.on("gameover",function(){c.innerText=r.score,a.style.display="block",u.style.display="none"})}),define("main",function(){});