/**@license
* Solpeo Engine
* v1.0 pre3
* Copyright (c) 2009-2013 Solpeo sp. z o.o.
* http://www.solpeo.com
*
* License rights of Application is non-payable and non-exclusive license for
* indefinite period of time for use of Application on the territory of the
* whole world, solely for the purposes of internal usage of non-commercial
* character.
* Any download or installation or usage of Application is deemed acceptance
* of License Terms, which you can find under address
* http://cdn.solpeo.com/engine/solpeo_engine-1.0.pre3.license.txt
*
* If you are using the Application, you are obliged to:
* a) present in Application and/or Modification information about copyrights
* entitled to SOLPEO by showing the following text: All rights reserved
* SOLPEO 2013,
* (b) place on Modification the following communicate: "Provided by SOLPEO",
* which shall be placed on user's interface bar
* (c) define the company of Licensor under name SOLPEO, as a source of origin
* of Application being also a base for any Modification
* (d) disseminate SOLPEO's logo available under address
* http://cdn.solpeo.com/logo/logopack_v1.zip as a part of Application
* and/or Modification without introducing any changes, in
* particular concerning its form and/or content.
**/

var global=window;global.msgpack||(global.msgpack=function(){function e(t,n,r){var i,s,o;if(null==n)t.push(192);else if(!1===n)t.push(194);else if(!0===n)t.push(195);else switch(typeof n){case"number":n!==n?t.push(203,255,255,255,255,255,255,255,255):Infinity===n?t.push(203,127,240,0,0,0,0,0,0):Math.floor(n)===n?0>n?-32<=n?t.push(224+n+32):-128<n?t.push(208,n+256):-32768<n?(n+=65536,t.push(209,n>>8,n&255)):-2147483648<n?(n+=4294967296,t.push(210,n>>>24,n>>16&255,n>>8&255,n&255)):(s=Math.floor(n/4294967296),n&=4294967295,t.push(211,s>>24&255,s>>16&255,s>>8&255,s&255,n>>24&255,n>>16&255,n>>8&255,n&255)):128>n?t.push(n):256>n?t.push(204,n):65536>n?t.push(205,n>>8,n&255):4294967296>n?t.push(206,n>>>24,n>>16&255,n>>8&255,n&255):(s=Math.floor(n/4294967296),n&=4294967295,t.push(207,s>>24&255,s>>16&255,s>>8&255,s&255,n>>24&255,n>>16&255,n>>8&255,n&255)):((s=0>n)&&(n*=-1),o=Math.log(n)/.6931471805599453+1023|0,r=n*Math.pow(2,1075-o),n=r&4294967295,s&&(o|=2048),s=r/4294967296&1048575|o<<20,t.push(203,s>>24&255,s>>16&255,s>>8&255,s&255,n>>24&255,n>>16&255,n>>8&255,n&255));break;case"string":r=n.length,o=t.length,t.push(0);for(s=0;s<r;++s)i=n.charCodeAt(s),128>i?t.push(i&127):2048>i?t.push(i>>>6&31|192,i&63|128):65536>i&&t.push(i>>>12&15|224,i>>>6&63|128,i&63|128);i=t.length-o-1,32>i?t[o]=160+i:65536>i?t.splice(o,1,218,i>>8,i&255):4294967296>i&&t.splice(o,1,219,i>>>24,i>>16&255,i>>8&255,i&255);break;default:if(++r>=l)return u=1,[];if(a(n))for(i=n.length,16>i?t.push(144+i):65536>i?t.push(220,i>>8,i&255):4294967296>i&&t.push(221,i>>>24,i>>16&255,i>>8&255,i&255),s=0;s<i;++s)e(t,n[s],r);else{o=t.length,t.push(0),i=0;for(s in n)++i,e(t,s,r),e(t,n[s],r);16>i?t[o]=128+i:65536>i?t.splice(o,1,222,i>>8,i&255):4294967296>i&&t.splice(o,1,223,i>>>24,i>>16&255,i>>8&255,i&255)}}return t}function t(){var e,r,i,u=0,a,l,c=s;r=c[++o];if(224<=r)return r-256;if(192>r){if(128>r)return r;144>r?(u=r-128,r=128):160>r?(u=r-144,r=144):(u=r-160,r=160)}switch(r){case 192:return null;case 194:return!1;case 195:return!0;case 202:return u=16777216*c[++o]+(c[++o]<<16)+(c[++o]<<8)+c[++o],a=u>>23&255,l=u&8388607,u&&2147483648!==u?255===a?l?NaN:Infinity:(u&2147483648?-1:1)*(l|8388608)*Math.pow(2,a-127-23):0;case 203:u=16777216*c[++o]+(c[++o]<<16)+(c[++o]<<8)+c[++o],r=u&2147483648,a=u>>20&2047,l=u&1048575;if(!u||2147483648===u)return o+=4,0;if(2047===a)return o+=4,l?NaN:Infinity;return u=16777216*c[++o]+(c[++o]<<16)+(c[++o]<<8)+c[++o],(r?-1:1)*((l|1048576)*Math.pow(2,a-1023-20)+u*Math.pow(2,a-1023-52));case 207:return u=16777216*c[++o]+(c[++o]<<16)+(c[++o]<<8)+c[++o],4294967296*u+16777216*c[++o]+(c[++o]<<16)+(c[++o]<<8)+c[++o];case 206:u+=16777216*c[++o]+(c[++o]<<16);case 205:u+=c[++o]<<8;case 204:return u+c[++o];case 211:return u=c[++o],u&128?-1*(72057594037927940*(u^255)+281474976710656*(c[++o]^255)+1099511627776*(c[++o]^255)+4294967296*(c[++o]^255)+16777216*(c[++o]^255)+65536*(c[++o]^255)+256*(c[++o]^255)+(c[++o]^255)+1):72057594037927940*u+281474976710656*c[++o]+1099511627776*c[++o]+4294967296*c[++o]+16777216*c[++o]+65536*c[++o]+256*c[++o]+c[++o];case 210:return u=16777216*c[++o]+(c[++o]<<16)+(c[++o]<<8)+c[++o],2147483648>u?u:u-4294967296;case 209:return u=(c[++o]<<8)+c[++o],32768>u?u:u-65536;case 208:return u=c[++o],128>u?u:u-256;case 219:u+=16777216*c[++o]+(c[++o]<<16);case 218:u+=(c[++o]<<8)+c[++o];case 160:a=[],r=o;for(e=r+u;r<e;)i=c[++r],a.push(128>i?i:224>i?(i&31)<<6|c[++r]&63:(i&15)<<12|(c[++r]&63)<<6|c[++r]&63);return o=r,10240>a.length?f.apply(null,a):n(a);case 223:u+=16777216*c[++o]+(c[++o]<<16);case 222:u+=(c[++o]<<8)+c[++o];case 128:for(l={};u--;){e=c[++o]-160,a=[],r=o;for(e=r+e;r<e;)i=c[++r],a.push(128>i?i:224>i?(i&31)<<6|c[++r]&63:(i&15)<<12|(c[++r]&63)<<6|c[++r]&63);o=r,l[f.apply(null,a)]=t()}return l;case 221:u+=16777216*c[++o]+(c[++o]<<16);case 220:u+=(c[++o]<<8)+c[++o];case 144:for(a=[];u--;)a.push(t());return a}}function n(e){try{return f.apply(null,e)}catch(t){}for(var n=[],r=0,s=e.length,o=i;r<s;++r)n[r]=o[e[r]];return n.join("")}var r={},i={},s=[],o=0,u=0,a=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},f=String.fromCharCode,l=512;return function(){for(var e=0,t;256>e;++e)t=f(e),r[t]=e,i[e]=t;for(e=128;256>e;++e)r[f(63232+e)]=e}(),{pack:function(t,r){u=0;var i=e([],t,0);return u?!1:r?n(i):i},unpack:function(e){var n;if("string"==typeof e){n=[];var i=e.split(""),u=-1,a;a=i.length;for(e=a%8;e--;)++u,n[u]=r[i[u]];for(e=a>>3;e--;)n.push(r[i[++u]],r[i[++u]],r[i[++u]],r[i[++u]],r[i[++u]],r[i[++u]],r[i[++u]],r[i[++u]])}else n=e;return s=n,o=-1,t()}}}()),global.RTree=function(e){var t=3,n=6;isNaN(e)||(t=Math.floor(e/2),n=e);var r={x:0,y:0,w:0,h:0,id:"root",nodes:[]},i=function(){var e={};return function(t){var n=0;return t in e?n=e[t]++:e[t]=0,t+"_"+n}}();RTree.Rectangle.squarified_ratio=function(e,t,n){var r=(e+t)/2;return e*=t,e*n/(e/(r*r))};var s=function(e,n,r){var i=[],s=[],a=[];if(!e||!RTree.Rectangle.overlap_rectangle(e,r))return a;e={x:e.x,y:e.y,w:e.w,h:e.h,target:n},s.push(r.nodes.length),i.push(r);do if(r=i.pop(),n=s.pop()-1,"target"in e)for(;0<=n;){var f=r.nodes[n];if(RTree.Rectangle.overlap_rectangle(e,f)){if(e.target&&"leaf"in f&&f.leaf===e.target||!e.target&&("leaf"in f||RTree.Rectangle.contains_rectangle(f,e))){"nodes"in f?(a=o(f,!0,[],f),r.nodes.splice(n,1)):a=r.nodes.splice(n,1),RTree.Rectangle.make_MBR(r.nodes,r),delete e.target,r.nodes.length<t&&(e.nodes=o(r,!0,[],r));break}"nodes"in f&&(s.push(n),i.push(r),r=f,n=f.nodes.length)}n-=1}else if("nodes"in e){r.nodes.splice(n+1,1),0<r.nodes.length&&RTree.Rectangle.make_MBR(r.nodes,r);for(n=0;n<e.nodes.length;n++)u(e.nodes[n],r);e.nodes.length=0,0==i.length&&1>=r.nodes.length?(e.nodes=o(r,!0,e.nodes,r),r.nodes.length=0,i.push(r),s.push(1)):0<i.length&&r.nodes.length<t?(e.nodes=o(r,!0,e.nodes,r),r.nodes.length=0):delete e.nodes}else RTree.Rectangle.make_MBR(r.nodes,r);while(0<i.length);return a},o=function(e,t,n,r){var i=[];if(!RTree.Rectangle.overlap_rectangle(e,r))return n;i.push(r.nodes);do{r=i.pop();for(var s=r.length-1;0<=s;s--){var o=r[s];RTree.Rectangle.overlap_rectangle(e,o)&&("nodes"in o?i.push(o.nodes):"leaf"in o&&(t?n.push(o):n.push(o.leaf)))}}while(0<i.length);return n},u=function(e,r){var i;if(0==r.nodes.length)r.x=e.x,r.y=e.y,r.w=e.w,r.h=e.h,r.nodes.push(e);else{var s=-1,o=[],u;o.push(r);var f=r.nodes;do{-1!=s&&(o.push(f[s]),f=f[s].nodes,s=-1);for(var l=f.length-1;0<=l;l--){var c=f[l];if("leaf"in c){s=-1;break}var h=RTree.Rectangle.squarified_ratio(c.w,c.h,c.nodes.length+1),p=Math.max(c.x+c.w,e.x+e.w)-Math.min(c.x,e.x),d=Math.max(c.y+c.h,e.y+e.h)-Math.min(c.y,e.y),c=RTree.Rectangle.squarified_ratio(p,d,c.nodes.length+2);if(0>s||Math.abs(c-h)<u)u=Math.abs(c-h),s=l}}while(-1!=s);s=e;do{if(i&&"nodes"in i&&0==i.nodes.length){for(u=i,i=o.pop(),f=0;f<i.nodes.length;f++)if(i.nodes[f]===u||0==i.nodes[f].nodes.length){i.nodes.splice(f,1);break}}else i=o.pop();if("leaf"in s||"nodes"in s||"[object Array]"===Object.prototype.toString.call(s)){if("[object Array]"===Object.prototype.toString.call(s)){for(u=0;u<s.length;u++)RTree.Rectangle.expand_rectangle(i,s[u]);i.nodes=i.nodes.concat(s)}else RTree.Rectangle.expand_rectangle(i,s),i.nodes.push(s);if(i.nodes.length<=n)s={x:i.x,y:i.y,w:i.w,h:i.h};else{u=s=i.nodes,f=u.length-1,l=0,h=u.length-1,c=0,d=p=void 0;for(p=u.length-2;0<=p;p--)d=u[p],d.x>u[l].x?l=p:d.x+d.w<u[f].x+u[f].w&&(f=p),d.y>u[c].y?c=p:d.y+d.h<u[h].y+u[h].h&&(h=p);p=Math.abs(u[f].x+u[f].w-u[l].x),d=Math.abs(u[h].y+u[h].h-u[c].y),p>d?f>l?(p=u.splice(f,1)[0],d=u.splice(l,1)[0]):(d=u.splice(l,1)[0],p=u.splice(f,1)[0]):h>c?(p=u.splice(h,1)[0],d=u.splice(c,1)[0]):(d=u.splice(c,1)[0],p=u.splice(h,1)[0]);for(u=[{x:p.x,y:p.y,w:p.w,h:p.h,nodes:[p]},{x:d.x,y:d.y,w:d.w,h:d.h,nodes:[d]}];0<s.length;){for(var f=s,l=u[0],h=u[1],p=RTree.Rectangle.squarified_ratio(l.w,l.h,l.nodes.length+1),d=RTree.Rectangle.squarified_ratio(h.w,h.h,h.nodes.length+1),v=void 0,m=void 0,c=void 0,g=f.length-1;0<=g;g--){var y=f[g],b,w;b=Math.min(l.x,y.x),w=Math.min(l.y,y.y),b=Math.max(l.x+l.w,y.x+y.w)-b,w=Math.max(l.y+l.h,y.y+y.h)-w,w=Math.abs(RTree.Rectangle.squarified_ratio(b,w,l.nodes.length+2)-p);var E;E=Math.min(h.x,y.x),b=Math.min(h.y,y.y),E=Math.max(h.x+h.w,y.x+y.w)-E,y=Math.max(h.y+h.h,y.y+y.h)-b,y=Math.abs(RTree.Rectangle.squarified_ratio(E,y,h.nodes.length+2)-d);if(!m||!v||Math.abs(y-w)<v)m=g,v=Math.abs(y-w),c=y<w?h:l}p=f.splice(m,1)[0],l.nodes.length+f.length+1<=t?(l.nodes.push(p),RTree.Rectangle.expand_rectangle(l,p)):h.nodes.length+f.length+1<=t?(h.nodes.push(p),RTree.Rectangle.expand_rectangle(h,p)):(c.nodes.push(p),RTree.Rectangle.expand_rectangle(c,p))}s=u,1>o.length&&(i.nodes.push(u[0]),o.push(i),s=u[1])}}else RTree.Rectangle.expand_rectangle(i,s),s={x:i.x,y:i.y,w:i.w,h:i.h}}while(0<o.length)}};this.get_tree=function(){return r},this.set_tree=function(e,t){t||(t=r);var n=t;return n.nodes=e.nodes,n.x=e.x,n.y=e.y,n.w=e.w,n.h=e.h,n},this.search=function(e,t,n){if(1>arguments.length)throw"Wrong number of arguments. RT.Search requires at least a bounding rectangle.";switch(arguments.length){case 1:arguments[1]=!1;case 2:arguments[2]=[];case 3:arguments[3]=r;default:arguments.length=4}return o.apply(this,arguments)},this.toJSON=function(e,t){var n=[],s=[],o={},u=3,a=1,f="";if(e&&!RTree.Rectangle.overlap_rectangle(e,r))return"";t?(u+=4,s.push(t.nodes.length),n.push(t.nodes),f+="var main_tree = {x:"+t.x.toFixed()+",y:"+t.y.toFixed()+",w:"+t.w.toFixed()+",h:"+t.h.toFixed()+",nodes:["):(s.push(r.nodes.length),n.push(r.nodes),f+="var main_tree = {x:"+r.x.toFixed()+",y:"+r.y.toFixed()+",w:"+r.w.toFixed()+",h:"+r.h.toFixed()+",nodes:[");do{var l=n.pop(),c=s.pop()-1;for(0<=c&&c<l.length-1&&(f+=",");0<=c;){var h=l[c];if(!e||RTree.Rectangle.overlap_rectangle(e,h))if(h.nodes)if(a>=u){var p=i("saved_subtree"),f=f+("{x:"+h.x.toFixed()+",y:"+h.y.toFixed()+",w:"+h.w.toFixed()+",h:"+h.h.toFixed()+",load:'"+p+".js'}");o[p]=this.toJSON(e,h),0<c&&(f+=",")}else f+="{x:"+h.x.toFixed()+",y:"+h.y.toFixed()+",w:"+h.w.toFixed()+",h:"+h.h.toFixed()+",nodes:[",a+=1,s.push(c),n.push(l),l=h.nodes,c=h.nodes.length;else h.leaf?(p=h.leaf.toJSON?h.leaf.toJSON():JSON.stringify(h.leaf),f+="{x:"+h.x.toFixed()+",y:"+h.y.toFixed()+",w:"+h.w.toFixed()+",h:"+h.h.toFixed()+",leaf:"+p+"}",0<c&&(f+=",")):h.load&&(f+="{x:"+h.x.toFixed()+",y:"+h.y.toFixed()+",w:"+h.w.toFixed()+",h:"+h.h.toFixed()+",load:'"+h.load+"'}",0<c&&(f+=","));c-=1}0>c&&(f+="]}",a-=1)}while(0<n.length);var f=f+";",d;for(d in o)f+="\nvar "+d+" = function(){"+o[d]+" return(main_tree);};";return f},this.remove=function(e,t){if(1>arguments.length)throw"Wrong number of arguments. RT.remove requires at least a bounding rectangle.";switch(arguments.length){case 1:arguments[1]=!1;case 2:arguments[2]=r;default:arguments.length=3}if(!1===arguments[1]){var n=0,i=[];do n=i.length,i=i.concat(s.apply(this,arguments));while(n!=i.length);return i}return s.apply(this,arguments)},this.insert=function(e,t){if(2>arguments.length)throw"Wrong number of arguments. RT.Insert requires at least a bounding rectangle and an object.";return u({x:e.x,y:e.y,w:e.w,h:e.h,leaf:t},r)}},RTree.Rectangle=function(e,t,n,r){var i,s,o,u,a,f;e.x?(i=e.x,o=e.y,0!==e.w&&!e.w&&e.x2?(a=e.x2-e.x,f=e.y2-e.y):(a=e.w,f=e.h)):(i=e,o=t,a=n,f=r),s=i+a,u=o+f,this.x1=this.x=function(){return i},this.y1=this.y=function(){return o},this.x2=function(){return s},this.y2=function(){return u},this.w=function(){return a},this.h=function(){return f},this.toJSON=function(){return'{"x":'+i.toString()+', "y":'+o.toString()+', "w":'+a.toString()+', "h":'+f.toString()+"}"},this.overlap=function(e){return this.x()<e.x2()&&this.x2()>e.x()&&this.y()<e.y2()&&this.y2()>e.y()},this.expand=function(e){var t=Math.min(this.x(),e.x()),n=Math.min(this.y(),e.y());return a=Math.max(this.x2(),e.x2())-t,f=Math.max(this.y2(),e.y2())-n,i=t,o=n,this},this.setRect=function(e,t,n,r){}},RTree.Rectangle.overlap_rectangle=function(e,t){return e.x<t.x+t.w&&e.x+e.w>t.x&&e.y<t.y+t.h&&e.y+e.h>t.y},RTree.Rectangle.contains_rectangle=function(e,t){return e.x+e.w<=t.x+t.w&&e.x>=t.x&&e.y+e.h<=t.y+t.h&&e.y>=t.y},RTree.Rectangle.expand_rectangle=function(e,t){var n=Math.min(e.x,t.x),r=Math.min(e.y,t.y);return e.w=Math.max(e.x+e.w,t.x+t.w)-n,e.h=Math.max(e.y+e.h,t.y+t.h)-r,e.x=n,e.y=r,e},RTree.Rectangle.make_MBR=function(e,t){if(1>e.length)return{x:0,y:0,w:0,h:0};t?t.x=e[0].x:t={x:e[0].x,y:e[0].y,w:e[0].w,h:e[0].h},t.y=e[0].y,t.w=e[0].w,t.h=e[0].h;for(var n=e.length-1;0<n;n--)RTree.Rectangle.expand_rectangle(t,e[n]);return t};var JSON;JSON||(JSON={}),function(){function h(t,n){var r,i,s,o,u=q,a,f=n[t];f&&"object"==typeof f&&"function"==typeof f.toJSON&&(f=f.toJSON(t)),"function"==typeof y&&(f=y.call(n,t,f));switch(typeof f){case"string":return k(f);case"number":return isFinite(f)?String(f):"null";case"boolean":case"null":return String(f);case"object":if(!f)return"null";q+=e,a=[];if("[object Array]"===Object.prototype.toString.apply(f)){o=f.length;for(r=0;r<o;r+=1)a[r]=h(r,f)||"null";return s=0===a.length?"[]":q?"[\n"+q+a.join(",\n"+q)+"\n"+u+"]":"["+a.join(",")+"]",q=u,s}if(y&&"object"==typeof y)for(o=y.length,r=0;r<o;r+=1)"string"==typeof y[r]&&(i=y[r],s=h(i,f),s&&a.push(k(i)+(q?": ":":")+s));else for(i in f)Object.prototype.hasOwnProperty.call(f,i)&&(s=h(i,f),s&&a.push(k(i)+(q?": ":":")+s));return s=0===a.length?"{}":q?"{\n"+q+a.join(",\n"+q)+"\n"+u+"}":"{"+a.join(",")+"}",q=u,s}}function k(e){return v.lastIndex=0,v.test(e)?'"'+e.replace(v,function(e){var t=z[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function a(e){return 10>e?"0"+e:e}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var t=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,v=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,q,e,z={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},y;"function"!=typeof JSON.stringify&&(JSON.stringify=function(t,n,r){var i;e=q="";if("number"==typeof r)for(i=0;i<r;i+=1)e+=" ";else"string"==typeof r&&(e=r);y=n;if(!n||"function"==typeof n||"object"==typeof n&&"number"==typeof n.length)return h("",{"":t});throw Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(JSON.parse=function(a,e){function h(t,n){var r,i,s=t[n];if(s&&"object"==typeof s)for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i=h(s,r),void 0!==i?s[r]=i:delete s[r]);return e.call(t,n,s)}var d;a=String(a),t.lastIndex=0,t.test(a)&&(a=a.replace(t,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return d=eval("("+a+")"),"function"==typeof e?h({"":d},""):d;throw new SyntaxError("JSON.parse")})}(),SockJS=function(){var e=document,t=window,n={},r=function(){};r.prototype.addEventListener=function(e,t){this._listeners||(this._listeners={}),e in this._listeners||(this._listeners[e]=[]);var r=this._listeners[e];-1===n.arrIndexOf(r,t)&&r.push(t)},r.prototype.removeEventListener=function(e,t){if(this._listeners&&e in this._listeners){var r=this._listeners[e],i=n.arrIndexOf(r,t);-1!==i&&(1<r.length?this._listeners[e]=r.slice(0,i).concat(r.slice(i+1)):delete this._listeners[e])}},r.prototype.dispatchEvent=function(e){var t=e.type,n=Array.prototype.slice.call(arguments,0);this["on"+t]&&this["on"+t].apply(this,n);if(this._listeners&&t in this._listeners)for(var r=0;r<this._listeners[t].length;r++)this._listeners[t][r].apply(this,n)};var i=function(e,t){this.type=e;if("undefined"!=typeof t)for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n])};i.prototype.toString=function(){var e=[],t;for(t in this)if(this.hasOwnProperty(t)){var n=this[t];"function"==typeof n&&(n="[function]"),e.push(t+"="+n)}return"SimpleEvent("+e.join(", ")+")"};var s=function(e){this.events=e||[]};s.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1);!this.nuked&&this["on"+e]&&this["on"+e].apply(this,t),-1===n.arrIndexOf(this.events,e)&&n.log("Event "+JSON.stringify(e)+" not listed "+JSON.stringify(this.events)+" in "+this)},s.prototype.nuke=function(e){this.nuked=!0;for(e=0;e<this.events.length;e++)delete this[this.events[e]]},n.random_string=function(e,t){t=t||37;var n,r=[];for(n=0;n<e;n++)r.push("abcdefghijklmnopqrstuvwxyz0123456789_".substr(Math.floor(Math.random()*t),1));return r.join("")},n.random_number=function(e){return Math.floor(Math.random()*e)},n.random_number_string=function(e){var t=(""+(e-1)).length;return(Array(t+1).join("0")+n.random_number(e)).slice(-t)},n.getOrigin=function(e){return(e+"/").split("/").slice(0,3).join("/")},n.isSameOriginUrl=function(e,n){return n||(n=t.location.href),e.split("/").slice(0,3).join("/")===n.split("/").slice(0,3).join("/")},n.getParentDomain=function(e){return/^[0-9.]*$/.test(e)||/^\[/.test(e)||!/[.]/.test(e)?e:e.split(".").slice(1).join(".")},n.objectExtend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},n.polluteGlobalNamespace=function(){"_jp"in t||(t._jp={})},n.closeFrame=function(e,t){return"c"+JSON.stringify([e,t])},n.userSetCode=function(e){return 1e3===e||3e3<=e&&4999>=e},n.countRTO=function(e){var t;return 100<e?t=3*e:t=e+200,t},n.log=function(){t.console&&console.log&&console.log.apply&&console.log.apply(console,arguments)},n.bind=function(e,t){return e.bind?e.bind(t):function(){return e.apply(t,arguments)}},n.flatUrl=function(e){return-1===e.indexOf("?")&&-1===e.indexOf("#")},n.amendUrl=function(t){var r=e.location;if(!t)throw Error("Wrong url for SockJS");if(!n.flatUrl(t))throw Error("Only basic urls are supported in SockJS");return 0===t.indexOf("//")&&(t=r.protocol+t),0===t.indexOf("/")&&(t=r.protocol+"//"+r.host+t),t=t.replace(/[/]+$/,""),t},n.arrIndexOf=function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1},n.arrSkip=function(e,t){var r=n.arrIndexOf(e,t);return-1===r?e.slice():e.slice(0,r).concat(e.slice(r+1))},n.isArray=Array.isArray||function(e){return 0<={}.toString.call(e).indexOf("Array")},n.delay=function(e,t){return"function"==typeof e&&(t=e,e=0),setTimeout(t,e)};var o=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,u={"\0":"\\u0000","":"\\u0001","":"\\u0002","":"\\u0003","":"\\u0004","":"\\u0005","":"\\u0006","":"\\u0007","\b":"\\b","	":"\\t","\n":"\\n","":"\\u000b","\f":"\\f","\r":"\\r","":"\\u000e","":"\\u000f","":"\\u0010","":"\\u0011","":"\\u0012","":"\\u0013","":"\\u0014","":"\\u0015","":"\\u0016","":"\\u0017","":"\\u0018","":"\\u0019","":"\\u001a","":"\\u001b","":"\\u001c","":"\\u001d","":"\\u001e","":"\\u001f",'"':'\\"',"\\":"\\\\","":"\\u007f","":"\\u0080","":"\\u0081","":"\\u0082","":"\\u0083","":"\\u0084","":"\\u0085","":"\\u0086","":"\\u0087","":"\\u0088","":"\\u0089","":"\\u008a","":"\\u008b","":"\\u008c","":"\\u008d","":"\\u008e","":"\\u008f","":"\\u0090","":"\\u0091","":"\\u0092","":"\\u0093","":"\\u0094","":"\\u0095","":"\\u0096","":"\\u0097","":"\\u0098","":"\\u0099","":"\\u009a","":"\\u009b","":"\\u009c","":"\\u009d","":"\\u009e","":"\\u009f","­":"\\u00ad","؀":"\\u0600","؁":"\\u0601","؂":"\\u0602","؃":"\\u0603","؄":"\\u0604","܏":"\\u070f","឴":"\\u17b4","឵":"\\u17b5","‌":"\\u200c","‍":"\\u200d","‎":"\\u200e","‏":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","‪":"\\u202a","‫":"\\u202b","‬":"\\u202c","‭":"\\u202d","‮":"\\u202e"," ":"\\u202f","⁠":"\\u2060","⁡":"\\u2061","⁢":"\\u2062","⁣":"\\u2063","⁤":"\\u2064","⁥":"\\u2065","⁦":"\\u2066","⁧":"\\u2067","⁨":"\\u2068","⁩":"\\u2069","⁪":"\\u206a","⁫":"\\u206b","⁬":"\\u206c","⁭":"\\u206d","⁮":"\\u206e","⁯":"\\u206f","﻿":"\\ufeff","￰":"\\ufff0","￱":"\\ufff1","￲":"\\ufff2","￳":"\\ufff3","￴":"\\ufff4","￵":"\\ufff5","￶":"\\ufff6","￷":"\\ufff7","￸":"\\ufff8","￹":"\\ufff9","￺":"\\ufffa","￻":"\\ufffb","￼":"\\ufffc","�":"\\ufffd","￾":"\\ufffe","￿":"\\uffff"},a=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,f,l=JSON&&JSON.stringify||function(e){return o.lastIndex=0,o.test(e)&&(e=e.replace(o,function(e){return u[e]})),'"'+e+'"'},c=function(e){var t,n={},r=[];for(t=0;65536>t;t++)r.push(String.fromCharCode(t));return e.lastIndex=0,r.join("").replace(e,function(e){return n[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4),""}),e.lastIndex=0,n};n.quote=function(e){return e=l(e),a.lastIndex=0,a.test(e)?(f||(f=c(a)),e.replace(a,function(e){return f[e]})):e};var h="websocket xdr-streaming xhr-streaming iframe-eventsource iframe-htmlfile xdr-polling xhr-polling iframe-xhr-polling jsonp-polling".split(" ");n.probeProtocols=function(){for(var e={},t=0;t<h.length;t++){var n=h[t];e[n]=g[n]&&g[n].enabled()}return e},n.detectProtocols=function(e,t,n){var r={},i=[];t||(t=h);for(var s=0;s<t.length;s++){var o=t[s];r[o]=e[o]}var u=function(e){var t=e.shift();r[t]?i.push(t):0<e.length&&u(e)};return!1!==n.websocket&&u(["websocket"]),r["xhr-streaming"]&&!n.null_origin?i.push("xhr-streaming"):!r["xdr-streaming"]||n.cookie_needed||n.null_origin?u(["iframe-eventsource","iframe-htmlfile"]):i.push("xdr-streaming"),r["xhr-polling"]&&!n.null_origin?i.push("xhr-polling"):!r["xdr-polling"]||n.cookie_needed||n.null_origin?u(["iframe-xhr-polling","jsonp-polling"]):i.push("xdr-polling"),i},n.createHook=function(){var e="a"+n.random_string(8);if(!("_sockjs_global"in t)){var r={};t._sockjs_global=function(e){return e in r||(r[e]={id:e,del:function(){delete r[e]}}),r[e]}}return t._sockjs_global(e)},n.attachMessage=function(e){n.attachEvent("message",e)},n.attachEvent=function(n,r){"undefined"!=typeof t.addEventListener?t.addEventListener(n,r,!1):(e.attachEvent("on"+n,r),t.attachEvent("on"+n,r))},n.detachMessage=function(e){n.detachEvent("message",e)},n.detachEvent=function(n,r){"undefined"!=typeof t.addEventListener?t.removeEventListener(n,r,!1):(e.detachEvent("on"+n,r),t.detachEvent("on"+n,r))};var p={},d=!1,v=function(){for(var e in p)p[e](),delete p[e]},m=function(){d||(d=!0,v())};n.attachEvent("beforeunload",m),n.attachEvent("unload",m),n.unload_add=function(e){var t=n.random_string(8);return p[t]=e,d&&n.delay(v),t},n.unload_del=function(e){e in p&&delete p[e]},n.createIframe=function(t,r){var i=e.createElement("iframe"),s,o,u=function(){clearTimeout(s);try{i.onload=null}catch(e){}i.onerror=null},a=function(){i&&(u(),setTimeout(function(){i&&i.parentNode.removeChild(i),i=null},0),n.unload_del(o))};return i.src=t,i.style.display="none",i.style.position="absolute",i.onerror=function(){i&&(a(),r("onerror"))},i.onload=function(){clearTimeout(s),s=setTimeout(function(){i&&(a(),r("onload timeout"))},2e3)},e.body.appendChild(i),s=setTimeout(function(){i&&(a(),r("timeout"))},15e3),o=n.unload_add(a),{post:function(e,t){try{i&&i.contentWindow&&i.contentWindow.postMessage(e,t)}catch(n){}},cleanup:a,loaded:u}},n.createHtmlfile=function(e,r){var i=new ActiveXObject("htmlfile"),s,o,u,a=function(){clearTimeout(s)},f=function(){i&&(a(),n.unload_del(o),u.parentNode.removeChild(u),u=i=null,CollectGarbage())};i.open(),i.write('<html><script>document.domain="'+document.domain+'";</script></html>'),i.close(),i.parentWindow._jp=t._jp;var l=i.createElement("div");return i.body.appendChild(l),u=i.createElement("iframe"),l.appendChild(u),u.src=e,s=setTimeout(function(){i&&(f(),r("timeout"))},15e3),o=n.unload_add(f),{post:function(e,t){try{u&&u.contentWindow&&u.contentWindow.postMessage(e,t)}catch(n){}},cleanup:f,loaded:a}},m=function(){},m.prototype=new s(["chunk","finish"]),m.prototype._start=function(e,r,i,s){var o=this;try{o.xhr=new XMLHttpRequest}catch(u){}if(!o.xhr)try{o.xhr=new t.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}if(t.ActiveXObject||t.XDomainRequest)r+=(-1===r.indexOf("?")?"?":"&")+"t="+ +(new Date);o.unload_ref=n.unload_add(function(){o._cleanup(!0)});try{o.xhr.open(e,r,!0)}catch(f){o.emit("finish",0,""),o._cleanup();return}s&&s.no_credentials||(o.xhr.withCredentials="true");if(s&&s.headers)for(var l in s.headers)o.xhr.setRequestHeader(l,s.headers[l]);o.xhr.onreadystatechange=function(){if(o.xhr){var e=o.xhr;switch(e.readyState){case 3:try{var t=e.status,n=e.responseText}catch(r){}n&&0<n.length&&o.emit("chunk",t,n);break;case 4:o.emit("finish",e.status,e.responseText),o._cleanup(!1)}}},o.xhr.send(i)},m.prototype._cleanup=function(e){if(this.xhr){n.unload_del(this.unload_ref),this.xhr.onreadystatechange=function(){};if(e)try{this.xhr.abort()}catch(t){}this.unload_ref=this.xhr=null}},m.prototype.close=function(){this.nuke(),this._cleanup(!0)},(n.XHRCorsObject=function(){var e=this,t=arguments;n.delay(function(){e._start.apply(e,t)})}).prototype=new m,(n.XHRLocalObject=function(e,t,r){var i=this;n.delay(function(){i._start(e,t,r,{no_credentials:!0})})}).prototype=new m,m=n.XDRObject=function(e,t,r){var i=this;n.delay(function(){i._start(e,t,r)})},m.prototype=new s(["chunk","finish"]),m.prototype._start=function(e,t,r){var i=this,s=new XDomainRequest;t+=(-1===t.indexOf("?")?"?":"&")+"t="+ +(new Date);var o=s.ontimeout=s.onerror=function(){i.emit("finish",0,""),i._cleanup(!1)};s.onprogress=function(){i.emit("chunk",200,s.responseText)},s.onload=function(){i.emit("finish",200,s.responseText),i._cleanup(!1)},i.xdr=s,i.unload_ref=n.unload_add(function(){i._cleanup(!0)});try{i.xdr.open(e,t),i.xdr.send(r)}catch(u){o()}},m.prototype._cleanup=function(e){if(this.xdr){n.unload_del(this.unload_ref),this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null;if(e)try{this.xdr.abort()}catch(t){}this.unload_ref=this.xdr=null}},m.prototype.close=function(){this.nuke(),this._cleanup(!0)},n.isXHRCorsCapable=function(){return t.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:t.XDomainRequest&&e.domain?2:N.enabled()?3:4};var g=function(e,t,r){var i=this,s;i._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0},r&&n.objectExtend(i._options,r),i._base_url=n.amendUrl(e),i._server=i._options.server||n.random_number_string(1e3),i._options.protocols_whitelist&&i._options.protocols_whitelist.length?s=i._options.protocols_whitelist:("string"==typeof t&&0<t.length?s=[t]:n.isArray(t)?s=t:s=null,s&&i._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.')),i._protocols=[],i.protocol=null,i.readyState=g.CONNECTING,i._ir=_(i._base_url),i._ir.onfinish=function(e,t){i._ir=null,e?(i._options.info&&(e=n.objectExtend(e,i._options.info)),i._options.rtt&&(t=i._options.rtt),i._applyInfo(e,t,s),i._didClose()):i._didClose(1002,"Can't connect to server",!0)}};g.prototype=new r,g.version="0.3.1",g.CONNECTING=0,g.OPEN=1,g.CLOSING=2,g.CLOSED=3,g.prototype._debug=function(){this._options.debug&&n.log.apply(n,arguments)},g.prototype._dispatchOpen=function(){this.readyState===g.CONNECTING?(this._transport_tref&&(clearTimeout(this._transport_tref),this._transport_tref=null),this.readyState=g.OPEN,this.dispatchEvent(new i("open"))):this._didClose(1006,"Server lost session")},g.prototype._dispatchMessage=function(e){this.readyState===g.OPEN&&this.dispatchEvent(new i("message",{data:e}))},g.prototype._dispatchHeartbeat=function(e){this.readyState===g.OPEN&&this.dispatchEvent(new i("heartbeat",{}))},g.prototype._didClose=function(e,t,r){var s=this;if(s.readyState!==g.CONNECTING&&s.readyState!==g.OPEN&&s.readyState!==g.CLOSING)throw Error("INVALID_STATE_ERR");s._ir&&(s._ir.nuke(),s._ir=null),s._transport&&(s._transport.doCleanup(),s._transport=null);var o=new i("close",{code:e,reason:t,wasClean:n.userSetCode(e)});if(!n.userSetCode(e)&&s.readyState===g.CONNECTING&&!r){if(s._try_next_protocol(o))return;o=new i("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:o})}s.readyState=g.CLOSED,n.delay(function(){s.dispatchEvent(o)})},g.prototype._didMessage=function(e){switch(e.slice(0,1)){case"o":this._dispatchOpen();break;case"a":e=JSON.parse(e.slice(1)||"[]");for(var t=0;t<e.length;t++)this._dispatchMessage(e[t]);break;case"m":e=JSON.parse(e.slice(1)||"null"),this._dispatchMessage(e);break;case"c":e=JSON.parse(e.slice(1)||"[]"),this._didClose(e[0],e[1]);break;case"h":this._dispatchHeartbeat()}},g.prototype._try_next_protocol=function(t){var r=this;r.protocol&&(r._debug("Closed transport:",r.protocol,""+t),r.protocol=null);for(r._transport_tref&&(clearTimeout(r._transport_tref),r._transport_tref=null);;){t=r.protocol=r._protocols.shift();if(!t)return!1;if(g[t]&&!0===g[t].need_body&&(!e.body||"undefined"!=typeof e.readyState&&"complete"!==e.readyState))return r._protocols.unshift(t),r.protocol="waiting-for-load",n.attachEvent("load",function(){r._try_next_protocol()}),!0;if(g[t]&&g[t].enabled(r._options)){r._transport_tref=n.delay((r._options.rto||0)*(g[t].roundTrips||1)||5e3,function(){r.readyState===g.CONNECTING&&r._didClose(2007,"Transport timeouted")});var i=n.random_string(8),i=r._base_url+"/"+r._server+"/"+i;return r._debug("Opening transport:",t," url:"+i," RTO:"+r._options.rto),r._transport=new g[t](r,i,r._base_url),!0}r._debug("Skipping transport:",t)}},g.prototype.close=function(e,t){if(e&&!n.userSetCode(e))throw Error("INVALID_ACCESS_ERR");return this.readyState!==g.CONNECTING&&this.readyState!==g.OPEN?!1:(this.readyState=g.CLOSING,this._didClose(e||1e3,t||"Normal closure"),!0)},g.prototype.send=function(e){if(this.readyState===g.CONNECTING)throw Error("INVALID_STATE_ERR");return this.readyState===g.OPEN&&this._transport.doSend(n.quote(""+e)),!0},g.prototype._applyInfo=function(t,r,i){this._options.info=t,this._options.rtt=r,this._options.rto=n.countRTO(r),this._options.info.null_origin=!e.domain,r=n.probeProtocols(),this._protocols=n.detectProtocols(r,i,t)},m=g.websocket=function(e,r){var i=this,s=r+"/websocket";"https"===s.slice(0,5)?s="wss"+s.slice(5):s="ws"+s.slice(4),i.ri=e,i.url=s,i.ws=new(t.WebSocket||t.MozWebSocket)(i.url),i.ws.onmessage=function(e){i.ri._didMessage(e.data)},i.unload_ref=n.unload_add(function(){i.ws.close()}),i.ws.onclose=function(){i.ri._didMessage(n.closeFrame(1006,"WebSocket connection broken"))}},m.prototype.doSend=function(e){this.ws.send("["+e+"]")},m.prototype.doCleanup=function(){var e=this.ws;e&&(e.onmessage=e.onclose=null,e.close(),n.unload_del(this.unload_ref),this.unload_ref=this.ri=this.ws=null)},m.enabled=function(){return!!t.WebSocket||!!t.MozWebSocket},m.roundTrips=2;var y=function(){};y.prototype.send_constructor=function(e){this.send_buffer=[],this.sender=e},y.prototype.doSend=function(e){this.send_buffer.push(e),this.send_stop||this.send_schedule()},y.prototype.send_schedule_wait=function(){var e=this,t;e.send_stop=function(){e.send_stop=null,clearTimeout(t)},t=n.delay(25,function(){e.send_stop=null,e.send_schedule()})},y.prototype.send_schedule=function(){var e=this;if(0<e.send_buffer.length){var t="["+e.send_buffer.join(",")+"]";e.send_stop=e.sender(e.trans_url,t,function(){e.send_stop=null,e.send_schedule_wait()}),e.send_buffer=[]}},y.prototype.send_destructor=function(){this._send_stop&&this._send_stop(),this._send_stop=null};var b=function(t,r,i){if(!("_send_form"in this)){var s=this._send_form=e.createElement("form"),o=this._send_area=e.createElement("textarea");o.name="d",s.style.display="none",s.style.position="absolute",s.method="POST",s.enctype="application/x-www-form-urlencoded",s.acceptCharset="UTF-8",s.appendChild(o),e.body.appendChild(s)}var s=this._send_form,o=this._send_area,u="a"+n.random_string(8);s.target=u,s.action=t+"/jsonp_send?i="+u;var a;try{a=e.createElement('<iframe name="'+u+'">')}catch(f){a=e.createElement("iframe"),a.name=u}a.id=u,s.appendChild(a),a.style.display="none";try{o.value=r}catch(l){n.log("Your browser is seriously broken. Go home! "+l.message)}s.submit();var c=function(e){a.onerror&&(a.onreadystatechange=a.onerror=a.onload=null,n.delay(500,function(){a.parentNode.removeChild(a),a=null}),o.value="",i())};return a.onerror=a.onload=c,a.onreadystatechange=function(e){"complete"==a.readyState&&c()},c},w=function(e){return function(t,n,r){return(new e("POST",t+"/xhr_send",n)).onfinish=function(e,t){r(e)},function(e){r(0,e)}}},E=function(t,r){var i,s=e.createElement("script"),o,u=function(e){o&&(o.parentNode.removeChild(o),o=null),s&&(clearTimeout(i),s.parentNode.removeChild(s),s.onreadystatechange=s.onerror=s.onload=s.onclick=null,s=null,r(e),r=null)},a=!1,f=null;s.id="a"+n.random_string(8),s.src=t,s.type="text/javascript",s.charset="UTF-8",s.onerror=function(e){f||(f=setTimeout(function(){a||u(n.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},s.onload=function(e){u(n.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},s.onreadystatechange=function(e){if(/loaded|closed/.test(s.readyState)){if(s&&s.htmlFor&&s.onclick){a=!0;try{s.onclick()}catch(t){}}s&&u(n.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}};if("undefined"==typeof s.async&&e.attachEvent)if(/opera/i.test(navigator.userAgent))o=e.createElement("script"),o.text="try{var a = document.getElementById('"+s.id+"'); if(a)a.onerror();}catch(x){};",s.async=o.async=!1;else{try{s.htmlFor=s.id,s.event="onclick"}catch(l){}s.async=!0}"undefined"!=typeof s.async&&(s.async=!0),i=setTimeout(function(){u(n.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var c=e.getElementsByTagName("head")[0];return c.insertBefore(s,c.firstChild),o&&c.insertBefore(o,c.firstChild),u},m=g["jsonp-polling"]=function(e,t){n.polluteGlobalNamespace(),this.ri=e,this.trans_url=t,this.send_constructor(b),this._schedule_recv()};m.prototype=new y,m.prototype._schedule_recv=function(){var e=this;e._recv_stop=S(e.trans_url+"/jsonp",E,function(t){e._recv_stop=null,t&&(e._is_closing||e.ri._didMessage(t)),e._is_closing||e._schedule_recv()})},m.enabled=function(){return!0},m.need_body=!0,m.prototype.doCleanup=function(){this._is_closing=!0,this._recv_stop&&this._recv_stop(),this.ri=this._recv_stop=null,this.send_destructor()};var S=function(e,r,i){var s="a"+n.random_string(6);return e=e+"?c="+escape("_jp."+s),r=r(e,function(e){delete t._jp[s],i(e)}),t._jp[s]=r,function(){t._jp[s]&&t._jp[s](n.closeFrame(1e3,"JSONP user aborted read"))}},m=function(){};m.prototype=new y,m.prototype.run=function(e,t,n,r,i){this.ri=e,this.trans_url=t,this.send_constructor(w(i)),this.poll=new D(e,r,t+n,i)},m.prototype.doCleanup=function(){this.poll&&(this.poll.abort(),this.poll=null)};var x=g["xhr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",j,n.XHRCorsObject)};x.prototype=new m,x.enabled=function(){return t.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},x.roundTrips=2,x.need_body=!0,y=g["xdr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",j,n.XDRObject)},y.prototype=new m,y.enabled=function(){return!!t.XDomainRequest},y.roundTrips=2;var T=g["xhr-polling"]=function(e,t){this.run(e,t,"/xhr",j,n.XHRCorsObject)};T.prototype=new m,T.enabled=x.enabled,T.roundTrips=2,x=g["xdr-polling"]=function(e,t){this.run(e,t,"/xhr",j,n.XDRObject)},x.prototype=new m,x.enabled=y.enabled,x.roundTrips=2;var N=function(){};N.prototype.i_constructor=function(e,t,r){var i=this;i.ri=e,i.origin=n.getOrigin(r),i.base_url=r,i.trans_url=t,e=r+"/iframe.html",i.ri._options.devel&&(e+="?t="+ +(new Date)),i.window_id=n.random_string(8),e+="#"+i.window_id,i.iframeObj=n.createIframe(e,function(e){i.ri._didClose(1006,"Unable to load an iframe ("+e+")")}),i.onmessage_cb=n.bind(i.onmessage,i),n.attachMessage(i.onmessage_cb)},N.prototype.doCleanup=function(){if(this.iframeObj){n.detachMessage(this.onmessage_cb);try{this.iframeObj.iframe.contentWindow&&this.postMessage("c")}catch(e){}this.iframeObj.cleanup(),this.onmessage_cb=this.iframeObj=this.iframeObj=null}},N.prototype.onmessage=function(e){if(e.origin===this.origin){var t=e.data.slice(0,8),n=e.data.slice(8,9);e=e.data.slice(9);if(t===this.window_id)switch(n){case"s":this.iframeObj.loaded(),this.postMessage("s",JSON.stringify([g.version,this.protocol,this.trans_url,this.base_url]));break;case"t":this.ri._didMessage(e)}}},N.prototype.postMessage=function(e,t){this.iframeObj.post(this.window_id+e+(t||""),this.origin)},N.prototype.doSend=function(e){this.postMessage("m",e)},N.enabled=function(){var e=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof t.postMessage||"object"==typeof t.postMessage)&&!e};var C,k=function(e,r){parent!==t?parent.postMessage(C+e+(r||""),"*"):n.log("Can't postMessage, no parent window.",e,r)},L=function(){};L.prototype._didClose=function(e,t){k("t",n.closeFrame(e,t))},L.prototype._didMessage=function(e){k("t",e)},L.prototype._doSend=function(e){this._transport.doSend(e)},L.prototype._doCleanup=function(){this._transport.doCleanup()},n.parent_origin=void 0,g.bootstrap_iframe=function(){var r;C=e.location.hash.slice(1),n.attachMessage(function(e){if(e.source===parent&&("undefined"==typeof n.parent_origin&&(n.parent_origin=e.origin),e.origin===n.parent_origin)){var i=e.data.slice(0,8),s=e.data.slice(8,9);e=e.data.slice(9);if(i===C)switch(s){case"s":var o=JSON.parse(e),i=o[0],s=o[1];e=o[2],o=o[3],i!==g.version&&n.log('Incompatibile SockJS! Main site uses: "'+i+'", the iframe: "'+g.version+'".');if(!n.flatUrl(e)||!n.flatUrl(o)){n.log("Only basic urls are supported in SockJS");break}if(!n.isSameOriginUrl(e)||!n.isSameOriginUrl(o)){n.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([t.location.href,e,o])+")");break}r=new L,r._transport=new L[s](r,e,o);break;case"m":r._doSend(e);break;case"c":r&&r._doCleanup(),r=null}}}),k("s")};var A=function(e,t){var r=this;n.delay(function(){r.doXhr(e,t)})};A.prototype=new s(["finish"]),A.prototype.doXhr=function(e,t){var r=this,i=(new Date).getTime(),s=new t("GET",e+"/info"),o=n.delay(8e3,function(){s.ontimeout()});s.onfinish=function(e,t){clearTimeout(o),o=null;if(200===e){var n=(new Date).getTime()-i,s=JSON.parse(t);"object"!=typeof s&&(s={}),r.emit("finish",s,n)}else r.emit("finish")},s.ontimeout=function(){s.close(),r.emit("finish")}};var O=function(t){var r=this,i=function(){var e=new N;e.protocol="w-iframe-info-receiver";var n=function(t){"string"==typeof t&&"m"===t.substr(0,1)?(t=JSON.parse(t.substr(1)),r.emit("finish",t[0],t[1])):r.emit("finish"),e.doCleanup(),e=null};e.i_constructor({_options:{},_didClose:n,_didMessage:n},t,t)};e.body?i():n.attachEvent("load",i)};O.prototype=new s(["finish"]);var M=function(){var e=this;n.delay(function(){e.emit("finish",{},2e3)})};M.prototype=new s(["finish"]);var _=function(e){if(n.isSameOriginUrl(e))return new A(e,n.XHRLocalObject);switch(n.isXHRCorsCapable()){case 1:return new A(e,n.XHRCorsObject);case 2:return new A(e,n.XDRObject);case 3:return new O(e);default:return new M}};(L["w-iframe-info-receiver"]=function(e,t,r){(new A(r,n.XHRLocalObject)).onfinish=function(t,n){e._didMessage("m"+JSON.stringify([t,n])),e._didClose()}}).prototype.doCleanup=function(){},s=g["iframe-eventsource"]=function(){this.protocol="w-iframe-eventsource",this.i_constructor.apply(this,arguments)},s.prototype=new N,s.enabled=function(){return"EventSource"in t&&N.enabled()},s.need_body=!0,s.roundTrips=3,(L["w-iframe-eventsource"]=function(e,t){this.run(e,t,"/eventsource",P,n.XHRLocalObject)}).prototype=new m,s=g["iframe-xhr-polling"]=function(){this.protocol="w-iframe-xhr-polling",this.i_constructor.apply(this,arguments)},s.prototype=new N,s.enabled=function(){return t.XMLHttpRequest&&N.enabled()},s.need_body=!0,s.roundTrips=3,(L["w-iframe-xhr-polling"]=function(e,t){this.run(e,t,"/xhr",j,n.XHRLocalObject)}).prototype=new m,s=g["iframe-htmlfile"]=function(){this.protocol="w-iframe-htmlfile",this.i_constructor.apply(this,arguments)},s.prototype=new N,s.enabled=function(){return N.enabled()},s.need_body=!0,s.roundTrips=3,(L["w-iframe-htmlfile"]=function(e,t){this.run(e,t,"/htmlfile",B,n.XHRLocalObject)}).prototype=new m;var D=function(e,t,n,r){this.ri=e,this.Receiver=t,this.recv_url=n,this.AjaxObject=r,this._scheduleRecv()};D.prototype._scheduleRecv=function(){var e=this,t=e.poll=new e.Receiver(e.recv_url,e.AjaxObject);t.onmessage=function(t){e.ri._didMessage(t.data)},t.onclose=function(n){e.poll=t=t.onmessage=t.onclose=null,e.poll_is_closing||("permanent"===n.reason?e.ri._didClose(1006,"Polling error ("+n.reason+")"):e._scheduleRecv())}},D.prototype.abort=function(){this.poll_is_closing=!0,this.poll&&this.poll.abort()};var P=function(e){var t=this,r=new EventSource(e);r.onmessage=function(e){t.dispatchEvent(new i("message",{data:unescape(e.data)}))},t.es_close=r.onerror=function(e,s){var o=s?"user":2!==r.readyState?"network":"permanent";t.es_close=r.onmessage=r.onerror=null,r.close(),r=null,n.delay(200,function(){t.dispatchEvent(new i("close",{reason:o}))})}};P.prototype=new r,P.prototype.abort=function(){this.es_close&&this.es_close({},!0)};var H,B=function(e){var r=this;n.polluteGlobalNamespace(),r.id="a"+n.random_string(6,26),e+=(-1===e.indexOf("?")?"?":"&")+"c="+escape("_jp."+r.id);if(void 0===H)if("ActiveXObject"in t)try{H=!!(new ActiveXObject("htmlfile"))}catch(s){}else H=!1;var o=H?n.createHtmlfile:n.createIframe,u;t._jp[r.id]={start:function(){u.loaded()},message:function(e){r.dispatchEvent(new i("message",{data:e}))},stop:function(){r.iframe_close({},"network")}},r.iframe_close=function(e,n){u.cleanup(),r.iframe_close=u=null,delete t._jp[r.id],r.dispatchEvent(new i("close",{reason:n}))},u=o(e,function(e){r.iframe_close({},"permanent")})};B.prototype=new r,B.prototype.abort=function(){this.iframe_close&&this.iframe_close({},"user")};var j=function(e,t){var n=this,r=0;n.xo=new t("POST",e,null),n.xo.onchunk=function(e,t){if(200===e)for(;;){var s=t.slice(r),o=s.indexOf("\n");if(-1===o)break;r+=o+1,s=s.slice(0,o),n.dispatchEvent(new i("message",{data:s}))}},n.xo.onfinish=function(e,t){n.xo.onchunk(e,t),n.xo=null,n.dispatchEvent(new i("close",{reason:200===e?"network":"permanent"}))}};return j.prototype=new r,j.prototype.abort=function(){this.xo&&(this.xo.close(),this.dispatchEvent(new i("close",{reason:"user"})),this.xo=null)},g.getUtils=function(){return n},g.getIframeTransport=function(){return N},g}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS}),function(){global.Class=function(){function e(e){return e&&"object"==typeof e&&!Array.isArray(e)}function t(t,n){if(!e(t)||"function"!=typeof n)throw new TypeError;return Object.forEach(t,function(e,t,r){r.hasOwnProperty(e)&&n(e,t)}),!0}var n=function(){},r={extend:function(e,t){if(2!==arguments.length)throw new RangeError;if("function"!=typeof e||"function"!=typeof t)throw new TypeError;var n=Object.createProto(t.prototype);return n.constructor=e,n._super=null,e.prototype=n,e},decorate:function(r,i,s){if(e(i))return t(i,this.decorate.bind(this,r));"function"==typeof r&&"function"!=typeof r[i]&&(r=r.prototype);if(3!==arguments.length)throw new RangeError;if("string"!=typeof i||"function"!=typeof s)throw new TypeError;var o=r.hasOwnProperty(i)&&"function"==typeof r[i]?r[i]:null,u=Object.getPrototypeOf(r);return r[i]=function(){if(null===this||"undefined"==typeof this)return s.apply(this,arguments);var e=this._super,t=!o&&u&&"function"==typeof u[i]&&u[i];return this._super=o||t||n,t=s.apply(this,arguments),this._super=e,t}}};return Function.prototype.property=function(n,r){if(e(n))return t(n,this.property.bind(this));if("string"!=typeof n)throw new TypeError;if(this.prototype.hasOwnProperty(n))throw new ReferenceError;this.prototype[n]=r},Function.prototype.method=function(n,i){if(e(n))return t(n,this.method.bind(this));if(this.prototype.hasOwnProperty(n))throw new ReferenceError;return r.decorate(this.prototype,n,i)},Function.prototype.decorate=function(n,i){if(e(n))return t(n,this.decorate.bind(this));if("function"!=typeof this.prototype[n])throw new ReferenceError;return r.decorate(this.prototype,n,i)},r}(),function(){Function.prototype.bind||(Function.prototype.bind=function(){var e=this,t=Array.prototype.shift.call(arguments),n=Array.prototype.slice.call(arguments,0);return function(){return e.apply(t,Array.prototype.concat.call(n,Array.prototype.slice.call(arguments,0)))}}),Function.isFunction=function(e){return"function"==typeof e}}(),function(){var e={},t=this.Uint8Array||Array;String.prototype.capitalize=function(){return this.length?e[this]||(e[this]=this[0].toUpperCase()+this.slice(1)):this},String.prototype.format=function(){var e=arguments,t=e.length;if(t){var n=this,r=n.match(/{[^}]*}/g),i=r?r.length:0,s=0;if("object"==typeof e[0])for(;s<i;){var t=r[s].replace(/{/,"").replace(/}/,""),o=isNaN(parseInt(t))?"{"+t+"}":"{["+s+"]}",o=RegExp(o,"g"),n=n.replace(o,e[0][t]);s++}else{if(!r||r.length!==t)throw new RangeError("Engine.Lib.format: wrong number of arguments, "+n);for(;s<t;)2==r[s].length?n=n.replace("{}",e[s]):(o=RegExp("{["+s+"]}","g"),n=n.replace(o,e[s])),s++}return n}return this},String.prototype.toByteArray=function(){for(var e=0,n=this.length,r=new t(n);e<n;e++)r[e]=this.charCodeAt(e)&255;return r},String.isString=function(e){return"string"==typeof e}}.call(this),function(e,t,n,r){Object.createProto=function(e){if(1!==arguments.length)throw new RangeError;if(!e||"object"!=typeof e)throw new TypeError;if(Object.create)return Object.create(e);var t=function(){};return t.prototype=e,new t},"undefined"==typeof Object.getPrototypeOf&&(Object.getPrototypeOf="".__proto__?function(e){return e.__proto__}:function(e){return e.constructor.prototype});var i=Object.merge=function(){var n=arguments[arguments.length-1];!0===n&&(n=Infinity);var n="number"==typeof n?t.call(arguments):0,r=e.call(arguments);if("object"!=typeof r)throw new TypeError("Object.merge: target must be an object");for(var s=arguments.length;s--;){var o=e.call(arguments);if("object"==typeof o)for(var u in o)n&&r.hasOwnProperty(u)&&"object"==typeof r[u]&&"object"==typeof o[u]&&null!==r[u]&&null!==o[u]?r[u]=i(r[u],o[u],n-1):r[u]=o[u]}return r};Object.forEach=function(e,t,r){var i=e&&"object"==typeof e&&!n(e);if(!i||!i||"function"!=typeof t)throw new TypeError;for(var s in e)t.call(r,s,e[s],e)},Object.clone=function(e,t){if("object"!=typeof e)throw new TypeError("Object#clone: object to clone must be a object");var n="function"==typeof e.toClone?e.toClone():e.toClone;return i({},e,n,t)},Object.isArguments=function(e){return"[object Arguments]"===r.call(e)}}(Array.prototype.shift,Array.prototype.pop,Array.isArray,Object.prototype.toString),global.TypedArray=function(e){this.Int8Array=this.Int8Array||Array,this.Int16Array=this.Int16Array||Array,this.Int32Array=this.Int32Array||Array,this.Uint8Array=this.Uint8Array||Array,this.Uint16Array=this.Uint16Array||Array,this.Uint32Array=this.Uint32Array||Array,this.Float32Array=this.Float32Array||Array,this.Float64Array=this.Float64Array||Array;var t=e(2,8)-1,n=e(2,16)-1,r=e(2,32)-1,i=e(2,64)-1;return function(e,s,o){var u="u"===e[0].toLowerCase(),f=~e.toLowerCase().indexOf("float");u||(s*=2),u=0;switch(!0){case!f&&s<=t:u=8;break;case!f&&s<=n:u=16;break;case s<=r:u=32;break;case f&&s<=i:u=64;break;default:return!1}return new(global[e.capitalize()+u+"Array"])(o)}}.call(global,Math.pow),Array.prototype.first=function(){return 0<this.length?this[0]:null},Array.prototype.last=function(){return 0<this.length?this[this.length-1]:null},Array.prototype.has=function(e){return-1!==this.indexOf(e)},Array.prototype.indexOfElems=function(e){var t=-1,n=arguments.length;e:for(;~(t=this.indexOf(e,t+1));){for(var r=1;r<n;r++)if(this[t+r]!==arguments[r])continue e;break}return t},Array.prototype.remove=function(e){for(var t=!1,n=0;-1!=(n=this.indexOf(e));)this.splice(n,1),t=!0;return t},Array.prototype.add=function(e){return-1===this.indexOf(e)?(this.push(e),!0):!1},Array.prototype.clear=function(){for(;0<this.length;)this.pop();return this},Array.prototype.filter||(Array.prototype.filter=function(e){for(var t=[],n=0;n<this.length;n++)e(this[n])&&t.push(this[n]);return t}),Array.prototype.random=function(){return this.length?this[Math.random()*this.length|0]:null},Array.prototype.swap=function(e,t){var n=null;return e<this.length&&0<=e&&t<this.length&&0<=t?(n=this[e],this[e]=this[t],this[t]=n,!0):!1},Array.prototype.clone=function(e){e="boolean"==typeof e?e:!1;var t=this.concat();if(!e)return t;e="function"==typeof Object.clone;for(var n=0,r=t.length;n<r;n++)"object"==typeof t[n]&&(t[n]=Array.isArray(t[n])?t[n].clone():e&&Object.clone(t[n]));return t},Array.prototype.forEach||(Array.prototype.forEach=function(e,t){if("function"!=typeof e)return this;for(var n=0;n<this.length;n++)e.call(t,this[n],n,this);return this}),Array.prototype.without=function(e){if(!Array.isArray(e)||!e.length)return this.clone();e=e.slice(0);for(var t=[],n=0,r=this.length;n<r;n++){var i=this[n],s=e.indexOf(i);~s?s===e.length-1?e.pop():e[s]=e.pop():t.push(i)}return t},Array.prototype.toObject=function(e,t){e="function"==typeof e?e:null;var n=(t="undefined"!=typeof t?Object(t):null)||{};if(!this.length)return n;for(var r=0,i=this.length;r<i;r++){var s=e?e(this[r],r,this):r;!1!==s&&(n[s]=this[r])}return n},Number.prototype.between=function(e,t){return this>=Math.min(e,t)&&this<=Math.max(e,t)},Number.prototype.sign=function(){return 0>this?-1:0<this?1:0},global.Matrix=function(){function e(e){this.m11=null!=e&&"number"==typeof e.m11?parseFloat(e.m11):this.m11,this.m12=null!=e&&"number"==typeof e.m12?parseFloat(e.m12):this.m12,this.m13=null!=e&&"number"==typeof e.m13?parseFloat(e.m13):this.m13,this.m21=null!=e&&"number"==typeof e.m21?parseFloat(e.m21):this.m21,this.m22=null!=e&&"number"==typeof e.m22?parseFloat(e.m22):this.m22,this.m23=null!=e&&"number"==typeof e.m23?parseFloat(e.m23):this.m23,this.m31=null!=e&&"number"==typeof e.m31?parseFloat(e.m31):this.m31,this.m32=null!=e&&"number"==typeof e.m32?parseFloat(e.m32):this.m32,this.m33=null!=e&&"number"==typeof e.m33?parseFloat(e.m33):this.m33}return e.prototype.m11=1,e.prototype.m12=0,e.prototype.m13=0,e.prototype.m21=0,e.prototype.m22=1,e.prototype.m23=0,e.prototype.m31=0,e.prototype.m32=0,e.prototype.m33=1,e.prototype.cos=Math.cos,e.prototype.sin=Math.sin,e.prototype.set=function(e,t,n,r,i,s,o,u,a){return this.m11=parseFloat(e)||0,this.m12=parseFloat(t)||0,this.m13=parseFloat(n)||0,this.m21=parseFloat(r)||0,this.m22=parseFloat(i)||0,this.m23=parseFloat(s)||0,this.m31=parseFloat(o)||0,this.m32=parseFloat(u)||0,this.m33=parseFloat(a)||0,this},e.prototype.copy=function(e){return this.set(e.m11,e.m12,e.m13,e.m21,e.m22,e.m23,e.m31,e.m32,e.m33)},e.prototype.transform=function(e,t,n,r,i,s,o){o=o||this,e=parseFloat(e)||0,n=parseFloat(n)||0,i=parseFloat(i)||0,t=parseFloat(t)||0,r=parseFloat(r)||0,s=parseFloat(s)||0;var u=parseFloat(this.m31)||0,a=parseFloat(this.m32)||0,f=parseFloat(this.m33)||0;return o.set(this.m11*e+this.m12*t+this.m13*u,this.m11*n+this.m12*r+this.m13*a,this.m11*i+this.m12*s+this.m13*f,this.m21*e+this.m22*t+this.m23*u,this.m21*n+this.m22*r+this.m23*a,this.m21*i+this.m22*s+this.m23*f,this.m31*e+this.m32*t+this.m33*u,this.m31*n+this.m32*r+this.m33*a,this.m31*i+this.m32*s+this.m33*f)},e.prototype.multiply=function(e,t){t=t||this;var n=parseFloat(e.m11)||0,r=parseFloat(e.m12)||0,i=parseFloat(e.m13)||0,s=parseFloat(e.m21)||0,o=parseFloat(e.m22)||0,u=parseFloat(e.m23)||0,a=parseFloat(e.m31)||0,f=parseFloat(e.m32)||0,l=parseFloat(e.m33)||0;return t.set(this.m11*n+this.m12*s+this.m13*a,this.m11*r+this.m12*o+this.m13*f,this.m11*i+this.m12*u+this.m13*l,this.m21*n+this.m22*s+this.m23*a,this.m21*r+this.m22*o+this.m23*f,this.m21*i+this.m22*u+this.m23*l,this.m31*n+this.m32*s+this.m33*a,this.m31*r+this.m32*o+this.m33*f,this.m31*i+this.m32*u+this.m33*l)},e.prototype.rotate=function(e){return this.transform(this.cos(e),this.sin(e),-this.sin(e),this.cos(e),0,0)},e.prototype.translate=function(e,t){return this.transform(1,0,0,1,parseInt(e)||0,parseInt(t)||0)},e.prototype.scale=function(e,t){return this.transform(parseFloat(e)||1,0,0,parseFloat(t)||1,0,0)},e.prototype.reset=function(){return this.set(1,0,0,0,1,0,0,0,1)},e.prototype.transpose=function(e){return(e||this).set(this.m11,this.m21,this.m31,this.m12,this.m22,this.m32,this.m13,this.m23,this.m33)},e.prototype.det=function(){return this.m11*this.m22*this.m33+this.m21*this.m32*this.m13+this.m31*this.m12*this.m23-this.m13*this.m22*this.m31-this.m23*this.m32*this.m11-this.m33*this.m12*this.m21},e.prototype.minor=function(e,t){var n=1,r=2,i=1,s=2;return 1==e?(n=2,r=3):2==e&&(n=1,r=3),1==t?(i=2,s=3):2==t&&(i=1,s=3),this["m"+n+i]*this["m"+r+s]-this["m"+n+s]*this["m"+r+i]},e.prototype.inverse=function(e){e=e||this;var t=this.det();this.transpose(e);var n=e.minor(1,1)/t,r=-e.minor(1,2)/t,i=e.minor(1,3)/t,s=-e.minor(2,1)/t,o=e.minor(2,2)/t,u=-e.minor(2,3)/t,a=e.minor(3,1)/t,f=-e.minor(3,2)/t,t=e.minor(3,3)/t;return e.set(n,r,i,s,o,u,a,f,t)},e.prototype.byVector=function(e,t,n){return n=n||Array(2),n[0]=this.m11*e+this.m12*t+this.m13,n[1]=this.m21*e+this.m22*t+this.m23,n},e}(),global.Namespace=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}var t=String.prototype.split,n=Array.prototype.indexOf,r=["function","object"];return e.prototype.get=function(t){return e.get(this,t)},e.prototype.set=function(t,n){return e.set(this,t,n)},e.prototype.unset=function(t){return e.unset(this,t)},e.get=function(e,r){var i=e,s=t.call(String(r),".");if(-1!==n.call(s,""))throw'Namespace.get: Empty key passed - "'+r+'"';for(var o=0,u=s.length;o<u;o++){var a=s[o];if(!i||!i.hasOwnProperty(a))return;i=i[a]}return i},e.set=function(e,i,s){var o=t.call(String(i),".");if(-1!==n.call(o,""))throw'Namespace.set: Empty key passed - "'+i+'"';i=0;for(var u=o.length-1;i<u;i++){var f=o[i];e=e&&e.hasOwnProperty(f)&&e[f]&&-1!==n.call(r,typeof e[f])?e[f]:e[f]={}}return e[o[i]]=s},e.unset=function(e,i){var s=e,o=t.call(String(i),".");if(-1!==n.call(o,""))throw'Namespace.unset: Empty key passed - "'+i+'"';for(var u=0,f=o.length-1;u<f;u++){var l=o[u];if(!(s&&s.hasOwnProperty(l)&&s[l]&&-1!==n.call(r,typeof s[l])))return null;s=s[l]}return delete s[o[f]],s},e.Chain=function(t,n){var r=e.prototype;e.prototype=n;var i=new e(t);return e.prototype=r,i},e}(),global.Model=function(e,t,n,r,i){function s(e){this._subscriptions={},this._events={},this._queue=[],this._triggered=[];if(e&&e.on){var t=e.on,n;for(n in t)this.on(n,t[n])}if(e&&e.subscribers)for(n in t=e.subscribers,t){var i=t[n];if(r(i)){if(i[0]instanceof s){var o=i[0];i.unshift(this),i[1]=n,o.subscribe.apply(o,i),i.shift(),i[0]=o}}else i instanceof s&&i.subscribe(this,n)}n=this.constructor.prototype;for(var u in n)this.hasOwnProperty(u)||"function"==typeof n[u]||(this[u]=e&&u in e&&typeof e[u]==typeof n[u]?e[u]:n[u]);this.initialize(e),this.trigger(s.INITIALIZE)}function o(e,r,i){e._triggered.push(i);var u=e._events,a=e["on"+r];if("function"!=typeof a||!1!==a.apply(e,i)){var l=u[r];if(l&&l.length)for(u=0,a=l.length;u<a;u++){var h=l[u];"function"==typeof h?h.apply(e,i):(l.splice(u--,1),a--)}if(r=e._subscriptions[r])for(u=0,a=r.length;u<a;u+=3)r[u]instanceof s?((l=r[u+2])&&n.apply(l,i),o(r[u],r[u+1],l||i),l&&t.call(l,-i.length,i.length)):(r.splice(u,3),u-=3,a-=3)}i=e._triggered.pop(),r=e._queue,u=0;for(a=r.length;u<a;u+=2)r[u]===i&&(l=r[u+1],r.splice(u,2),u-=2,a-=2,e.trigger.apply(e,l));return e}return s.INITIALIZE="initialize",s.prototype={constructor:s,initialize:function(e){},get:function(e){e+="";var t=this["get"+e.capitalize()];return"function"==typeof t?(arguments[0]=this,i.apply(t,arguments)):this[e]},set:function(e){e+="";var t=this["set"+e.capitalize()];if("function"==typeof t)arguments[0]=this,i.apply(t,arguments);else{if(!this.hasOwnProperty(e))throw new ReferenceError("Model::set: passed key doesn't exist in model");this[e]=arguments[1]}return this},on:function(e,t){if(!e)throw new TypeError("Model::on: event name is not defined");if("function"!=typeof t)throw new TypeError("Model::on: handler is not a function");e+="";var n=this._events;return(n[e]||(n[e]=[])).add(t),this},off:function(e,t){e&&(e+=""),"function"!=typeof t&&(t=null);var n=this._events,r=n[e];if(arguments.length&&!e)throw new TypeError("Model::off: event name is empty");switch(arguments.length){case 0:for(e in n)n[e]=null;break;case 1:if(!r||!r.length)break;for(var n=0,i=r.length;n<i;n++)r[n]=null;break;default:if(!t)throw new TypeError("Model::off: "+typeof t+" handler is not callable");n=r.indexOf(t);if(!~n)break;r[n]=null}return this},trigger:function(t){if(!t)throw new TypeError("Model::trigger: event is not defined");return t+="",e.call(arguments),o(this,t,arguments),this},queue:function(e){if(!e)throw new TypeError("Model::queue: event is not defined");return arguments[0]=e+="",this._triggered.length?(this._queue.push(this._triggered.last(),arguments),this):this.trigger.apply(this,arguments)},subscribe:function(e,n,r){if(!n)throw new TypeError("Model::subscribe: event name is not defined");if(e instanceof s){if(e===this)throw new ReferenceError("Model::subscribe: model can't subscribe itself");r=r||n,n+="",r+="";var i=e._subscriptions,i=i[n]||(i[n]=[]),o=i.indexOfElems(this,r);return~o||(o=i.length),i[o]=this,i[o+1]=r,t.call(arguments,0,3),i[o+2]=arguments.length?arguments:null,this}throw new TypeError("Model::subscribe: model is not a Model instance")},unsubscribe:function(e,t,n){if(!t)throw new TypeError("Model::unsubscribe: event name is not defined");if(e instanceof s){if(e===this)throw new ReferenceError("Model::unsubscribe: model can't unsubscribe itself");return n=n||t,e=e._subscriptions[t+""],e?(n=e.indexOfElems(this,n+""),~n?(e[n]=e[++n]=e[++n]=null,this):this):this}throw new TypeError("Model::unsubscribe: model is not a Model")}},s}(Array.prototype.shift,Array.prototype.splice,Array.prototype.push,Array.isArray,Function.prototype.call),global.Engine=function(e,t,n,r,i){var s=new Model;return s.config={DEBUG:!0},s.loaded=!1,s.ready=function(e){"function"==typeof e&&(s.loaded?e.call(s):s.on("ready",e))},s.start=function(){s.loaded||(s.loaded=!0,s.trigger("ready"))},s.NOP=function(){},s.ERROR="error",s.WARN="warn",s.log=function(i,o){if(s.config.DEBUG&&arguments.length){var u=arguments;o=arguments[arguments.length-1],o!==s.ERROR&&o!==s.WARN||e.call(u);switch(o){case s.ERROR:var l=r.error;break;case s.WARN:l=r.warn;break;default:l=r.log}l||(l=r.log,t.call(u,o.capitalize()+":")),n.call(l,r,u)}},s.now=i.now||function(){return(new i).valueOf()},s}(Array.prototype.pop,Array.prototype.unshift,Function.prototype.apply,console,Date),Engine.Loop=function(){function e(){n=0,t.frame()}var t=new Model,n=0;return t.VSYNC="vsync",t.REFLOW="reflow",t.frame=function(){return t.trigger(t.VSYNC),t.trigger(t.REFLOW),this},t.request=function(){return n?!1:(n=setTimeout(e,17),!0)},t}(),Engine.Device=function(){var e=new Model;return e.platform={type:"desktop",name:""},e.navigator={browser:{name:"",version:0},language:""},e.keyboard=!1,e.online=!0,e.pageVisible=!0,e.screen={width:0,height:0,innerWidth:0,innerHeight:0,pixelDepth:24,pixelRatio:1,orientation:0},e.features={canvas:!1,svg:!1,audio:!1,video:!1,compass:!1,fullscreen:!1,userMedia:!1,gamepad:!1,cache:{scripts:!1,files:!1,data:!1},geolocation:!1,notifications:!1,pageVisibility:!1,vibration:!1,telephony:!1,pointerLock:!1},e}(),Engine.Device.Fullscreen=function(){var e=new Model;e.viewport=null,e.STATUS_CHANGED="statuschanged";var t=e.request=function(t,n,r){if(e.viewport!==t)return r(Error("Feature not implemented"));e.trigger(e.STATUS_CHANGED,t),n()},n=e.exit=function(t,n){if(e.viewport)return n();e.trigger(e.STATUS_CHANGED),t()};return e.toggle=function(r,i,s){return e.status?n(i,s):t(r,i,s)},e}(),Engine.Device.Geolocation=function(){var e=new Model;return e.position=null,e.watching=!1,e.getPosition=function(t,n,r){t=e.position,null===t?n():r(t)},e.setPosition=function(t){e.position!==t&&(e.position=t,e.trigger("positionchanged"))},e.clearWatch=function(t,n){!1===e.watching?n():t()},e}(),Engine.Device.Notification=function(e,t){function n(e,n){n=n||!1,this.body="string"==typeof e?e:this.body,this.title=n&&"string"==typeof n.title?n.title:this.title,this.tag=n&&"string"==typeof n.tag?n.tag:this.tag,this.expireTime=n&&"number"==typeof n.expireTime&&0<=n.expireTime?n.expireTime:this.expireTime,this.iconURL=n&&"string"==typeof n.iconURL?n.iconURL:this.iconURL,this.autoshow=n&&"boolean"==typeof n.autoshow?n.autoshow:this.autoshow,this.onshow=n&&"function"==typeof n.onshow?n.onshow:this.onshow,this.onerror=n&&"function"==typeof n.onerror?n.onerror:this.onerror,this.onclick=n&&"function"==typeof n.onclick?n.onclick:this.onclick,this.onclose=n&&"function"==typeof n.onclose?n.onclose:this.onclose;if(!t.features.notifications)return this.onerror&&this.onerror();if(null===this.title||"undefined"==typeof this.title)this.title=String(this.body),this.body=null;this.autoshow&&this.show()}return n.property({title:void 0,body:void 0,tag:void 0,expireTime:0,iconURL:void 0,autoshow:!0,onshow:null,onerror:null,onclick:null,onclose:null}),n.method({show:function(){if("function"==typeof this.onshow)return this.onshow()},close:function(){if("function"==typeof this.onclose)return this.onclose()}}),n}(Engine,Engine.Device),Engine.Fill=function(e,t){function n(e){return String(e).toLowerCase().trim().replace(/\s*,\s*/g,",").replace(/\s*\(\s*/g,"(").replace(/\s+\)/g,")").replace(/\s\s+/g," ")}function r(n,r,i,s){this.r=t(0,e(parseInt(n)||0,255)),this.g=t(0,e(parseInt(r)||0,255)),this.b=t(0,e(parseInt(i)||0,255)),this.a=t(0,e(parseInt(s)||0,255))}function i(e){this.src=String(e)}function s(e,t,n,r){this.type=String(e),this.from=t,this.to=n,this.steps=this.steps||[]}function o(e){return"stop("+e.stop+","+e.color+")"}function u(e,t){return e.stop-t.stop}function a(e,n,r){this.x=parseInt(e)||0,this.y=parseInt(n)||0,this.r=t(0,parseInt(r)||0)}function f(n,r){this.stop=t(0,e(parseFloat(n)||0,1)),this.color=r}function l(e){return e}var c={},h={},p={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",transparent:"rgba(0,0,0,0)",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},d;for(d in p)r[d.toUpperCase()]=p[d];var v=Object.keys(p);d=v.join("|"),v="("+v.join("|")+")",d=[d,"#(?:[0-9a-fA-F]{3}|[0-9a-fA-F]{6})|rgb\\(\\d+,\\d+,\\d+\\)|rgba\\(\\d+,\\d+,\\d+,[0-9\\.]+\\)|hsl\\(\\d+(?:deg)?,\\d+%?,\\d+%?\\)"].join("|");var v=[v,"(#)(?:([0-9a-fA-F])([0-9a-fA-F])([0-9a-fA-F])|([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2}))|(rgb)\\((\\d+),(\\d+),(\\d+)\\)|(rgba)\\((\\d+),(\\d+),(\\d+),([0-9\\.]+)\\)|(hsl)\\((\\d+)(?:deg)?,(\\d+)%?,(\\d+)%?\\)"].join("|"),m=RegExp("^(?:"+v+")$","i"),g=/^(?:image\(([^\)]*)\))$/i,y=/(linear|radial)/i,b=/(-?\d+)\s(-?\d+)(?:\s(-?\d+))?/i,w="from\\(("+d+")\\)",E=RegExp(w,"i"),S="to\\(("+d+")\\)",x=RegExp(S,"i"),T="stop\\(([0-9\\.]+),("+d+")\\)",N=RegExp(T,"i"),v=["linear|radial|-?\\d+\\s-?\\d+(?:\\s-?\\d+)?","from\\((?:"+d+")\\)","to\\((?:"+d+")\\)","stop\\([0-9\\.]+,(?:"+d+")\\)"].join("|"),C=["(linear|radial)|(-?\\d+)\\s(-?\\d+)(?:\\s(-?\\d+))?",w,S,T].join("|"),w="gradient\\((?:"+v+")(?:,(?:"+v+"))*\\)",k=RegExp("^(?:"+("gradient\\(((?:"+v+")(?:,(?:"+v+"))*)\\)")+")$","i"),L=["repeat","repeat-x","repeat-y","no-repeat"],v=L.join("|"),S="("+L.join("|")+")",A=RegExp("^(?:"+S+")$","i");d=[d,w,"image\\([^\\)]*\\)",v].join("|");var O=RegExp("^("+d+")(?:\\s("+d+"))?(?:\\s("+d+"))?(?:\\s("+d+"))?(?:\\s("+d+"))?(?:\\s("+d+"))?(?:\\s("+d+"))?(?:\\s("+d+"))?(?:\\s("+d+"))?(?:\\s("+d+"))?(?:\\s("+d+"))?(?:\\s("+d+"))?(?:\\s("+d+"))?$","i");c.REPEAT="repeat",c.COLOR="color",c.IMAGE="image",c.parse=function(e,t){t=t||{},e=n(e);var o=O.exec(e);if(!o)return null;o.shift(),o.remove(void 0),t[c.IMAGE]=null,t[c.COLOR]=r.parse("transparent"),t[c.REPEAT]=L.first();for(var u=0,a=o.length;u<a;u++){var f=o[u];switch(!1){case!(e=s.parse(f)):case!(e=i.parse(f)):t[c.IMAGE]=e;break;case!(e=r.parse(f)):t[c.COLOR]=e;break;case!(e=l.parse(f)):t[c.REPEAT]=e}}return t},c.Color=r,r.prototype={toString:function(){return"rgba({},{},{},{})".format(this.r,this.g,this.b,this.a/255)}},r.parse=function(e,t){e=n(e);var i=m.exec(e);if(!i)return null;t=t||h[e]||(h[e]=new r(0,0,0,0));for(var s=0,o=0,u=i.length;s<u;s++)void 0!==i[s]&&(i[o++]=i[s]);return i.length=o,i.shift(),s=i.shift(),(o=M.hasOwnProperty(s)?M[s]:null)?o.apply(t,i):s in p?r.parse(p[s],t):null};var M={hsl:function(){function e(e,t,n){return 0>n&&(n+=1),1<n&&(n-=1),n<1/6?e+6*(t-e)*n:.5>n?t:n<2/3?e+6*(t-e)*(2/3-n):e}return function(t,n,i){t=(parseFloat(t)||0)%360/360,n=(parseFloat(n)||0)/100,i=(parseFloat(i)||0)/100;if(0===n){t=n=i*=255;var s=255}else{var s=.5>i?i*(1+n):i+n-i*n,o=2*i-s;i=255*e(o,s,t+1/3),n=255*e(o,s,t),t=255*e(o,s,t-1/3),s=255}return this instanceof r?(r.call(this,i,n,t,s),this):new r(i,n,t,s)}}(),"#":function(e,t,n){return e=1===e.length?e+e:e,t=1===t.length?t+t:t,n=1===n.length?n+n:n,e=parseInt(e,16)||0,t=parseInt(t,16)||0,n=parseInt(n,16)||0,this instanceof r?(r.call(this,e,t,n,255),this):new r(e,t,n,255)},rgb:function(e,t,n){return this instanceof r?(r.call(this,e,t,n,255),this):new r(e,t,n,255)},rgba:function(e,t,n,i){return this instanceof r?(r.call(this,e,t,n,255*i),this):new r(e,t,n,255*i)},transparent:function(){return this instanceof r?(r.call(this,0,0,0,0),this):new r(0,0,0,0)}};return c.Image=i,i.prototype.toString=function(){return"image("+this.src+")"},i.parse=function(e,t){e=n(e);var r=g.exec(e);return r?(t=t||h[e]||(h[e]=new i),t.src=String(r[1]),t):null},c.Gradient=s,s.prototype={add:function(e,t){this.steps.push(new f(e,t)),this.steps.sort(u)},toString:function(){var e;return e="gradient("+this.type,e=e+","+[this.from.x,this.from.y,this.from.r].join(" "),e+=",",e+=[this.to.x,this.to.y,this.to.r].join(" "),e+=",",e+=this.steps.map(o).join(","),e+=")"}},s.parse=function(e,t){e=n(e);var i=k.exec(e);if(!i)return null;i=i.last().match(RegExp(C,"gi"));if(!i)return null;for(var o=t?(s.call(t),t):h[e]||(h[e]=new s),u=0,f=i.length,l=null;u<f;u++){var l=i[u],c=null;switch(!1){case!(c=y.exec(l)):o.type=c.last();break;case!(c=b.exec(l)):c.shift(),c=new a(c[0],c[1],c[2]),o.from?o.to=c:o.from=c;break;case!(c=E.exec(l)):l=0,c=r.parse(c.last()),o.add(l,c);break;case!(c=x.exec(l)):l=1,c=r.parse(c.last()),o.add(l,c);break;case!(c=N.exec(l)):l=c[1],c=r.parse(c.last()),o.add(l,c)}}return o},s.Position=a,s.Stop=f,c.Repetition=l,l.parse=function(e){return e=n(e),(e=A.exec(e))?e[1]:null},c}(Math.min,Math.max),function(e,t){var n=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||null;if(!n)return!1;var r=!1,i=function(){r=!1,t.frame()};t.request=function(){return r?!1:(r=!0,n(i),!0)}}(this,Engine.Loop),function(e,t){function n(e,t){if(e&&t){var n=document.createElement("meta");return n.setAttribute("name",e),n.setAttribute("content",t),document.head.insertBefore(n,r),n}}var r=document.head.children[1];n("viewport","width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"),n("HandheldFriendly","true"),n("MobileOptimized",480),/iPod|iPad|iPhone/.test(navigator.userAgent)&&(n("apple-mobile-web-app-capable","yes"),n("apple-mobile-web-app-status-bar-style","black-translucent"))}(Engine,Engine.Device),function(e){e.userAgents={platform:{"windows nt 6.2":"Windows 8","windows nt 6.1":"Windows 7","windows nt 6.0":"Windows Vista","windows nt 5.2":"Windows 2003","windows nt 5.1":"Windows XP","windows nt 5.0":"Windows 2000","windows nt 4.0":"Windows NT","winnt4.0":"Windows NT","winnt 4.0":"Windows NT",winnt:"Windows NT","windows 98":"Windows 98",win98:"Windows 98","windows 95":"Windows 95",win95:"Windows 95",windows:"Unknown Windows OS","os x":"Mac OS X","intel mac":"Intel Mac","ppc mac":"PowerPC Mac",powerpc:"PowerPC",ppc:"PowerPC",cygwin:"Cygwin",linux:"Linux",debian:"Debian",openvms:"OpenVMS",sunos:"Sun Solaris",amiga:"Amiga",beos:"BeOS",apachebench:"ApacheBench",freebsd:"FreeBSD",netbsd:"NetBSD",bsdi:"BSDi",openbsd:"OpenBSD","os/2":"OS/2",warp:"OS/2",aix:"AIX",irix:"Irix",osf:"DEC OSF","hp-ux":"HP-UX",hurd:"GNU/Hurd",unix:"Unknown Unix OS"},browser:{opera:"Opera",msie:"Internet Explorer","internet explorer":"Internet Explorer",iemobile:"Internet Explorer",shiira:"Shiira",firefox:"Firefox",chimera:"Chimera",phoenix:"Phoenix",firebird:"Firebird",camino:"Camino",navigator:"Netscape",netscape:"Netscape",omniweb:"OmniWeb",chrome:"Chrome",safari:"Safari",cfnetwork:"Safari",konqueror:"Konqueror",epiphany:"Epiphany",galeon:"Galeon",mozilla:"Mozilla",icab:"iCab",lynx:"Lynx",links:"Links",hotjava:"HotJava",amaya:"Amaya",ibrowse:"IBrowse"},mobile:{iemobile:"Windows Phone OS","windows phone os":"Windows Phone OS",mobileexplorer:"Mobile Explorer",openwave:"Open Wave","opera mini":"Opera Mini",operamini:"Opera Mini",elaine:"Palm",palmsource:"Palm","digital paths":"Palm",avantgo:"Avantgo",xiino:"Xiino",palmscape:"Palmscape",nokia:"Nokia",ericsson:"Ericsson",blackberry:"BlackBerry",motorola:"Motorola",iphone:"iPhone",ipad:"iPad",ipod:"iPod",android:"Android"}}}(Engine.Device),function(e){var t,n=function(e,t,n){n[t]=e.toLowerCase()},r=function(e,t){var n=function(e,n){return t.indexOf(e)-t.indexOf(n)};return 1<e.length&&e.sort(n),e};t=function(){var t=document.documentElement;return e.features=Object.merge(e.features,{canvas:!!window.CanvasRenderingContext2D,svg:!!window.SVGElement,audio:!!window.Audio,video:!!window.HTMLVideoElement,compass:"object"==typeof window.ondeviceorientation&&"object"==typeof window.ondevicemotion,fullscreen:!!(t.requestFullscreen||t.requestFullScreen||t.mozRequestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullscreen||t.webkitRequestFullScreen),userMedia:!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia),gamepad:!!(navigator.gamepads||navigator.webkitGamepads||navigator.mozGamepads),cache:{scripts:!!window.applicationCache,files:!!(window.requestFileSystem||window.webkitRequestFileSystem||window.mozRequestFileSystem),data:!!(window.localStorage||window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.openDatabase)},geolocation:!!navigator.geolocation,notifications:!!window.Notification,pageVisibility:!!(document.visibilityState||document.mozVisibilityState||document.webkitVisibilityState),vibration:!!navigator.vibrate,telephony:!!navigator.telephony||!!navigator.mozTelephony,pointerLock:!!(t.requestPointerLock||t.webkitRequestPointerLock||t.mozRequestPointerLock)})}(),function(){var t,i,s,o,u=navigator.userAgent;s=e.userAgents.mobile,o=Object.keys(s),t=u.match(RegExp(o.join("|"),"ig")),null!==t?i="mobile":(s=e.userAgents.platform,o=Object.keys(s),t=u.match(RegExp(o.join("|"),"ig")),null!==t&&(i="desktop")),null!==t&&(t.forEach(n),r(t,o),t=s[t.first()],null!==t.match(/iPod|iPad|iPhone/)&&(t="iOS"),e.platform=Object.merge(e.platform,{type:i,name:t}))}(),function(){(function(){var t,i,s=Object.keys(e.userAgents.browser);i=navigator.userAgent,t=i.match(RegExp(s.join("|"),"ig")),null!==t&&(t.forEach(n),r(t,s),t=t.first(),s=RegExp(t,"i").exec(i).index,i=i.substring(s+t.length+1),0<i.length?(0<i.indexOf(" ")&&(i=i.substring(0,i.indexOf(" "))),i=parseFloat(i)):i=void 0,e.navigator.browser=Object.merge(e.navigator.browser,{name:e.userAgents.browser[t],version:i}))})(),function(){var t=navigator.userLanguage||navigator.systemLanguage||navigator.language;"undefined"!=typeof t&&(t=t.split("-"),"undefined"==typeof t[1]&&(t[1]=t[0]),t=t[0]+"_"+t[1].toUpperCase(),e.navigator.language=t)}()}(),function(){if("mobile"===e.platform.type){var t=function(t){e.keyboard!==t&&(e.keyboard=t,e.trigger("keyboardstatuschanged"))};window.addEventListener("DOMContentLoaded",function(){document.body.addEventListener("touchstart",function(){t(!1)}),document.body.addEventListener("keydown",function(){t(!0)})})}e.keyboard="mobile"!==e.platform.type}(),"boolean"==typeof navigator.onLine&&function(){window.addEventListener("online",function(){e.online=navigator.onLine,e.trigger("online")}),window.addEventListener("offline",function(){e.online=navigator.onLine,e.trigger("offline")}),e.online=navigator.onLine}(),function(){var t,n,r=screen.mozOrientation||screen.webkitOrientation||screen.orientation;"string"==typeof r?(t=function(){e.screen.orientation=function(){switch(r){case"portrait-primary":return 0;case"portrait-secondary":return 180;case"landscape-primary":return-90;case"landscape-secondary":return 90}}()},screen.addEventListener("orientationchanged",function(){t(),e.trigger("screenorientationchanged",e.screen.orientation)}),t()):"undefined"!=typeof window.orientation?(t=function(){e.screen.orientation=window.orientation},window.addEventListener("DOMContentLoaded",function(){document.body.addEventListener("orientationchange",function(){t(),e.trigger("screenorientationchanged",window.orientation)}),t()})):(t=function(){e.screen.orientation=n.clientWidth>n.clientHeight?90:0},window.addEventListener("DOMContentLoaded",function(){n=document.body,window.addEventListener("resize",function(){var n=e.screen.orientation;t(),n!==e.screen.orientation&&e.trigger("screenorientationchanged",n)}),t()})),window.addEventListener("resize",function(){e.screen.innerWidth=window.innerWidth,e.screen.innerHeight=window.innerHeight,e.trigger("resize")}),e.screen=Object.merge(e.screen,{width:screen.width,height:screen.height,innerWidth:window.innerWidth,innerHeight:window.innerHeight,pixelDepth:screen.pixelDepth||screen.colorDepth,pixelRatio:window.devicePixelRatio||1})}(),t.pageVisibility&&function(){var t="visibilityState",n="visibilitychange";(function(){var e=document.webkitVisibilityState&&"webkit"||document.mozVisibilityState&&"moz"||document.msVisibilityState&&"ms"||null;null!==e&&(t=e+t.capitalize(),n=e+n)})(),document.addEventListener(n,function(n){n="visible"===document[t],e.pageVisible=n,e.trigger(n?"pagevisible":"pagehidden")})}(),delete e.userAgents}(Engine.Device),function(e,t){function n(){c={};for(var e=l.length;e--;)l.pop()()}var r=window.document,i=r.documentElement,s=null,o=null,u=null,a=null,f=null;(function(){function e(e,t){""!==d&&(e=e.capitalize()),t=t||"";for(var n=0;n<c;n++)var s=d+e+l[n]+t;return s in r||s in i?s:null}for(var t=["moz","webkit"],n=t.length,l=["Fullscreen","FullScreen"],c=l.length,p=-1;p<n;p++){var d=t[p]||"";e("request")&&(s=e("request"),o=e("exit")||e("cancel"),u=e("","Element")||e("current","Element"),a=d+"fullscreenchange",f=d+"fullscreenerror")}})();if(s&&o&&u&&a&&f){var l=[],c={};r[u]&&(t.viewport=!0,t.exit()),i.addEventListener(a,function(){var e=r[u];t.viewport=e&&c[e],n()}),i.addEventListener(f,function(){n()}),Class.decorate(t,"request",function(e,t,n){t=this._super.bind(this,e,t,n),l.push(t),t=e.div,c[t]=e,t[s]()}),Class.decorate(t,"exit",function(e,t){var n=this._super.bind(this,e,t);l.push(n),r[o]()})}}(Engine.Device,Engine.Device.Fullscreen),function(e,t){if(e.features.geolocation){var n=null;Class.decorate(t,"getPosition",function(e,r,i){var s=this._super,o;o=navigator.geolocation[e?"watchPosition":"getCurrentPosition"](function(n){t.setPosition([n.coords.latitude,n.coords.longitude]),s(e,r,i)},function(){s(e,r,i)}),e&&(n=o)}),Class.decorate(t,"clearWatch",function(e){var r=this._super;null!==n&&!0===t.watching&&(t.watching=!1,navigator.geolocation.clearWatch(n)),r(onerror,e)})}}(Engine.Device,Engine.Device.Geolocation),function(e,t){e.features.notifications&&(t.decorate("show",function(){function e(){return r.onerror&&r.onerror()}function t(){var t=r.notification=new window.Notification(r.title,{body:r.body,tag:r.tag||"",iconUrl:r.iconURL});t.addEventListener("show",function(){return n.call(r)}),t.addEventListener("error",e),t.addEventListener("click",function(){return r.onclick&&r.onclick(),r.close()}),r.expireTime&&t.addEventListener("show",function(){r.timeout=window.setTimeout(function(){return r.close()},r.expireTime)}),t.show()}var n=this._super,r=this,i=window.Notification.permission||window.Notification.permissionLevel&&window.Notification.permissionLevel();"granted"===i||"undefined"==typeof i?t():window.Notification.requestPermission(function(n){return"granted"===n?t():e()})}),t.decorate("close",function(){if(!this.notification)return this._super();var e=this._super,t=this,n=this.notification,r=n.timeout;return n.addEventListener("close",function(){return e.call(t)}),r&&window.clearTimeout(r),n.close(),delete this.notification}))}(Engine.Device,Engine.Device.Notification),function(e,t){Class.decorate(e,"request",function(n,r,i){n=n instanceof Engine.Viewport?n:null,r="function"==typeof r?r:t,i="function"==typeof i?i:t;if(!n)throw new TypeError("No viewport passed");if(e.viewport===n)return r();if(e.viewport)return n=this._super.bind(this,n,r,i),e.exit(n,i);this._super(n,r,i)}),Class.decorate(e,"exit",function(n,r){n="function"==typeof n?n:t,r="function"==typeof r?r:t;if(!e.viewport)return n();this._super(n,r)})}(Engine.Device.Fullscreen,Engine.NOP),Engine.Error=function(e,t,n){function r(t,i){i||(i=t,t=""),this.type=String(t||this.type),this.name=r.NAME.format(this.type.capitalize()),this.message=String(arguments.length?i:this.message),n.DEBUG&&Engine.log(this+"",Engine.ERROR),this.model instanceof e&&this.model.trigger(this.name.toLowerCase(),this)}return r.NAME="Engine{0}Error",r.property({type:"",model:null,message:"",toString:function(){return this.name+(this.message&&": "+this.message)}}),r}(Model,Error,Engine.config),Engine.Error.Reference=function(e){function t(){e.apply(this,arguments)}return Class.extend(t,e),t.property("type","reference"),t}(Engine.Error),Engine.Error.Syntax=function(e){function t(){e.apply(this,arguments)}return Class.extend(t,e),t.property("type","syntax"),t}(Engine.Error),Engine.Error.Range=function(e){function t(){e.apply(this,arguments)}return Class.extend(t,e),t.property("type","range"),t}(Engine.Error),Engine.Error.Type=function(e){function t(){e.apply(this,arguments)}return Class.extend(t,e),t.property("type","type"),t}(Engine.Error),Engine.Error.NotImplemented=function(e){function t(){e.apply(this,arguments)}return Class.extend(t,e),t.property("type","notImplemented"),t}(Engine.Error),Engine.Timer=function(e,t,n,r,i){function s(e){this.duration=e&&"duration"in e?t(1,parseFloat(e.duration)||0):t(1,parseFloat(this.duration)||0),this.delay=e&&"delay"in e?t(1,parseInt(e.delay)||0):t(1,parseInt(this.delay)||0),this.autoplay=e&&"autoplay"in e?Boolean(e.autoplay):this.autoplay,this.type=e&&"type"in e?String(e.type):String(this.type),this.loop=e&&"loop"in e?Boolean(e.loop):Boolean(this.loop),this.iterations=e&&"iterations"in e?t(0,n(parseFloat(e.iterations))||0):t(0,n(parseFloat(this.iterations))||0),this.playing=!1,this.count=this.stepprogress=this.progress=0,Model.call(this,e),this.autoplay&&this.play()}var o=s.STANDARD="standard",u=s.LOOP="loop",a=s.STEP="step",f=s.STOP="stop",l=s.PLAY="play",c=s.PAUSE="pause",h=s.START="timerstart",p=s.STOP="timerstop",d={};return Class.extend(s,Model),s.property({type:o,duration:1e3,loop:!1,iterations:Infinity,delay:1,autoplay:!1}),s.method({reset:function(){this.count=this.stepprogress=this.progress=0},play:function(){if(!this.playing){var e=d.hasOwnProperty(this.type)?d[this.type]:d[this.type]=[];return e.add(this),1===e.length&&s.start(this.type),this.playing=!0,this.trigger(l),!0}return!1},pause:function(){if(this.playing){var e=d.hasOwnProperty(this.type)?d[this.type]:d[this.type]=[],t=r.call(e,this);return~t&&(e[t]=null),this.playing=!1,this.queue(c),!0}return!1},stop:function(){if(this.playing){var e=d.hasOwnProperty(this.type)?d[this.type]:d[this.type]=[],t=r.call(e,this);return~t&&(e[t]=null),this.playing=!1,this.stepprogress=this.progress=0,this.queue(f),!0}return!1}}),s.evaluate=function(t,n){var r=d.hasOwnProperty(t)?d[t]:null;if(!r||!r.length)return!1;for(var s=r.length;0<s--;){var o=r[s];if(o){var f=o.progress+=n;o.stepprogress+=n,o.stepprogress>=o.delay&&(o.progress=e(o.progress,o.duration),o.trigger(a),o.stepprogress%=o.delay),f>=o.duration&&(o.loop?(o.trigger(u),o.count++,o.progress=f%o.duration,o.count>=o.iterations&&o.stop()):o.stop())}else i.call(r,s,1)}return!!r.length},s.start=function(e){Engine.trigger(h,e)},s.stop=function(e){Engine.trigger(p,e)},s}(Math.min,Math.max,Math.floor,Array.prototype.indexOf,Array.prototype.splice),function(e,t,n){function r(){var e=n()-o;o+=e,t.evaluate(s,e)||t.stop(t.STANDARD)}var i=0,s=t.STANDARD,o=0;e.on(t.START,function(e){return e!==s?!1:(i||(o=n(),i=setInterval(r,17)),!0)}).on(t.STOP,function(e){return e!==s?!1:(clearInterval(i),i=0,!0)})}(Engine,Engine.Timer,Engine.now),function(e,t,n,r){function i(){var e=r()-o;o+=e,n.evaluate(s,e)?t.request():n.stop(n.VSYNC)}var s=n.VSYNC="vsync",o=null;e.on(n.START,function(e){if(e!==s)return!1;t.on(t.VSYNC,i);if(t.request()||null===o)o=r();return!0}).on(n.STOP,function(e){return e!==s?!1:(t.off(t.VSYNC,i),o=null,!0)})}(Engine,Engine.Loop,Engine.Timer,Engine.now),Engine.Timer.Animation=function(e,t,n,r){function i(n){var r=this.frames=!n||"object"!=typeof n.frames&&"function"!=typeof n.frames?this.frames:n.frames;t(r)&&(this.frames=s(r)),this.easing=n&&"function"==typeof n.easing?n.easing:this.easing,this.frameEasing=n&&"function"==typeof n.frameEasing?n.frameEasing:this.frameEasing,e.call(this,n),this.frameDuration=(this.frameDuration=parseFloat(n&&"frameDuration"in n?n.frameDuration:this.frames&&"object"==typeof this.frames?this.duration/Object.keys(this.frames).length:this.frameDuration))||this.duration}function s(e){var t=e.length;return e.toObject(function(e,n){return parseFloat((n/t).toFixed(2))})}Class.extend(i,e);var o=i.EASING={linear:function(e,t){return e},nothing:function(e,t){return 0},easeIn:function(e,t){return n(e/t,3)*t},easeOut:function(e,t){return(1-n(1-e/t,3))*t}};return i.property({type:e.VSYNC,frames:null,easing:o.linear,frameEasing:null,frameprogress:0,frameDuration:0}),i.method({onstep:function(){var e=this.frameEasing||this.easing;switch(typeof this.frames){case"function":var t=this.easing.call(null,this.progress,this.duration),n=r(t/this.frameDuration),i=t-n*this.frameDuration;t===this.frameDuration&&(n--,i=this.progress),this.frameprogress=i,this.frames(n,this.frameEasing?e(i,this.frameDuration):i);break;case"object":t=this.progress/this.duration;for(i in this.frames){i=parseFloat(i);if(i>t)break;n=i}i===n&&(i=1),this.frameDuration=(i-n)*this.duration,this.frameprogress=(t-n)*this.duration,e=e(this.frameprogress,this.frameDuration),this.frames[n].call(this,e)}this._super()}}),i}(Engine.Timer,Array.isArray,Math.pow,Math.floor),Engine.Timer.Animation.Property=function(e,t){function n(n,r,i,s,o){var u=n;u.constructor!==Object&&(u={model:n,property:r,from:i,to:s,duration:o}),this.model=u&&u.model&&u.model instanceof Model?u.model:this.model;if(!(this.model instanceof Model))throw new t.Type("Engine.Timer.Animation.Property: model is not specified");this.property=String(u&&u.property?u.property:this.property);if(!this.property.length)throw new t.Type("Engine.Timer.Animation.Property: property to animate is not specified");if(!(this.property in this.model))throw new t.Reference("Engine.Timer.Animation.Property: passed model doesn't have such property to animate");this.from=u&&"from"in u?u.from:this.from||this.model[this.property],this.to=u&&"to"in u?u.to:this.to,e.call(this,u)}return Class.extend(n,e),n.property({model:null,property:"",from:null,to:null}),n}(Engine.Timer.Animation,Engine.Error),Engine.Timer.Animation.Property.Number=function(e,t){function n(n){e.apply(this,arguments);if("number"!=typeof this.model[this.property])throw new t.Type("Engine.Timer.Animation.Property.Number: specified property to animate is not a number");this.from=parseFloat(this.from)||0,this.to=parseFloat(this.to)||0}return Class.extend(n,e),n.property({frames:function(e,t){this.model.set(this.property,this.from+(e*this.frameDuration+t)/this.duration*(this.to-this.from))}}),n}(Engine.Timer.Animation.Property,Engine.Error),Engine.Box=function(){function e(e,t,n,s){this.x=i(parseFloat(e)||0),this.y=i(parseFloat(t)||0),this.w=r(parseFloat(e+n)||0)-this.x,this.h=r(parseFloat(t+s)||0)-this.y}var t=Math.max,n=Math.min,r=Math.ceil,i=Math.floor;return e.overlap=function(e,t,n,r,i,s,o,u){return e<i+o&&e+n>i&&t<s+u&&t+r>s},e.extend=function(e,t,n,r,i,s,o,u){return e<i&&e+n>i+o&&t<s&&t+r>s+u},e.method({overlap:function(t){return e.overlap(this.x,this.y,this.w,this.h,t.x,t.y,t.w,t.h)},extend:function(t){return e.extend(this.x,this.y,this.w,this.h,t.x,t.y,t.w,t.h)},bound:function(e,r){var i=this.x,s=this.y,o=e.x,u=e.y;return r=r||this,r.x=n(i,o),r.y=n(s,u),r.w=t(i+this.w,o+e.w)-r.x,r.h=t(s+this.h,u+e.h)-r.y,r},clip:function(e,r){var i,s,o,u;o=this.x,u=this.y;var a=e.x,f=e.y;return r=r||this,i=t(o,a),s=t(u,f),o=n(o+this.w,a+e.w)-i,u=n(u+this.h,f+e.h)-s,0>o||0>u?r.reset(0,0,0,0):r.reset(i,s,o,u)},copy:function(e){this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h},area:function(){return this.w*this.h},toString:function(){return"Box("+this.x+","+this.y+","+this.w+","+this.h+")"},clone:function(){return new e(this.x,this.y,this.w,this.h)},equal:function(e){return e.x==this.x&&e.y==this.y&&e.w==this.w&&e.h==this.h},reset:function(e,t,n,r){return this.x=parseInt(e)||0,this.y=parseInt(t)||0,this.w=0<=n?parseInt(n)||0:0,this.h=0<=r?parseInt(r)||0:0,this}}),e}(),Engine.Font=function(e){function t(t,r,i,s){1===arguments.length&&"object"==typeof t?(this.family=String(t&&"family"in t?t.family:this.family),this.size=String(t&&"size"in t?t.size:this.size).toLowerCase(),this.weight=String(t&&"weight"in t?t.weight:this.weight),this.style=String(t&&"style"in t?t.style:this.style),n(this),e.call(this,t)):(this.family=String(void 0!==t?t:this.family),this.size=String(void 0!==r?r:this.size).toLowerCase(),this.weight=String(void 0!==i?i:this.weight),this.style=String(void 0!==s?s:this.style),n(this),e.call(this))}function n(e){e.size=r.test(e.size)?e.size:t.SIZE,e.weight=i.has(e.weight)?e.weight:i.first(),e.style=s.has(e.style)?e.style:s.first()}var r=/(?:[1-9][0-9]+|[0-9])px|pt/;t.SIZE="12px";var i=[t.REGULAR="regular",t.BOLD="bold"],s=[t.NORMAL="normal",t.ITALIC="italic"];return Class.extend(t,e),t.property({family:"",size:t.SIZE,weight:t.REGULAR,style:t.NORMAL}),t}(Model),Engine.Network=function(){return new Model}(),Engine.Network.Url=function(e){var t=e.xUrl=RegExp("{}?{}?{}?{}?{}?{}?".format("(?:([a-z0-9]+\\:?)?\\/\\/)","([^\\/\\:]+)","(?:\\:([0-9]+))","([^\\?]+)","(?:(\\?[^\\#]+))","(?:(#.*))"),"i");return{parse:function(e){e=String(e);var n=t.exec(e)||[];e=String(n[1]||"").toLowerCase();var r=n[2]||"",i=n[3]||"",s=n[4]||"",o=n[5]||"",n=n[6]||"",u=i?r+":"+i:r;return{protocol:e,host:u,hostname:r,port:i,pathname:s,search:o,hash:n,origin:e+"//"+u,href:e+"//"+u+s+o+n}},toQuery:function(e){if(!e)return"";var t="",n;for(n in e)t+=n+"="+e[n]+"&";return t.slice(0,-1)},fromQuery:function(e){e=String(e);var t={};if(""===e)return t;e=e.split("&");for(var n=0,r=e.length;n<r;n++){var i=e[n].split("=");t[i[0]||""]=i[1]||""}return t}}}(Engine.Network),Engine.Network.Resource=function(){function e(e){this.src=String(e&&"src"in e?e.src:this.src),this.method=String(e&&"method"in e?e.method:this.method),this.data=e&&"data"in e?e.data:this.data,this.type=String(e&&"type"in e?e.type:this.type),this.headers=e&&"headers"in e?e.headers:this.headers,this.headers="object"==typeof this.headers?this.headers:null,this.autoload=Boolean(e&&"autoload"in e?e.autoload:this.autoload),this.pending=!1,this.response=null,this.complete=!1,Model.call(this,e),""===this.src&&Engine.log("Resource was created without URL. Set config.src parameter during instancing to resolve.",Engine.WARN),this.autoload&&this.load()}return Class.extend(e,Model),e.JSON="json",e.TEXT="text",e.DATA="data",e.AUTO="auto",e.GET="get",e.POST="post",e.LOAD="load",e.ERROR="error",e.PROGRESS="progress",e.ABORT="abort",e.property({src:"",headers:null,method:e.GET,type:e.AUTO,data:null,autoload:!0}),e.property("on"+e.LOAD,function(e){this.response=e,this.pending=!1,this.complete=!0}),e.property("on"+e.ERROR,function(e){this.response=null,this.complete=this.pending=!1}),e.method({load:function(){return this.pending||!this.src?!1:(this.pending=!0,this.complete=!1,this.response=null,!0)},abort:function(){return this.pending?(this.complete=this.pending=!1,this.response=null,!0):!1}}),e}(),Engine.Network.Resource.Error={},Engine.Network.Resource.Error.Request=function(e){function t(t){e.call(this,"Request finished with [{}] status".format(t)),this.status=parseInt(t)||0}return Class.extend(t,e),t.property("type","networkResourceRequest"),t.property("status",0),t}(Engine.Error),Engine.Network.Resource.Error.Parse=function(e){function t(t){e.call(this,t)}return Class.extend(t,e),t.property("type","networkResourceParse"),t}(Engine.Error),Engine.Network.Socket=function(){function e(e){this.src=e&&"src"in e?e.src:this.src,Model.call(this,e),""===this.src&&Engine.log("Socket was created without URL. Set config.src parameter during instancing to resolve.",Engine.WARN)}return Class.extend(e,Model),e.property("src",""),e.method({connect:function(e){},send:function(e){},close:function(){}}),e}(),Engine.Element=function(){function e(t){this.global=new Matrix,this.name=t&&"name"in t?String(t.name):this.name,this.id=t&&"id"in t?null!==t.id?String(t.id):null:null!==this.id?String(this.id):null,this.parent=t&&t.parent&&t.parent instanceof Engine.Node?t.parent:this.parent,this.zindex=!t||"number"!=typeof t.zindex&&null!==t.zindex?this.zindex:t.zindex,e.register(this.id,this),this.selectable=t&&"boolean"==typeof t.selectable?t.selectable:this.selectable,Model.call(this,t),this.parent&&this.parent.appendChild(this)}return Class.extend(e,Model),e.elements={},e.SELECTED="selected",e.DESELECTED="deselected",e.property({selectable:!1,global:null,matrix:null,id:null,name:null,root:null,parent:null,zindex:null}),e.getElementById=function(e){return this.elements[e]||null},e.register=function(e,t){null!==e&&(this.elements[e]=t)},e.unregister=function(e,t){null!==e&&this.elements[e]===t&&delete this.elements[e]},e.method({destroy:function(){e.unregister(this.id,this),this.parent&&this.parent.removeChild(this)},getElementById:function(t){return e.getElementById(t)},next:function(){return this.parent&&this.parent.children[this.parent.children.indexOf(this)+1]||null},update:function(){var e=this.parent&&this.parent.root||this.parent||null;this.root!==e&&this.deselect(),this.root=e,this.parent?this.global=this.matrix?this.parent.global.multiply(this.matrix,this.global):this.global.copy(this.parent.global):this.global.reset()},prev:function(){return this.parent&&this.parent.children[this.parent.children.indexOf(this)-1]||null},setId:function(t){return t=null===t?t:String(t),this.id===t?!1:(e.unregister(this.id,this),this.id=t,e.register(this.id,this),!0)},setZindex:function(e){return e=null!==e?parseInt(e)||0:e,this.zindex===e?!1:(this.zindex=e,this.update(),!0)},extractZindex:function(){for(var e=this;null!==e&&null===e.zindex;)e=e.parent;return e?parseInt(e.zindex)||0:0},index:function(){return this.parent?this.parent.children.indexOf(this):0},firstParentOfType:function(e){if("function"!=typeof e)return null;for(var t=this;t=t.parent;)if(t instanceof e)return t;return null},setName:function(e){e=null!==e?String(e):e;var t=this.name;if(t===e)return!1;this.name=e;var n=this.parent;return n&&(n[t]===this&&delete n[t],!n.hasOwnProperty(e)&&(n[e]=this)),!0},select:function(){return this.root instanceof Engine.Scene&&this.selectable?this.root.selected.has(this)?!0:null===this.root.multiSelect?!1:(!this.root.multiSelect&&this.root.selected.length&&this.root.deselectAll(),this.root.selected.push(this),this.trigger(e.SELECTED),!0):!1},deselect:function(){return this.root instanceof Engine.Scene&&this.root.selected.has(this)?(this.root.selected.remove(this),this.trigger(e.DESELECTED),!0):!1}}),e}(),Engine.Node=function(e,t){function n(t){this.children=[],e.call(this,t);if(null!=t&&t.children instanceof Array){t=t.children;for(var n=0;n<t.length;n++)t[n]instanceof e&&this.appendChild(t[n])}}return Class.extend(n,e),n.method({update:function(e){e=e||this,this._super(e);for(var t=this.children,n=t.length;n--;)t[n].update(e)},appendChild:function(e,t){return t="undefined"==typeof t?this.children.length:t,this.children.has(e)?null:(null!==e.parent&&e.parent!==this&&e.parent.removeChild(e),this.children.splice(t,0,e),e.parent=this,null!==e.name&&!this.hasOwnProperty(e.name)&&(this[e.name]=e),e.update(this),e)},removeChild:function(e){return this.children.has(e)?(this.children.remove(e),e.parent=null,null!==e.name&&this[e.name]===e&&delete this[e.name],e.update(this),e):null},destroy:function(){for(var e=this.children,t=e.length;0<t--;)e[t].destroy();this._super()},clear:function(){for(var e=this.children,t=e.length;0<t--;)e[t].destroy();e.length&&Engine.log("Engine.Node::clear: Node is not clear enough",Engine.WARN)},getBb:function(){for(var e=new t(0,0,0,0),n=0,r=this.children,i=r.length;n<i;n++){var s=r[n].getBb();e.w&&e.h?e.bound(s):e.copy(s)}return e}}),n}(Engine.Element,Engine.Box),Engine.Scene=Engine.Node.Scene=function(e,t,n,r){function i(t){this.space={},this.space[i.GEOMETRY]=new n,this.space[i.MEDIA]=new n,this.space[i.CAMERA]=new n,this.multiSelect=!t||"boolean"!=typeof t.multiSelect&&null!==t.multiSelect?this.multiSelect:t.multiSelect,this.selected=[],e.call(this,t);if(!this.selectable)throw"Scene: Root element must be selectable"}return Class.extend(i,e),i.GEOMETRY="geometry",i.MEDIA="media",i.CAMERA="camera",i.property({selectable:!0,multiSelect:!1,selected:null}),i.method({setMultiSelect:function(e){if("boolean"!=typeof e&&null!==e)throw new TypeError;this.multiSelect=e;if(!e&&this.selected.length){if(!1===e){if(1===this.selected.length)return;var t=this.selected.first(),n=function(e){return e!==t}}this.deselectAll(n)}},search:function(e,t){t="undefined"==typeof t?i.GEOMETRY:t;var n=this.space[t];return n?(e=null===e?n.get_tree():e,n.search(e)):[]},sort:function(e){return e.sort(this.compare)},compare:function(e,t){var n=t.extractZindex()-e.extractZindex();if(n)return n;for(var n=[],r=[];e;)n.push(e.index()),e=e.parent;for(;t;)r.push(t.index()),t=t.parent;for(;0<n.length||0<r.length;)if(e=parseInt(n.pop())||0,t=parseInt(r.pop())||0,t-e)return t-e;return 0},spaceInsert:function(e,t,r){(this.space[e]=this.space[e]||new n).insert(t,r)},spaceClear:function(e,t,n){(e=this.space[e])&&t.w&&t.h&&e.remove(t,n)},captureGeometryByPixel:function(e){var n=new Matrix,r=[0,0],i=new t(0,0,1,1);return function(t,s,o,u){o=Array.isArray(o)?o:null,u="function"==typeof u?u:null,i.x=t,i.y=s,t=this.sort(this.search(i)),s=null;for(var f=0,l=t.length;f<l;f++)if(s=t[f],s.captureEvents&&!(o&&o.has(s)||u&&!u(s))&&(s.global.inverse(n).byVector(i.x,i.y,r),s.captureUI(e(r[0]),e(r[1]))))return s;return null}}(Math.round),deselectAll:function(e){e="function"==typeof e?e:null;for(var t=0;t<this.selected.length;t++){var n=this.selected[t];(!e||e(n))&&n.deselect()&&t--}return!this.selected.length},select:function(){throw"Scene: Root element can't be selected"},deselect:function(){throw"Scene: Root element can't be deselected"},getSelectedGeometries:function(){function e(n){if(n instanceof Engine.Geometry)return t.push(n);n.children&&n.children.forEach(e)}var t=[];return this.selected.forEach(e),t}}),i}(Engine.Node,Engine.Box,RTree,Engine.Fill),Engine.Transform=Engine.Node.Transform=function(e){function t(t){this.matrix=new Matrix(t),e.call(this,t)}return Class.extend(t,e),t.method({setTransform:function(e,t,n,r,i,s){return this.matrix.set(e,n,i,t,r,s,0,0,1),this.update(this),this},transform:function(e,t,n,r,i,s){return this.matrix.transform(e,t,n,r,i,s),this.update(this),this},multiply:function(e,t){return this.matrix.multiply(e),this.update(this),this},rotate:function(e){return this.matrix.rotate(e),this.update(this),this},translate:function(e,t){return this.matrix.translate(e,t),this.update(this),this},scale:function(e,t){return this.matrix.scale(e,t),this.update(this),this},reset:function(){return this.matrix.reset(),this.update(this),this}}),t}(Engine.Node),Engine.Node.Transform.Anchor=function(e,t){function n(t){var r=t&&t.anchors||this.anchors;this.anchors={},this[n.LEFT]=t&&t.hasOwnProperty(n.LEFT)?parseInt(t[n.LEFT])||0:this[n.LEFT],this[n.TOP]=t&&t.hasOwnProperty(n.TOP)?parseInt(t[n.TOP])||0:this[n.TOP],this.width=t&&t.hasOwnProperty("width")&&0<=t.width?parseInt(t.width)||0:this.width,this.height=t&&t.hasOwnProperty("height")&&0<=t.height?parseInt(t.height)||0:this.height,this[n.RIGHT]=this[n.LEFT]+this.width,this[n.BOTTOM]=this[n.TOP]+this.height,this.marginLeft=t&&t.hasOwnProperty("marginLeft")?parseInt(t.marginLeft)||0:this.marginLeft,this.marginRight=t&&t.hasOwnProperty("marginRight")?parseInt(t.marginRight)||0:this.marginRight,this.marginTop=t&&t.hasOwnProperty("marginTop")?parseInt(t.marginTop)||0:this.marginTop,this.marginBottom=t&&t.hasOwnProperty("marginBottom")?parseInt(t.marginBottom)||0:this.marginBottom,e.call(this,t);if(r)for(var i in r)this.connect(i,r[i])}return Class.extend(n,e),n.HANCHORS=[n.LEFT="left",n.CENTERH="centerh",n.RIGHT="right"],n.VANCHORS=[n.TOP="top",n.CENTERV="centerv",n.BOTTOM="bottom"],n.EXTRAANCHORS=[n.CENTERIN="centerin",n.FILL="fill",n.FILLWIDTH="fillwidth",n.FILLHEIGHT="fillheight"],n.SYMBOLS=[n.PARENT="parent",n.NEXT="next",n.PREV="prev"],n.ANCHORS=n.HANCHORS.concat(n.VANCHORS,n.EXTRAANCHORS),n.SEPARATOR=".",n.property(n.LEFT,0),n.property(n.CENTERH,0),n.property(n.RIGHT,0),n.property(n.TOP,0),n.property(n.CENTERV,0),n.property(n.BOTTOM,0),n.property({marginLeft:0,marginRight:0,marginTop:0,marginBottom:0,width:0,height:0}),n.method({setBounds:function(e,t,r,i){e=parseInt(e)||0,t=parseInt(t)||0,r=parseInt(r)||0,i=parseInt(i)||0,this[n.LEFT]=e,this[n.TOP]=t,this[n.RIGHT]=r>=this[n.LEFT]?r:this[n.LEFT],this[n.BOTTOM]=i>=this[n.TOP]?i||0:this[n.TOP],this.width=this[n.RIGHT]-this[n.LEFT],this.height=this[n.BOTTOM]-this[n.TOP],this[n.CENTERH]=this[n.LEFT]+this.width/2,this[n.CENTERV]=this[n.TOP]+this.height/2,this.matrix.set(1,0,this[n.LEFT],0,1,this[n.TOP],0,0,1)},setPosition:function(e,t){this.setBounds(e,t,e+this.width,t+this.height),this.update()},setSize:function(e,t){this.setBounds(this[n.LEFT],this[n.TOP],this[n.LEFT]+e,this[n.TOP]+t),this.update()},update:function(e){this.calculate();if(null!=this.parent&&(null==e||e.parent!=this.parent))for(var t=null,r=this.parent.children,i=0;i<r.length;i++)t=r[i],1==t instanceof n&&t!==this&&t.update(this);this._super(e)},calculate:function(){var e={};e[n.LEFT]=null,e[n.CENTERH]=null,e[n.RIGHT]=null,e[n.TOP]=null,e[n.CENTERV]=null,e[n.BOTTOM]=null;for(var t=n.SEPARATOR,r=0,i="",s="",r="",s=null,o=0,u="",o=0;o<n.HANCHORS.length;o++)if(u=n.HANCHORS[o],i=this.anchors[u])r=i.indexOf(t),s=i.slice(0,r),r=i.slice(r+1),s=this.getBySymbol(s)||this.getElementById(s),s instanceof n&&(e[u]=s==this.parent?s[r]-s[n.LEFT]:s.parent==this.parent?s[r]:e[u]);null!==e[n.LEFT]?(e[n.LEFT]+=this.marginLeft,e[n.RIGHT]=null!==e[n.RIGHT]?e[n.RIGHT]:null!==e[n.CENTERH]?e[n.CENTERH]+(e[n.CENTERH]-e[n.LEFT]):e[n.LEFT]+this.width):null!==e[n.RIGHT]?(e[n.RIGHT]-=this.marginRight,e[n.LEFT]=null!==e[n.LEFT]?e[n.LEFT]:null!==e[n.CENTERH]?e[n.CENTERH]+(e[n.CENTERH]-e[n.RIGHT]):e[n.RIGHT]-this.width):null!==e[n.CENTERH]?(e[n.LEFT]=e[n.CENTERH]-this.width/2+this.marginLeft-this.marginRight,e[n.RIGHT]=e[n.CENTERH]+this.width/2+this.marginLeft-this.marginRight):(e[n.LEFT]=this[n.LEFT],e[n.RIGHT]=this[n.RIGHT]);for(o=0;o<n.VANCHORS.length;o++)if(u=n.VANCHORS[o],i=this.anchors[u])r=i.indexOf(t),s=i.slice(0,r),r=i.slice(r+1),s=this.getBySymbol(s)||this.getElementById(s),s instanceof n&&(e[u]=s==this.parent?s[r]-s[n.TOP]:s.parent==this.parent?s[r]:e[u]);null!==e[n.TOP]?(e[n.TOP]+=this.marginTop,e[n.BOTTOM]=null!==e[n.BOTTOM]?e[n.BOTTOM]:null!==e[n.CENTERV]?e[n.CENTERV]+(e[n.CENTERV]-e[n.TOP]):e[n.TOP]+this.height):null!==e[n.BOTTOM]?(e[n.BOTTOM]-=this.marginBottom,e[n.TOP]=null!==e[n.TOP]?e[n.TOP]:null!==e[n.CENTERV]?e[n.CENTERV]+(e[n.CENTERV]-e[n.BOTTOM]):e[n.BOTTOM]-this.height):null!==e[n.CENTERV]?(e[n.TOP]=e[n.CENTERV]-this.height/2+this.marginTop-this.marginBottom,e[n.BOTTOM]=e[n.CENTERV]+this.height/2+this.marginTop-this.marginBottom):(e[n.TOP]=this[n.TOP],e[n.BOTTOM]=this[n.BOTTOM]),this.setBounds(e[n.LEFT],e[n.TOP],e[n.RIGHT],e[n.BOTTOM])},getBySymbol:function(e){var t=null;switch(e){case n.PARENT:t=this.parent;break;case n.NEXT:t=this.next();break;case n.PREV:t=this.prev()}return t instanceof n?t:null},connect:function(e,t){if("string"!=typeof t||""==t)return!1;var r=n.SEPARATOR,i=t.indexOf(r),s=-1==i?t:t.slice(0,i),i=-1==i?"":t.slice(i+1);if(n.HANCHORS.has(e)&&n.HANCHORS.has(i)||n.VANCHORS.has(e)&&n.VANCHORS.has(i))this.anchors[e]=t,this.update();else if(n.EXTRAANCHORS.has(e)){switch(e){case n.CENTERIN:this.anchors[n.CENTERH]=s+r+n.CENTERH,this.anchors[n.CENTERV]=s+r+n.CENTERV;break;case n.FILLWIDTH:this.anchors[n.LEFT]=s+r+n.LEFT,this.anchors[n.RIGHT]=s+r+n.RIGHT;break;case n.FILLHEIGHT:this.anchors[n.TOP]=s+r+n.TOP,this.anchors[n.BOTTOM]=s+r+n.BOTTOM;break;case n.FILL:this.anchors[n.LEFT]=s+r+n.LEFT,this.anchors[n.RIGHT]=s+r+n.RIGHT,this.anchors[n.TOP]=s+r+n.TOP,this.anchors[n.BOTTOM]=s+r+n.BOTTOM}this.update()}},disconnect:function(e){if(0==n.ANCHORS.has(e))return!1;switch(e){case n.CENTERIN:delete this.anchors[n.CENTERH],delete this.anchors[n.CENTERV];break;case n.FILLWIDTH:delete this.anchors[n.LEFT],delete this.anchors[n.RIGHT];break;case n.FILLHEIGHT:delete this.anchors[n.TOP],delete this.anchors[n.BOTTOM];break;case n.FILLHEIGHT:delete this.anchors[n.LEFT],delete this.anchors[n.RIGHT],delete this.anchors[n.TOP],delete this.anchors[n.BOTTOM];break;default:delete this.anchors[e]}}}),n}(Engine.Node.Transform,Engine.Scene),Engine.Geometry=function(e,t,n){function r(t){this.bb=new n(0,0,0,0),this.captureEvents=null!=t&&"boolean"==typeof t.captureEvents?t.captureEvents:this.captureEvents,this.vAlign=t&&"vAlign"in t?String(t.vAlign):String(this.vAlign),this.vAlign=l.has(this.vAlign)?this.vAlign:l[0],this.hAlign=t&&"hAlign"in t?String(t.hAlign):String(this.hAlign),this.hAlign=f.has(this.hAlign)?this.hAlign:f[0],this.zindex=t&&t.zindex?parseInt(t.zindex)||0:this.zindex,this.left=t&&"left"in t?parseInt(t.left)||0:this.left,this.top=t&&"top"in t?parseInt(t.top)||0:this.top,this.width=t&&"width"in t?s(0,parseInt(t.width)||0):s(0,parseInt(this.width)||0),this.height=t&&"height"in t?s(0,parseInt(t.height)||0):s(0,parseInt(this.height)||0),this.right=this.left+this.width,this.bottom=this.top+this.height,e.call(this,t),i(this,this.hAlign,this.vAlign,this.width,this.height);if(!this.captureEvents&&this.selectable)throw"Geometry::initialize: Geometry can't be selectable and doesn't capture events simultaneously"}function i(e,t,n,i,s){var o=e.left,u=e.top,a=e.left+i,f=e.top+s;switch(t){case r.LEFT:o=0,a=i;break;case r.RIGHT:o=-i,a=0;break;case r.CENTER:o=-i/2,a=-o}switch(n){case r.TOP:u=0,f=s;break;case r.BOTTOM:u=-s,f=0;break;case r.CENTER:u=-s/2,f=-u}e.setBounds(o,u,a,f)}var s=Math.max,o=Math.min,u=Math.floor,a=Math.ceil;Class.extend(r,e);var f=[r.NONE="none",r.LEFT="left",r.CENTER="center",r.RIGHT="right"],l=[r.NONE,r.TOP="top",r.BOTTOM="bottom",r.CENTER];r.property({types:[t.GEOMETRY],vAlign:r.NONE,hAlign:r.NONE,transform:null,captureEvents:!0,opacity:1,left:0,top:0,right:0,bottom:0,width:0,height:0,bb:null});var c=[0,0];return r.toBB=function(e,t,r,i,f,l){var p,d,v,m;return l=l instanceof n?l:new n(0,0,0,0),f.byVector(e,t,c),p=d=c[0],v=m=c[1],f.byVector(r,t,c),p=o(p,c[0]),d=s(d,c[0]),v=o(v,c[1]),m=s(m,c[1]),f.byVector(e,i,c),p=o(p,c[0]),d=s(d,c[0]),v=o(v,c[1]),m=s(m,c[1]),f.byVector(r,i,c),p=o(p,c[0]),d=s(d,c[0]),v=o(v,c[1]),m=s(m,c[1]),l.w=a(d)-(l.x=u(p)),l.h=a(m)-(l.y=u(v)),l},r.method({setOpacity:function(e){return e=s(o(parseFloat(e)||0,1),0),this.opacity===e?!1:(this.opacity=e,this.redraw(),!0)},setAlign:function(e,t){return e=f.has(e)?e:0,t=l.has(t)?t:0,this.hAlign===e&&this.vAlign===t?!1:(this.hAlign=e,this.vAlign=t,i(this,e,t,this.width,this.height),!0)},setBounds:function(e,t,n,i){return e=parseInt(e)||0,t=parseInt(t)||0,n=s(e,parseInt(n)||0),i=s(t,parseInt(i)||0),this.left===e&&this.top===t&&this.right===n&&this.bottom===i?!1:(this.left=e,this.top=t,this.right=n,this.bottom=i,this.width=n-e,this.height=i-t,this.clearBB(this.root),this.bb=r.toBB(this.left,this.top,this.right,this.bottom,this.global,this.bb),this.insertBB(this.root),!0)},setPosition:function(e,t){return e=parseInt(e)||0,t=parseInt(t)||0,this.setBounds(e,t,e+this.width,t+this.height)},setBox:function(e,t,n,r){return this.setBounds(e,t,e+n,t+r)},setSize:function(e,t){return e=0<=e?parseInt(e)||0:0,t=0<=t?parseInt(t)||0:0,this.width===e&&this.height===t?!1:(i(this,this.hAlign,this.vAlign,e,t),!0)},captureUI:function(e,t){return e>=this.left&&e<this.right&&t>=this.top&&t<this.bottom},getPixel:function(e,t,n){return n=n||[],n[0]=0,n[1]=0,n[2]=0,n[3]=0,n},clearBB:function(e){if(e instanceof t){for(var n=0,r=this.bb,i=this.types,s=i.length;n<s;n++)e.spaceClear(i[n],r,this);return!0}return!1},insertBB:function(e){if(e instanceof t){for(var n=0,r=this.bb,i=this.types,s=i.length;n<s;n++)e.spaceInsert(i[n],r,this);return!0}return!1},update:function(e){this.clearBB(this.root),this._super(e),this.bb=r.toBB(this.left,this.top,this.right,this.bottom,this.global,this.bb),this.insertBB(this.root)},redraw:function(e,t,n,r){return this.width&&this.height},getBb:function(){return this.bb}}),r}(Engine.Element,Engine.Scene,Engine.Box),Engine.Geometry.Shape=function(e,t,n){function r(n){this.image=t.Image.parse(n&&"image"in n?n.image:this.image),this.repeat=t.Repetition.parse(n&&"repeat"in n?n.repeat:this.repeat),this.color=t.Color.parse(n&&"color"in n?n.color:this.color),this.stroke=t.Color.parse(n&&"stroke"in n?n.stroke:this.stroke),n&&"fill"in n&&t.parse(String(n.fill),this),this.offsetX=parseInt(n&&"offsetX"in n?n.offsetX:this.offsetX)||0,this.offsetY=parseInt(n&&"offsetY"in n?n.offsetY:this.offsetY)||0,e.call(this,n)}return Class.extend(r,e),r.property({image:"",color:"rgba(0,0,0,0)",repeat:"repeat",stroke:"rgba(0,0,0,0)",offsetX:0,offsetY:0}),r.method({setColor:function(e){return e===this.color?!1:(this.color=e instanceof t.Color?e:t.Color.parse(e),this.redraw(),!0)},setImage:function(e){return e===this.image?!1:(this.image=e instanceof t.Image?e:t.Image.parse(e),this.redraw(),!0)},setRepeat:function(e){return e===this.repeat?!1:(this.repeat=t.Repetition.parse(e),this.redraw(),!0)},setFill:function(e){return this.color=this.repeat=this.image=null,t.parse(e,this),this.redraw(),!0},setStroke:function(e){return e===this.stroke?!1:(this.stroke=e instanceof t.Color?e:t.Color.parse(e),this.redraw(),!0)},setOffset:function(e,t){return e=parseInt(e)||0,t=parseInt(t)||0,this.offsetX===e&&this.offsetY===t?!1:(this.offsetX=e,this.offsetY=t,this.redraw(),!0)},setOffsetX:function(e){return e=parseInt(e)||0,this.setOffset(e,this.offsetY)},setOffsetY:function(e){return e=parseInt(e)||0,this.setOffset(this.offsetX,e)}}),n.property({image:"",color:"rgba(0,0,0,0)",repeat:"repeat"}),n.method({initialize:function(e){this.image=t.Image.parse(e&&"image"in e?e.image:this.image),this.repeat=t.Repetition.parse(e&&"repeat"in e?e.repeat:this.repeat),this.color=t.Color.parse(e&&"color"in e?e.color:this.color),this.stroke=t.Color.parse(e&&"stroke"in e?e.stroke:this.stroke),e&&"fill"in e&&t.parse(String(e.fill),this),this._super(e)},setColor:function(e){return e===this.color?!1:(this.color=e instanceof t.Color?e:t.Color.parse(e),this.redraw(),!0)},setImage:function(e){return e===this.image?!1:(this.image=e instanceof t.Image?e:t.Image.parse(e),this.redraw(),!0)},setRepeat:function(e){return e===this.repeat?!1:(this.repeat=t.Repetition.parse(e),this.redraw(),!0)},setFill:function(e){return this.color=this.repeat=this.image=null,t.parse(e,this),this.redraw(),!0},redraw:function(){}}),r}(Engine.Geometry,Engine.Fill,Engine.Scene),Engine.Geometry.Rectangle=Engine.Geometry.Shape.Rectangle=function(e,t){function n(e){t.call(this,e)}return Class.extend(n,t),n}(Engine.Geometry,Engine.Geometry.Shape),Engine.Geometry.Polygon=Engine.Geometry.Shape.Polygon=function(e,t,n,r){function i(e){t.call(this,e),e&&"points"in e&&this.setPoints(e.points)}return Class.extend(i,t),i.property("points",null),i.method("setPoints",function(e){var t=0,i=0,s=0,o=0;if(e=this.points)for(var u=0,f=e.length;u<f;u++)var l=e[u],c=l[0],l=l[1],t=n(t,c)-1,i=r(i,c)+1,s=n(s,l)-1,o=r(o,l)+1;this.setBounds(t,s,i,o)}),i}(Engine.Geometry,Engine.Geometry.Shape,Math.min,Math.max),Engine.Geometry.Oval=Engine.Geometry.Shape.Oval=function(e,t){function n(t){e.call(this,t);var n=this.originX=parseInt(t&&"originX"in t?t.originX:this.originX)||0,r=this.originY=parseInt(t&&"originY"in t?t.originY:this.originY)||0;t&&"radius"in t&&(this.radiusY=this.radiusX=parseInt(t.radius)||0);var i=this.radiusX=parseInt(t&&"radiusX"in t?t.radiusX:this.radiusX)||0;t=this.radiusY=parseInt(t&&"radiusY"in t?t.radiusY:this.radiusY)||0,this.setBounds(n-i,r-t,n+i,r+t)}return Class.extend(n,e),n.property({originX:0,originY:0,radiusX:0,radiusY:0}),n.method({setOrigin:function(e,t){e=parseInt(e)||0,t=parseInt(t)||0;var n=this.radiusX,r=this.radiusY;return this.setBounds(e-n,t-r,e+n,t+r)},setRadius:function(e,n){e=t(0,parseInt(e)||0),n=void 0===n?e:t(0,parseInt(n)||0);var r=this.originX,i=this.originY;return this.setBounds(r-e,i-n,r+e,i+n)},setBounds:function(e,t,n,r){return this._super(e,t,n,r)?(e=this.width/2,t=this.height/2,this.originX=this.left+e,this.originY=this.top+t,this.radiusX=e,this.radiusY=t,!0):!1}}),n}(Engine.Geometry.Shape,Math.max),Engine.Geometry.Shape.Text=function(e,t,n,r,i){function s(n){this.font=n&&"font"in n?n.font:this.font,this.font=this.font instanceof t?this.font:null,this.textColor=String(n&&"textColor"in n?n.textColor:this.textColor),this.text=String(n&&"text"in n?n.text:this.text),this.minWidth=r(0,parseFloat(n&&"minWidth"in n?n.minWidth:this.minWidth)||0),this.minHeight=r(0,parseFloat(n&&"minHeight"in n?n.minHeight:this.minHeight)||0),this.maxWidth=r(0,parseFloat(n&&"maxWidth"in n?n.maxWidth:this.maxWidth)||0),this.maxHeight=r(0,parseFloat(n&&"maxHeight"in n?n.maxHeight:this.maxHeight)||0),this.spacing=parseInt(n&&"spacing"in n?n.spacing:this.spacing)||0,this.lineHeight=r(-1,parseInt(n&&"lineHeight"in n?n.lineHeight:this.lineHeight)||0),this.textAlign=String(n&&"textAlign"in n?n.textAlign:this.textAlign),this.textAlign=o.has(this.textAlign)?this.textAlign:o[0];if(n&&"padding"in n){var i=parseInt(n.padding)||0;this.paddingBottom=this.paddingRight=this.paddingTop=this.paddingLeft=i}this.paddingLeft=parseInt(n&&"paddingLeft"in n?n.paddingLeft:this.paddingLeft)||0,this.paddingTop=parseInt(n&&"paddingTop"in n?n.paddingTop:this.paddingTop)||0,this.paddingRight=parseInt(n&&"paddingRight"in n?n.paddingRight:this.paddingRight)||0,this.paddingBottom=parseInt(n&&"paddingBottom"in n?n.paddingBottom:this.paddingBottom)||0,e.call(this,n)}Class.extend(s,e),s.AUTO=-1;var o=[s.LEFT="left",s.RIGHT="right",s.CENTER="center",s.JUSTIFY="justify",s.PRE="pre"];return s.COLOR="black",s.READY="ready",s.property({font:null,textColor:s.COLOR,text:"",minWidth:0,minHeight:0,maxWidth:Infinity,maxHeight:Infinity,spacing:0,lineHeight:s.AUTO,textAlign:s.LEFT,paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:0}),s.method({setFont:function(e){return e=e instanceof t?e:null,this.font===e?!1:(this.font=e,!0)},setTextColor:function(e){return e=String(e),this.textColor===e?!1:(this.textColor=e,!0)},setText:function(e){return e=String(e),this.text===e?!1:(this.text=e,!0)},setSpacing:function(e){return e=parseInt(e)||0,this.spacing===e?!1:(this.spacing=e,!0)},setLineHeight:function(e){return e=parseInt(e)||0,this.lineHeight===e?!1:(this.lineHeight=e,!0)},setTextAlign:function(e){return e=String(e),e=o.has(e)?e:o[0],this.textAlign===e?!1:(this.textAlign=e,!0)},setPadding:function(e,t,n,r){for(;0<arguments.length&&void 0===arguments[arguments.length-1];)i.call(arguments);switch(arguments.length){case 2:n=e,r=t;break;case 1:r=n=t=e}return e=parseInt(e)||0,t=parseInt(t)||0,n=parseInt(n)||0,r=parseInt(r)||0,this.paddingLeft===e&&this.paddingTop===t&&this.paddingRight===n&&this.paddingBottom===r?!1:(this.paddingLeft=e,this.paddingTop=t,this.paddingRight=n,this.paddingBottom=r,!0)},setMinWidth:function(e){return e=r(0,parseFloat(e)||0),this.minWidth===e?!1:(this.minWidth=e,!0)},setMinHeight:function(e){return e=r(0,parseFloat(e)||0),this.minHeight===e?!1:(this.minHeight=e,!0)},setMaxWidth:function(e){return e=r(0,parseFloat(e)||0),this.maxWidth===e?!1:(this.maxWidth=e,!0)},setMaxHeight:function(e){return e=r(0,parseFloat(e)||0),this.maxHeight===e?!1:(this.maxHeight=e,!0)}}),s}(Engine.Geometry.Shape,Engine.Font,Math.min,Math.max,Array.prototype.pop),Engine.Image=Engine.Geometry.Image=function(e){function t(t){this.src=t&&"src"in t?String(t.src):String(this.src),this.complete=!1,e.call(this,t)}return Class.extend(t,e),t.LOAD="load",t.ERROR="error",t.property({complete:!1,src:""}),t.method("setSrc",function(e){return e=String(e),this.src===e||""===e?!1:(this.complete=!1,this.src=e,!0)}),t}(Engine.Geometry),Engine.Geometry.Image.Sprite=function(e){function t(t){this.offsetx=t&&"offsetx"in t?parseInt(t.offsetx)||0:parseInt(this.offsetx)||0,this.offsety=t&&"offsety"in t?parseInt(t.offsety)||0:parseInt(this.offsety)||0,e.call(this,t)}return Class.extend(t,e),t.property({offsetx:0,offsety:0}),t.method("setOffset",function(e,t){return e=parseInt(e)||0,t=parseInt(t)||0,this.offsetx===e&&this.offsety===t?!1:(this.offsetx=e,this.offsety=t,this.redraw(),!0)}),t}(Engine.Geometry.Image),Engine.Geometry.Media=function(e,t,n,r,i,s,o,u,a,f,l,c){function h(t){this.ambient=t&&"ambient"in t?Boolean(t.ambient):Boolean(this.ambient),this.loop=t&&"loop"in t?Boolean(t.loop):Boolean(this.loop),this.autoplay=t&&"autoplay"in t?Boolean(t.autoplay):Boolean(this.autoplay),this.volume=t&&"volume"in t?i(0,r(parseFloat(t.volume)||0,1)):i(0,r(parseFloat(this.volume)||0,1)),this.src=t&&"src"in t?String(t.src):String(this.src),e.call(this,t),this.autoplay&&this.play()}return Class.extend(h,e),h.property({types:[t.MEDIA],src:"",volume:1,globalVolume:0,balanceRadius:0,balanceAngle:3*l,ambient:!1,loop:!1,playing:!1,autoplay:!1}),h.method({setSrc:function(e){return e=String(e),this.src===e||""===e?!1:(this.src=e,!0)},setVolume:function(e){return e=i(r(parseFloat(e)||0,1),0),e===this.volume?!1:(this.volume=e,!0)},update:function(e){this._super(e),this.calculateRenderBalance()},calculateRenderBalance:function(){var e=l,n=1;if(this.root instanceof t)if(this.ambient)this.balanceRadius=1-this.volume;else{var e=this.bb,u=this.root.search(e,t.CAMERA),a=n=0,c=u.length;if(c){for(var h=0,p=0;p<c;p++)var d=u[p],v=d.view,y=d.x,b=d.y,w=e.x,E=e.y,S=e.w,x=e.h,T=v.w,v=v.h,y=y>w&&y<w+S?0:s(w-y)<s(w+S-y)?w-y:w+S-y,b=b>E&&b<E+x?0:s(E-b)<s(E+x-b)?E-b:E+x-b,n=n+y/(T/2),a=a+b/(v/2),h=h+d.volume;h/=c,e=n||a?f(n/o(n*n+a*a)):0,n=r(i(0,i(s(n),s(a))/c),1),n+=(1-n)*(1-h),e=0<a?2*l-e+2*l:e}else e=l,n=1}return e===this.balanceAngle&&n===this.balanceRadius?!1:(this.balanceAngle=e,this.balanceRadius=n,!0)},play:function(){return this.playing?!1:this.playing=!0},pause:function(){return this.playing?!1:!(this.playing=!1)},stop:function(){return this.pause()}}),h}(Engine.Geometry,Engine.Scene,Engine.Box,Math.min,Math.max,Math.abs,Math.sqrt,Math.pow,Math.tan,Math.acos,Math.PI/2,2*Math.PI),Engine.Geometry.Sound=Engine.Geometry.Media.Sound=function(e,t,n,r,i,s){function o(e){this.priority=e&&"priority"in e?parseInt(e.priority)||0:parseInt(this.priority)||0,this.radius=e&&"radius"in e?s(0,parseInt(e.radius)||0):s(0,parseInt(this.radius)||0),t.call(this,e),this.setRadius(this.radius)}function u(e){e&&e.component&&(e.pause(),e.component.removeSound(e))}function a(e){if(e._sound)return e;if(""===e.src)return e._sound=null;for(var t,n=0,s=f.length;n<s;n++){var o=f[n++];if(o.src===e.src&&o.loop===e.loop){t=o;break}}return e._sound=new Engine.Sound({refersTo:t,src:e.src,loop:e.loop,volume:e.volume,position:{x:i(e.balanceAngle)*e.balanceRadius,y:r(e.balanceAngle)*e.balanceRadius,z:-0.5}}),f.add(e._sound.component),e}Class.extend(o,t),o.property({_sound:null,filter:void 0,priority:0,radius:1}),o.method({setSrc:function(e){return this._super(e)?(this._sound&&(u(this._sound),this._sound=null),this.src.length&&(a(this),this.playing&&this._sound&&this._sound.play()),!0):!1},destroy:function(){this._super(),this._sound&&(u(this._sound),this._sound=null)},setVolume:function(e){return this._super(e)?(this._sound&&(this._sound.setVolume(this.volume),0===this.volume?this._sound.pause():this.playing&&!this._sound.playing&&this._sound.play()),!0):!1},calculateRenderBalance:function(){return this._super()?(this._sound&&(1===this.balanceRadius?this._sound.pause():(this.playing&&!this._sound.playing&&this._sound.play(),this._sound.setPosition(i(this.balanceAngle)*this.balanceRadius,r(this.balanceAngle)*this.balanceRadius,-0.5))),!0):!1},setRadius:function(e){return e=parseInt(s(e,0))||0,this.setBounds(-e,-e,e,e)},play:function(e,t){return this._super()?(!this._sound&&a(this),this._sound&&this._sound.play(!this.loop&&0),!0):!1},pause:function(){return this._super()?(this._sound&&this._sound.pause(),!0):!1},stop:function(){return this._super()?(this._sound&&this._sound.stop(),!0):!1}});var f=[];return o}(Engine.Geometry,Engine.Geometry.Media,Engine.Scene,Math.sin,Math.cos,Math.max),Engine.Geometry.Media.Video=function(e,t){function n(t){e.call(this,t)}return Class.extend(n,e),n.AUTO=1,n.property({autosize:n.AUTO,types:[t.GEOMETRY,t.MEDIA]}),n}(Engine.Geometry.Media,Engine.Scene),Engine.Viewport=function(e,t,n,r){function i(e,t,n,o){if("string"==typeof e)return"number"==typeof t?i.call(this,{id:e,width:t,height:n,cameras:o}):i.call(this,{id:e,cameras:t});this.cameras=[],this.id=String(e&&"id"in e?e.id:this.id),this.width=r(0,parseInt(e&&"width"in e?e.width:this.width)||0),this.height=r(0,parseInt(e&&"height"in e?e.height:this.height)||0),this.background=String(e&&"background"in e?e.background:this.background),this.fullscreen=e&&("width"in e||"height"in e)?!1:Boolean(this.fullscreen),this.fullscreen=Boolean(e&&"fullscreen"in e?e.fullscreen:this.fullscreen),Model.call(this,e),this.fullscreen&&s(this);if(o=e&&"cameras"in e?e.cameras:null)for(e=0,t=parseInt(o.length)||0;e<t;e++)this.addCamera(o[e])}function s(e){o.add(e),e.setSize(t.screen.innerWidth,t.screen.innerHeight)}Class.extend(i,Model),i.property({id:"",width:0,height:0,background:"rgba(0, 0, 0, 0)",fullscreen:!0}),i.method({setSize:function(e,t){e=r(0,parseInt(e)||0),t=r(0,parseInt(t)||0);if(this.width===e&&this.height===t)return!1;this.width=e,this.height=t;for(var n=0,i=this.cameras,s=i.length;n<s;n++){var o=i[n];o.fullscreen&&o.setSize(e,t)}return!0},setFullscreen:function(e){return e=Boolean(e),this.fullscreen===e?!1:((this.fullscreen=e)?s(this):o.remove(this),!0)},setBackground:function(e){return e=String(e),this.background===e?!1:(this.background=e,!0)},addCamera:function(e){return e.parent===this?!1:(e.parent&&e.parent.removeCamera(e),this.cameras.add(e),e.parent=this,e.fullscreen&&e.setSize(this.width,this.height),!0)},removeCamera:function(e){return e.parent!==this?!1:(this.cameras.remove(e),e.parent=null,!0)},getCameraByPixel:function(){var t=new e(0,0,1,1),n=new e(0,0,0,0);return function(e,r,i){if("number"!=typeof e||"number"!=typeof r)return!1;i=Array.isArray(i)?i:null,t.x=e,t.y=r;for(e=this.cameras.length;e--;)if(r=this.cameras[e],!i||!i.has(r))if(n.x=r.left,n.y=r.top,n.w=r.width,n.h=r.height,t.overlap(n))return r;return null}}()});var o=[];return t.on("resize",function(){for(var e=t.screen.innerWidth,n=t.screen.innerHeight,r=0;r<o.length;r++)o[r].setSize(e,n)}),i}(Engine.Box,Engine.Device,Math.min,Math.max),Engine.Camera=function(e,t,n,r,i,s){function o(i){this.view=new e(0,0,0,0),this.volume=r(0,n(parseFloat(i&&"volume"in i?i.volume:this.volume),1)),this.zoom=r(0,n(parseFloat(i&&"zoom"in i?i.zoom:this.zoom),Infinity)),this.fullscreen=i&&("width"in i||"height"in i)?!1:Boolean(this.fullscreen),this.fullscreen=Boolean(i&&"fullscreen"in i?i.fullscreen:this.fullscreen),this.x=parseFloat(i&&"x"in i?i.x:this.x)||0,this.y=parseFloat(i&&"y"in i?i.y:this.y)||0,this.left=parseInt(i&&"left"in i?i.left:this.left)||0,this.top=parseInt(i&&"top"in i?i.top:this.top)||0,this.width=r(0,parseInt(i&&"width"in i?i.width:this.width)),this.height=r(0,parseInt(i&&"height"in i?i.height:this.height)),this.lookingAt=i&&"lookAt"in i&&i.lookAt instanceof t?i.lookAt:null,f(this),a(this),l(this,this.view),Model.call(this,i)}function u(e){e.lookingAt&&e.lookingAt.spaceClear(t.CAMERA,e.view,e)}function a(e){e.lookingAt&&e.lookingAt.spaceInsert(t.CAMERA,e.view,e)}function f(e){var t=e.view,n=e.zoom,r=t.w=i(e.width/n),n=t.h=i(e.height/n);t.x=i(e.x-r/2),t.y=i(e.y-n/2)}function l(e,n){var r=e.lookingAt;if(r)for(var r=r.search(n,t.MEDIA),i=0;i<r.length;i++)r[i].calculateRenderBalance()}return Engine.Camera=o,Class.extend(o,Model),o.property({volume:1,lookingAt:null,view:null,x:0,y:0,zoom:1,parent:null,left:0,top:0,width:0,height:0,fullscreen:!0}),o.method({setOffset:function(e,t){return e=parseInt(e)||0,t=parseInt(t)||0,this.left===e&&this.top===t?!1:(this.left=e,this.top=t,!0)},setVolume:function(e){return e=r(0,n(parseFloat(e)||0,1)),e===this.volume?!1:(this.volume=e,l(this,this.view),!0)},lookAt:function(e){return e=e instanceof t?e:null,this.lookingAt===e?!1:(this.lookingAt instanceof t&&(u(this),l(this,this.view)),this.lookingAt=e,this.lookingAt instanceof t&&(a(this),l(this,this.view)),!0)},setFullscreen:function(e){e=Boolean(e);if(this.fullscreen==e)return!1;if(this.fullscreen=e)e=this.parent,this.setSize(e.width,e.height);return!0},setZoom:function(e){e=r(0,n(parseFloat(e)||0,Infinity));if(this.zoom===e)return!1;this.zoom=e,e=this.view;var t=e.clone();return u(this),f(this),a(this),l(this,t),l(this,e),!0},setSize:function(e,t){e=r(0,parseInt(e)||0),t=r(0,parseInt(t)||0);if(this.width===e&&this.height===t)return!1;this.width=e,this.height=t;var n=this.view,i=n.clone();return u(this),f(this),a(this),l(this,i),l(this,n),this.trigger("resize",e,t),!0},moveTo:function(e,t){e=parseFloat(e)||0,t=parseFloat(t)||0;if(this.x===e&&this.y===t)return!1;this.x=e,this.y=t;var n=this.view,r=n.clone();return u(this),f(this),a(this),l(this,r),l(this,n),this.trigger("move",e,t),!0},moveBy:function(e,t){return e=parseFloat(e)||0,t=parseFloat(t)||0,this.moveTo(this.x+e,this.y+t)},projectX:function(e){return e=parseInt(e)||0,(e-this.view.x)*this.zoom},projectY:function(e){return e=parseInt(e)||0,(e-this.view.y)*this.zoom},toSceneX:function(e){return e=parseInt(e)||0,e/this.zoom+this.view.x},toSceneY:function(e){return e=parseInt(e)||0,e/this.zoom+this.view.y}}),o}(Engine.Box,Engine.Scene,Math.min,Math.max,Math.round,Math.abs),function(e){var t=Engine.Renderer=new Model;t.createContext=function(){return e.createElement("canvas").getContext("2d")},t.ctx=t.createContext()}(document),function(e){e.decorate("initialize",function(e){this.div=this.id&&document.getElementById(this.id)||document.createElement("div"),this.div.setAttribute("style",["width : "+this.width+"px","height : "+this.height+"px","background : "+this.background,"position : relative;margin : 0px;padding : 0px;overflow : hidden"].join(";")),this._super(e)}),e.decorate("setSize",function(e,t){if(!this._super(e,t))return!1;var n=this.div.style;return n.width=this.width+"px",n.height=this.height+"px",!0}),e.decorate("setBackground",function(e){return this._super(e)?(this.div.style.background=this.background,!0):!1}),e.decorate("addCamera",function(e){return this._super(e)?(this.div.appendChild(e.div),!0):!1}),e.decorate("removeCamera",function(e){return this._super(e)?(this.div.removeChild(e.div),!0):!1})}(Engine.Viewport),function(e,t,n,r,i,s,o,u,a){function f(e,t){for(var n=e.length;0<n--;){var r=e[n];if(r.overlap(t))return t.bound(r),h.push(e[n]),e.splice(n,1),f(e,t)}return e.push(t),e}function l(t,n,i,s,o){var u=h.pop();u?r.call(u,n,i,s,o):u=new r(n,i,s,o),f(t.stack,u),d.add(t),e.request()}function c(e,t,n,s,o,f,c,h,p){if(r.overlap(t,n,s,o,f,c,h,p)){var d=e.canvas,v=u.width=d.width,m=u.height=d.height;v&&m&&a.drawImage(d,0,0),d.width=h,d.height=p,u.width&&u.height&&e.ctx.drawImage(u,t-f,n-c)}var d=t+s,v=n+o,m=f+h,g=c+p;f<t&&l(e,f,n,i(t-f,h),o),m>d&&l(e,d,n,i(m-(t-s),h),o),c<n&&l(e,f,c,h,i(n-c,p)),g>v&&l(e,f,v,h,i(g-v,p))}var h=[];t.property({debug:!1,translateX:0,translateY:0}),t.decorate("initialize",function(e){this._super(e),this.stack=[],this.canvas=document.createElement("canvas"),this.canvas.setAttribute("style","width:100%;height:100%;"),this.canvas.width=this.view.w,this.canvas.height=this.view.h,this.ctx=this.canvas.getContext("2d"),this.div=document.createElement("div"),this.div.setAttribute("style","position:absolute;left:"+this.left+"px;top:"+this.top+"px;width:"+this.width+"px;height:"+this.height+"px;overflow:hidden;"),this.div.appendChild(this.canvas),e=this.renderview=this.view.clone(),l(this,e.x,e.y,e.w,e.h)}),t.decorate("setOffset",function(e,t){if(!this._super(e,t))return!1;var n=this.div.style;return n.left=this.left+"px",n.top=this.top+"px",!0}),t.decorate("lookAt",function(e){return this._super(e)?(e=this.renderview,l(this,e.x,e.y,e.w,e.h),!0):!1}),t.decorate("moveTo",function(e,t){var n=this.x,r=this.y;if(this._super(e,t)||this.translateX||this.translateY){if(this._isScrolled){var i=this.zoom,n=parseFloat((this.x-n)*i)||0,r=parseFloat((this.y-r)*i)||0;p(this,this.translateX-n,this.translateY-r)}else{p(this,0,0);var r=this.renderview,i=r.x,n=r.y,s=r.w,o=r.h;r.copy(this.view),c(this,i,n,s,o,r.x,r.y,s,o)}return!0}return!1}),t.decorate("setSize",function(e,t){if(!this._super(e,t))return!1;var n=this.renderview,r=n.x,i=n.y,s=n.w,o=n.h;return n.copy(this.view),c(this,r,i,s,o,n.x,n.y,n.w,n.h),n=this.div.style,n.width=this.width+"px",n.height=this.height+"px",!0}),t.decorate("setZoom",function(e){if(this._super(e)){e=this.renderview;var t=e.x,n=e.y,r=e.w,i=e.h;return e.copy(this.view),c(this,t,n,r,i,e.x,e.y,e.w,e.h),!0}return!1}),t.method("redraw",function(e){l(this,e.x,e.y,e.w,e.h)});var p=function(){var e="transform",t="translate({x}px,{y}px)";return function(n){var r=document.createElement("div"),i;for(i in n)if("string"==typeof r.style[i])return e=i,t=n[i],!0}({"-webkit-transform":"translate3d({0}px,{1}px,0px)","-moz-transform":"translate3d({0}px,{1}px,0px)","-o-transform":"translate({0}px,{1}px)","-ms-transform":"translate({0}px,{1}px)",transform:"translate({0}px,{1}px)"}),function(n,r,i){return r=parseFloat(r)||0,i=parseFloat(i)||0,n.translateX===r&&n.translateY===i?!1:(n.translateX=r,n.translateY=i,n.canvas.style[e]=t.replace("{0}",o(r)).replace("{1}",o(i)),!0)}}(),d=[];e.on(e.REFLOW,function(){if(d.length)for(var e=null,t=null;d.length;)for(e=d.shift(),t=e.stack;t.length;){var r=e,i=t.shift(),s=r.lookingAt instanceof n?r.lookingAt:null;if(s){var o=i.x,u=i.y,a=i.w,f=i.h;if(a&&f){var l=r.ctx,c=s.search(i),p=c.length,v=r.renderview;h.push(i),p&&s.sort(c),l.save(),l.translate(-v.x,-v.y),l.clearRect(o,u,a,f),l.beginPath(),l.rect(o,u,a,f),l.clip(),s.render(l);for(l.closePath();p--;)i=c[p],i.opacity&&(s=i.global,l.save(),l.transform(s.m11,s.m21,s.m12,s.m22,s.m13,s.m23),l.beginPath(),l.rect(i.left,i.top,i.width,i.height),l.clip(),l.closePath(),l.globalAlpha=i.opacity,i.render(l),l.restore());r.debug&&(l.fillStyle="rgba({}, {}, {}, {})".format(255*Math.random()|0,255*Math.random()|0,255*Math.random()|0,.2),l.fillRect(o,u,a,f)),l.restore()}}}})}(Engine.Loop,Engine.Camera,Engine.Scene,Engine.Box,Math.min,Math.max,Math.round,Engine.Renderer.ctx.canvas,Engine.Renderer.ctx),Engine.Renderer.Cache=function(e,t){function n(t,n,r){var s=new e;return s.addEventListener("load",i),s.addEventListener("error",o),s.addEventListener("load",n),s.addEventListener("error",r),s.src=t,s}function r(){i.call(this);var e=this.src;if(e=a.hasOwnProperty(e)?a[e]:null)for(var t=0,n=e.length;t<n;t++)e[t].trigger("load");this.removeEventListener("load",r),this.removeEventListener("error",s)}function i(){var e=this.src,e=u.hasOwnProperty(e)?u[e]:u[e]=document.createElement("canvas");e.width=this.width,e.height=this.height,e.getContext("2d").drawImage(this,0,0)}function s(){o.call(this);var e=this.src;if(e=a.hasOwnProperty(e)?a[e]:null)for(var t=0,n=e.length;t<n;t++)e[t].trigger("error");this.removeEventListener("load",r),this.removeEventListener("error",s)}function o(){var e=this.src,e=u.hasOwnProperty(e)?u[e]:u[e]=document.createElement("canvas");e.width=0,e.height=0}var u={},a={};return{get:function(e){return e=String(e),u.hasOwnProperty(e)?u[e]:null},load:function(e,t,r){e=String(e);if(""===e)return!1;var i=u.hasOwnProperty(e)?u[e]:null;return i?i:(t=n(e,t,r),a[t.src]=a[e],u[e]=u[t.src]=document.createElement("canvas"))},set:function(e,n){e=String(e);if(""===e)return!1;var r=u.hasOwnProperty(e)?u[e]:u[e]=t.createElement("canvas");r.width=n.width,r.height=n.height,r.getContext("2d").drawImage(n,0,0);if(r=a.hasOwnProperty(e)?a[e]:null)for(var i=0,s=r.length;i<s;i++)r[i].trigger("load")},bind:function(e,t){e=String(e);if(""===e)return!1;(a.hasOwnProperty(e)?a[e]:a[e]=[]).add(t);var i=u.hasOwnProperty(e)?u[e]:null;i||(i=n(e,r,s),a[i.src]=a[e],i=u[e]=u[i.src]=document.createElement("canvas"),i.width=i.height=0),i.width&&i.height&&t.trigger("load")},unbind:function(e,t){e=String(e);if(""===e)return!1;var n=a.hasOwnProperty(e)?a[e]:null;return n&&n.remove(t),!0},create:n}}(Image,document),Engine.Font.PATH="fonts/",function(e,t,n,r,i,s,o){var u=e.ctx,a=u.canvas;t.prototype.debug=!1,t.prototype.render=function(e,t,n,r,i){this.debug&&(e.fillStyle="rgba({}, {}, {}, {})".format(255*s()|0,255*s()|0,255*s()|0,.2),e.fillRect(this.left,this.top,this.width,this.height))},t.prototype.redraw=function(e,n,r,i){arguments.length?(e=parseInt(e)||0,n=parseInt(n)||0,r=o(0,parseInt(r)||0),i=o(0,parseInt(i)||0),f(this,t.toBB(this.left+e,this.top+n,this.left+e+r,this.top+n+i,this.global))):f(this,this.bb)},t.prototype.getPixel=function(e,t,n){return u.save(),a.width=1,a.height=1,u.translate(-e,-t),this.render(u,e,t,1,1),u.restore(),e=u.getImageData(0,0,1,1).data,n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n};var f=e.updateDirtyRectangle=function(e,t){if(!e.types.has(r.GEOMETRY)||0==e.root instanceof r)return!1;for(var n=e.root.search(t,r.CAMERA),i=n.length;i--;)n[i].redraw(t)}}(Engine.Renderer,Engine.Geometry,Engine.Box,Engine.Scene,Engine.Camera,Math.random,Math.max),function(e,t,n,r){function i(e){e._pattern=null;var t=e.image;t instanceof r.Image&&n.Cache.unbind(t.src,e)}function s(e){var t=e.image;if(t instanceof r.Image)e instanceof Model||(e=e._image=new Engine.Image({src:t.src})),n.Cache.bind(t.src,e);else if(t instanceof r.Gradient){var i=t.from,s=t.to,o=t.steps;switch(t.type){case"radial":e=e._pattern=n.ctx.createRadialGradient(i.x,i.y,i.r,s.x,s.y,s.r);break;default:e=e._pattern=n.ctx.createLinearGradient(i.x,i.y,s.x,s.y)}t=0;for(i=o.length;t<i;t++)s=o[t],e.addColorStop(s.stop,s.color)}}e.property({_pattern:null,onload:function(){return this._pattern=n.ctx.createPattern(n.Cache.get(this.image.src),this.repeat),this.redraw(),!0}}),e.decorate({initialize:function(e){this._super(e),s(this)},setFill:function(e){i(this),this._super(e),s(this)},setImage:function(e){i(this),this._super(e),s(this)},setRepeat:function(e){i(this),this._super(e),s(this)},clearBB:function(e){return this._super(e)?(n.updateDirtyRectangle(this,this.bb),!0):!1},insertBB:function(e){return this._super(e)?(n.updateDirtyRectangle(this,this.bb),!0):!1}}),n.parseFill=function(e){i(e),s(e)},t.property({_pattern:null,onload:function(){return this._pattern=n.ctx.createPattern(n.Cache.get(this.image.src),this.repeat),this.redraw(),!0}}),t.decorate({initialize:function(e){this._super(e),s(this)},setFill:function(e){i(this),this._super(e),s(this)},setImage:function(e){i(this),this._super(e),s(this)},setRepeat:function(e){i(this),this._super(e),s(this)},redraw:function(){for(var e=this.search(null,t.CAMERA),n=0,r=e.length;n<r;n++)e[n].redraw(e[n].view)}}),t.method({render:function(e){this.color&&(e.save(),e.fillStyle=this.color+"",e.fill(),e.restore()),this._pattern&&(e.save(),e.fillStyle=this._pattern,e.fill(),e.restore())}})}(Engine.Geometry.Shape,Engine.Node.Scene,Engine.Renderer,Engine.Fill),function(e,t){e.decorate({render:function(e){e.translate(this.left,this.top),e.fillStyle=String(this.color),e.fillRect(0,0,this.width,this.height);var t=this.offsetX,n=this.offsetY;e.translate(t,n),e.fillStyle=this._pattern,e.fillRect(-t,-n,this.width,this.height),e.translate(-t,-n),e.strokeStyle=String(this.stroke),e.strokeRect(1,1,this.width-2,this.height-2),e.translate(-this.left,-this.top),this._super(e)}})}(Engine.Geometry.Rectangle,Engine.Renderer.updateDirtyRectangle),function(e){e.decorate("render",function(e){var t=this.points;if(!t||2>t.length)return!1;e.save(),e.beginPath(),e.moveTo.apply(e,t[0]);for(var n=1,r=t.length;n<r;n++)e.lineTo.apply(e,t[n]);e.lineTo.apply(e,t[0]),e.closePath(),e.fillStyle=String(this.color),e.fill(),e.fillStyle=this._pattern,e.fill(),e.strokeStyle=String(this.stroke),e.stroke(),e.restore(),this._super(e)})}(Engine.Geometry.Polygon),function(e){e.decorate({render:function(e){var t=this.left,n=this.top,r=this.originX-t,i=this.originY-n,s=this.radiusX-1,o=this.radiusY-1,u=.5522848*s,a=.5522848*o,f=r+s,l=i+o,s=r-s,o=i-o;e.save(),e.translate(t,n),e.beginPath(),e.moveTo(s,i),e.bezierCurveTo(s,i-a,r-u,o,r,o),e.bezierCurveTo(r+u,o,f,i-a,f,i),e.bezierCurveTo(f,i+a,r+u,l,r,l),e.bezierCurveTo(r-u,l,s,i+a,s,i),e.closePath(),e.clip(),e.fillStyle=String(this.color),e.fill(),u=this.offsetX,a=this.offsetY,e.translate(u,a),e.fillStyle=this._pattern,e.fillRect(-u,-a,this.width,this.height),e.translate(-u,-a),e.restore(),e.strokeStyle=String(this.stroke),e.stroke(),this._super(e)}})}(Engine.Geometry.Oval),function(e,t,n,r,i,s){function o(t){var s=e.getFont(t.font,t.textColor);if(!s.ready)return t.setBounds(0,0,0,0);for(var o=s.base,f=s.response,s=f.pages,l=f.common,h=f.chars,v=f.kernings,m=t.paddingLeft,g=t.paddingTop,y=t.paddingRight,w=t.paddingBottom,E=t.spacing,S=t.lineHeight===e.AUTO?parseInt(l.lineHeight):t.lineHeight,x=t.textAlign,T=t.minWidth,N=t.minHeight,C=t.maxWidth,L=t.maxHeight,l=x!==e.PRE?String(t.text).trim().replace(p,u):String(t.text),A=x!==e.PRE?l.match(p)||[]:[l],O=m,M=g,l=m,f=g,_=[],D=null,P=0;P<A.length;P++)switch(D=D||[],!0){case A[P]===c:O=m,M+=S;break;default:var H=new a(A[P],h,v,E,S,x===e.PRE?C:Infinity),B=H.x,j=H.y,F=H.w,I=H.h;0<P&&O+B+F>m+C&&(_.add(D),D=[],O=m,M+=S);if(!D.length&&d.test(H.text))continue;H.ox=O,H.oy=M,D.push(H),l=i(m+T+y,r(i(l,O+B+F+y),m+C+y)),f=i(m+N+y,r(i(f,M+j+I+w),g+L+w)),O+=B+F,_.add(D)}if(x!==e.PRE)for(h=l,v=0;v<_.length;v++)switch(m=_[v],m.length&&(d.test(m.first().text)&&m.shift(),m.length&&d.test(m.last().text)&&m.pop()),x){case e.RIGHT:g=m.last(),w=h-y,g=w-(g.ox+g.x+g.w);for(w=0;w<m.length;w++)m[w].ox+=g;break;case e.CENTER:g=m.last(),w=h-y,g=(w-(g.ox+g.x+g.w))/2;for(w=0;w<m.length;w++)m[w].ox+=g;break;case e.JUSTIFY:if(v===_.length-1)break;g=m.last(),w=h-y,g=w-(g.ox+g.x+g.w);for(w=1;w<m.length;w++)m[w].ox+=parseInt(g*(w/(m.length-1)))}y=t._canvas,y.width=l,y.height=f,y=t._ctx;for(x=0;x<_.length;x++)for(h=_[x],v=0;v<h.length;v++)for(m=h[v],g=m.ox,w=m.oy,E=0;E<m.length;E++)O=m[E],S=n.get(o+s[O.page].file),T=g+O.dx,N=w+O.dy,C=O.sx,L=O.sy,A=O.sw,O=O.sh,A&&O&&y.drawImage(S,C,L,A,O,T,N,A,O);t.setSize(l,f)||t.redraw()}function u(e){switch(!0){case e===c:return c;case d.test(e):return l;default:return e}}function a(e,t,n,o,u,a){this.length=this.oy=this.ox=0,this.text=e;var l=0,p=0,d=0,v=0,g=0,y=0,b=0;e=e.split("");for(var w=0,E=e.length;w<E;w++)switch(!0){case e[w]===c:g=0,y+=u,l=r(g,l),p=r(y,p),d=i(d,g),v=i(v,y+u);break;default:var S=e[w].charCodeAt(0),x=t[S]||t[h],T=parseInt(x.x),N=parseInt(x.y),C=parseInt(x.width),k=parseInt(x.height),L=parseInt(x.xoffset),A=parseInt(x.yoffset),O=parseInt(x.xadvance),x=parseInt(x.page),b=parseInt(n[[b,S]])||0;g+L+C>a?(g=L,y+=u):g+=L,l=r(g,l),p=r(y,p),d=i(d,g+C),v=i(v,y+A+k),s.call(this,new f(g,y+A,T,N,C,k,x)),g+=O,g+=b,g+=o,b=S}this.x=l,this.y=p,this.w=d-l,this.h=v-p}function f(e,t,n,r,i,s,o){this.dx=e,this.dy=t,this.sx=n,this.sy=r,this.sw=i,this.sh=s,this.page=o}var l=" ",c="\n",h=l.charCodeAt(0);e.property("on"+e.READY,function(){o(this)}),e.decorate({initialize:function(n){this._ctx=t.createContext(),this._canvas=this._ctx.canvas;var r=e.getFont(this.font,this.textColor);r&&(r.ready?this.trigger(e.READY):this.subscribe(r,e.READY)),this._super(n)},setFont:function(t){var n=e.getFont(this.font,this.textColor);return this._super(t)?(this.unsubscribe(n,e.READY),(t=e.getFont(this.font,this.textColor))&&(t.ready?this.trigger(e.READY):this.subscribe(t,e.READY)),!0):!1},setTextColor:function(t){var n=e.getFont(this.font,this.textColor);return this._super(t)?(this.unsubscribe(n,e.READY),(t=e.getFont(this.font,this.textColor))&&(t.ready?this.trigger(e.READY):this.subscribe(t,e.READY)),!0):!1},setText:function(e){return this._super(e)?(o(this),!0):!1},setSpacing:function(e){return this._super(e)?(o(this),!0):!1},setLineHeight:function(e){return this._super(e)?(o(this),!0):!1},setTextAlign:function(e){return this._super(e)?(o(this),!0):!1},setPadding:function(e,t,n,r){return this._super(e,t,n,r)?(o(this),!0):!1},setMinWidth:function(e){return this._super(e)?(o(this),!0):!1},setMinHeight:function(e){return this._super(e)?(o(this),!0):!1},setMaxWidth:function(e){return this._super(e)?(o(this),!0):!1},setMaxHeight:function(e){return this._super(e)?(o(this),!0):!1},render:function(e){e.translate(this.left,this.top),e.fillStyle=String(this.color),e.fillRect(0,0,this.width,this.height);var t=this.offsetX,n=this.offsetY;e.translate(t,n),e.fillStyle=this._pattern,e.fillRect(-t,-n,this.width,this.height),e.translate(-t,-n),t=this._canvas,t.width&&t.height&&e.drawImage(t,0,0),e.strokeStyle=String(this.stroke),e.strokeRect(1,1,this.width-2,this.height-2),e.translate(-this.left,-this.top),this._super(e)},setSize:function(e,t){return this._super(e,t)?(this.redraw(),!0):!1}});var p=/(\n|\s+|\S+)/g,d=/^\s+$/}(Engine.Geometry.Shape.Text,Engine.Renderer,Engine.Renderer.Cache,Math.min,Math.max,Array.prototype.push),function(e,t,n,r){function i(e){t.call(this,{src:e}),this.ready=!1,this.base=String(this.src).replace(a,""),this.pages=[]}function s(e){for(var t={},n=0,r=e.length;n<r;n++){var i=e[n];t[i.id]=i}return t}function o(e){for(var t={},n=0,r=e.length;n<r;n++){var i=e[n];t[[i.first,i.second]]=i.amount}return t}var u={},a=/[^\/]+$/;Class.extend(i,t),i.method({onload:function(t){function r(){return 0<--l?!1:(i.ready=!0,i.trigger(e.READY),!0)}var i=this,u=t.pages,a=this.base,l=u.length;t.chars=s(t.chars["char"]),t.kernings=t.kernings?o(t.kernings.kerning||[]):{},this._super(t);for(t=0;t<u.length;t++)(function(e){e=a+e.file;if(n.get(e))return r();n.load(e,r)})(u[t])}}),e.getFont=function(e,t){var n=r.PATH+"{}/{}/{}/{}/{}".format(e.family,e.weight,e.style,t,e.size)+".json";return""===n?null:u.hasOwnProperty(n)?u[n]:u[n]=new i(n)}}(Engine.Geometry.Shape.Text,Engine.Network.Resource,Engine.Renderer.Cache,Engine.Font),function(e,t,n,r){e.property({onload:function(){this.complete=!0;var e=this.canvas=t.Cache.get(this.src);e?this.setSize(e.width,e.height):this.setSize(0,0)}}),e.decorate({initialize:function(){this.canvas=null;var e=this.src;e&&t.Cache.bind(e,this)},setSrc:function(e){var n=this.src;return this._super(e)?(e=this.src,n&&t.Cache.unbind(n,this),this.canvas=null,e&&t.Cache.bind(e,this),!0):!1},render:function(e){var t=this.canvas;t&&t.width&&t.height&&e.drawImage(t,this.left,this.top),this._super(e)},setBounds:function(e,t,n,r){return this._super(e,t,n,r)?!0:!1},clearBB:function(e){return this._super(e)?(n(this,this.bb),!0):!1},insertBB:function(e){return this._super(e)?(n(this,this.bb),!0):!1}})}(Engine.Image,Engine.Renderer,Engine.Renderer.updateDirtyRectangle,Engine.Geometry),function(e,t,n,r,i){t.property({onload:function(){this.complete=!0,this.canvas=e.Cache.get(this.src),this.redraw()}});var s=n.prototype.render;t.decorate("render",function(e){var t=this.canvas;if(!t)return!1;var n=t.width,o=t.height;if(!n||!o)return!1;var u=this.offsetx,l=this.offsety,c=r(i(0,-u),n),h=r(i(0,-l),o),n=r(i(0,-u+this.width),n)-c,o=r(i(0,-l+this.height),o)-h;n&&o&&e.drawImage(t,c,h,n,o,this.left+c+u,this.top+h+l,n,o),s.call(this,e)})}(Engine.Renderer,Engine.Image.Sprite,Engine.Geometry,Math.min,Math.max),function(e){function t(e){}var n={loadstart:t,progress:t,suspend:t,stalled:t,durationchange:t,loadedmetadata:t,canplay:t,canplaythrough:t,play:t,playing:function(e){this.playing=!0},seeking:t,seeked:function(e){this.redraw(0,0,this.width,this.height)},loadend:t,timeout:t,emptied:t,pause:function(e){this.playing=!1},stop:t,loadeddata:function(t){switch(this.autosize){case e.AUTO:this.setSize(this.video.videoWidth,this.video.videoHeight)}},waiting:t,timeupdate:function(e){this.redraw(0,0,this.width,this.height)},ended:function(e){this.playing=!1},ratechange:t,volumechange:t};e.decorate("setSrc",function(e){this.video&&(this.video.pause(),delete this.video,this.setSize(0,0)),this._super(e),this.video=document.createElement("video"),this.video.loop=this.loop,this.video.src=this.src;for(var t in n)this.video.on(t,n[t].bind(this))}),e.prototype.play=function(){this.video&&(this.video.volume=this.globalVolume,this.video.play())},e.prototype.pause=function(){this.video&&this.video.pause()},e.prototype.stop=function(){this.video&&(this.video.pause(),this.video.currentTime=0)},e.decorate("render",function(e){this.video&&e.drawImage(this.video,0,0,this.video.videoWidth,this.video.videoHeight,this.left,this.top,this.width,this.height),this._super(e)})}(Engine.Geometry.Media.Video),function(e,t,n,r,i){function s(t){t=this.self;if(!t.pending||this instanceof n&&this.readyState!==l)return!1;var s=parseInt(this.status)||200;switch(!0){case c.test(s):try{var o=e.parse(t,this)}catch(u){t.trigger(e.ERROR,new i(u.message));break}t.trigger(e.LOAD,o);break;case h.test(s):t.trigger(e.ERROR,new r(s))}}function o(t){this.self.trigger(e.PROGRESS,t?t.position||t.loaded:1,t?t.totalSize||t.total:1)}function u(t){this.self.trigger(e.ERROR,t)}function a(t){this.self.trigger(e.ABORT)}var f=e.XHR="_xhr",l=4,c=/^[23]\d+$/,h=/^[45]\d+$/;e.property(f,null),e.decorate("load",function(){if(!this._super())return!1;var n=this[f]=e.transport(this);n.self=this,n.onload=s,n.onreadystatechange=s,n.onerror=u,n.onprogress=o,n.onabort=a;var r=this.method,i=this.src,l={};switch(r){case e.GET:var c=i.indexOf("?"),h=i.indexOf("#"),c=~c?c+1:i.length,h=~h?h:i.length,l=t.fromQuery(i.slice(c,h).split("&")),l=t.toQuery(Object.merge(l,this.data)),i=i.slice(0,c)+l+i.slice(h);break;case e.POST:l=t.toQuery(this.data)}return n.open(r,i,!0),e.prepare(this,n),n.send(l),!0}),e.decorate("abort",function(){return this._super()?(this[f]&&this[f].abort(),!0):!1})}.call(this,Engine.Network.Resource,Engine.Network.Url,global.XMLHttpRequest||Engine.NOP,Engine.Network.Resource.Error.Request,Engine.Network.Resource.Error.Parse),function(e,t,n,r){var i="Internet Explorer"===n.navigator.browser.name,s=parseInt(n.navigator.browser.version),o=t.parse(r);e.transport=function(e){return e=t.parse(e.src),i&&10>s&&e.host&&e.host!==o.host?new XDomainRequest:new XMLHttpRequest}}(Engine.Network.Resource,Engine.Network.Url,Engine.Device,global.location),function(e,t,n){var r={};r[e.TEXT]="text",r[e.JSON]="json",r[e.DATA]="arraybuffer",r[e.AUTO]="",e.prepare=function(n,i){switch(!0){case i instanceof t:var s=n.headers;if(i.setRequestHeader){if(s)for(var o in s)i.setRequestHeader(o,s[o]);n.method===e.POST&&i.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")}i.responseType=r[n.type]||r[e.AUTO]}}}(Engine.Network.Resource,global.XMLHttpRequest||Engine.NOP,global.XDomainRequest||Engine.NOP),function(e,t,n,r){function i(e){return"function"==typeof u&&e.response instanceof u?new Uint8Array(e.response):o&&e instanceof XMLHttpRequest?(new VBArray(e.responseBody)).toArray():e.responseText.toByteArray()}function s(e){return e=e.response||e.responseText,"object"==typeof e?e:JSON.parse(e)}var o="Internet Explorer"===t.navigator.browser.name,u=n.ArrayBuffer,a=/text/,f=/json/;e.parse=function(t,n){switch(t.type){case e.DATA:return i(n);case e.JSON:return s(n);case e.TEXT:return n.responseText;case e.AUTO:var o=String(n instanceof r?n.contentType:n.getResponseHeader("Content-type"));return a.test(o)?n.responseText:f.test(o)?s(n):i(n)}}}(Engine.Network.Resource,Engine.Device,global,global.XDomainRequest||Engine.NOP),function(e){function t(){this.trigger("open")}function n(e){this.trigger("message",e)}function r(){this.trigger("error")}function i(){this.trigger("close")}e.prototype.sock=null,e.decorate({connect:function(e){return this.sock?!1:(this.sock=new SockJS(this.src,null,e),this.sock.onopen=t.bind(this),this.sock.onmessage=n.bind(this),this.sock.onclose=i.bind(this),this.sock.onerror=r.bind(this),!0)},send:function(e){this.sock.send(e)},close:function(){this.sock.close(),delete this.sock.onopen,delete this.sock.onmessage,delete this.sock.onclose,delete this.sock.onerror,delete this.sock}})}(Engine.Network.Socket),Engine.I18n=function(e,t,n){var r=null,i={},s={tr:function(){return(r?r.tr:s.Translator.prototype.tr).apply(null,arguments)},changeLang:function(e){return e=null!==e?s.getTranslator(e):null,s.setDefaultTranslator(e)},setDefaultTranslator:function(t){if(null===t)return r=null;if(!(t instanceof s.Translator))throw new e.Type;if(!s.getTranslator(t.code))throw new e.Reference("Engine.I18n.setDefaultTranslator: specified "+t.code+" language translator doesn't exist; Create it using `Engine.I18n.translatorFactory()` method.");r=t},translatorFactory:function(){n.call(arguments,null);var e=new(t.apply(s.Translator,arguments)),r=s.getTranslator(e.code);return r?(Object.merge(r,e),Engine.log("Engine.I18n: translator for "+r.code+" language already exists; Before created translator has been overridden.",Engine.WARN),r):(s.registerTranslator(e),e)},getTranslator:function(e){return i[e+""]},getDefaultTranslator:function(){return r},registerTranslator:function(t){if(!(t instanceof s.Translator))throw new e.Type;if(s.getTranslator(t.code))throw new e.Reference;i[t.code]=t,r||s.setDefaultTranslator(t)},unregisterTranslator:function(t){if(!(t instanceof s.Translator))throw new e.Type;if(!s.getTranslator(t.code))throw new e.Reference;i[t.code]=null,r===t&&s.setDefaultTranslator(null)}};return s}(Engine.Error,Function.prototype.bind,Array.prototype.unshift),Engine.I18n.Translator=function(d,c,b,a,e){function f(e,t,n){var r=Object(e);"object"!=typeof e&&(r={code:e,rules:t,strings:n}),Model.call(this,r);if(!h.test(this.code+""))throw new c.Type("Engine.I18n.Translator: language code is invalid");t=this.rules,this.rules=null;if(!this.setRules(t))throw new c.Type("Engine.I18n.Translator: specified `rules` has to be an array of functions");n=this.strings,this.strings=null;if(!this.setStrings(n))throw new c.Type("Engine.I18n.Translator: `strings` has to be an object");this.tr=this.tr.bind(this)}function g(e){return"function"==typeof e&&"boolean"==typeof e(0)}Class.extend(f,Model),f.DEFAULT_CONTEXT="";var h=/^[a-z]{2}_[A-Z]{2}$/;return f.property({code:"",rules:null,strings:null,defaultContext:f.DEFAULT_CONTEXT}),f.parseRulesFromJSON=function(a){if("string"==typeof a)try{a=JSON.parse(a)}catch(d){throw new c.Type("Engine.I18n.Translator.parseRulesFromJSON: specified `rules` can't be parsed from JSON")}if(!b(a)||!a.every(e))throw new c.Type("Engine.I18n.Translator.parseRulesFromJSON: array of strings expected");for(var f=0,g=a.length;f<g;f++){var h=a[f],q=new Function("n","return "+h+";");try{eval("funcEval = "+q),(void 0)(0)}catch(r){throw new c.Type("Engine.I18n.Translator.parseRulesFromJSON: "+f+" element of `rules` ("+h+") can't be parsed into function")}if("boolean"!=typeof q(0))throw new c.Type("Engine.I18n.Translator.parseRulesFromJSON: element index "+f+" of `rules` ("+h+") doesn't return boolean value");a[f]=q}return a},f.method({setRules:function(e){return this.rules===e||!b(e)||!e.every(a)||!e.every(g)?!1:(this.rules=e,!0)},setStrings:function(e){return this.strings===e||"object"!=typeof e||b(e)?!1:(this.strings=e,!0)},tr:function(){return function(e,t,n,r){var i=Object(this);if("undefined"==typeof e)throw new c.Type("Engine.I18n.Translator::tr: Nothing to translate");if(null!=t&&"string"!=typeof t)throw new c.Type("Engine.I18n.Translator::tr: disambiguation is not a string");if(null==n||"number"==typeof n&&!!isFinite(n)){if(null!=r&&"object"!=typeof r)throw new c.Type("Engine.I18n.Translator::tr: format is not an object");e+="",t=t||i.defaultContext||f.DEFAULT_CONTEXT,n=n||0,r=r||null;var s=i.strings&&i.strings[e];if(s)if("object"!=typeof s||b(s)||(s=s[t]),"string"==typeof s)e=s;else{if(t=b(s))if(t=i.rules){e:{i=i.rules,t=n;if(i.length)for(var o=0,u=i.length;o<u;o++)if(i[o](t)){i=o;break e}i=void 0}t=s[i]}e=t||e}return e=e.replace("{n}",n),r?e.format(r):e}throw new c.Type("Engine.I18n.Translator::tr: count is not a proper number")}}()}),f}(Engine.I18n,Engine.Error,Array.isArray,Function.isFunction,String.isString),Engine.Input=function(){var e=new Model;return e.events={},e.propagateEvent=function(t,n){if(t instanceof e.Event){if(!n||!n.length||!t.propagate)return t.propagate;for(var r=0,i=n.length,s;r<i;r++)if(s=n[r],t.fire(s),!t.propagate)return s;return t.propagate}throw new TypeError("Input#propagateEvent: Event to propagate must be a Input#Event instance")},e}(),Engine.Input.Event=function(e){function t(t){this.type=t&&"string"==typeof t.type?t.type:this.type,this.propagate=t&&"boolean"==typeof t.propagate?t.propagate:this.propagate,this.prevent=t&&"boolean"==typeof t.prevent?t.prevent:this.prevent,this.defaultAction=t&&"function"==typeof t.defaultAction?t.defaultAction:this.defaultAction;if(!this.type.length)throw new e.Type("Input#Event: type is required")}return t.property({type:"",propagate:!0,prevent:!1}),t.property("toClone",{propagate:t.prototype.propagate,prevent:t.prototype.prevent}),t.method({stopPropagation:function(){return this.propagate=!1},preventDefault:function(){return this.prevent=!0},defaultAction:Engine.NOP,fire:function(e){if(!(e instanceof Model))return!1;e.queue(this.type,this),!this.prevent&&"function"==typeof this.defaultAction&&this.defaultAction(e)}}),t}(Engine.Error),Engine.Input.Event.Focus=function(e){function t(t){e.call(this,t)}return Class.extend(t,e),t.FOCUS="focus",t.BLUR="blur",t.property("propagate",!1),t}(Engine.Input.Event),Engine.Input.Event.Mouse=function(e,t,n,r,i,s,o,u,a){function f(a){e.call(this,a),this.button=a&&"number"==typeof a.button?a.button:this.button,this.timestamp=a&&"number"==typeof a.timestamp?a.timestamp:this.timestamp,this.x=a&&"number"==typeof a.x?a.x:this.x,this.y=a&&"number"==typeof a.y?a.y:this.y,this.movementX=a&&"number"==typeof a.movementX?a.movementX:this.movementX,this.movementY=a&&"number"==typeof a.movementY?a.movementY:this.movementY,this.viewX=a&&"number"==typeof a.viewX?a.viewX:this.viewX,this.viewY=a&&"number"==typeof a.viewY?a.viewY:this.viewY,this.cameraX=a&&"number"==typeof a.cameraX?a.cameraX:this.cameraX,this.cameraY=a&&"number"==typeof a.cameraY?a.cameraY:this.cameraY,this.sceneX=a&&"number"==typeof a.sceneX?a.sceneX:this.sceneX,this.sceneY=a&&"number"==typeof a.sceneY?a.sceneY:this.sceneY,this.parent=a&&a.parent instanceof f?a.parent:this.parent,this.viewport=a&&a.viewport instanceof n?a.viewport:this.viewport,this.camera=a&&a.camera instanceof i?a.camera:this.camera,this.scene=a&&a.scene instanceof r?a.scene:this.scene,this.nodes=a&&u(a.nodes)?a.nodes:this.nodes,this.geometry=a&&a.geometry instanceof s?a.geometry:this.geometry;switch(!0){case this.viewport&&!(this.viewport instanceof n):case this.camera&&!(this.camera instanceof i):case this.scene&&!(this.scene instanceof r):case this.geometry&&!(this.geometry instanceof s):case this.nodes&&!u(this.nodes):case this.parent&&!(this.parent instanceof f):throw new t.Type("Engine.Input.Event.Mouse: invalid config object")}this.timestamp=o()}return Class.extend(f,e),f.BUTTON={LEFT:0,MIDDLE:1,RIGHT:2},f.MOUSEDOWN="mousedown",f.MOUSEUP="mouseup",f.MOUSEMOVE="mousemove",f.property({button:f.BUTTON.LEFT,timestamp:0,x:0,y:0,movementX:0,movementY:0,viewX:0,viewY:0,cameraX:0,cameraY:0,sceneX:0,sceneY:0,parent:null,viewport:null,camera:null,scene:null,nodes:null,geometry:null}),f.method({getElements:function(){var e=[];return this.geometry&&e.push(this.geometry),this.nodes&&this.nodes.length&&a.apply(e,this.nodes),this.scene&&e.push(this.scene),e},getModels:function(){var e=this.getElements();return this.camera&&e.push(this.camera),this.viewport&&e.push(this.viewport),e}}),f}(Engine.Input.Event,Engine.Error,Engine.Viewport,Engine.Scene,Engine.Camera,Engine.Geometry,Engine.now,Array.isArray,Array.prototype.push),Engine.Input.Event.Mouse.Drag=function(e){function t(t){e.call(this,t)}return Class.extend(t,e),t.DRAGSTART="dragstart",t.DRAGEND="dragend",t.DRAGMOVE="dragmove",t}(Engine.Input.Event.Mouse),Engine.Input.Event.Keyboard=function(e,t,n){function r(e){t.call(this,e),this.key=e&&"string"==typeof e.key?e.key:this.key,this.keyCode=e&&"number"==typeof e.keyCode?e.keyCode:this.keyCode,this.text=e&&"string"==typeof e.text?e.text:this.text,this.modifiers=e&&"number"==typeof e.modifiers?e.modifiers:this.modifiers,e=this.keyCode|0,this.key=i[e]||(e?n(e):this.key)}Class.extend(r,t),r.KEYDOWN="keydown",r.KEYPRESS="keypress",r.KEYUP="keyup",r.CTRL_MODIFIER=1,r.ALT_MODIFIER=2,r.SHIFT_MODIFIER=4;var i=r.SPECIAL_KEY_CODES={8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",17:"CTRL",18:"ALT",19:"PAUSE",20:"CAPS_LOCK",27:"ESC",32:"SPACE",33:"PAGE_UP",34:"PAGE_DOWN",35:"END",36:"HOME",37:"ARROW_LEFT",38:"ARROW_UP",39:"ARROW_RIGHT",40:"ARROW_DOWN",45:"INSERT",46:"DELETE",91:"SUPER_LEFT",92:"SUPER_RIGHT",93:"SELECT",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NUM_LOCK",145:"SCROLL_LOCK"};return r.property({key:"",keyCode:0,text:"",modifiers:0}),r}(Engine.Input,Engine.Input.Event,String.fromCharCode),Engine.Input.Pointer=function(e){var t=new Model;return t.viewport=null,t.LOCK="lock",t.UNLOCK="unlock",t.isLocked=function(){return!!t.viewport},t.lock=function(e,n,r){return t.viewport===e?(t.trigger(t.LOCK),n()):r(),this},t.unlock=function(e,n){return t.viewport?n():(t.trigger(t.UNLOCK),e()),this},t.toggle=function(e,n,r){return t.viewport?t.unlock(n,r):t.lock(e,n,r)},t}(Engine.Error),function(e,t){e.events.mouse=[t.MOUSEDOWN,t.MOUSEUP,t.MOUSEMOVE],e.pressed=null,e.DELTA=10,e.on(t.MOUSEDOWN,function(e){this.pressed=e}),e.on(t.MOUSEUP,function(e){this.pressed=null}),Class.decorate(e,"propagateEvent",function(e,n){return e instanceof t&&!n&&(n=e.getModels()),this._super(e,n)})}(Engine.Input,Engine.Input.Event.Mouse),function(e){e.property({captureTransparent:!0})}(Engine.Camera),function(e,t,n,r,i){e.dragged=!1;var s=new r(0,0,e.DELTA,e.DELTA),o=new r(0,0,1,1),u=null;e.on(t.MOUSEDOWN,function(e){s.x=e.x-s.w/2,s.y=e.y-s.h/2;if(e.camera)for(var t=e.getModels(),n=t.length,r;n--;)if(r=t[n],r.selectable||r.scrollable)return u=e}),e.on(t.MOUSEUP,function(t){u=null;if(e.dragged){var r=i(t);r.type=n.DRAGEND,(new n(r)).fire(e.dragged),e.dragged=null,t.stopPropagation()}}),e.on(t.MOUSEMOVE,function(t){if(u||e.dragged){if(e.dragged)return t=i(t),t.type=n.DRAGMOVE,(new n(t)).fire(e.dragged);o.x=t.x,o.y=t.y;if(!o.overlap(s)){t=[];for(var r=u.getModels(),a=0,l=r.length;a<l;a++)r[a].scrollable&&t.push(r[a]);if(!t.length)return u=null;r=i(u),r.type=n.DRAGSTART,e.dragged=this.propagateEvent(new n(r),t),u=null;if(!(e.dragged instanceof Model))return e.dragged=null}}}),Class.decorate(e,"on"+t.MOUSEMOVE,function(t){e.dragged&&t.stopPropagation(),this._super(t)})}(Engine.Input,Engine.Input.Event.Mouse,Engine.Input.Event.Mouse.Drag,Engine.Box,Object.clone),function(e,t,n,r){function i(e){this._isScrolled=!0,e.stopPropagation()}function s(e){this._isScrolled=!1,this.moveTo(this.x,this.y)}function o(e){var t=this.zoom;this.moveBy(-e.movementX/t,-e.movementY/t)}t.decorate("initialize",function(e){this._super&&this._super(e),this.scrollable&&(this.on(r.DRAGSTART,i),this.on(r.DRAGEND,s),this.on(r.DRAGMOVE,o))}),t.property({scrollable:!0,_isScrolled:!1})}(Engine.Input,Engine.Camera,Engine.Input.Event.Mouse,Engine.Input.Event.Mouse.Drag),function(e,t,n){t.MOUSEOVER="mouseover",t.MOUSEOUT="mouseout",t.MOUSEENTER="mouseenter",t.MOUSELEAVE="mouseleave";var r=null;["on"+t.MOUSEDOWN,"on"+t.MOUSEMOVE].forEach(function(i){Class.decorate(e,i,function(e){this._super(e);if(e.propagate){var i=r&&r.getModels().without(e.getModels()),s=e.getModels().without(r&&r.getModels());if(i&&i.length){var o=n(e);o.type=t.MOUSEOUT,this.propagateEvent(new t(o),r.getModels()),o=n(r),o.type=t.MOUSELEAVE,this.propagateEvent(new t(o),i)}s&&s.length&&(i=n(e),i.type=t.MOUSEOVER,this.propagateEvent(new t(i),e.getModels()),i=n(e),i.type=t.MOUSEENTER,this.propagateEvent(new t(i),s)),r=e}})})}(Engine.Input,Engine.Input.Event.Mouse,Object.clone),function(e,t,n){e.events.mouse.push(t.MOUSECLICK="mouseclick");var r=null;e.on(t.MOUSEDOWN,function(e){e.propagate&&(r=e)}),e.on(t.MOUSEUP,function(e){e.propagate&&(e=n(e),e.type=t.MOUSECLICK,e.parent=r,(new t(e)).fire(this))})}(Engine.Input,Engine.Input.Event.Mouse,Object.clone),function(e,t,n){if(!t.MOUSECLICK)throw"Engine.Input: `mousedblclick` requires `mouseclick` event";e.events.mouse.push(t.MOUSEDBLCLICK="mousedblclick");var r=null;e.on(t.MOUSECLICK,function(e){if(!r||500<e.timestamp-r.timestamp)return r=e;e=n(e),e.type=t.MOUSEDBLCLICK,e.parent=r,(new t(e)).fire(this)})}(Engine.Input,Engine.Input.Event.Mouse,Object.clone),function(e,t,n,r){function i(){s&&clearTimeout(s),a=s=null}e.events.mouse.push(t.MOUSEHOLD="mousehold");var s=0,o=new n(0,0,e.DELTA,e.DELTA),u=new n(0,0,1,1),a=null;e.on(t.MOUSEDOWN,function(e){var n=this;s&&clearTimeout(s),s=setTimeout(function(){if(a){var s=r(a);s.type=t.MOUSEHOLD,s.parent=a!==e&&e,(new t(s)).fire(n)}i()},1e3),o.x=e.x-o.w/2,o.y=e.y-o.h/2,a=e}),e.on(t.MOUSEUP,i),e.on(t.MOUSEMOVE,function(e){a&&(a=e,u.x=e.x,u.y=e.y,u.overlap(o)||i())})}(Engine.Input,Engine.Input.Event.Mouse,Engine.Box,Object.clone),function(e,t,n,r,i){function s(e,t){return e.parent?e[t]===e.parent[t]:!0}function o(e,t){switch(t){case"viewport":e.viewport=null;case"camera":e.camera=null,e.cameraX=e.cameraY=0;case"scene":e.scene=null,e.sceneX=e.sceneY=0;case"geometry":e.geometry=null;case"nodes":e.nodes=null}}function u(e,t){var a=e.viewport;if(!a||!s(e,"viewport"))return"viewport";if(n.viewport===a)return"camera";a=e.camera=e.camera||a.getCameraByPixel(e.viewX,e.viewY,t);if(!a||!s(e,"camera"))return"camera";e.cameraX=e.cameraX||e.viewX-a.left,e.cameraY=e.cameraY||e.viewY-a.top;var f=e.scene=e.scene||a.lookingAt;if(!f||!s(e,"scene"))return"scene";e.sceneX=e.sceneX||a.toSceneX(e.cameraX),e.sceneY=e.sceneY||a.toSceneY(e.cameraY);if(!((e.geometry=e.geometry||f.captureGeometryByPixel(e.sceneX,e.sceneY))instanceof i&&s(e,"geometry")))return a.captureTransparent?"geometry":(t.push(a),o(e,"camera"),u(e,t));for(a=e.geometry;a&&(a=a.parent)&&!(a instanceof r);){var l=l||[];l.add(a)}e.nodes=l;if(!l||!l.length)return"nodes"}function a(e){f.clear(),o(e,u(e,f)),this._super(e)}var f=[];t=e.events.mouse;for(var l=t.length;l--;)Class.decorate(e,"on"+t[l],a)}(Engine.Input,Engine.Input.Event.Mouse,Engine.Input.Pointer,Engine.Scene,Engine.Geometry),function(e,t,n,r){if(!r.MOUSECLICK)throw"Engine#Input: broken dependencies for select elements on mouse event"}(Engine.Input,Engine.Scene,Engine.Element,Engine.Input.Event.Mouse),function(e,t,n){function r(e){return e.root.selected.has(e)?!0:(e=e.children)?e.some(r):!1}function i(e){var t=e.scene;t&&null!==t.multiSelect&&(t=this.children,!this.selectable||this.root.selected.has(this)||t&&t.some(r)||(this.select(),o=e))}function s(e){var t=e.scene;t&&e.parent!==o&&t.multiSelect&&(this.root.selected.has(this)&&this.deselect(),o=null)}var o=null;e.decorate("initialize",function(e){this._super(e),this instanceof t||!this.selectable||(this.on(n.MOUSEDOWN,i),this.on(n.MOUSECLICK,s))})}(Engine.Element,Engine.Scene,Engine.Input.Event.Mouse),function(e,t){function n(t){return t instanceof e?!1:t.selectable?!0:(t=t.children)?t.some(n):!1}function r(e){e.propagate&&this.selected.length&&!this.multiSelect&&(e.geometry&&e.getElements().some(n)||this.deselectAll())}e.decorate("initialize",function(e){this._super(e),this.on(t.MOUSECLICK,r)})}(Engine.Scene,Engine.Input.Event.Mouse),function(e,t,n,r){e.focused=null,e.getFocusedLeaf=function(){for(var e=this;e.focused||e.lookingAt;)e=e.focused||e.lookingAt;return e},e.setFocusOn=function(){var e={type:""};return function(r){if(null===r||r instanceof t)return this.focused===r?!0:(this.focused&&(e.type=n.BLUR,(new n(e)).fire(this.focused),this.focused=null),r&&(this.focused=r,e.type=n.FOCUS,(new n(e)).fire(r)),!0);throw"Input#setFocusOn: viewport to focus must be a viewport"}}(),e.on(r.MOUSEDOWN,function(e){var t=e.camera;if(t)return t.focus();(t=this.focused)&&t.focused&&t.setFocusOn(null);if(e=e.viewport)return e.focus();this.focused&&this.setFocusOn(null)})}(Engine.Input,Engine.Viewport,Engine.Input.Event.Focus,Engine.Input.Event.Mouse),function(e,t,n){t.property("focusable",!1),t.method({focus:function(){return this.root instanceof n?this.root.setFocusOn(this):!1},blur:function(){return this.root instanceof n&&this.root.focused===this?this.root.setFocusOn(null):!1}}),t.decorate("update",function(){var e=this.root;this._super(),e instanceof n&&this.root!==e&&e.focused===this&&e.setFocusOn(null)})}(Engine.Input,Engine.Element,Engine.Scene),function(e,t,n,r,i){function s(e){do if(e.focusable&&e.root&&e.focus())return!0;while(e=e.parent);return!1}function o(e){if(e.geometry&&(s(e.geometry)||(e=this.captureGeometryByPixel(e.sceneX,e.sceneY,[e.geometry],s))&&this.setFocusOn(e)))return;this.setFocusOn(null)}t.property({focusable:!0,focused:null}),t.method({setFocusOn:function(){var e={type:""};return function(t){if(!this.focusable)return!1;if(null!==t){if(!(t.root&&t instanceof n&&t.root===this))return!1;var i=t;do if(!i.focusable)return!1;while(i=i.parent);if(this.focused===t)return!0;for(var i=this.space.camera.get_tree().nodes,s=i.length,o;i[--s]&&(o=i[s].leaf)&&(!o.parent||o.parent.focused!==o););if(0>s)return!1}return this.focused&&(e.type=r.BLUR,(new r(e)).fire(this.focused),this.focused=null),t&&(this.focused=t,e.type=r.FOCUS,(new r(e)).fire(t)),!0}}(),focus:function(){throw"Scene::focus: Can't focus root element"},blur:function(){throw"Scene::focus: Can't blur root element"}}),t.decorate("initialize",function(e){this._super(e),this.on(i.MOUSEDOWN,o)})}(Engine.Input,Engine.Scene,Engine.Element,Engine.Input.Event.Focus,Engine.Input.Event.Mouse),function(e,t,n,r){n.property("focusable",!0),n.method({focus:function(){return this.parent?this.parent.setFocusOn(this):!1},blur:function(){return this.parent&&this.parent.focused===this?this.parent.setFocusOn(null):!1}}),n.method("on"+r.BLUR,function(){this.lookingAt&&this.lookingAt.setFocusOn(null)})}(Engine.Input,Engine.Element,Engine.Camera,Engine.Input.Event.Focus),function(e,t,n,r){t.decorate("initialize",function(t){this._super(t),!e.focus&&this.focus()}),t.property({focusable:!0,focused:null}),t.method({setFocusOn:function(){var e={type:""};return function(t){if(!this.focusable||!this.focus())return!1;if(null!==t){if(!(t instanceof n&&t.parent===this))return!1;if(this.focused===t)return!0}return this.focused&&(e.type=r.BLUR,(new r(e)).fire(this.focused),this.focused=null),t&&(this.focused=t,e.type=r.FOCUS,(new r(e)).fire(t)),!0}}(),focus:function(){return e.setFocusOn(this)},blur:function(){return e.focused===this?e.setFocusOn(null):!1}}),t.decorate({addCamera:function(e){var t=this._super(e);return t?(!this.focused&&this.setFocusOn(e),t):t},removeCamera:function(e){return e=this._super(e),e?(this.setFocusOn(null),e):e}}),t.method("on"+r.BLUR,function(){this.setFocusOn(null)})}(Engine.Input,Engine.Viewport,Engine.Camera,Engine.Input.Event.Focus),function(e,t){function n(e){var t=e.type===r|0&&f;switch(e.key){case"CTRL":l=o&t;break;case"ALT":c=u&t;break;case"SHIFT":h=a&t}e.modifiers=l|c|h}var r=t.KEYDOWN,i=t.KEYPRESS,s=t.KEYUP,o=t.CTRL_MODIFIER,u=t.ALT_MODIFIER,a=t.SHIFT_MODIFIER,f=o|u|a;e.events.keyboard=[r,i,s];var l=0,c=0,h=0;e["on"+r]=n,e["on"+i]=n,e["on"+s]=n}(Engine.Input,Engine.Input.Event.Keyboard),function(e,t){function n(e){var t=this.getFocusedLeaf();t!==this&&this.propagateEvent(e,[t])}e.events.keyboard.forEach(function(t){e.on(t,n)})}(Engine.Input,Engine.Input.Event.Keyboard),function(e){(function t(n){var r,i;for(i in n)n.hasOwnProperty(i)&&((r=n[i],"object"==typeof r)?t(r):e.on(r,e.propagateEvent))})(e.events)}(Engine.Input),function(e,t,n){function r(r,s){s.preventDefault();if(o!==s){var a=this instanceof t?this:null;u.type=r,u.button=s.button,u.movementX=s.movementX||s.mozMovementX||s.webkitMovementX,u.movementY=s.movementY||s.mozMovementY||s.webkitMovementY,u.movementX=null!=u.movementX?u.movementX:s[i]-u.x||0,u.movementY=null!=u.movementY?u.movementY:s.pageY-u.y||0,u.x=s[i],u.y=s.pageY,u.viewport=a,u.viewX=a&&s[i]-a.div.offsetLeft,u.viewY=a&&s.pageY-a.div.offsetTop,(new n(u)).fire(e),o=s}}if("undefined"==typeof window.ontouchstart){var i="pageX",s=document.documentElement,o=null,u={};t.decorate("initialize",function(e){this._super&&this._super(e),this.div.addEventListener("mousedown",r.bind(this,n.MOUSEDOWN)),this.div.addEventListener("mouseup",r.bind(this,n.MOUSEUP)),this.div.addEventListener("mousemove",r.bind(this,n.MOUSEMOVE))}),s.addEventListener("mousedown",r.bind(null,n.MOUSEDOWN)),s.addEventListener("mouseup",r.bind(null,n.MOUSEUP)),s.addEventListener("mousemove",r.bind(null,n.MOUSEMOVE))}}(Engine.Input,Engine.Viewport,Engine.Input.Event.Mouse),function(e,t,n,r){function i(r,i){if(this instanceof t){var l=i.touches.item(0)||i.changedTouches.item(0);o.x=l[s],o.y=l.pageY,u.x=this.div.offsetLeft,u.y=this.div.offsetTop,u.w=this.div.offsetWidth,u.h=this.div.offsetHeight;var p=o.overlap(u)?this:null;a.type=r,a.x=l[s],a.y=l.pageY,a.viewport=p,a.viewX=p&&l[s]-p.div.offsetLeft,a.viewY=p&&l.pageY-p.div.offsetTop,(new n(a)).fire(e),"touchend"===i.type&&(new n({type:n.MOUSEMOVE,propagate:!1,x:Infinity,y:Infinity})).fire(e)}}if("undefined"!=typeof window.ontouchstart){var s="pageX",o=new r(0,0,1,1),u=new r(0,0,0,0),a={};t.decorate("initialize",function(e){this._super&&this._super(e),this.div.addEventListener("touchstart",i.bind(this,n.MOUSEDOWN)),this.div.addEventListener("touchend",i.bind(this,n.MOUSEUP)),this.div.addEventListener("touchmove",i.bind(this,n.MOUSEMOVE)),this.div.addEventListener("touchmove",function(e){e.preventDefault()})})}}(Engine.Input,Engine.Viewport,Engine.Input.Event.Mouse,Engine.Box),function(e,t,n){function r(e){return(e.keyCode||e.which||e.key&&e.key.toUpperCase().charCodeAt()||0)|0}function i(i,a,f){var c=r(a);if(c){a=i===o,l.type=i,l.keyCode=c,l.text=a?f&&(f["char"]||n(f.charCode)):"",i=new t(l);if(a){l.type=u;var h=new t(l);h.text=""}return i.fire(e),h&&s(h,f),h||i}}function s(t,r){if(!t||!r)return!1;var i=r&&(r["char"]||n(r.charCode));return t.text===i?!1:(t.text=i,t.fire(e),!0)}var o=t.KEYDOWN,u=t.KEYPRESS,a=t.KEYUP,f=document.documentElement,l={},c=null,h=null,p={},d=[8,9];f.addEventListener("keydown",function(e){var t=r(e);d.has(t)&&e.preventDefault(),h=null,!p[t]&&setTimeout(function(){p[t]=i(o,e,h)},0),c=e}),f.addEventListener("keyup",function(e){i(a,e,h),c=0,h=null,p[r(e)]=null}),f.addEventListener("keypress",function(e){h=e;var t=p[r(c)];t&&s(t,e)})}(Engine.Input,Engine.Input.Event.Keyboard,String.fromCharCode),function(e,t){function n(){var t=l.shift(),n=l.shift(),i=!!r[s];e.viewport=i?t:null;if(n)return n();e.trigger(e[i?"LOCK":"UNLOCK"])}var r=window.document,i=r.documentElement,s="pointerLockElement"in r&&"pointerLockElement"||"webkitPointerLockElement"in r&&"webkitPointerLockElement"||"mozPointerLockElement"in r&&"mozPointerLockElement",o="onpointerlockchange"in r&&"pointerlockchange"||"onwebkitpointerlockchange"in r&&"webkitpointerlockchange"||"onmozpointerlockchange"in r&&"mozpointerlockchange",u="onpointerlockerror"in r&&"pointerlockerror"||"onwebkitpointerlockerror"in r&&"webkitpointerlockerror"||"onmozpointerlockerror"in r&&"mozpointerlockerror",a=i.requestPointerLock||i.webkitRequestPointerLock||i.mozRequestPointerLock,f=r.exitPointerLock||r.webkitExitPointerLock||r.mozExitPointerLock;if(!(s&&o&&u&&a&&f))return Engine.log("Engine.Input.Pointer: implementation not available");var l=[];r[s]&&(e.viewport=!0,e.unlock()),r.addEventListener(o,n),r.addEventListener(u,n),Class.decorate(e,"lock",function(e,t,n){return l.push(e,this._super.bind(this,e,t,n)),a.call(e.div),this}),Class.decorate(e,"unlock",function(e,t){return l.push(null,this._super.bind(this,e,t)),f.call(r),this})}(Engine.Input.Pointer,Engine.NOP),function(e,t,n,r){Class.decorate(e,"lock",function(i,s,o){i=i||Input.focused,s="function"==typeof s?s:r,o="function"==typeof o?o:r;if(i instanceof t){if(!i)throw new n.Reference("Engine.Input.Pointer: viewport to lock pointer doesn't exists");return e.viewport===i?(s(),this):this._super(i,s,o)}throw new n.Type("Engine.Input.Pointer: viewport must be a instance of Engine.Viewport")}),Class.decorate(e,"unlock",function(t,n){return t="function"==typeof t?t:r,n="function"==typeof n?n:r,e.viewport?this._super(t,n):(t(),this)})}(Engine.Input.Pointer,Engine.Viewport,Engine.Error,Engine.NOP),Engine.Sound=function(e){function t(e){if(!e||!e.src)throw new TypeError;Model.call(this,e),this.component=null,(this.refersTo=this.refersTo instanceof t.Component?this.refersTo:null)&&!t.Component.compare(this.refersTo,this)&&(this.refersTo=null,Engine.log("Sound can't refers to component with different src, loop or filter; new Component created",Engine.WARN)),this.refersTo||(this.refersTo=new t.Component({src:this.src,loop:this.loop,filter:this.filter})),this.refersTo.addSound(this),this.subscribe(this.refersTo,t.ENDED),this.subscribe(this.refersTo,t.LOADED),this.subscribe(this.refersTo,t.LOADERROR),this.autoplay&&this.on(t.LOADED,this.play)}return Class.extend(t,Model),t._implemented=!1,t.ENDED="ended",t.LOADED="loaded",t.LOADERROR="loaderror",t.property({refersTo:null,component:null,src:"",loop:!1,filter:null,autoload:!0,autoplay:!1,playing:!1}),t.now=function(){return e()/1e3},t.method({load:function(e,t){return this.component&&this.component.load(e,t)},play:function(e){return!this.component&&this.refersTo.addSound(this),(this.playing=!0)&&this.refersTo.play(e)},pause:function(e){return this.playing=!1,this.component&&this.component.pause(e)},stop:function(){return this.playing=!1,this.component&&!1!==this.component.stop()?this.component.removeSound(this):!1},toString:function(){var e="Sound `"+this.src+"`";return this.loop&&(e+="; looped"),this.filter&&(e+="; with filter `"+this.filter+"`"),e}}),t}(Engine.now),Engine.Sound.Error=function(e){function t(e,t){this.name="Sound"+e,this.message=t}return Class.extend(t,Error),t.UNKNOWN_ERROR="UnknownError",t.TYPE_ERROR="TypeError",t.RANGE_ERROR="RangeError",t.REFERENCE_ERROR="ReferenceError",t.REQUEST_ERROR="RequestError",t.NOT_IMPLEMENTED_ERROR="NotImplementedError",t.raise=function(n,r,i){if(1>arguments.length)throw new RangeError;return"object"!=typeof n&&(i=r,r=n,n=[]),i||(i=r,r=t.UNKNOWN_ERROR),e.call(n,new t(r,i)),n},t.exists=function(e){if("object"!=typeof e)throw new TypeError;for(var n=0,r=e.length;n<r;n++)if(e[n]instanceof t)return n;return!1},t.findAll=function(e){if("object"!=typeof e)throw new TypeError;for(var n=null,r=0,i=e.length;r<i;r++)e[r]instanceof t&&(n=n||[],n.push(e[r]));return n},t}(Array.prototype.push),function(e,t,n){e.globalVolume=1,e.VOLUME_DEFAULT=1,e.VOLUME_MIN=0,e.VOLUME_MAX=1,e.property("volume",e.VOLUME_DEFAULT),e.setGlobalVolume=function(r){if(1>arguments.length)throw new RangeError;e.globalVolume=t(n(parseFloat(r||0),e.VOLUME_MAX),e.VOLUME_MIN)},e.method("setVolume",function(r){if(1>arguments.length)throw new RangeError;this.volume=t(n(parseFloat(r||0),e.VOLUME_MAX),e.VOLUME_MIN)})}(Engine.Sound,Math.max,Math.min),function(e,t,n,r,i){var s=e.globalPosition={x:0,y:0,z:0,r:0};e.decorate("initialize",function(t){this._super(t),t=t&&t.position,this.position={x:t&&parseFloat(t.x||0)||0,y:t&&parseFloat(t.x||0)||0,z:t&&parseFloat(t.x||0)||0,r:e.calculateRadius(t)}}),e.property("position",null),e.calculateRadius=function(e){return e&&n(t(r(i(parseFloat(e.x||0),2)+i(parseFloat(e.y||0),2)+i(parseFloat(e.z||0),2)),0),1)},e.setGlobalPosition=function(r,i,o){s.x=t(n(parseFloat(r||0),1),-1),s.y=t(n(parseFloat(i||0),1),-1),s.z=t(n(parseFloat(o||0),1),-1),s.r=e.calculateRadius(s)},e.method("setPosition",function(r,i,s){this.position.x=t(n(parseFloat(r||0),1),-1),this.position.y=t(n(parseFloat(i||0),1),-1),this.position.z=t(n(parseFloat(s||0),1),-1),this.position.r=e.calculateRadius(this.position)})}(Engine.Sound,Math.max,Math.min,Math.sqrt,Math.pow),Engine.Sound.Component=function(e,t){function n(e){Model.call(this,e),this.sounds=[],this.autoload&&this.load()}return Class.extend(n,Model),n.property({sounds:null,src:"",loop:!1,filter:null,startTime:0,offset:0,duration:0,loaded:!1,loading:!1,playing:!1,_audio:null,onended:function(){for(var e=0,t=this.sounds,n=t.length;e<n;e++)t[0].stop()}}),n.compare=function(t,n){return this&&2>arguments.length&&(n=t,t=this),n instanceof e&&n.src===t.src&&n.loop===t.loop&&n.filter===t.filter},n.method({compare:n.compare,addSound:function(t){if(t instanceof e){if(t.refersTo!==this)throw new ReferenceError;if(!this.compare(t))throw new ReferenceError;if(this.sounds.has(t))return!1;var n=this.sounds.push(t);return t.component=this,t.autoload&&t.load(),t.autoplay&&t.play(0),n}throw new TypeError},removeSound:function(e){return this.sounds.has(e)?e.playing?e.stop():(this.sounds.remove(e),e.component=null,!0):!1},load:function(t,n){this.loading=!1,this.loaded=!0,t&&t(),this.trigger(e.LOADED)},play:function(t){return this.startTime=e.now(),this.playing=!0},pause:function(){return this.playing=!1,this.offset+=e.now()-this.startTime,this.offset%=this.duration,this.startTime=0,!0},stop:function(){this.pause()&&(this.offset=0)},getUri:function(e){return"undefined"==typeof e&&(e=""),e+""}}),n}(Engine.Sound,Engine.Sound.Error),function(e,t){function n(e){for(var t=e.sounds,n=t.length,r=0,i=0,s=0,o;s<n;s++)o=t[s],o.playing&&(r++,i+=o.volume);r&&e.setVolume(i/r)}e.property("volume",t.VOLUME_DEFAULT),e.method("setVolume",function(e){this.volume=e}),e.decorate({addSound:function(e){return(e=this._super(e))&&n(this),e},removeSound:function(e){return(e=this._super(e))&&n(this),e}}),t.decorate("setVolume",function(e){this._super(e),this.component&&n(this.component)})}(Engine.Sound.Component,Engine.Sound),function(e,t){function n(e){function t(e){for(var t=i=0,s=0,o;s<r;s++)o=n[s],o.playing&&(i++,t+=o.position[e]);return t}var n=e.sounds,r=n.length,i=0,s=t("x"),o=t("y"),u=t("z");i&&e.setPosition(s/i,o/i,u/i)}e.property("position",null),e.method("setPosition",function(e,n,r){this.position.x=e,this.position.y=n,this.position.z=r,this.position.r=t.calculateRadius(this.position)}),e.decorate({initialize:function(e){this._super(e),this.position={x:0,y:0,z:0,r:0}},addSound:function(e){return(e=this._super(e))&&n(this),e},removeSound:function(e){return(e=this._super(e))&&n(this),e}}),t.decorate("setPosition",function(e,t,r){this._super(e,t,r),this.component&&n(this.component)})}(Engine.Sound.Component,Engine.Sound),function(e,t,n){var r=n._validator=function(t){return function(){var r="function"==typeof arguments[1]?arguments[1]:null;e._implemented&&e._implemented.methods.has(t)||n.raise(arguments,n.NOT_IMPLEMENTED_ERROR,"This method is not implemented");if(n.exists(arguments)){var i=n.findAll(arguments);return r&&r.apply(null,i),(r=e[t.toUpperCase()+"ERROR"])&&this.trigger(r,i),i}return this._super.apply(this,arguments)}};t.decorate({load:r("load"),play:r("play"),pause:r("pause")})}(Engine.Sound,Engine.Sound.Component,Engine.Sound.Error),function(e,t,n){t.decorate("setVolume",n("setVolume")),Class.decorate(e,"setGlobalVolume",n("setGlobalVolume"))}(Engine.Sound,Engine.Sound.Component,Engine.Sound.Error._validator),function(e,t,n){t.decorate("setPosition",n("setPosition")),Class.decorate(e,"setGlobalPosition",n("setGlobalPosition"))}(Engine.Sound,Engine.Sound.Component,Engine.Sound.Error._validator),function(e,t){"undefined"!=typeof Audio&&(e.TYPE=function(){var e=new Audio,t={mp3:"audio/mpeg",ogg:'audio/ogg; codecs="vorbis"'},n,r;for(n=1;2>=n;n+=1)for(r in t)if(t.hasOwnProperty(r)){var i=t[r];if(e.canPlayType(i)===(1===n?"probably":"maybe"))return{ext:r,mime:i}}return null}(),e.TYPE&&t.decorate("getUri",function(t){return this._super(t)+"."+e.TYPE.ext}))}(Engine.Sound,Engine.Sound.Component),function(e,t){if(!e._implemented&&e.TYPE){e.WEBAUDIO_IMPLEMENTATION={name:"WebAudioAPI",methods:["play","pause"]};var n=this.AudioContext||this.webkitAudioContext||this.mozAudioContext;if(n){e._implemented=e.WEBAUDIO_IMPLEMENTATION;var r=e._ctx=new n,i=Object.getPrototypeOf(Object.getPrototypeOf(r.destination)).constructor,n=r.createBufferSource().constructor;i===Object&&(i=null),r.joinNode=function(e,t,n){return t.right.disconnect(n),t.right.connect(e),t.right=e,e.connect(n),e},r.createGain=r.createGain||r.createGainNode,n.prototype.start||(n.prototype.start=n.prototype.noteOn),n.prototype.stop||(n.prototype.stop=n.prototype.noteOff),t.decorate({load:function(){this._audio.buffer&&(this.duration=this._audio.buffer.duration),this._super.apply(this,arguments)},play:function(){var t=this;return this._audio.source.start(r.currentTime,this.offset),this.loop||(this._audio.onend=setTimeout(function(){t.trigger(e.ENDED)},1e3*(this.duration-this.offset))),this._super.apply(this,arguments)},pause:function(e){function t(){var e=r.source;if(!n.playing&&e){e.stop(0),clearTimeout(r.onend);for(var t in r)(i?r[t]instanceof i:~r[t].constructor.toString().indexOf("NodeConstructor"))&&delete r[t]}}var n=this,r=this._audio,s=this._super.apply(this,arguments);return 0<e?setTimeout(t,1e3*e):t(),s}}),Class.decorate(e,"now",function(){return r.currentTime})}}}.call(this,Engine.Sound,Engine.Sound.Component),function(e,t,n,r){if(e._implemented===e.WEBAUDIO_IMPLEMENTATION){e.WEBAUDIO_IMPLEMENTATION.methods.push("load");var i={};t.decorate("load",function(){function t(t,n,s){return h++,i[u.src]?n(i[u.src]):new r({src:t,type:"data",on:{load:function(t){e._ctx.decodeAudioData(t.buffer,n,s)},error:s}})}function s(e,t){i[u.src]=t,u._audio[e]=t,++c===h&&f.apply(u,l)}function o(){n.raise(l,n.REQUEST_ERROR,"Can't load sound file"),h=-1,f.apply(u,l)}var u=this,f=this._super,l=arguments;this._audio={};for(var c=0,h=0,p=0,v=arguments.length;p<v;p++){var m=arguments[p];m&&m.uri&&m.name&&t(m.uri,s.bind(null,m.name),o)}})}}(Engine.Sound,Engine.Sound.Component,Engine.Sound.Error,Engine.Network.Resource),function(e,t,n){if(e._implemented===e.WEBAUDIO_IMPLEMENTATION){var r=n.sources=n.createGain();r.right=r,r.connect(n.destination),t.decorate({load:function(){return Array.prototype.push.call(arguments,{name:"buffer",uri:this.getUri(this.src)}),this._super.apply(this,arguments)},play:function(){if(!this._audio.source){var e=this._audio.source=n.createBufferSource();e.connect(r),e.right=e,e.loop=this.loop,e.buffer=this._audio.buffer}return this._super.apply(this,arguments)}})}}(Engine.Sound,Engine.Sound.Component,Engine.Sound._ctx),function(e,t,n,r,i,s){function o(e,t){e.setPosition(t.x,t.y,t.z),e.refDistance=1-t.r}if(e._implemented===e.WEBAUDIO_IMPLEMENTATION){e.WEBAUDIO_IMPLEMENTATION.methods.push("setPosition","setGlobalPosition");var u=r.joinNode(r.createPanner(),r.sources,r.destination);u.panningModel=u.EQUALPOWER,t.decorate({play:function(){var e=this._super.apply(this,arguments);if(!this._audio.panner){var t=this._audio.panner=r.joinNode(r.createPanner(),this._audio.source,r.sources);t.refDistance=0,o(t,this.position)}return e},setPosition:function(e,t,n){return e=this._super(e,t,n),this._audio&&this._audio.panner&&o(this._audio.panner,this.position),e}}),Class.decorate(e,"setGlobalPosition",function(){var t=this._super.apply(this,arguments);return o(u,e.globalPosition),t}),o(u,e.globalPosition)}}(Engine.Sound,Engine.Sound.Component,Engine.Sound.now,Engine.Sound._ctx,Engine.Loop,Math.min),function(e,t,n){if(e._implemented===e.WEBAUDIO_IMPLEMENTATION){e.WEBAUDIO_IMPLEMENTATION.methods.push("setVolume","setGlobalVolume");var r=n.joinNode(n.createGain(),n.sources,n.destination);t.decorate({play:function(){var e=this._super.apply(this,arguments);return this._audio.volume||(this._audio.volume=n.joinNode(n.createGain(),this._audio.source,n.sources),this._audio.volume.gain.setValueAtTime(this.volume,n.currentTime)),e},setVolume:function(e){return e=this._super(e),this._audio&&this._audio.volume&&this._audio.volume.gain.setValueAtTime(this.volume,n.currentTime),e}}),Class.decorate(e,"setGlobalVolume",function(t){return t=this._super(t),r.gain.setValueAtTime(e.globalVolume,n.currentTime),t}),r.gain.setValueAtTime(e.globalVolume,n.currentTime)}}(Engine.Sound,Engine.Sound.Component,Engine.Sound._ctx),function(e,t,n){e._implemented===e.WEBAUDIO_IMPLEMENTATION&&t.decorate({load:function(){return this.filter&&Array.prototype.push.call(arguments,{name:"filter",uri:this.getUri(this.filter)}),this._super.apply(this,arguments)},play:function(){var e=this._super.apply(this,arguments);return!this._audio.convolver&&this._audio.filter&&((this._audio.convolver=n.joinNode(n.createConvolver(),this._audio.source,n.sources)).buffer=this._audio.filter),e}})}(Engine.Sound,Engine.Sound.Component,Engine.Sound._ctx),function(e,t,n){!e._implemented&&e.TYPE&&(e.NODE_IMPLEMENTATION={name:"Node",methods:["load","play","pause"]},e._implemented=e.NODE_IMPLEMENTATION,t.decorate({load:function(){function t(){o.removeEventListener("canplaythrough",t),r.duration=o.duration,i.apply(r,s)}var r=this,i=this._super,s=arguments,o=this._audio=new Audio;o.src=this.getUri(this.src),o.loop=this.loop,o.volume=this.volume,o.addEventListener("ended",this.trigger.bind(this,e.ENDED)),o.addEventListener("error",function(){n.raise(s,n.REQUEST_ERROR,"Can't load sound file"),i.apply(r,s)}),o.addEventListener("canplaythrough",t)},play:function(){return this._audio.currentTime=this.offset,this._audio.play(),this._super.apply(this,arguments)},pause:function(e){function t(){n.playing||n._audio.pause()}var n=this,r=this._super();return 0<e?setTimeout(t,1e3*e):t(),r}}))}(Engine.Sound,Engine.Sound.Component,Engine.Sound.Error),function(e,t){function n(t){var n=t.volume*e.globalVolume,n=n*(1-e.globalPosition.r),n=n*(1-t.position.r);t._audio.volume=n}function r(){for(var t=this._super.apply(this,arguments),r=e._instances,i=0,s=r.length;i<s;i++)n(r[i]);return t}e._implemented===e.NODE_IMPLEMENTATION&&(e.NODE_IMPLEMENTATION.methods.push("setVolume","setGlobalVolume"),e.NODE_IMPLEMENTATION.methods.push("setPosition","setGlobalPosition"),t.decorate({play:function(){var e=this._super.apply(this,arguments);return n(this),e},setVolume:function(e){return e=this._super(e),n(this),e},setPosition:function(e,t,r){return e=this._super(e,t,r),n(this),e}}),Class.decorate(e,{setGlobalVolume:r,setGlobalPosition:r}))}(Engine.Sound,Engine.Sound.Component),function(e,t){e.decorate({load:function(t,n){t="function"==typeof t?t:null,n="function"==typeof n?n:null;if(this.loaded)return t&&t();if(this.loading){if(!t&&!n)return;return t&&this.on(e.LOADED,t),n&&this.on(e.LOADERROR,n)}this.loading=!0,this._super(t,n)},play:function(e){if(this.refersTo.loaded)return this.playing&&"number"==typeof e&&this.stop(),this._super(e)},pause:function(){if(this.playing&&this.refersTo.loaded)return this._super()}})}(Engine.Sound,Engine.Sound.Error),function(e,t,n,r){t.decorate({load:function(t,n){t="function"==typeof t?t:null,n="function"==typeof n?n:null;if(this.loaded)return t&&t();if(this.loading){if(!t&&!n)return;return t&&this.on(e.LOADED,t),n&&this.on(e.LOADERROR,n)}this.loading=!0,this._super(t,n)},play:function(t){for(var n=!1,r=0,i=this.sounds,s=i.length;r<s&&!(n=i[r].playing);r++);if(!n)return!1;if("number"!=typeof t||0>t)t=void 0;return"undefined"==typeof t&&this.playing?!0:("undefined"!=typeof t&&(this.offset=t%this.duration||0),this.loaded?this._super(t):this.on(e.LOADED,this.play.bind(this,t)))},pause:function(e){if(this.playing&&this.loaded&&!this.paused){for(var t=!1,n=0,r=this.sounds,i=r.length;n<i&&!(t=r[n].playing);n++);return t?!1:this._super("number"==typeof e&&0<e?e:0)}}})}(Engine.Sound,Engine.Sound.Component,Engine.Sound.Error,Math.max),Engine.Particles=function(){function e(e){Model.call(this,e)}return Class.extend(e,Model),e}(),Engine.Particles=function(e,t){function n(t){e.call(this,t),this.timer.set("duration",this.emitDelay)}Class.extend(n,e),n.BEFORE_EMIT="beforeemit",n.EMIT="emit",n.BEFORE_CREATE_PARTICLE="beforecreateparticle",n.CREATE_PARTICLE="createparticle",n.property({amount:10,iterations:Infinity,emitDelay:1e3,emitters:null});var r=[];return n.method({onstep:function(){this._super();if(!this.emitters.length&&this.timer.count>=this.iterations)return this.stop()},onplay:function(){this._super(),this.emitters=[],this.emit()},onstop:function(){this._super(),this.emitters=n.prototype.emitters},onloop:function(){this._super(),this.timer.count<this.iterations&&this.emit()},onemitterdestroyed:function(e){r.push(e),5<r.length&&r.shift()},emit:function(){if(this.timer.playing){this.trigger(n.BEFORE_EMIT);var e=this.amount,t;e:{t=0;for(var i=r.length;t<i;t++){var s=r[t];if(s.amount===e){t===r.length-1?r.pop():r[t]=r.pop(),t=s;break e}}t=void 0}t=t||{amount:e},this.emitters.push(t),this.trigger(n.EMIT,t,this.amount);for(i=0;i<e;i++)this.trigger(n.BEFORE_CREATE_PARTICLE,i),this.trigger(n.CREATE_PARTICLE,t,i)}}}),n}(Engine.Particles,Engine.now),Engine.Particles=function(e,t){function n(t){var n=function(e,t,n,r){e=r[n]-t,r[n]=0>e?0:e};n.shortcutArguments=["timeleft"],this.funcs.push(n),e.call(this,t)}return Class.extend(n,e),n.EMITTER_DESTROYED="emitterdestroyed",n.property({lifetime:5e3}),n.method({onemit:function(e,t){this._super(e,t),e.lifetime=e.lifetime||new TypedArray("uint",this.lifetime,t),e.timeleft=e.timeleft||new TypedArray("uint",this.lifetime,t)},oncreateparticle:function(e,n){this._super(e,n),e.lifetime[n]=e.timeleft[n]=t(0,this.lifetime)},onstep:function(){this._super();var e=0,t=this.emitters,r=t.length;e:for(;e<r;e++){for(var i=0,s=t[e].timeleft,o=s.length;i<o;i++)if(s[i])continue e;i=t[e],e===t.length-1?t.pop():t[e]=t.pop(),this.queue(n.EMITTER_DESTROYED,i),e--,r--}}}),n}(Engine.Particles,Math.max),Engine.Particles=function(e){function t(t){e.call(this,t),this.timer.set("delay",this.redrawDelay)}return Class.extend(t,e),t.property({geometry:null,redrawDelay:1,parent:null,left:0,top:0,width:1,height:1}),t.method({onstep:function(){this._super(),this.geometry.redraw()},onplay:function(){this._super(),this.geometry=new Engine.Particles.Geometry({emitters:this.emitters,parent:this.parent,left:this.left,top:this.top,width:this.width,height:this.height})},onstop:function(){this._super(),this.geometry.destroy()}}),t}(Engine.Particles),Engine.Particles=function(e){function t(t){e.call(this,t)}return Class.extend(t,e),t.property({fill:"red 2px 2px",_fills:null}),t.method({onemit:function(e,t){this._super(e,t),e.shape=e.shape||Array(t)},onplay:function(){this._fills={},this._super()},onstop:function(){this._super(),this._fills=t.prototype._fills},oncreateparticle:function(e,t){this._super(e,t);var n;if(n=this._fills[this.fill])return e.shape[t]=n;e.shape[t]=this._fills[this.fill]=Engine.Particles.Fill.parse(this.fill)}}),t}(Engine.Particles),Engine.Particles=function(e,t,n){function r(t){var n=t&&"dy"in t?t.dy:this.dy;!1!==(t&&"dx"in t?t.dx:this.dx)&&!1!==n&&(n=function(e,t,n,r,i){r&&i&&(n*=2,r[n]+=i[n]*t/1e3,r[n+1]+=i[n+1]*t/1e3)},n.shortcutArguments=["position","move"],this.funcs.push(n)),e.call(this,t),this.dx=t&&"undefined"!=typeof t.dx?t.dx:this.dx,this.dy=t&&"undefined"!=typeof t.dy?t.dy:this.dy,this.originX=t&&"number"==typeof t.originX?t.originX:this.width/2,this.originY=t&&"number"==typeof t.originY?t.originY:this.height/2}return Class.extend(r,e),r.property({originX:null,originY:null,dx:100,dy:100}),r.method({onemit:function(e,n){this._super(e,n);var r=t(this.width,this.height);e.position=e.position||new TypedArray("float",r,2*n),e.move=e.move||new TypedArray("int",r,2*n)},oncreateparticle:function(e,t){this._super(e,t),t*=2,e.position[t]=this.originX,e.move[t]=this.dx,t++,e.position[t]=this.originY,e.move[t]=this.dy},verifyPosition:function(e,t,r,i){return"undefined"==typeof r&&(r=this.dx),"undefined"==typeof i&&(i=this.dy),n(r)+(e+1)/2>this.width/2||n(i)+(t+1)/2>this.height/2?!1:!0}}),r}(Engine.Particles,Math.max,Math.abs),Engine.Particles=function(e){function t(t){if(!1!==(t&&"opacity"in t?t.opacity:this.opacity)){var n=function(e,t,n,r,i){r&&(r[n]*=1-t/i[n])};n.shortcutArguments=["opacity","timeleft"],this.funcs.push(n)}e.call(this,t),this.opacity=t&&"undefined"!=typeof t.opacity?t.opacity:this.opacity}return Class.extend(t,e),t.property({opacity:1}),t.method({onemit:function(e,t){this._super(e,t),!1===this.opacity?e.opacity&&(e.opacity=null):e.opacity=e.opacity||new TypedArray("float",1,t)},oncreateparticle:function(e,n){this._super(e,n),!1!==this.opacity&&(e.opacity[n]="number"==typeof this.opacity?this.opacity:t.prototype.opacity)}}),t}(Engine.Particles),Engine.Particles=function(e,t){function n(t){var n=Math.PI;if(!1!==(t&&"rotate"in t?t.rotate:this.rotate)){var r=function(e,t,r,i,s){i&&(i[r]+=s[r]*t/1e3,i[r]%=2*n)};r.shortcutArguments=["rotation","rotate"],this.funcs.push(r)}e.call(this,t),this.rotate=t&&"undefined"!=typeof t.rotate?t.rotate:this.rotate}return Class.extend(n,e),n.property({rotate:0}),n.method({onemit:function(e,n){this._super(e,n),!1===this.rotate?(e.rotate&&(e.rotate=null),e.rotation&&(e.rotation=null)):(e.rotate=e.rotate||new TypedArray("float",2*t,n),e.rotation=e.rotation||new TypedArray("float",2*t,n))},oncreateparticle:function(e,t){this._super(e,t),e.rotate&&(e.rotate[t]=this.rotate,e.rotation[t]=0)}}),n}(Engine.Particles,Math.PI),Engine.Particles=function(e,t){function n(n){var r=this.timer=new t({type:t.VSYNC,loop:!0,subscribers:{reset:this,play:this,pause:this,stop:this,step:this,loop:this}});this.reset=r.reset.bind(r),this.play=r.play.bind(r),this.pause=r.pause.bind(r),this.stop=r.stop.bind(r),e.call(this,n)}return Class.extend(n,e),n.STEP="step",n.LOOP="loop",n.PLAY="play",n.STOP="stop",n.property({timer:null,autoplay:!0,oninitialize:function(e){this.autoplay&&setTimeout(this.timer.play.bind(this.timer),0)},reset:null,play:null,pause:null,stop:null}),n}(Engine.Particles,Engine.Timer),Engine.Particles=function(e,t,n){function r(r){this.funcs=[],e.call(this,r),r&&n(r.funcs)&&t.apply(this.funcs,r.funcs)}return Class.extend(r,e),r.property({funcs:null}),r.method({onstep:function(){var e=arguments,t=this.funcs,n=t.length;this._super(),e[1]=this.timer.stepprogress;for(var r=0,i=this.emitters,s=i.length;r<s;r++)for(var o=e[0]=i[r],u=0;u<n;u++){var a=t[u],f=a.shortcutArguments;e.length=3;if(f){e.length=f.length+3;for(var l=0,c=f.length;l<c;l++)e[l+3]=o[f[l]]}f=o.timeleft,l=0;for(c=f.length;l<c;l++)f[l]&&(e[2]=l,a.apply(null,e))}}}),r}(Engine.Particles,Array.prototype.push,Array.isArray),Engine.Particles.Geometry=function(e){function t(t){e.call(this,t)}return Class.extend(t,e),t.property({emitters:null}),t}(Engine.Geometry),Engine.Particles.Fill=function(e){e={parse:e.parse.bind(e)};var t=/\s(\d+)px\s(\d+)px$/;return Class.decorate(e,"parse",function(e,n){var r=t.exec(e);r&&(e=e.substring(0,e.length-r[0].length));var i=this._super(e,n);return i.image instanceof Engine.Fill.Gradient&&"radial"===i.image.type&&(i.left=0,i.top=0),r&&(i.width=parseInt(r[1]),i.height=parseInt(r[2])),i}),e}(Engine.Fill),function(e,t){e.decorate("oncreateparticle",function(e,n){this._super(e,n);var r=e.shape[n];if(!("_pattern"in r)){t(r);var i=r._image;if(i){if(i.complete)return r.width=i.width,r.height=i.height;i.on("load",function(){r._image=this,r.width=this.width,r.height=this.height})}}})}(Engine.Particles,Engine.Renderer.parseFill),function(e,t){e.decorate("render",function(e){this._super(e);var t=this.emitters;if(t&&t.length)for(var n=0,r=t.length;n<r;n++)for(var i=t[n],s=i.shape,o=i.opacity,u=i.rotation,a=i.position,i=i.timeleft,f=0,l=i.length,c=0;f<l;c=2*++f)if(i[f]){var h=s[f];e.globalAlpha=o?o[f]:1;var p=this.left+a[c]|0,d=this.top+a[c+1]|0,c=h.width|0,v=h.height|0;c&&v&&(e.save(),e.translate(p,d),u&&e.rotate(u[f]),e.translate(-c/2,-v/2),(p=h._image)?e.drawImage(p.canvas,0,0):(e.fillStyle=h._pattern||h.color+"",e.fillRect(0,0,c,v)),e.restore())}})}(Engine.Particles.Geometry,Engine.Fill),Engine.Path=function(){var e=new Model;return e.Metric={},e.METRIC="euclidean",e.distance=function(t,n,r,i,s){return(s=e.Metric[s]||e.Metric[e.METRIC]||null)?s.distance(t,n,r,i):0},e}(),function(e){var t=Math.sqrt,n=Math.pow,r=Math.abs;e.Metric.euclidean={directions:[[1,0,1],[0,1,1],[-1,0,1],[0,-1,1],[1,1,Math.SQRT2],[-1,-1,Math.SQRT2],[-1,1,Math.SQRT2],[1,-1,Math.SQRT2]],distance:function(e,r,i,s){return t(n(e-i,2)+n(r-s,2))}},e.Metric.manhattan={directions:[[1,0,1],[0,1,1],[-1,0,1],[0,-1,1]],distance:function(e,t,n,i){return r(e-n)+r(t-i)}}}(Engine.Path),function(e){function t(e,t){return 1}function n(e,t){return t.h-e.h||t.g-e.g}function r(e,t){t="function"==typeof t?t:s;for(var n=[];e;)n.unshift(t(e)),e=e.parent;return n}function i(e,t,n,r,i,s){this.x=e,this.y=t,this.g=n,this.h=r,this.parent=i,this.cost=s}function s(e){return[e.x,e.y]}e.MAX=500,e.INVALID=-1,e.search=function(s,o,u,f,l,h){if(s===u&&o===f)return[];l="function"==typeof l?l:t;var p=e.Metric[e.METRIC]||null;if(!p)throw'Engine.Path.search: no "'+e.METRIC+'" metric found';var v=p.directions,m=v.length,p=p.distance,g=Math.max(0,parseFloat(e.MAX)||0),y=e.INVALID,w=0,E=p.call(null,s,o,u,f);s=[new i(s,o,w,E,null,0)],o={};for(var S={},x=s.last();s.length&&0<g--;){var T=s.pop(),N=T.x,C=T.y;x.h>T.h&&(x=T);if(N===u&&C===f)return r(T,h);o[T]=T;for(var k=0;k<m;k++){var L=v[k],w=L[0],E=L[1],A=L[2],L=N+w,O=C+E;if(!o[L+","+O]&&!S[L+","+O]){var M=l.call(this,L,O,w,E);S[L+","+O]=!0,Number(M)!==y&&(w=T.g+M*A,E=p.call(null,L,O,u,f),s.push(new i(L,O,w,E,T,M)))}}s.sort(n)}return r(x,h)},i.prototype.toString=function(){return this.x+","+this.y}}(Engine.Path),Engine.Isometry=function(e,t){var n={TILE_WIDTH:64,TILE_HEIGHT:40,X:"x",Y:"y",Z:"z",W:"w",H:"h",D:"d",LAYER:"layer",LABEL:"ISOMETRY",project:function(t,r,i,s){return t=parseFloat(t)||0,r=parseFloat(r)||0,i=parseFloat(i)||0,s=s||[0,0],s[0]=e(n.TILE_WIDTH/2*t-n.TILE_WIDTH/2*r),s[1]=e(n.TILE_HEIGHT/2*t+n.TILE_HEIGHT/2*r-n.TILE_HEIGHT*i),s},coords:function(e,t,r){return e=parseInt(e)||0,t=parseInt(t)||0,r=r||[0,0,0],r[0]=1/n.TILE_WIDTH*e+1/n.TILE_HEIGHT*t,r[1]=-1/n.TILE_WIDTH*e+1/n.TILE_HEIGHT*t,r[2]=0,r},UNIT:{valueOf:function(){return n.TILE_WIDTH/t}}};return n}(Math.round,Math.SQRT2),Engine.Isometry.Node=function(e,t,n,r,i){function s(r){var s=e.X,u=e.Y,a=e.Z,f=e.W,l=e.H,h=e.D,p=e.LAYER,s=this[s]=r&&s in r?parseFloat(r[s])||0:parseFloat(this[s])||0,u=this[u]=r&&u in r?parseFloat(r[u])||0:parseFloat(this[u])||0,v=this[a]=r&&a in r?parseFloat(r[a])||0:parseFloat(this[a])||0,f=this[f]=r&&f in r?i(0,parseFloat(r[f])||0):i(0,parseFloat(this[f])||0),l=this[l]=r&&a in r?i(0,parseFloat(r[a])||0):i(0,parseFloat(this[a])||0);this[h]=r&&a in r?i(0,parseFloat(r[a])||0):i(0,parseFloat(this[a])||0),this[p]=r&&p in r?parseInt(r[p])||0:parseInt(this[p])||0,this.bb=new n(s,u,f,l),t.call(this,r),e.project(s,u,v,o),this.setTransform(1,0,0,1,o[0],o[1])}var o=[0,0];return Class.extend(s,t),s.method({setCube:function(t,n,r,s,u,a){var f=e.X,l=e.Y,c=e.Z,h=e.W,p=e.H,v=e.D;return t=parseFloat(t)||0,n=parseFloat(n)||0,r=parseFloat(r)||0,s=i(0,parseFloat(s)||0),u=i(0,parseFloat(u)||0),a=i(0,parseFloat(a)||0),t===this[f]&&n===this[l]&&r===this[c]&&s===this[h]&&u===this[p]&&a==this[v]?!1:(this[f]=t,this[l]=n,this[c]=r,this[h]=s,this[p]=u,this[v]=a,e.project(t,n,r,o),this.setTransform(1,0,0,1,o[0],o[1]),!0)},setPosition:function(t,n,r){return this.setCube(t,n,r,this[e.W],this[e.H],this[e.D])},setSize:function(t,n,r){return this.setCube(this[e.X],this[e.Y],this[e.Z],t,n,r)},setLayer:function(t){var n=e.LAYER;return t=parseInt(t)||0,t===this[n]?!1:(this[n]=t,this.update(),!0)},update:function(t){var n=e.X,r=e.Y,i=e.W,o=e.H,u=e.LABEL,a=this.bb,l=this.root;l&&l.spaceClear(u,a,this),this._super(t),t=this.firstParentOfType(s),a.reset(t?t.bb.x+this[n]:this[n],t?t.bb.y+this[r]:this[r],this[i],this[o]),(n=this.root)&&n.spaceInsert(u,a,this)}}),s}(Engine.Isometry,Engine.Transform,Engine.Box,Engine.Scene,Math.max),Engine.Isometry.Scene=function(e,t,n,r){function i(n){t.call(this,n),this.space[e.LABEL]=new RTree(4)}return Class.extend(i,t),i.method({sort:function(t){for(var i=0,s=t.length;i<s;i++)for(var o=0;o<s;o++)if(i!==o){var u=t[i],f=t[o],l;l=u;var c=f,h=e.X,p=e.Y,v=e.W,m=e.H,g=e.LAYER,y=l.firstParentOfType(n),w=c.firstParentOfType(n);if(y===w)l=this.compare(l,c);else{var E=y?y[h]:0,S=y?y[p]:0,x=y?y[v]:0,T=y?y[m]:0,h=w?w[h]:0,p=w?w[p]:0,v=w?w[v]:0,m=w?w[m]:0;l=r.call((w?w[g]:0)-(y?y[g]:0)||(E>=h+v&&S+T>p||S>=p+m&&E+x>h?-1:E+x<=h||S+T<=p||E<h||S<p?1:0)||this.compare(l,c))}~l||(t[i]=f,t[o]=u)}return t}}),i}(Engine.Isometry,Engine.Scene,Engine.Isometry.Node,Number.prototype.sign),Engine.Isometry.Transform=function(e,t,n,r,i){function s(e){var n=this.align=e&&"align"in e?String(e.align):String(this.align);u.has(this.align)||(this.align=u.last()),t.call(this,e),o(this,n)}function o(t,s){var o=n.LEFT,f=n.TOP,l=e.TILE_HEIGHT/e.TILE_WIDTH;switch(s){case u[0]:o=n.RIGHT,f=n.BOTTOM,t.setTransform(1,-l,0,1,0,0),t.scale(1/r,l*r);break;case u[1]:o=n.LEFT,f=n.BOTTOM,t.setTransform(1,l,0,1,0,0),t.scale(1/r,l*r);break;case u[2]:o=n.LEFT,f=n.TOP,t.setTransform(1,0,0,l,0,0),t.rotate(i)}return t.halign=o,t.valign=f,!0}var u=["x","y","z"];return Class.extend(s,t),s.property({align:u.last(),halign:n.LEFT,valign:n.TOP}),s.method({setAlign:function(e){return e=u.has(e)?e:u.last(),e===this.align?!1:(this.align=e,o(this,e),!0)},appendChild:function(e){return this._super(e)?(e instanceof n&&e.setAlign(this.hAlign,this.vAlign),!0):!1}}),s.X=Class.extend(function(e){s.call(this,e)},s),s.X.property("align",u[0]),s.Y=Class.extend(function(e){s.call(this,e)},s),s.Y.property("align",u[1]),s.Z=Class.extend(function(e){s.call(this,e)},s),s.Z.property("align",u[2]),s}(Engine.Isometry,Engine.Transform,Engine.Geometry,Math.SQRT2,Math.PI/4),Engine.Isometry.Camera=function(e,t,n,r,i){function s(e){t.call(this,e)}return Class.extend(s,t),s.method({getVisibleArea:function(){var t=e.coords(this.toSceneX(0),this.toSceneY(0)),s=e.coords(this.toSceneX(0),this.toSceneY(this.height)),o=e.coords(this.toSceneX(this.width),this.toSceneY(0)),u=e.coords(this.toSceneX(this.width),this.toSceneY(this.height)),f=r(t[0],s[0],o[0],u[0]),l=r(t[1],s[1],o[1],u[1]),c=i(t[0],s[0],o[0],u[0]),t=i(t[1],s[1],o[1],u[1]);return new n(f,l,c-f,t-l)},isAreaVisible:function(t,s,o,u){t=parseFloat(t)||0,s=parseFloat(s)||0,o=i(0,parseFloat(o)||0),u=i(0,parseFloat(u)||0);var f=e.project(t,s),l=e.project(t,s+u),c=e.project(t+o,s);return u=e.project(t+o,s+u),t=r(f[0],l[0],c[0],u[0]),s=r(f[1],l[1],c[1],u[1]),o=i(f[0],l[0],c[0],u[0]),f=i(f[1],l[1],c[1],u[1]),l=this.view,n.overlap(t,s,o-t,f-s,l.x,l.y,l.w,l.h)}}),s}(Engine.Isometry,Engine.Camera,Engine.Box,Math.min,Math.max),Engine.Sna=function(){var e=new Model;return e.BYTESPERPIXEL=4,e.FRAMEDELAY=80,e.DURATION="duration",e.SOUND="sound",e.TICK=1,e}(),Engine.Sna.Resource=function(e){function t(t){this.states=this.sets=null,e.call(this,t)}var n={};return Class.extend(t,e),t.property({type:"data"}),t.method({getState:function(e){return this.states&&this.states.hasOwnProperty(e)?this.states[e]:null}}),t.load=function(e){return n.hasOwnProperty(e)?n[e]:n[e]=new t({src:e})},t}(Engine.Network.Resource),Engine.Sna.Animation=function(e,t,n,r,i){function s(e){var n=e&&e.loop?e.loop:null;this.begin=n?parseInt(n[0])||0:0,this.end=n?parseInt(n[1])||0:0,this.cycle=n?0<=n[2]?2:1:2,this.repeat=n?0===n[2]||-1===n[2]?Infinity:i(n[2]):0,this.last=r(e&&1<=e.length?parseInt(e.length)-1||0:0,this.end),this.number=this.repeat,this.direction=1,this.frame=0,t.call(this,e)}return Class.extend(s,t),s.property({type:"animation",loop:!0,delay:e.FRAMEDELAY,duration:e.FRAMEDELAY,onloop:function(){var e=this.frame;switch(this.cycle){case 2:e=e===this.end&&0<--this.number?this.begin:e+this.direction;break;case 1:e===this.begin&&e+this.direction<this.begin?0<--this.number?(this.direction*=-1,e+=this.direction):(this.direction=1,e=this.end+this.direction):(e===this.end&&e+this.direction>this.end&&(0<--this.number?this.direction*=-1:this.direction=1),e+=this.direction)}if(0>e||e>this.last)return this.stop();this.frame=e,this.trigger("frame",this.frame)}}),s.method({setFrame:function(e){return e=parseInt(e)||0,this.frame===e?!1:(this.frame=e,this.trigger("frame",e),!0)},setLoop:function(e){null===e?(this.end=this.begin=0,this.cycle=1,this.last=this.repeat=0,this.reset(),this.stop()):(this.begin=e?parseInt(e[0])||0:0,this.end=e?parseInt(e[1])||0:0,this.cycle=e?0<=e[2]?2:1:2,this.repeat=e?0===e[2]||-1===e[2]?Infinity:i(e[2]):0,this.last=r(this.last,this.end),this.reset(),this.play())},reset:function(){this.direction=1,this.number=this.repeat,this.frame=0,this.trigger("frame",this.frame),this._super()},play:function(){return this.repeat&&this._super()?(this.trigger("frame",this.frame),!0):!1},stop:function(){return this._super()?(this.frame=0,this.trigger("frame",this.frame),!0):!1}}),s}(Engine.Sna,Engine.Timer,Math.min,Math.max,Math.abs),Engine.Sna.Layer=function(e){function t(t){this.frames=t&&t.frames instanceof Array?t.frames:[],this.frame=0;var n=this.meta=this.frames[this.frame];e.call(this,t),n&&this.setBox(n.x,n.y,n.w,n.h)&&this.redraw()}return Class.extend(t,e),t.method({setFrame:function(e){return e=parseInt(e)||0,this.frame===e?!1:(this.frame=e,e=this.meta=(e=this.frames)&&e[this.frame]||null,this.redraw(),e&&this.setBox(e.x,e.y,e.w,e.h)&&this.redraw(),!0)}}),t}(Engine.Geometry),Engine.Sna.Sound=function(e){function t(t){this.frame=0,this.frames=t&&"frames"in t?t.frames:"",this.src=this.frames instanceof Array?this.frames[this.frame]||"":this.frames,this.autoplay=this.loop=!(this.frames instanceof Array),e.call(this,t)}return Class.extend(t,e),t.method({setFrame:function(e){if(this.loop)return!0;var t=this.frames;return e=t&&t[e]||null,e?(this.setSrc(e),this.play(),!0):!1}}),t}(Engine.Geometry.Sound),Engine.Sna.Node=function(e,t,n,r,i,s,o,u){function a(e){this.state=e&&"state"in e?String(e.state):String(this.state),this.src=e&&"src"in e?String(e.src):String(this.src),this.sound=e&&"sound"in e?Boolean(e.sound):Boolean(this.sound),this.animation=new i,t.call(this,e),this.subscribe(this.animation,"stop"),this.subscribe(this.animation,"frame"),this.on("frame",f),this.on("load",l),this.on("error",c),d(this,this.src)}function f(t){var i=n.load(this.src).getState(this.state);if(!i)return!1;var o=this.animation,u=this.animation,a=e.FRAMEDELAY;i=i.duration,i="number"==typeof i?parseFloat(i)||1:null!==i&&null!==i[t]?parseFloat(i[t])||1:1,o.duration=u.delay=a*i*this.tick*e.TICK,o=this.children;for(u=o.length;0<u--;)a=o[u],(a instanceof r||a instanceof s)&&a.setFrame(t)}function l(){p(this),h(this,this.state)}function c(){}function h(e,t){var i=n.load(e.src).states,i=i.hasOwnProperty(t)?i[t]:null;if(!i)return!1;var o=i.layers||null;if(o)for(var u in o)e.appendChild(new r(o[u]));return u=i.sound||null,e.sound&&u&&e.appendChild(new s({frames:u,width:i.width,height:i.height})),e.animation.setLoop(i.loop),e.setSize(i.width,i.height),!0}function p(e){for(var t=e.children,n=t.length;0<n--;){var i=t[n];(i instanceof r||i instanceof s)&&i.destroy()}return e.animation.setLoop(null),!0}function d(e,t){var r=n.load(t);e.subscribe(r,"load"),r.complete&&h(e,e.state)}return Class.extend(a,t),a.property({tick:1,state:"",src:"",opacity:1,sound:!0}),a.method({setLoop:function(e){this.animation.setLoop(e)},appendChild:function(e){return this._super(e)?(e instanceof r&&e.setOpacity(this.opacity),e):null},setOpacity:function(e){e=u(0,o(parseFloat(e)||0,1));if(this.opacity===e)return!1;this.opacity=e;for(var t=this.children,n=t.length,i=0;i<n;i++)t[i]instanceof r&&t[i].setOpacity(e);return!0},setState:function(e){e=String(e);if(e===this.state)return!1;this.state=e,p(this),h(this,e)},setSrc:function(e){e=String(e);if(this.src===e)return!1;this.unsubscribe(n.load(this.src),"load"),this.src=e,d(this,e)}}),a}(Engine.Sna,Engine.Transform.Anchor,Engine.Sna.Resource,Engine.Sna.Layer,Engine.Sna.Animation,Engine.Sna.Sound,Math.min,Math.max),function(e,t){t.parseMeta=function(e){for(var n={sets:[],states:{}},r=0,i=n.states,s=0;s<e.length;s++){for(var o=e[s],u=o[2],a=o[3],o={name:o[0],loop:o[1],layers:{},duration:1,sound:null,width:u[0],height:u[1]},f=0;f<a.length;f++){var l=a[f],h=l[0];switch(h){case t.DURATION:o.duration=l[1];break;case t.SOUND:o.sound=l[1];break;default:for(var l=l[1],p=o.layers[h]={frames:[],width:u[0],height:u[1]},d=0;d<l.length;d++){for(var v=l[d],m=v[0],g=v[1],v=v[2];m<p.length;)p.push(y);var y={x:g[0],y:g[1],w:g[2],h:g[3],offset:r,diff:v};p.frames.push(y);for(m=0;m<v.length;m++)g=v[m],r+=g[2]*g[3]*t.BYTESPERPIXEL}o.layers[h]=p,n.sets.push(p)}}i[o.name]=o}return n},t.parseSets=function(n,r,i){for(var s=0;s<n.length;s++)for(var o=n[s],u=o.frames,a=e.ctx.createImageData(o.width,o.height),f=a.data,l=0;l<u.length;l++){for(var h=u[l],p=h.diff,v=0;v<p.length;v++)for(var m=p[v],g=m[0],y=m[1],b=m[2],m=m[3],w=0;w<m;w++)for(var E=t.BYTESPERPIXEL*((y+w)*o.width+g),S=0;S<b;S++)for(var x=0;x<t.BYTESPERPIXEL;x++)f[E++]^=r[i++];p=document.createElement("canvas"),v=p.getContext("2d"),p.width=h.w,p.height=h.h,v.putImageData(a,-h.x,-h.y,h.x,h.y,h.w,h.h),h.canvas=p,h.data=v.getImageData(0,0,p.width,p.height).data}return n}}(Engine.Renderer,Engine.Sna),function(e,t,n,r){t.decorate("initialize",function(e){this._super(e),this.offset=0}),t.decorate("onload",function(t){this.offset=2+(t[0]<<8)+t[1];var n=r.unpack((t.subarray||t.slice).call(t,2,this.offset)),n=e.parseMeta(n);this.states=n.states,this.sets=n.sets,e.parseSets(this.sets,t,this.offset),this._super(t)})}(Engine.Sna,Engine.Sna.Resource,Engine.Renderer,msgpack),function(e){e.decorate("initialize",function(e){this._super(e),this.canvas=(e=this.meta)&&e.canvas||null}),e.decorate("setFrame",function(e){return this._super(e)?(this.canvas=(e=this.meta)&&e.canvas||null,!0):!1}),e.decorate("render",function(e){var t=this.canvas;return t&&t.width&&t.height&&e.drawImage(t,this.left,this.top),this._super(e)}),e.decorate("getPixel",function(e,t,n){e-=this.left,t-=this.top;var r=this.meta||null;n=n||[];if(!r)return n[0]=0,n[1]=0,n[2]=0,n[3]=0,n;var i=r.data;return e=4*(t*r.w+e),n[0]=i[e++],n[1]=i[e++],n[2]=i[e++],n[3]=i[e],n})}(Engine.Sna.Layer),Engine.UI=function(){return{}}(),Engine.UI.Layout=function(e,t){function n(t){e.call(this,t),this.setFill(this.fill)}return Class.extend(n,e),n.property({fill:null,onresize:function(e,t,n){e=this.camera.view,t=e.x,n=e.y,this.setBounds(t,n,t+e.w,n+e.h),this.update(this)}}),n.method("setFill",function(e){this.camera&&this.unsubscribe(this.camera,"resize"),(this.camera=e instanceof t?e:null)&&(this.subscribe(this.camera,"resize"),this.onresize(this.camera.width,this.camera.height,this.camera))}),n}(Engine.Node.Transform.Anchor,Engine.Camera),Engine.UI.Box=function(e,t){function n(n){e.call(this,n),n&&n.on&&(n.on=null),this.appendChild(new t(Object.merge({},n,e.prototype,{name:"background",fill:this.fill,stroke:this.stroke,width:this.width,height:this.height},!1)))}return Class.extend(n,e),n.property({fill:"",stroke:""}),n.method({setFill:function(e){this.background.setFill(e)},setStroke:function(e){this.background.setStroke(e)},setBounds:function(e,t,n,r){this._super(e,t,n,r),this.background&&this.background.setSize(this.width,this.height)}}),n}(Engine.Node.Transform.Anchor,Engine.Geometry.Rectangle),Engine.UI.Text=function(e,t,n,r,i,s){function o(t){e.call(this,t),this.on(n.READY,a),this.appendChild(new n(u(this,t))),t=this[o.LABEL];for(var r=0,i=l.length;r<i;r++){var s=l[r];s in n.prototype&&(this[s]=t[s])}}function u(e,t){for(var r={},i=0,s=l.length;i<s;i++){var u=l[i];t&&u in t&&(r[u]=t[u])}return r.name=o.LABEL,(r.subscribers={})[n.READY]=e,r}function a(){var e=this[o.LABEL];e&&this.setSize(e.width,e.height)}function f(){var e=arguments,t=r.call(e),n=s.call(e,1);return!n.length&&n.push.apply(n,e),function(){var r=this[o.LABEL],s=r[t];i.apply(arguments,e);if(!s.apply(r,arguments))return!1;for(var s=0,u=n.length;s<u;s++){var f=n[s];this[f]=r[f]}return a.call(this),!0}}var l="font text minWidth minHeight maxWidth maxHeight spacing lineHeight textAlign padding paddingLeft paddingRight paddingTop paddingBottom fill image color repeat stroke".split(" ");Class.extend(o,e),o.LABEL="label",t=0;for(var c=l.length;t<c;t++){var h=l[t];h in n.prototype&&o.property(h,n.prototype[h])}return o.method({setFont:f("set","font"),setText:f("set","text"),setFill:f("set","fill","image","color","repeat"),setStroke:f("set","stroke"),setSpacing:f("set","spacing"),setLineHeight:f("set","lineHeight"),setTextAlign:f("set","textAlign"),setPadding:f("set","padding","paddingLeft","paddingTop","paddingRight","paddingBottom"),setMinWidth:f("set","minWidth"),setMinHeight:f("set","minHeight"),setMaxWidth:f("set","maxWidth"),setMaxHeight:f("set","maxHeight")}),o}(Engine.Node.Transform.Anchor,Engine.Font,Engine.Geometry.Shape.Text,Array.prototype.shift,Array.prototype.unshift,Array.prototype.splice),Engine.UI.Widget=function(e,t){function n(r){e.Box.call(this,r),this.font=this.font instanceof t?this.font:n.prototype.font,this.input=r&&r.hasOwnProperty("input")?r.input:this.input}return Class.extend(n,e.Box),n.property({font:null,input:null}),n.method("getInput",function(){return this.input}),n}(Engine.UI,Engine.Font),Engine.UI.Widget.Fieldset=function(e){function t(t){e.call(this,t),this.fields={}}return Class.extend(t,e),t.property({focusable:!0,fields:null}),t.method({getInput:function(){var e=this.fields,t=this.input={},n,r;for(n in e)e.hasOwnProperty(n)&&(r=e[n],t[n]=r.getInput?r.getInput():r.input);return this._super()},appendChild:function(t,n){return t instanceof e&&t.name&&(this.fields[t.name]=t,t.fieldset=this),this._super(t,n)},removeChild:function(e){return this.fields[e.name]&&(e.fieldset=null,delete this.fields[e.name]),this._super(e)}}),t}(Engine.UI.Widget),Engine.UI.Widget.Checkbox=function(e,t){function n(e){t.call(this,e),this.input&&this.trigger(n.CHECKED)}return Class.extend(n,t),n.CHECKED="checked",n.UNCHECKED="unchecked",n.property({onmousedown:function(){this._super(),this.toggleInput()},input:!1}),n.method("toggleInput",function(){this.input=!this.input,this.trigger(this.input?n.CHECKED:n.UNCHECKED)}),n}(Engine.UI,Engine.UI.Widget),Engine.UI.Widget.Radio=function(e){function t(n){e.call(this,n),this.checked&&this.trigger(t.CHECKED)}return Class.extend(t,e),t.CHECKED="checked",t.UNCHECKED="unchecked",t.property({input:!1,fieldset:null,checked:!1,onmousedown:function(){this._super(),this.setChecked()}}),t.method({getInput:function(){return this.checked?this._super():null},setChecked:function(){if(!this.checked){var e=this.fieldset;if(e&&this.name){var n=e.fields[this.name];n&&n.checked&&(n.checked=!1,n.trigger(t.UNCHECKED)),e.fields[this.name]=this}this.checked=!0,this.trigger(t.CHECKED)}}}),t}(Engine.UI.Widget),Engine.UI.Widget.Select=function(e,t,n){function r(e){t.call(this,e),this.appendChild(new r.Text(Object.merge({font:this.font},e&&e.text))),this.optionsChildren={},this.option=this.option||{},this.option.text=this.option.text||{},this.option.text.font=this.font}function i(e){var t=e.getFirstOptionChild();t&&(t.marginTop=e.height-e.text.bottom,t.update())}Class.extend(r,t);var s=null;return r.property({focusable:!0,option:null,options:null,optionsChildren:null,opened:!1,onfocus:function(){this.open()},onblur:function(){this.close()},onmousedown:function(){this.open()},onmouseclick:function(e){s!==e.parent&&this.close()}}),r.method({getFirstOptionChild:function(){for(var e=0,t=this.children.length;e<t;e++)if(this.children[e]instanceof r.Option)return this.children[e];return null},toggle:function(){return this[this.opened?"close":"open"]()},open:function(){if(!this.opened&&Object.keys(this.options).length){this.opened=!0,s=n.pressed;for(var e in this.options)if(this.options.hasOwnProperty(e)){var t;this.appendChild(t=new r.Option(this.option)),t.optionName=e,t.text.setText(String(this.options[e])),this.optionsChildren[e]=t,this.input===e&&t.trigger(r.Option.CHECKED)}i(this)}},close:function(){if(this.opened){this.opened=!1;for(var e in this.optionsChildren)this.optionsChildren.hasOwnProperty(e)&&(this.removeChild(this.optionsChildren[e]),delete this.optionsChildren[e])}},setInput:function(e,t){this.text.setText(t),this.input=e,i(this)}}),r}(Engine.UI,Engine.UI.Widget,Engine.Input),Engine.UI.Widget.Select.Text=function(e){function t(t){e.call(this,t)}return Class.extend(t,e),t.property({name:"text",text:"",anchors:{centerv:"parent.centerv",left:"parent.left"},marginLeft:15}),t}(Engine.UI.Text),Engine.UI.Widget.Select.Option=function(e,t){function n(n){e.call(this,n),this.appendChild(new t(n&&n.text))}return Class.extend(n,e),n.CHECKED="checked",n.UNCHECKED="unchecked",n.property({optionName:null,anchors:{centerh:"parent.centerh",top:"prev.bottom"},onmousedown:function(e){(e=this.parent.input)&&this.parent.optionsChildren[e].trigger(n.UNCHECKED),this.parent.setInput(this.optionName,this.text.label.text),this.trigger(n.CHECKED)}}),n}(Engine.UI.Box,Engine.UI.Widget.Select.Text),Engine.UI.Widget.Text=function(e,t,n,r){function i(t){e.call(this,t),this.appendChild(new i.Text(Object.merge({font:this.font},t&&t.text))),this.appendChild(new i.Pointer(t&&t.pointer)),this.pointer.timer.text=this.text,this.text.setText(t&&t.text&&"undefined"!=typeof t.text.text?t.text.text:this.input)}return Class.extend(i,e),i.property({focusable:!0,onkeypress:function(e){var t=this.text.getPointerText();e.text&&(t=this.text.getPointerText(),this.text.setText(t.prev+e.text+t.next),this.pointer.move(e.text.length))},onkeydown:function(e){var t=this.text,n=this.text.getPointerText();switch(e.key){case"BACKSPACE":t.setText(n.prev.substring(0,n.prev.length-1)+n.next);case"ARROW_LEFT":this.pointer.move(-1);break;case"DELETE":t.setText(n.prev+n.next.substring(1,n.next.length));break;case"ARROW_RIGHT":this.pointer.move(1);break;case"HOME":this.pointer.move(-this.pointer.position);break;case"END":this.pointer.move(this.text.label.children.length-this.pointer.position)}},onfocus:function(){this.pointer.append()},onblur:function(){this.pointer.remove()},onmousedown:function(e){e=e.sceneX-this.left-this.text.left;var t=this.pointer,n=this.text.label.children,r=n.length;if(0>=e)t.move(-t.position);else if(n.length&&e>=n.last().right)t.move(r-t.position);else for(;1<r--;){var i=n[r];if(n[r-1].right<=e&&i.right>=e){t.move(r-t.position);break}}}}),i.method({setInput:function(e){this.input!==e&&(this.text.setText(e),this.pointer.move(this.text.label.children.length-this.pointer.position))}}),i}(Engine.UI.Widget,Engine.UI,Engine.Timer,Engine.Font),function(e,t){function n(){o.stop(),i=null,clearTimeout(s),s=0}var r=e.REPEAT_EVENT_TIMEOUT=500,i=null,s=0,o=new Engine.Timer({duration:Infinity,delay:50,on:{step:function(){i&&i.fire(Engine.Input.getFocusedLeaf())}}});e.decorate({onkeydown:function(e){i=e,s||(s=setTimeout(o.play.bind(o),r)),this._super(e)},onkeypress:function(e){e.text&&(i=e),this._super(e)},onblur:function(){n(),this._super()}}),e.property("onkeyup",function(e){n()})}(Engine.UI.Widget.Text,Engine.Input),Engine.UI.Widget.Text.Text=function(e){function t(t){e.call(this,t)}return Class.extend(t,e),t.property({name:"text",anchors:{centerv:"parent.centerv",left:"parent.left"},marginLeft:15,marginRight:15,_lastActionTime:0}),t.method({getPointerText:function(){var e=this.label.text,t=this.parent.pointer.position;return{prev:e.substring(0,t),next:e.substring(t,e.length)}},setText:function(e){this._super(e);if(this.parent&&this.right+this.marginRight>=this.parent.right)return this.setText(e.substring(0,e.length-1));this.parent&&(this.parent.input=this.label.text)}}),t}(Engine.UI.Text),Engine.UI.Widget.Text.Pointer=function(e,t){function n(t){e.call(this,t),this["default"]={fill:this.fill},this.timer=new n.Timer({pointer:this}),this.setFill(this.TRANSPARENT)}return Class.extend(n,e),n.property({TRANSPARENT:"rgba(0, 0, 0, 0)",name:"pointer",width:1,height:25,fill:"white",anchors:{centerv:"parent.centerv"},"default":null,position:null}),n.method({append:function(){var e=this.parent.text,t=e.label;if(!t.font.complete)return t.on("load",this.append.bind(this));null===this.position&&(this.position=t.children.length),e=t.children[this.position-1],this.setPosition((e?e.right:-2)+t.parent.left,this.top),this.timer.play(),this.setFill(this["default"].fill)},remove:function(){this.position=null,this.timer.stop(),this.setFill(this.fill=this.TRANSPARENT)},move:function(e){if("undefined"!=typeof e){e=parseInt(e,10);var n=this.parent.text;0>=this.position&&0>e||this.position>=n.label.children.length&&0<e||(this.position+=e,n=n.label.children[this.position-1],this.setPosition((n?n.right:-2)+n.label.parent.left,this.top),n._lastActionTime=t())}}}),n}(Engine.UI.Box,Engine.now),Engine.UI.Widget.Text.Pointer.Timer=function(e,t){function n(t){e.call(this,t)}return Class.extend(n,e),n.property({delay:500,loop:!0,text:null,pointer:null,onstep:function(){var e=this.pointer;if(this.text&&1e3>=t()-this.text._lastActionTime)return e.setFill(e["default"].fill);e.setFill(e.fill=e.fill===e["default"].fill?e.TRANSPARENT:e["default"].fill)}}),n}(Engine.Timer,Engine.now),Engine.UI.Widget.Scrollbar=function(e){function t(n){e.call(this,n),this.appendChild(new t.Thumb(n&&n.thumb)),this.setValue(this.value)}Class.extend(t,e),t.VALUECHANGED="valuechanged",t.property({min:0,max:100,value:0,width:300,height:20,fill:"gray",scrollable:!0,_padding:0});var n=function(){var e=new Matrix,t=[];return function(n){this.global.inverse(e).byVector(n.sceneX,n.sceneY,t),n=t[0];var r=this._padding,i=this.width-this._padding;n<r&&(n=r),n>i&&(n=i),n=this.calculateValue(n+this.left),this.setValue(n)}}();return t.method({calculateValue:function(e){return(e-this.left-this._padding)/(this.width-2*this._padding)*(this.max-this.min)+this.min},setValue:function(e){"number"!=typeof e&&Engine.log(new TypeError,Engine.ERROR),(e<this.min||e>this.max)&&Engine.log(new RangeError,Engine.ERROR),this.thumb instanceof t.Thumb||Engine.log(new ReferenceError,Engine.ERROR),this.value=e,this.thumb.setPosition((this.width-2*this._padding)*(e-this.min)/(this.max-this.min)+this.thumb.marginH/2,this.thumb.top),this.trigger(t.VALUECHANGED,e)},onmousedown:n,ondragstart:function(e){e.stopPropagation()},ondragmove:n}),t}(Engine.UI.Widget),Engine.UI.Widget.Scrollbar.Thumb=function(e,t){function n(e){t.call(this,e)}return Class.extend(n,t),n.property({name:"thumb",width:50,height:e.prototype.height,fill:"red",marginH:0,anchors:{centerv:"parent.centerv"}}),n.decorate({setBounds:function(){this._super.apply(this,arguments),this.parent&&(this.parent._padding=this.width/2+this.marginH/2)}}),n}(Engine.UI.Widget.Scrollbar,Engine.UI.Box),Engine.Storage=function(e){var t=new Model;return t.TEXT="textType",t.OBJECT="objectType",t.set=function(t,n,r,i,s){return s(new e.NotImplemented),this},t.get=function(t,n,r){return r(new e.NotImplemented),this},t.remove=function(t,n,r){return r(new e.NotImplemented),this},t.clear=function(t,n){return n(new e.NotImplemented),this},t}(Engine.Error),function(e,t){function n(e){e()}function r(e,n){e(new t)}function i(e,t,n,r){p.open(c,function(i){i=i.put(t,e),i.onerror=r,i.onsuccess=n},r)}function s(e,t,n){p.open(h,function(r){r=r.get(e),r.onerror=n,r.onsuccess=function(e){e=e.target.result;if("undefined"==typeof e)return n();t(e)}},n)}function o(e,t,n){p.open(c,function(r){r=r.delete(e),r.onerror=n,r.onsuccess=t},n)}function u(e,t){p.open(c,function(n){n=n.clear(),n.onerror=t,n.onsuccess=e},t)}if(!e._implemented){var a=this.indexedDB||this.webkitIndexedDB||this.mozIndexedDB||this.msIndexedDB,f=this.IDBTransaction||this.webkitIDBTransaction,l=this.IDBFactory;if(a){e._implemented="html-indexeddb";var c=f.READ_WRITE||"readwrite",h=f.READ_ONLY||"readonly",p={NEW_API:!!l&&!!l.prototype.deleteDatabase,DB_NAME:"SGP_Storage",DB_VERSION:1,STORE_NAME:"SGP",idb:null,open:function(e,t,n){if(this.idb)return this.transaction(e,t,n);var r=this.NEW_API?a.open(this.DB_NAME,this.DB_VERSION):a.open(this.DB_NAME);r.onupgradeneeded=function(e){e.target.result.createObjectStore(p.STORE_NAME)},r.onerror=n,r.onsuccess=function(r){var i=p.idb=r.target.result;if(p.NEW_API||p.DB_VERSION===parseInt(i.version))return p.transaction(e,t,n);r=i.setVersion(p.DB_VERSION),r.onerror=n,r.onsuccess=function(r){i.createObjectStore(p.STORE_NAME),r.target.transaction.onsuccess=p.transaction.bind(p,e,t,n)}}},transaction:function(e,t,n){if(!this.idb)throw new ReferenceError;e=e||c,e=this.idb.transaction(p.STORE_NAME,e===c?c:h).objectStore(p.STORE_NAME),t(e)}};Class.decorate(e,"set",function(t,s,o,u,a){return o!==e.TEXT&&o!==e.OBJECT?this._super.apply.bind(this._super,this,arguments)(t,s,o,u,a):(u=n.bind(null,u),a=r.bind(null,a),i(t,s,u,a),this)}),Class.decorate(e,"get",function(e,t,n){return n=r.bind(null,n),s(e,t,n),this}),Class.decorate(e,"remove",function(e,t,i){return t=n.bind(null,t),i=r.bind(null,i),o(e,t,i),this}),Class.decorate(e,"clear",function(e,t){return e=n.bind(null,e),t=r.bind(null,t),u(e,t),this})}}}.call(this,Engine.Storage,Engine.Error),function(e,t,n){function r(e){e()}function i(e,n){e(new t)}function s(e,t,r,i,o){var u=arguments;o=o||1;var a=setTimeout(function(){i=r=n;if(1===o)return s(e,t,u[2],u[3],2);u[3]()},700);r=function(){clearTimeout(a),u[2]()},i=function(){clearTimeout(a),u[3].apply(null,arguments)},l.open("readwrite",function(){l.executeSql("INSERT OR REPLACE INTO {} (key, value) VALUES (?,?)".format(escape(l.STORE_NAME)),[e,t],r,i)},i)}function o(e,t,n){l.open("readonly",function(){l.executeSql("SELECT value FROM {} WHERE key=?".format(escape(l.STORE_NAME)),[e],function(e,r){if(!r.rows.length)return n();var i=r.rows.item(0);t(i.value)},n)},n)}function u(e,t,n){l.open("readwrite",function(){l.executeSql("DELETE FROM {} WHERE key=?".format(escape(l.STORE_NAME)),[e],t,n)},n)}function a(e,t){l.open("readwrite",function(){l.executeSql("DELETE FROM {}".format(escape(l.STORE_NAME)),null,e,t)},t)}if(!e._implemented){var f=this.openDatabase||this.openDatabaseSync;if(f){e._implemented="html-websql";var l={ASYNC_MODE:!!this.openDatabase,DB_NAME:"SGP_Storage",STORE_NAME:"SGP",sqldb:null,tx:null,open:function(e,t,n){if(this.sqldb)return this.transaction(e,t,n);this.sqldb=f(this.DB_NAME,"1.0",this.DB_NAME,1048576),this.transaction("readwrite",function(){l.executeSql("CREATE TABLE IF NOT EXISTS {} (key TEXT PRIMARY KEY, value TEXT)".format(escape(l.STORE_NAME)),null,t,n)},n)},transaction:function(e,t,n){var r=this;this.sqldb["readonly"===e?"readTransaction":"transaction"](function(e){r.tx=e,t()})},executeSql:function(e,t,n,r){t=t||[];if(this.ASYNC_MODE)this.tx.executeSql(e,t,n,r);else try{var i=this.tx.executeSql(e,t);n(this.tx,i)}catch(s){r(s)}}};Class.decorate(e,"set",function(t,n,o,u,a){return o!==e.TEXT?this._super.apply(this,arguments):(u=r.bind(null,u),a=i.bind(null,a),s(t,n,u,a),this)}),Class.decorate(e,"get",function(e,t,n){return n=i.bind(null,n),o(e,t,n),this}),Class.decorate(e,"remove",function(e,t,n){return t=r.bind(null,t),n=i.bind(null,n),u(e,t,n),this}),Class.decorate(e,"clear",function(e,t){return e=r.bind(null,e),t=i.bind(null,t),a(e,t),this})}}}.call(this,Engine.Storage,Engine.Error,Engine.NOP),function(e,t,n){Class.decorate(e,"set",function(r,i,s,o,u){if("undefined"==typeof r||"undefined"==typeof i)throw new t.Type;return"string"!=typeof s&&(u=o,o=s,s=e.TEXT),r&&"object"==typeof r&&(r=JSON.stringify(r)),o="function"==typeof o?o:n,u="function"==typeof u?u:n,s===e.TEXT&&"object"==typeof i&&(i=JSON.stringify(i)),this._super(r,i,s,o,u)}),Class.decorate(e,"get",function(e,r,i){if("undefined"==typeof e)throw new t.Type;return e&&"object"==typeof e&&(e=JSON.stringify(e)),r="function"==typeof r?r:n,i="function"==typeof i?i:n,this._super(e,r,i)}),Class.decorate(e,"remove",function(e,r,i){if("undefined"==typeof e)throw new t.Type;return e&&"object"==typeof e&&(e=JSON.stringify(e)),r="function"==typeof r?r:n,i="function"==typeof i?i:n,this._super(e,r,i)}),Class.decorate(e,"clear",function(e,t){return e="function"==typeof e?e:n,t="function"==typeof t?t:n,this._super(e,t)})}(Engine.Storage,Engine.Error,Engine.NOP),Engine.Compass=function(e){function t(t){e.call(this,t),this.gamma=this.beta=this.alpha=0,this.acceleration={x:0,y:0,z:0,alpha:0,beta:0,gamma:0}}return t.ORIENTATION="orientation",t.MOTION="motion",Class.extend(t,e),t.property({alpha:0,beta:0,gamma:0,acceleration:{x:0,y:0,z:0,alpha:0,beta:0,gamma:0},isEnabled:!1}),t.method({enable:function(){return this.isEnabled?!1:this.isEnabled=!0},disable:function(){return this.isEnabled?(this.isEnabled=!1,!0):!1},toggle:function(){this.isEnabled?this.disable():this.enable()},destroy:function(){this.disable()}}),t}(Model),function(e){function t(t){var n=i(t.alpha),s=i(t.beta);t=i(t.gamma);for(var o=0,u=r.length;o<u;o++){var f=r[o];if(f.alpha!==n||f.beta!==s||f.gamma!==t)f.alpha=n,f.beta=s,f.gamma=t,f.trigger(e.ORIENTATION,n,s,t)}}function n(t){var n=t.rotationRate;t=t.acceleration;for(var s=i(n.alpha),o=i(n.beta),n=i(n.gamma),u=i(t.x),f=i(t.y),l=i(t.z),c=0,h=r.length;c<h;c++){var p=r[c];t=p.acceleration;if(t.alpha!==s||t.beta!==o||t.gamma!==n||t.x!==u||t.y!==f||t.z!==l)t.alpha=s,t.beta=o,t.gamma=n,t.x=u,t.y=f,t.z=l,p.trigger(e.MOTION,u,f,l,s,o,n)}}var r=[],i=Math.round;e.decorate({enable:function(){return this._super()?(r.add(this),1===r.length&&(window.addEventListener("deviceorientation",t),window.addEventListener("devicemotion",n)),!0):!1},disable:function(){return this._super()?(r.remove(this),r||(window.removeEventListener("deviceorientation",t),window.removeEventListener("devicemotion",n)),!0):!1}})}(Engine.Compass),function(e){function t(){this.removeEventListener&&(this.removeEventListener("DOMContentLoaded",t),this.removeEventListener("load",t)),e.start()}this.addEventListener("DOMContentLoaded",t),this.addEventListener("load",t,!1)}.call(this,Engine)}.call(this);