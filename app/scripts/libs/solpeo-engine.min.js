/**@license
* Solpeo Engine
* v1.0 pre3
* Copyright (c) 2009-2013 Solpeo sp. z o.o.
* http://www.solpeo.com
*
* License rights of Application is non-payable and non-exclusive license for
* indefinite period of time for use of Application on the territory of the
* whole world, solely for the purposes of internal usage of non-commercial
* character.
* Any download or installation or usage of Application is deemed acceptance
* of License Terms, which you can find under address
* http://cdn.solpeo.com/engine/solpeo_engine-1.0.pre3.license.txt
*
* If you are using the Application, you are obliged to:
* a) present in Application and/or Modification information about copyrights
* entitled to SOLPEO by showing the following text: All rights reserved
* SOLPEO 2013,
* (b) place on Modification the following communicate: "Provided by SOLPEO",
* which shall be placed on user's interface bar
* (c) define the company of Licensor under name SOLPEO, as a source of origin
* of Application being also a base for any Modification
* (d) disseminate SOLPEO's logo available under address
* http://cdn.solpeo.com/logo/logopack_v1.zip as a part of Application
* and/or Modification without introducing any changes, in
* particular concerning its form and/or content.
**/

var global=window;global.msgpack||(global.msgpack=function(){function h(a,d,n){var c,g,l;if(null==d)a.push(192);else if(!1===d)a.push(194);else if(!0===d)a.push(195);else switch(typeof d){case "number":d!==d?a.push(203,255,255,255,255,255,255,255,255):Infinity===d?a.push(203,127,240,0,0,0,0,0,0):Math.floor(d)===d?0>d?-32<=d?a.push(224+d+32):-128<d?a.push(208,d+256):-32768<d?(d+=65536,a.push(209,d>>8,d&255)):-2147483648<d?(d+=4294967296,a.push(210,d>>>24,d>>16&255,d>>8&255,d&255)):(g=Math.floor(d/4294967296),d&=4294967295,
a.push(211,g>>24&255,g>>16&255,g>>8&255,g&255,d>>24&255,d>>16&255,d>>8&255,d&255)):128>d?a.push(d):256>d?a.push(204,d):65536>d?a.push(205,d>>8,d&255):4294967296>d?a.push(206,d>>>24,d>>16&255,d>>8&255,d&255):(g=Math.floor(d/4294967296),d&=4294967295,a.push(207,g>>24&255,g>>16&255,g>>8&255,g&255,d>>24&255,d>>16&255,d>>8&255,d&255)):((g=0>d)&&(d*=-1),l=Math.log(d)/0.6931471805599453+1023|0,n=d*Math.pow(2,1075-l),d=n&4294967295,g&&(l|=2048),g=n/4294967296&1048575|l<<20,a.push(203,g>>24&255,g>>16&255,
g>>8&255,g&255,d>>24&255,d>>16&255,d>>8&255,d&255));break;case "string":n=d.length;l=a.length;a.push(0);for(g=0;g<n;++g)c=d.charCodeAt(g),128>c?a.push(c&127):2048>c?a.push(c>>>6&31|192,c&63|128):65536>c&&a.push(c>>>12&15|224,c>>>6&63|128,c&63|128);c=a.length-l-1;32>c?a[l]=160+c:65536>c?a.splice(l,1,218,c>>8,c&255):4294967296>c&&a.splice(l,1,219,c>>>24,c>>16&255,c>>8&255,c&255);break;default:if(++n>=f)return z=1,[];if(y(d))for(c=d.length,16>c?a.push(144+c):65536>c?a.push(220,c>>8,c&255):4294967296>
c&&a.push(221,c>>>24,c>>16&255,c>>8&255,c&255),g=0;g<c;++g)h(a,d[g],n);else{l=a.length;a.push(0);c=0;for(g in d)++c,h(a,g,n),h(a,d[g],n);16>c?a[l]=128+c:65536>c?a.splice(l,1,222,c>>8,c&255):4294967296>c&&a.splice(l,1,223,c>>>24,c>>16&255,c>>8&255,c&255)}}return a}function k(){var r,d,f,c=0,g,l,b=q;d=b[++e];if(224<=d)return d-256;if(192>d){if(128>d)return d;144>d?(c=d-128,d=128):160>d?(c=d-144,d=144):(c=d-160,d=160)}switch(d){case 192:return null;case 194:return!1;case 195:return!0;case 202:return c=
16777216*b[++e]+(b[++e]<<16)+(b[++e]<<8)+b[++e],g=c>>23&255,l=c&8388607,c&&2147483648!==c?255===g?l?NaN:Infinity:(c&2147483648?-1:1)*(l|8388608)*Math.pow(2,g-127-23):0;case 203:c=16777216*b[++e]+(b[++e]<<16)+(b[++e]<<8)+b[++e];d=c&2147483648;g=c>>20&2047;l=c&1048575;if(!c||2147483648===c)return e+=4,0;if(2047===g)return e+=4,l?NaN:Infinity;c=16777216*b[++e]+(b[++e]<<16)+(b[++e]<<8)+b[++e];return(d?-1:1)*((l|1048576)*Math.pow(2,g-1023-20)+c*Math.pow(2,g-1023-52));case 207:return c=16777216*b[++e]+
(b[++e]<<16)+(b[++e]<<8)+b[++e],4294967296*c+16777216*b[++e]+(b[++e]<<16)+(b[++e]<<8)+b[++e];case 206:c+=16777216*b[++e]+(b[++e]<<16);case 205:c+=b[++e]<<8;case 204:return c+b[++e];case 211:return c=b[++e],c&128?-1*(72057594037927936*(c^255)+281474976710656*(b[++e]^255)+1099511627776*(b[++e]^255)+4294967296*(b[++e]^255)+16777216*(b[++e]^255)+65536*(b[++e]^255)+256*(b[++e]^255)+(b[++e]^255)+1):72057594037927936*c+281474976710656*b[++e]+1099511627776*b[++e]+4294967296*b[++e]+16777216*b[++e]+65536*b[++e]+
256*b[++e]+b[++e];case 210:return c=16777216*b[++e]+(b[++e]<<16)+(b[++e]<<8)+b[++e],2147483648>c?c:c-4294967296;case 209:return c=(b[++e]<<8)+b[++e],32768>c?c:c-65536;case 208:return c=b[++e],128>c?c:c-256;case 219:c+=16777216*b[++e]+(b[++e]<<16);case 218:c+=(b[++e]<<8)+b[++e];case 160:g=[];d=e;for(r=d+c;d<r;)f=b[++d],g.push(128>f?f:224>f?(f&31)<<6|b[++d]&63:(f&15)<<12|(b[++d]&63)<<6|b[++d]&63);e=d;return 10240>g.length?A.apply(null,g):a(g);case 223:c+=16777216*b[++e]+(b[++e]<<16);case 222:c+=(b[++e]<<
8)+b[++e];case 128:for(l={};c--;){r=b[++e]-160;g=[];d=e;for(r=d+r;d<r;)f=b[++d],g.push(128>f?f:224>f?(f&31)<<6|b[++d]&63:(f&15)<<12|(b[++d]&63)<<6|b[++d]&63);e=d;l[A.apply(null,g)]=k()}return l;case 221:c+=16777216*b[++e]+(b[++e]<<16);case 220:c+=(b[++e]<<8)+b[++e];case 144:for(g=[];c--;)g.push(k());return g}}function a(a){try{return A.apply(null,a)}catch(d){}for(var f=[],c=0,g=a.length,l=v;c<g;++c)f[c]=l[a[c]];return f.join("")}var t={},v={},q=[],e=0,z=0,y=Array.isArray||function(a){return"[object Array]"===
Object.prototype.toString.call(a)},A=String.fromCharCode,f=512;(function(){for(var a=0,d;256>a;++a)d=A(a),t[d]=a,v[a]=d;for(a=128;256>a;++a)t[A(63232+a)]=a})();return{pack:function(f,d){z=0;var n=h([],f,0);return z?!1:d?a(n):n},unpack:function(a){var d;if("string"===typeof a){d=[];var f=a.split(""),c=-1,g;g=f.length;for(a=g%8;a--;)++c,d[c]=t[f[c]];for(a=g>>3;a--;)d.push(t[f[++c]],t[f[++c]],t[f[++c]],t[f[++c]],t[f[++c]],t[f[++c]],t[f[++c]],t[f[++c]])}else d=a;q=d;e=-1;return k()}}}());global.RTree=function(h){var k=3,a=6;isNaN(h)||(k=Math.floor(h/2),a=h);var t={x:0,y:0,w:0,h:0,id:"root",nodes:[]},v=function(){var a={};return function(e){var f=0;e in a?f=a[e]++:a[e]=0;return e+"_"+f}}();RTree.Rectangle.squarified_ratio=function(a,e,f){var r=(a+e)/2;a*=e;return a*f/(a/(r*r))};var q=function(a,h,f){var r=[],d=[],n=[];if(!a||!RTree.Rectangle.overlap_rectangle(a,f))return n;a={x:a.x,y:a.y,w:a.w,h:a.h,target:h};d.push(f.nodes.length);r.push(f);do if(f=r.pop(),h=d.pop()-1,"target"in a)for(;0<=
h;){var c=f.nodes[h];if(RTree.Rectangle.overlap_rectangle(a,c))if(a.target&&"leaf"in c&&c.leaf===a.target||!a.target&&("leaf"in c||RTree.Rectangle.contains_rectangle(c,a))){"nodes"in c?(n=e(c,!0,[],c),f.nodes.splice(h,1)):n=f.nodes.splice(h,1);RTree.Rectangle.make_MBR(f.nodes,f);delete a.target;f.nodes.length<k&&(a.nodes=e(f,!0,[],f));break}else"nodes"in c&&(d.push(h),r.push(f),f=c,h=c.nodes.length);h-=1}else if("nodes"in a){f.nodes.splice(h+1,1);0<f.nodes.length&&RTree.Rectangle.make_MBR(f.nodes,
f);for(h=0;h<a.nodes.length;h++)z(a.nodes[h],f);a.nodes.length=0;0==r.length&&1>=f.nodes.length?(a.nodes=e(f,!0,a.nodes,f),f.nodes.length=0,r.push(f),d.push(1)):0<r.length&&f.nodes.length<k?(a.nodes=e(f,!0,a.nodes,f),f.nodes.length=0):delete a.nodes}else RTree.Rectangle.make_MBR(f.nodes,f);while(0<r.length);return n},e=function(a,h,f,e){var d=[];if(!RTree.Rectangle.overlap_rectangle(a,e))return f;d.push(e.nodes);do{e=d.pop();for(var n=e.length-1;0<=n;n--){var c=e[n];RTree.Rectangle.overlap_rectangle(a,
c)&&("nodes"in c?d.push(c.nodes):"leaf"in c&&(h?f.push(c):f.push(c.leaf)))}}while(0<d.length);return f},z=function(e,h){var f;if(0==h.nodes.length)h.x=e.x,h.y=e.y,h.w=e.w,h.h=e.h,h.nodes.push(e);else{var r=-1,d=[],n;d.push(h);var c=h.nodes;do{-1!=r&&(d.push(c[r]),c=c[r].nodes,r=-1);for(var g=c.length-1;0<=g;g--){var l=c[g];if("leaf"in l){r=-1;break}var b=RTree.Rectangle.squarified_ratio(l.w,l.h,l.nodes.length+1),u=Math.max(l.x+l.w,e.x+e.w)-Math.min(l.x,e.x),q=Math.max(l.y+l.h,e.y+e.h)-Math.min(l.y,
e.y),l=RTree.Rectangle.squarified_ratio(u,q,l.nodes.length+2);if(0>r||Math.abs(l-b)<n)n=Math.abs(l-b),r=g}}while(-1!=r);r=e;do{if(f&&"nodes"in f&&0==f.nodes.length)for(n=f,f=d.pop(),c=0;c<f.nodes.length;c++){if(f.nodes[c]===n||0==f.nodes[c].nodes.length){f.nodes.splice(c,1);break}}else f=d.pop();if("leaf"in r||"nodes"in r||"[object Array]"===Object.prototype.toString.call(r)){if("[object Array]"===Object.prototype.toString.call(r)){for(n=0;n<r.length;n++)RTree.Rectangle.expand_rectangle(f,r[n]);f.nodes=
f.nodes.concat(r)}else RTree.Rectangle.expand_rectangle(f,r),f.nodes.push(r);if(f.nodes.length<=a)r={x:f.x,y:f.y,w:f.w,h:f.h};else{n=r=f.nodes;c=n.length-1;g=0;b=n.length-1;l=0;q=u=void 0;for(u=n.length-2;0<=u;u--)q=n[u],q.x>n[g].x?g=u:q.x+q.w<n[c].x+n[c].w&&(c=u),q.y>n[l].y?l=u:q.y+q.h<n[b].y+n[b].h&&(b=u);u=Math.abs(n[c].x+n[c].w-n[g].x);q=Math.abs(n[b].y+n[b].h-n[l].y);u>q?c>g?(u=n.splice(c,1)[0],q=n.splice(g,1)[0]):(q=n.splice(g,1)[0],u=n.splice(c,1)[0]):b>l?(u=n.splice(b,1)[0],q=n.splice(l,1)[0]):
(q=n.splice(l,1)[0],u=n.splice(b,1)[0]);for(n=[{x:u.x,y:u.y,w:u.w,h:u.h,nodes:[u]},{x:q.x,y:q.y,w:q.w,h:q.h,nodes:[q]}];0<r.length;){for(var c=r,g=n[0],b=n[1],u=RTree.Rectangle.squarified_ratio(g.w,g.h,g.nodes.length+1),q=RTree.Rectangle.squarified_ratio(b.w,b.h,b.nodes.length+1),t=void 0,v=void 0,l=void 0,z=c.length-1;0<=z;z--){var w=c[z],B,x;B=Math.min(g.x,w.x);x=Math.min(g.y,w.y);B=Math.max(g.x+g.w,w.x+w.w)-B;x=Math.max(g.y+g.h,w.y+w.h)-x;x=Math.abs(RTree.Rectangle.squarified_ratio(B,x,g.nodes.length+
2)-u);var D;D=Math.min(b.x,w.x);B=Math.min(b.y,w.y);D=Math.max(b.x+b.w,w.x+w.w)-D;w=Math.max(b.y+b.h,w.y+w.h)-B;w=Math.abs(RTree.Rectangle.squarified_ratio(D,w,b.nodes.length+2)-q);if(!v||!t||Math.abs(w-x)<t)v=z,t=Math.abs(w-x),l=w<x?b:g}u=c.splice(v,1)[0];g.nodes.length+c.length+1<=k?(g.nodes.push(u),RTree.Rectangle.expand_rectangle(g,u)):b.nodes.length+c.length+1<=k?(b.nodes.push(u),RTree.Rectangle.expand_rectangle(b,u)):(l.nodes.push(u),RTree.Rectangle.expand_rectangle(l,u))}r=n;1>d.length&&(f.nodes.push(n[0]),
d.push(f),r=n[1])}}else RTree.Rectangle.expand_rectangle(f,r),r={x:f.x,y:f.y,w:f.w,h:f.h}}while(0<d.length)}};this.get_tree=function(){return t};this.set_tree=function(a,e){e||(e=t);var f=e;f.nodes=a.nodes;f.x=a.x;f.y=a.y;f.w=a.w;f.h=a.h;return f};this.search=function(a,h,f){if(1>arguments.length)throw"Wrong number of arguments. RT.Search requires at least a bounding rectangle.";switch(arguments.length){case 1:arguments[1]=!1;case 2:arguments[2]=[];case 3:arguments[3]=t;default:arguments.length=4}return e.apply(this,
arguments)};this.toJSON=function(a,e){var f=[],h=[],d={},n=3,c=1,g="";if(a&&!RTree.Rectangle.overlap_rectangle(a,t))return"";e?(n+=4,h.push(e.nodes.length),f.push(e.nodes),g+="var main_tree = {x:"+e.x.toFixed()+",y:"+e.y.toFixed()+",w:"+e.w.toFixed()+",h:"+e.h.toFixed()+",nodes:["):(h.push(t.nodes.length),f.push(t.nodes),g+="var main_tree = {x:"+t.x.toFixed()+",y:"+t.y.toFixed()+",w:"+t.w.toFixed()+",h:"+t.h.toFixed()+",nodes:[");do{var l=f.pop(),b=h.pop()-1;for(0<=b&&b<l.length-1&&(g+=",");0<=b;){var k=
l[b];if(!a||RTree.Rectangle.overlap_rectangle(a,k))if(k.nodes)if(c>=n){var q=v("saved_subtree"),g=g+("{x:"+k.x.toFixed()+",y:"+k.y.toFixed()+",w:"+k.w.toFixed()+",h:"+k.h.toFixed()+",load:'"+q+".js'}");d[q]=this.toJSON(a,k);0<b&&(g+=",")}else g+="{x:"+k.x.toFixed()+",y:"+k.y.toFixed()+",w:"+k.w.toFixed()+",h:"+k.h.toFixed()+",nodes:[",c+=1,h.push(b),f.push(l),l=k.nodes,b=k.nodes.length;else k.leaf?(q=k.leaf.toJSON?k.leaf.toJSON():JSON.stringify(k.leaf),g+="{x:"+k.x.toFixed()+",y:"+k.y.toFixed()+",w:"+
k.w.toFixed()+",h:"+k.h.toFixed()+",leaf:"+q+"}",0<b&&(g+=",")):k.load&&(g+="{x:"+k.x.toFixed()+",y:"+k.y.toFixed()+",w:"+k.w.toFixed()+",h:"+k.h.toFixed()+",load:'"+k.load+"'}",0<b&&(g+=","));b-=1}0>b&&(g+="]}",c-=1)}while(0<f.length);var g=g+";",z;for(z in d)g+="\nvar "+z+" = function(){"+d[z]+" return(main_tree);};";return g};this.remove=function(a,e){if(1>arguments.length)throw"Wrong number of arguments. RT.remove requires at least a bounding rectangle.";switch(arguments.length){case 1:arguments[1]=
!1;case 2:arguments[2]=t;default:arguments.length=3}if(!1===arguments[1]){var f=0,h=[];do f=h.length,h=h.concat(q.apply(this,arguments));while(f!=h.length);return h}return q.apply(this,arguments)};this.insert=function(a,e){if(2>arguments.length)throw"Wrong number of arguments. RT.Insert requires at least a bounding rectangle and an object.";return z({x:a.x,y:a.y,w:a.w,h:a.h,leaf:e},t)}};
RTree.Rectangle=function(h,k,a,t){var v,q,e,z,y,A;h.x?(v=h.x,e=h.y,0!==h.w&&!h.w&&h.x2?(y=h.x2-h.x,A=h.y2-h.y):(y=h.w,A=h.h)):(v=h,e=k,y=a,A=t);q=v+y;z=e+A;this.x1=this.x=function(){return v};this.y1=this.y=function(){return e};this.x2=function(){return q};this.y2=function(){return z};this.w=function(){return y};this.h=function(){return A};this.toJSON=function(){return'{"x":'+v.toString()+', "y":'+e.toString()+', "w":'+y.toString()+', "h":'+A.toString()+"}"};this.overlap=function(a){return this.x()<
a.x2()&&this.x2()>a.x()&&this.y()<a.y2()&&this.y2()>a.y()};this.expand=function(a){var h=Math.min(this.x(),a.x()),d=Math.min(this.y(),a.y());y=Math.max(this.x2(),a.x2())-h;A=Math.max(this.y2(),a.y2())-d;v=h;e=d;return this};this.setRect=function(a,e,d,h){}};RTree.Rectangle.overlap_rectangle=function(h,k){return h.x<k.x+k.w&&h.x+h.w>k.x&&h.y<k.y+k.h&&h.y+h.h>k.y};RTree.Rectangle.contains_rectangle=function(h,k){return h.x+h.w<=k.x+k.w&&h.x>=k.x&&h.y+h.h<=k.y+k.h&&h.y>=k.y};
RTree.Rectangle.expand_rectangle=function(h,k){var a=Math.min(h.x,k.x),t=Math.min(h.y,k.y);h.w=Math.max(h.x+h.w,k.x+k.w)-a;h.h=Math.max(h.y+h.h,k.y+k.h)-t;h.x=a;h.y=t;return h};RTree.Rectangle.make_MBR=function(h,k){if(1>h.length)return{x:0,y:0,w:0,h:0};k?k.x=h[0].x:k={x:h[0].x,y:h[0].y,w:h[0].w,h:h[0].h};k.y=h[0].y;k.w=h[0].w;k.h=h[0].h;for(var a=h.length-1;0<a;a--)RTree.Rectangle.expand_rectangle(k,h[a]);return k};var JSON;JSON||(JSON={});
(function(){function h(a,f){var r,d,n,c,g=q,l,b=f[a];b&&"object"==typeof b&&"function"==typeof b.toJSON&&(b=b.toJSON(a));"function"==typeof y&&(b=y.call(f,a,b));switch(typeof b){case "string":return k(b);case "number":return isFinite(b)?String(b):"null";case "boolean":case "null":return String(b);case "object":if(!b)return"null";q+=e;l=[];if("[object Array]"===Object.prototype.toString.apply(b)){c=b.length;for(r=0;r<c;r+=1)l[r]=h(r,b)||"null";n=0===l.length?"[]":q?"[\n"+q+l.join(",\n"+q)+"\n"+g+"]":
"["+l.join(",")+"]";q=g;return n}if(y&&"object"==typeof y)for(c=y.length,r=0;r<c;r+=1)"string"==typeof y[r]&&(d=y[r],n=h(d,b),n&&l.push(k(d)+(q?": ":":")+n));else for(d in b)Object.prototype.hasOwnProperty.call(b,d)&&(n=h(d,b),n&&l.push(k(d)+(q?": ":":")+n));n=0===l.length?"{}":q?"{\n"+q+l.join(",\n"+q)+"\n"+g+"}":"{"+l.join(",")+"}";q=g;return n}}function k(a){v.lastIndex=0;return v.test(a)?'"'+a.replace(v,function(a){var e=z[a];return"string"==typeof e?e:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+
'"':'"'+a+'"'}function a(a){return 10>a?"0"+a:a}"use strict";"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var t=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
v=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,q,e,z={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},y;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,f,k){var d;e=q="";if("number"==typeof k)for(d=0;d<k;d+=1)e+=" ";else"string"==typeof k&&(e=k);y=f;if(!f||"function"==typeof f||"object"==typeof f&&"number"==typeof f.length)return h("",{"":a});throw Error("JSON.stringify");});"function"!=
typeof JSON.parse&&(JSON.parse=function(a,e){function h(a,c){var d,k,b=a[c];if(b&&"object"==typeof b)for(d in b)Object.prototype.hasOwnProperty.call(b,d)&&(k=h(b,d),void 0!==k?b[d]=k:delete b[d]);return e.call(a,c,b)}var d;a=String(a);t.lastIndex=0;t.test(a)&&(a=a.replace(t,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return d=eval("("+a+")"),"function"==typeof e?h({"":d},""):d;throw new SyntaxError("JSON.parse");})})();
SockJS=function(){var h=document,k=window,a={},t=function(){};t.prototype.addEventListener=function(p,s){this._listeners||(this._listeners={});p in this._listeners||(this._listeners[p]=[]);var b=this._listeners[p];-1===a.arrIndexOf(b,s)&&b.push(s)};t.prototype.removeEventListener=function(p,s){if(this._listeners&&p in this._listeners){var b=this._listeners[p],m=a.arrIndexOf(b,s);-1!==m&&(1<b.length?this._listeners[p]=b.slice(0,m).concat(b.slice(m+1)):delete this._listeners[p])}};t.prototype.dispatchEvent=
function(p){var a=p.type,b=Array.prototype.slice.call(arguments,0);this["on"+a]&&this["on"+a].apply(this,b);if(this._listeners&&a in this._listeners)for(var m=0;m<this._listeners[a].length;m++)this._listeners[a][m].apply(this,b)};var v=function(p,a){this.type=p;if("undefined"!=typeof a)for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])};v.prototype.toString=function(){var p=[],a;for(a in this)if(this.hasOwnProperty(a)){var b=this[a];"function"==typeof b&&(b="[function]");p.push(a+"="+b)}return"SimpleEvent("+
p.join(", ")+")"};var q=function(p){this.events=p||[]};q.prototype.emit=function(p){var s=Array.prototype.slice.call(arguments,1);!this.nuked&&this["on"+p]&&this["on"+p].apply(this,s);-1===a.arrIndexOf(this.events,p)&&a.log("Event "+JSON.stringify(p)+" not listed "+JSON.stringify(this.events)+" in "+this)};q.prototype.nuke=function(p){this.nuked=!0;for(p=0;p<this.events.length;p++)delete this[this.events[p]]};a.random_string=function(p,a){a=a||37;var b,m=[];for(b=0;b<p;b++)m.push("abcdefghijklmnopqrstuvwxyz0123456789_".substr(Math.floor(Math.random()*
a),1));return m.join("")};a.random_number=function(a){return Math.floor(Math.random()*a)};a.random_number_string=function(p){var s=(""+(p-1)).length;return(Array(s+1).join("0")+a.random_number(p)).slice(-s)};a.getOrigin=function(a){return(a+"/").split("/").slice(0,3).join("/")};a.isSameOriginUrl=function(a,s){return s||(s=k.location.href),a.split("/").slice(0,3).join("/")===s.split("/").slice(0,3).join("/")};a.getParentDomain=function(a){return/^[0-9.]*$/.test(a)||/^\[/.test(a)||!/[.]/.test(a)?a:
a.split(".").slice(1).join(".")};a.objectExtend=function(a,s){for(var b in s)s.hasOwnProperty(b)&&(a[b]=s[b]);return a};a.polluteGlobalNamespace=function(){"_jp"in k||(k._jp={})};a.closeFrame=function(a,s){return"c"+JSON.stringify([a,s])};a.userSetCode=function(a){return 1E3===a||3E3<=a&&4999>=a};a.countRTO=function(a){var s;return 100<a?s=3*a:s=a+200,s};a.log=function(){k.console&&console.log&&console.log.apply&&console.log.apply(console,arguments)};a.bind=function(a,s){return a.bind?a.bind(s):function(){return a.apply(s,
arguments)}};a.flatUrl=function(a){return-1===a.indexOf("?")&&-1===a.indexOf("#")};a.amendUrl=function(p){var s=h.location;if(!p)throw Error("Wrong url for SockJS");if(!a.flatUrl(p))throw Error("Only basic urls are supported in SockJS");return 0===p.indexOf("//")&&(p=s.protocol+p),0===p.indexOf("/")&&(p=s.protocol+"//"+s.host+p),p=p.replace(/[/]+$/,""),p};a.arrIndexOf=function(a,s){for(var b=0;b<a.length;b++)if(a[b]===s)return b;return-1};a.arrSkip=function(p,s){var b=a.arrIndexOf(p,s);return-1===
b?p.slice():p.slice(0,b).concat(p.slice(b+1))};a.isArray=Array.isArray||function(a){return 0<={}.toString.call(a).indexOf("Array")};a.delay=function(a,s){return"function"==typeof a&&(s=a,a=0),setTimeout(s,a)};var e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,z={"\x00":"\\u0000","\u0001":"\\u0001","\u0002":"\\u0002","\u0003":"\\u0003","\u0004":"\\u0004","\u0005":"\\u0005","\u0006":"\\u0006","\u0007":"\\u0007","\b":"\\b",
"\t":"\\t","\n":"\\n","\x0B":"\\u000b","\f":"\\f","\r":"\\r","\u000e":"\\u000e","\u000f":"\\u000f","\u0010":"\\u0010","\u0011":"\\u0011","\u0012":"\\u0012","\u0013":"\\u0013","\u0014":"\\u0014","\u0015":"\\u0015","\u0016":"\\u0016","\u0017":"\\u0017","\u0018":"\\u0018","\u0019":"\\u0019","\u001a":"\\u001a","\u001b":"\\u001b","\u001c":"\\u001c","\u001d":"\\u001d","\u001e":"\\u001e","\u001f":"\\u001f",'"':'\\"',"\\":"\\\\","\u007f":"\\u007f","\u0080":"\\u0080","\u0081":"\\u0081","\u0082":"\\u0082",
"\u0083":"\\u0083","\u0084":"\\u0084","\u0085":"\\u0085","\u0086":"\\u0086","\u0087":"\\u0087","\u0088":"\\u0088","\u0089":"\\u0089","\u008a":"\\u008a","\u008b":"\\u008b","\u008c":"\\u008c","\u008d":"\\u008d","\u008e":"\\u008e","\u008f":"\\u008f","\u0090":"\\u0090","\u0091":"\\u0091","\u0092":"\\u0092","\u0093":"\\u0093","\u0094":"\\u0094","\u0095":"\\u0095","\u0096":"\\u0096","\u0097":"\\u0097","\u0098":"\\u0098","\u0099":"\\u0099","\u009a":"\\u009a","\u009b":"\\u009b","\u009c":"\\u009c","\u009d":"\\u009d",
"\u009e":"\\u009e","\u009f":"\\u009f","\u00ad":"\\u00ad","\u0600":"\\u0600","\u0601":"\\u0601","\u0602":"\\u0602","\u0603":"\\u0603","\u0604":"\\u0604","\u070f":"\\u070f","\u17b4":"\\u17b4","\u17b5":"\\u17b5","\u200c":"\\u200c","\u200d":"\\u200d","\u200e":"\\u200e","\u200f":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","\u202a":"\\u202a","\u202b":"\\u202b","\u202c":"\\u202c","\u202d":"\\u202d","\u202e":"\\u202e","\u202f":"\\u202f","\u2060":"\\u2060","\u2061":"\\u2061","\u2062":"\\u2062","\u2063":"\\u2063",
"\u2064":"\\u2064","\u2065":"\\u2065","\u2066":"\\u2066","\u2067":"\\u2067","\u2068":"\\u2068","\u2069":"\\u2069","\u206a":"\\u206a","\u206b":"\\u206b","\u206c":"\\u206c","\u206d":"\\u206d","\u206e":"\\u206e","\u206f":"\\u206f","\ufeff":"\\ufeff","\ufff0":"\\ufff0","\ufff1":"\\ufff1","\ufff2":"\\ufff2","\ufff3":"\\ufff3","\ufff4":"\\ufff4","\ufff5":"\\ufff5","\ufff6":"\\ufff6","\ufff7":"\\ufff7","\ufff8":"\\ufff8","\ufff9":"\\ufff9","\ufffa":"\\ufffa","\ufffb":"\\ufffb","\ufffc":"\\ufffc","\ufffd":"\\ufffd",
"\ufffe":"\\ufffe","\uffff":"\\uffff"},y=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,
A,f=JSON&&JSON.stringify||function(a){return e.lastIndex=0,e.test(a)&&(a=a.replace(e,function(a){return z[a]})),'"'+a+'"'},r=function(a){var s,b={},m=[];for(s=0;65536>s;s++)m.push(String.fromCharCode(s));return a.lastIndex=0,m.join("").replace(a,function(a){return b[a]="\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4),""}),a.lastIndex=0,b};a.quote=function(a){a=f(a);return y.lastIndex=0,y.test(a)?(A||(A=r(y)),a.replace(y,function(a){return A[a]})):a};var d="websocket xdr-streaming xhr-streaming iframe-eventsource iframe-htmlfile xdr-polling xhr-polling iframe-xhr-polling jsonp-polling".split(" ");
a.probeProtocols=function(){for(var a={},s=0;s<d.length;s++){var c=d[s];a[c]=b[c]&&b[c].enabled()}return a};a.detectProtocols=function(a,s,b){var m={},c=[];s||(s=d);for(var e=0;e<s.length;e++){var h=s[e];m[h]=a[h]}var f=function(a){var p=a.shift();m[p]?c.push(p):0<a.length&&f(a)};return!1!==b.websocket&&f(["websocket"]),m["xhr-streaming"]&&!b.null_origin?c.push("xhr-streaming"):!m["xdr-streaming"]||b.cookie_needed||b.null_origin?f(["iframe-eventsource","iframe-htmlfile"]):c.push("xdr-streaming"),
m["xhr-polling"]&&!b.null_origin?c.push("xhr-polling"):!m["xdr-polling"]||b.cookie_needed||b.null_origin?f(["iframe-xhr-polling","jsonp-polling"]):c.push("xdr-polling"),c};a.createHook=function(){var p="a"+a.random_string(8);if(!("_sockjs_global"in k)){var b={};k._sockjs_global=function(a){return a in b||(b[a]={id:a,del:function(){delete b[a]}}),b[a]}}return k._sockjs_global(p)};a.attachMessage=function(p){a.attachEvent("message",p)};a.attachEvent=function(a,b){"undefined"!=typeof k.addEventListener?
k.addEventListener(a,b,!1):(h.attachEvent("on"+a,b),k.attachEvent("on"+a,b))};a.detachMessage=function(p){a.detachEvent("message",p)};a.detachEvent=function(a,b){"undefined"!=typeof k.addEventListener?k.removeEventListener(a,b,!1):(h.detachEvent("on"+a,b),k.detachEvent("on"+a,b))};var n={},c=!1,g=function(){for(var a in n)n[a](),delete n[a]},l=function(){c||(c=!0,g())};a.attachEvent("beforeunload",l);a.attachEvent("unload",l);a.unload_add=function(p){var b=a.random_string(8);return n[b]=p,c&&a.delay(g),
b};a.unload_del=function(a){a in n&&delete n[a]};a.createIframe=function(p,b){var c=h.createElement("iframe"),m,d,e=function(){clearTimeout(m);try{c.onload=null}catch(a){}c.onerror=null},f=function(){c&&(e(),setTimeout(function(){c&&c.parentNode.removeChild(c);c=null},0),a.unload_del(d))};return c.src=p,c.style.display="none",c.style.position="absolute",c.onerror=function(){c&&(f(),b("onerror"))},c.onload=function(){clearTimeout(m);m=setTimeout(function(){c&&(f(),b("onload timeout"))},2E3)},h.body.appendChild(c),
m=setTimeout(function(){c&&(f(),b("timeout"))},15E3),d=a.unload_add(f),{post:function(a,p){try{c&&c.contentWindow&&c.contentWindow.postMessage(a,p)}catch(b){}},cleanup:f,loaded:e}};a.createHtmlfile=function(p,b){var c=new ActiveXObject("htmlfile"),m,d,e,f=function(){clearTimeout(m)},h=function(){c&&(f(),a.unload_del(d),e.parentNode.removeChild(e),e=c=null,CollectGarbage())};c.open();c.write('<html><script>document.domain="'+document.domain+'";\x3c/script></html>');c.close();c.parentWindow._jp=k._jp;
var g=c.createElement("div");return c.body.appendChild(g),e=c.createElement("iframe"),g.appendChild(e),e.src=p,m=setTimeout(function(){c&&(h(),b("timeout"))},15E3),d=a.unload_add(h),{post:function(a,p){try{e&&e.contentWindow&&e.contentWindow.postMessage(a,p)}catch(b){}},cleanup:h,loaded:f}};l=function(){};l.prototype=new q(["chunk","finish"]);l.prototype._start=function(p,b,c,m){var d=this;try{d.xhr=new XMLHttpRequest}catch(e){}if(!d.xhr)try{d.xhr=new k.ActiveXObject("Microsoft.XMLHTTP")}catch(f){}if(k.ActiveXObject||
k.XDomainRequest)b+=(-1===b.indexOf("?")?"?":"&")+"t="+ +new Date;d.unload_ref=a.unload_add(function(){d._cleanup(!0)});try{d.xhr.open(p,b,!0)}catch(h){d.emit("finish",0,"");d._cleanup();return}m&&m.no_credentials||(d.xhr.withCredentials="true");if(m&&m.headers)for(var g in m.headers)d.xhr.setRequestHeader(g,m.headers[g]);d.xhr.onreadystatechange=function(){if(d.xhr){var a=d.xhr;switch(a.readyState){case 3:try{var b=a.status,p=a.responseText}catch(c){}p&&0<p.length&&d.emit("chunk",b,p);break;case 4:d.emit("finish",
a.status,a.responseText),d._cleanup(!1)}}};d.xhr.send(c)};l.prototype._cleanup=function(b){if(this.xhr){a.unload_del(this.unload_ref);this.xhr.onreadystatechange=function(){};if(b)try{this.xhr.abort()}catch(c){}this.unload_ref=this.xhr=null}};l.prototype.close=function(){this.nuke();this._cleanup(!0)};(a.XHRCorsObject=function(){var b=this,c=arguments;a.delay(function(){b._start.apply(b,c)})}).prototype=new l;(a.XHRLocalObject=function(b,c,d){var m=this;a.delay(function(){m._start(b,c,d,{no_credentials:!0})})}).prototype=
new l;l=a.XDRObject=function(b,c,d){var m=this;a.delay(function(){m._start(b,c,d)})};l.prototype=new q(["chunk","finish"]);l.prototype._start=function(b,c,d){var m=this,e=new XDomainRequest;c+=(-1===c.indexOf("?")?"?":"&")+"t="+ +new Date;var f=e.ontimeout=e.onerror=function(){m.emit("finish",0,"");m._cleanup(!1)};e.onprogress=function(){m.emit("chunk",200,e.responseText)};e.onload=function(){m.emit("finish",200,e.responseText);m._cleanup(!1)};m.xdr=e;m.unload_ref=a.unload_add(function(){m._cleanup(!0)});
try{m.xdr.open(b,c),m.xdr.send(d)}catch(h){f()}};l.prototype._cleanup=function(b){if(this.xdr){a.unload_del(this.unload_ref);this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null;if(b)try{this.xdr.abort()}catch(c){}this.unload_ref=this.xdr=null}};l.prototype.close=function(){this.nuke();this._cleanup(!0)};a.isXHRCorsCapable=function(){return k.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:k.XDomainRequest&&h.domain?2:x.enabled()?3:4};var b=function(p,c,d){var m=this,
e;m._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0};d&&a.objectExtend(m._options,d);m._base_url=a.amendUrl(p);m._server=m._options.server||a.random_number_string(1E3);m._options.protocols_whitelist&&m._options.protocols_whitelist.length?e=m._options.protocols_whitelist:("string"==typeof c&&0<c.length?e=[c]:a.isArray(c)?e=c:e=null,e&&m._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.'));
m._protocols=[];m.protocol=null;m.readyState=b.CONNECTING;m._ir=R(m._base_url);m._ir.onfinish=function(b,p){m._ir=null;b?(m._options.info&&(b=a.objectExtend(b,m._options.info)),m._options.rtt&&(p=m._options.rtt),m._applyInfo(b,p,e),m._didClose()):m._didClose(1002,"Can't connect to server",!0)}};b.prototype=new t;b.version="0.3.1";b.CONNECTING=0;b.OPEN=1;b.CLOSING=2;b.CLOSED=3;b.prototype._debug=function(){this._options.debug&&a.log.apply(a,arguments)};b.prototype._dispatchOpen=function(){this.readyState===
b.CONNECTING?(this._transport_tref&&(clearTimeout(this._transport_tref),this._transport_tref=null),this.readyState=b.OPEN,this.dispatchEvent(new v("open"))):this._didClose(1006,"Server lost session")};b.prototype._dispatchMessage=function(a){this.readyState===b.OPEN&&this.dispatchEvent(new v("message",{data:a}))};b.prototype._dispatchHeartbeat=function(a){this.readyState===b.OPEN&&this.dispatchEvent(new v("heartbeat",{}))};b.prototype._didClose=function(p,c,d){var m=this;if(m.readyState!==b.CONNECTING&&
m.readyState!==b.OPEN&&m.readyState!==b.CLOSING)throw Error("INVALID_STATE_ERR");m._ir&&(m._ir.nuke(),m._ir=null);m._transport&&(m._transport.doCleanup(),m._transport=null);var e=new v("close",{code:p,reason:c,wasClean:a.userSetCode(p)});if(!a.userSetCode(p)&&m.readyState===b.CONNECTING&&!d){if(m._try_next_protocol(e))return;e=new v("close",{code:2E3,reason:"All transports failed",wasClean:!1,last_event:e})}m.readyState=b.CLOSED;a.delay(function(){m.dispatchEvent(e)})};b.prototype._didMessage=function(a){switch(a.slice(0,
1)){case "o":this._dispatchOpen();break;case "a":a=JSON.parse(a.slice(1)||"[]");for(var b=0;b<a.length;b++)this._dispatchMessage(a[b]);break;case "m":a=JSON.parse(a.slice(1)||"null");this._dispatchMessage(a);break;case "c":a=JSON.parse(a.slice(1)||"[]");this._didClose(a[0],a[1]);break;case "h":this._dispatchHeartbeat()}};b.prototype._try_next_protocol=function(c){var d=this;d.protocol&&(d._debug("Closed transport:",d.protocol,""+c),d.protocol=null);for(d._transport_tref&&(clearTimeout(d._transport_tref),
d._transport_tref=null);;){c=d.protocol=d._protocols.shift();if(!c)return!1;if(b[c]&&!0===b[c].need_body&&(!h.body||"undefined"!=typeof h.readyState&&"complete"!==h.readyState))return d._protocols.unshift(c),d.protocol="waiting-for-load",a.attachEvent("load",function(){d._try_next_protocol()}),!0;if(b[c]&&b[c].enabled(d._options)){d._transport_tref=a.delay((d._options.rto||0)*(b[c].roundTrips||1)||5E3,function(){d.readyState===b.CONNECTING&&d._didClose(2007,"Transport timeouted")});var e=a.random_string(8),
e=d._base_url+"/"+d._server+"/"+e;return d._debug("Opening transport:",c," url:"+e," RTO:"+d._options.rto),d._transport=new b[c](d,e,d._base_url),!0}d._debug("Skipping transport:",c)}};b.prototype.close=function(c,d){if(c&&!a.userSetCode(c))throw Error("INVALID_ACCESS_ERR");return this.readyState!==b.CONNECTING&&this.readyState!==b.OPEN?!1:(this.readyState=b.CLOSING,this._didClose(c||1E3,d||"Normal closure"),!0)};b.prototype.send=function(c){if(this.readyState===b.CONNECTING)throw Error("INVALID_STATE_ERR");
return this.readyState===b.OPEN&&this._transport.doSend(a.quote(""+c)),!0};b.prototype._applyInfo=function(b,c,d){this._options.info=b;this._options.rtt=c;this._options.rto=a.countRTO(c);this._options.info.null_origin=!h.domain;c=a.probeProtocols();this._protocols=a.detectProtocols(c,d,b)};l=b.websocket=function(b,c){var d=this,m=c+"/websocket";"https"===m.slice(0,5)?m="wss"+m.slice(5):m="ws"+m.slice(4);d.ri=b;d.url=m;d.ws=new (k.WebSocket||k.MozWebSocket)(d.url);d.ws.onmessage=function(a){d.ri._didMessage(a.data)};
d.unload_ref=a.unload_add(function(){d.ws.close()});d.ws.onclose=function(){d.ri._didMessage(a.closeFrame(1006,"WebSocket connection broken"))}};l.prototype.doSend=function(a){this.ws.send("["+a+"]")};l.prototype.doCleanup=function(){var b=this.ws;b&&(b.onmessage=b.onclose=null,b.close(),a.unload_del(this.unload_ref),this.unload_ref=this.ri=this.ws=null)};l.enabled=function(){return!!k.WebSocket||!!k.MozWebSocket};l.roundTrips=2;var u=function(){};u.prototype.send_constructor=function(a){this.send_buffer=
[];this.sender=a};u.prototype.doSend=function(a){this.send_buffer.push(a);this.send_stop||this.send_schedule()};u.prototype.send_schedule_wait=function(){var b=this,c;b.send_stop=function(){b.send_stop=null;clearTimeout(c)};c=a.delay(25,function(){b.send_stop=null;b.send_schedule()})};u.prototype.send_schedule=function(){var a=this;if(0<a.send_buffer.length){var b="["+a.send_buffer.join(",")+"]";a.send_stop=a.sender(a.trans_url,b,function(){a.send_stop=null;a.send_schedule_wait()});a.send_buffer=
[]}};u.prototype.send_destructor=function(){this._send_stop&&this._send_stop();this._send_stop=null};var N=function(b,c,d){if(!("_send_form"in this)){var m=this._send_form=h.createElement("form"),e=this._send_area=h.createElement("textarea");e.name="d";m.style.display="none";m.style.position="absolute";m.method="POST";m.enctype="application/x-www-form-urlencoded";m.acceptCharset="UTF-8";m.appendChild(e);h.body.appendChild(m)}var m=this._send_form,e=this._send_area,f="a"+a.random_string(8);m.target=
f;m.action=b+"/jsonp_send?i="+f;var g;try{g=h.createElement('<iframe name="'+f+'">')}catch(k){g=h.createElement("iframe"),g.name=f}g.id=f;m.appendChild(g);g.style.display="none";try{e.value=c}catch(l){a.log("Your browser is seriously broken. Go home! "+l.message)}m.submit();var n=function(b){g.onerror&&(g.onreadystatechange=g.onerror=g.onload=null,a.delay(500,function(){g.parentNode.removeChild(g);g=null}),e.value="",d())};return g.onerror=g.onload=n,g.onreadystatechange=function(a){"complete"==g.readyState&&
n()},n},O=function(a){return function(b,c,d){return(new a("POST",b+"/xhr_send",c)).onfinish=function(a,b){d(a)},function(a){d(0,a)}}},P=function(b,c){var d,e=h.createElement("script"),f,g=function(a){f&&(f.parentNode.removeChild(f),f=null);e&&(clearTimeout(d),e.parentNode.removeChild(e),e.onreadystatechange=e.onerror=e.onload=e.onclick=null,e=null,c(a),c=null)},k=!1,l=null;e.id="a"+a.random_string(8);e.src=b;e.type="text/javascript";e.charset="UTF-8";e.onerror=function(b){l||(l=setTimeout(function(){k||
g(a.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1E3))};e.onload=function(b){g(a.closeFrame(1006,"JSONP script loaded abnormally (onload)"))};e.onreadystatechange=function(b){if(/loaded|closed/.test(e.readyState)){if(e&&e.htmlFor&&e.onclick){k=!0;try{e.onclick()}catch(c){}}e&&g(a.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}};if("undefined"==typeof e.async&&h.attachEvent)if(/opera/i.test(navigator.userAgent))f=h.createElement("script"),f.text="try{var a = document.getElementById('"+
e.id+"'); if(a)a.onerror();}catch(x){};",e.async=f.async=!1;else{try{e.htmlFor=e.id,e.event="onclick"}catch(n){}e.async=!0}"undefined"!=typeof e.async&&(e.async=!0);d=setTimeout(function(){g(a.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35E3);var q=h.getElementsByTagName("head")[0];return q.insertBefore(e,q.firstChild),f&&q.insertBefore(f,q.firstChild),g},l=b["jsonp-polling"]=function(b,c){a.polluteGlobalNamespace();this.ri=b;this.trans_url=c;this.send_constructor(N);this._schedule_recv()};
l.prototype=new u;l.prototype._schedule_recv=function(){var a=this;a._recv_stop=Q(a.trans_url+"/jsonp",P,function(b){a._recv_stop=null;b&&(a._is_closing||a.ri._didMessage(b));a._is_closing||a._schedule_recv()})};l.enabled=function(){return!0};l.need_body=!0;l.prototype.doCleanup=function(){this._is_closing=!0;this._recv_stop&&this._recv_stop();this.ri=this._recv_stop=null;this.send_destructor()};var Q=function(b,c,d){var e="a"+a.random_string(6);b=b+"?c="+escape("_jp."+e);c=c(b,function(a){delete k._jp[e];
d(a)});k._jp[e]=c;return function(){k._jp[e]&&k._jp[e](a.closeFrame(1E3,"JSONP user aborted read"))}},l=function(){};l.prototype=new u;l.prototype.run=function(a,b,c,d,e){this.ri=a;this.trans_url=b;this.send_constructor(O(e));this.poll=new H(a,d,b+c,e)};l.prototype.doCleanup=function(){this.poll&&(this.poll.abort(),this.poll=null)};var w=b["xhr-streaming"]=function(b,c){this.run(b,c,"/xhr_streaming",E,a.XHRCorsObject)};w.prototype=new l;w.enabled=function(){return k.XMLHttpRequest&&"withCredentials"in
new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)};w.roundTrips=2;w.need_body=!0;u=b["xdr-streaming"]=function(b,c){this.run(b,c,"/xhr_streaming",E,a.XDRObject)};u.prototype=new l;u.enabled=function(){return!!k.XDomainRequest};u.roundTrips=2;var B=b["xhr-polling"]=function(b,c){this.run(b,c,"/xhr",E,a.XHRCorsObject)};B.prototype=new l;B.enabled=w.enabled;B.roundTrips=2;w=b["xdr-polling"]=function(b,c){this.run(b,c,"/xhr",E,a.XDRObject)};w.prototype=new l;w.enabled=u.enabled;w.roundTrips=2;var x=
function(){};x.prototype.i_constructor=function(b,c,d){var e=this;e.ri=b;e.origin=a.getOrigin(d);e.base_url=d;e.trans_url=c;b=d+"/iframe.html";e.ri._options.devel&&(b+="?t="+ +new Date);e.window_id=a.random_string(8);b+="#"+e.window_id;e.iframeObj=a.createIframe(b,function(a){e.ri._didClose(1006,"Unable to load an iframe ("+a+")")});e.onmessage_cb=a.bind(e.onmessage,e);a.attachMessage(e.onmessage_cb)};x.prototype.doCleanup=function(){if(this.iframeObj){a.detachMessage(this.onmessage_cb);try{this.iframeObj.iframe.contentWindow&&
this.postMessage("c")}catch(b){}this.iframeObj.cleanup();this.onmessage_cb=this.iframeObj=this.iframeObj=null}};x.prototype.onmessage=function(a){if(a.origin===this.origin){var c=a.data.slice(0,8),d=a.data.slice(8,9);a=a.data.slice(9);if(c===this.window_id)switch(d){case "s":this.iframeObj.loaded();this.postMessage("s",JSON.stringify([b.version,this.protocol,this.trans_url,this.base_url]));break;case "t":this.ri._didMessage(a)}}};x.prototype.postMessage=function(a,b){this.iframeObj.post(this.window_id+
a+(b||""),this.origin)};x.prototype.doSend=function(a){this.postMessage("m",a)};x.enabled=function(){var a=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof k.postMessage||"object"==typeof k.postMessage)&&!a};var D,I=function(b,c){parent!==k?parent.postMessage(D+b+(c||""),"*"):a.log("Can't postMessage, no parent window.",b,c)},C=function(){};C.prototype._didClose=function(b,c){I("t",a.closeFrame(b,c))};C.prototype._didMessage=function(a){I("t",
a)};C.prototype._doSend=function(a){this._transport.doSend(a)};C.prototype._doCleanup=function(){this._transport.doCleanup()};a.parent_origin=void 0;b.bootstrap_iframe=function(){var c;D=h.location.hash.slice(1);a.attachMessage(function(d){if(d.source===parent&&("undefined"==typeof a.parent_origin&&(a.parent_origin=d.origin),d.origin===a.parent_origin)){var e=d.data.slice(0,8),f=d.data.slice(8,9);d=d.data.slice(9);if(e===D)switch(f){case "s":var g=JSON.parse(d),e=g[0],f=g[1];d=g[2];g=g[3];e!==b.version&&
a.log('Incompatibile SockJS! Main site uses: "'+e+'", the iframe: "'+b.version+'".');if(!a.flatUrl(d)||!a.flatUrl(g)){a.log("Only basic urls are supported in SockJS");break}if(!a.isSameOriginUrl(d)||!a.isSameOriginUrl(g)){a.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([k.location.href,d,g])+")");break}c=new C;c._transport=new C[f](c,d,g);break;case "m":c._doSend(d);break;case "c":c&&c._doCleanup(),c=null}}});I("s")};var F=function(b,c){var d=this;a.delay(function(){d.doXhr(b,
c)})};F.prototype=new q(["finish"]);F.prototype.doXhr=function(b,c){var d=this,e=(new Date).getTime(),f=new c("GET",b+"/info"),g=a.delay(8E3,function(){f.ontimeout()});f.onfinish=function(a,b){clearTimeout(g);g=null;if(200===a){var c=(new Date).getTime()-e,f=JSON.parse(b);"object"!=typeof f&&(f={});d.emit("finish",f,c)}else d.emit("finish")};f.ontimeout=function(){f.close();d.emit("finish")}};var L=function(b){var c=this,d=function(){var a=new x;a.protocol="w-iframe-info-receiver";var d=function(b){"string"==
typeof b&&"m"===b.substr(0,1)?(b=JSON.parse(b.substr(1)),c.emit("finish",b[0],b[1])):c.emit("finish");a.doCleanup();a=null};a.i_constructor({_options:{},_didClose:d,_didMessage:d},b,b)};h.body?d():a.attachEvent("load",d)};L.prototype=new q(["finish"]);var M=function(){var b=this;a.delay(function(){b.emit("finish",{},2E3)})};M.prototype=new q(["finish"]);var R=function(b){if(a.isSameOriginUrl(b))return new F(b,a.XHRLocalObject);switch(a.isXHRCorsCapable()){case 1:return new F(b,a.XHRCorsObject);case 2:return new F(b,
a.XDRObject);case 3:return new L(b);default:return new M}};(C["w-iframe-info-receiver"]=function(b,c,d){(new F(d,a.XHRLocalObject)).onfinish=function(a,c){b._didMessage("m"+JSON.stringify([a,c]));b._didClose()}}).prototype.doCleanup=function(){};q=b["iframe-eventsource"]=function(){this.protocol="w-iframe-eventsource";this.i_constructor.apply(this,arguments)};q.prototype=new x;q.enabled=function(){return"EventSource"in k&&x.enabled()};q.need_body=!0;q.roundTrips=3;(C["w-iframe-eventsource"]=function(b,
c){this.run(b,c,"/eventsource",J,a.XHRLocalObject)}).prototype=new l;q=b["iframe-xhr-polling"]=function(){this.protocol="w-iframe-xhr-polling";this.i_constructor.apply(this,arguments)};q.prototype=new x;q.enabled=function(){return k.XMLHttpRequest&&x.enabled()};q.need_body=!0;q.roundTrips=3;(C["w-iframe-xhr-polling"]=function(b,c){this.run(b,c,"/xhr",E,a.XHRLocalObject)}).prototype=new l;q=b["iframe-htmlfile"]=function(){this.protocol="w-iframe-htmlfile";this.i_constructor.apply(this,arguments)};
q.prototype=new x;q.enabled=function(){return x.enabled()};q.need_body=!0;q.roundTrips=3;(C["w-iframe-htmlfile"]=function(b,c){this.run(b,c,"/htmlfile",K,a.XHRLocalObject)}).prototype=new l;var H=function(a,b,c,d){this.ri=a;this.Receiver=b;this.recv_url=c;this.AjaxObject=d;this._scheduleRecv()};H.prototype._scheduleRecv=function(){var a=this,b=a.poll=new a.Receiver(a.recv_url,a.AjaxObject);b.onmessage=function(b){a.ri._didMessage(b.data)};b.onclose=function(c){a.poll=b=b.onmessage=b.onclose=null;
a.poll_is_closing||("permanent"===c.reason?a.ri._didClose(1006,"Polling error ("+c.reason+")"):a._scheduleRecv())}};H.prototype.abort=function(){this.poll_is_closing=!0;this.poll&&this.poll.abort()};var J=function(b){var c=this,d=new EventSource(b);d.onmessage=function(a){c.dispatchEvent(new v("message",{data:unescape(a.data)}))};c.es_close=d.onerror=function(b,e){var f=e?"user":2!==d.readyState?"network":"permanent";c.es_close=d.onmessage=d.onerror=null;d.close();d=null;a.delay(200,function(){c.dispatchEvent(new v("close",
{reason:f}))})}};J.prototype=new t;J.prototype.abort=function(){this.es_close&&this.es_close({},!0)};var G,K=function(b){var c=this;a.polluteGlobalNamespace();c.id="a"+a.random_string(6,26);b+=(-1===b.indexOf("?")?"?":"&")+"c="+escape("_jp."+c.id);if(void 0===G)if("ActiveXObject"in k)try{G=!!new ActiveXObject("htmlfile")}catch(d){}else G=!1;var e=G?a.createHtmlfile:a.createIframe,f;k._jp[c.id]={start:function(){f.loaded()},message:function(a){c.dispatchEvent(new v("message",{data:a}))},stop:function(){c.iframe_close({},
"network")}};c.iframe_close=function(a,b){f.cleanup();c.iframe_close=f=null;delete k._jp[c.id];c.dispatchEvent(new v("close",{reason:b}))};f=e(b,function(a){c.iframe_close({},"permanent")})};K.prototype=new t;K.prototype.abort=function(){this.iframe_close&&this.iframe_close({},"user")};var E=function(a,b){var c=this,d=0;c.xo=new b("POST",a,null);c.xo.onchunk=function(a,b){if(200===a)for(;;){var e=b.slice(d),f=e.indexOf("\n");if(-1===f)break;d+=f+1;e=e.slice(0,f);c.dispatchEvent(new v("message",{data:e}))}};
c.xo.onfinish=function(a,b){c.xo.onchunk(a,b);c.xo=null;c.dispatchEvent(new v("close",{reason:200===a?"network":"permanent"}))}};return E.prototype=new t,E.prototype.abort=function(){this.xo&&(this.xo.close(),this.dispatchEvent(new v("close",{reason:"user"})),this.xo=null)},b.getUtils=function(){return a},b.getIframeTransport=function(){return x},b}();"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1);"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS});
(function(){'use strict';global.Class=function(){function d(a){return a&&"object"===typeof a&&!Array.isArray(a)}function c(a,b){if(!d(a)||"function"!==typeof b)throw new TypeError;Object.forEach(a,function(a,e,c){c.hasOwnProperty(a)&&b(a,e)});return!0}var b=function(){},a={extend:function(a,b){if(2!==arguments.length)throw new RangeError;if("function"!==typeof a||"function"!==typeof b)throw new TypeError;var c=Object.createProto(b.prototype);c.constructor=a;c._super=null;a.prototype=c;return a},decorate:function(a,
f,g){if(d(f))return c(f,this.decorate.bind(this,a));"function"===typeof a&&"function"!==typeof a[f]&&(a=a.prototype);if(3!==arguments.length)throw new RangeError;if("string"!==typeof f||"function"!==typeof g)throw new TypeError;var h=a.hasOwnProperty(f)&&"function"===typeof a[f]?a[f]:null,k=Object.getPrototypeOf(a);return a[f]=function(){if(null===this||"undefined"===typeof this)return g.apply(this,arguments);var a=this._super,e=!h&&k&&"function"===typeof k[f]&&k[f];this._super=h||e||b;e=g.apply(this,
arguments);this._super=a;return e}}};Function.prototype.property=function(a,b){if(d(a))return c(a,this.property.bind(this));if("string"!==typeof a)throw new TypeError;if(this.prototype.hasOwnProperty(a))throw new ReferenceError;this.prototype[a]=b};Function.prototype.method=function(b,f){if(d(b))return c(b,this.method.bind(this));if(this.prototype.hasOwnProperty(b))throw new ReferenceError;return a.decorate(this.prototype,b,f)};Function.prototype.decorate=function(b,f){if(d(b))return c(b,this.decorate.bind(this));
if("function"!==typeof this.prototype[b])throw new ReferenceError;return a.decorate(this.prototype,b,f)};return a}();(function(){Function.prototype.bind||(Function.prototype.bind=function(){var d=this,c=Array.prototype.shift.call(arguments),b=Array.prototype.slice.call(arguments,0);return function(){return d.apply(c,Array.prototype.concat.call(b,Array.prototype.slice.call(arguments,0)))}});Function.isFunction=function(d){return"function"===typeof d}})();(function(){var d={},c=this.Uint8Array||Array;String.prototype.capitalize=function(){return this.length?d[this]||(d[this]=this[0].toUpperCase()+this.slice(1)):this};String.prototype.format=function(){var b=arguments,a=b.length;if(a){var e=this,c=e.match(/{[^}]*}/g),d=c?c.length:0,h=0;if("object"===typeof b[0])for(;h<d;){var a=c[h].replace(/{/,"").replace(/}/,""),k=isNaN(parseInt(a))?"{"+a+"}":"{["+h+"]}",k=RegExp(k,"g"),e=e.replace(k,b[0][a]);h++}else{if(!c||c.length!==a)throw new RangeError("Engine.Lib.format: wrong number of arguments, "+
e);for(;h<a;)2==c[h].length?e=e.replace("{}",b[h]):(k=RegExp("{["+h+"]}","g"),e=e.replace(k,b[h])),h++}return e}return this};String.prototype.toByteArray=function(){for(var b=0,a=this.length,e=new c(a);b<a;b++)e[b]=this.charCodeAt(b)&255;return e};String.isString=function(b){return"string"===typeof b}}).call(this);(function(d,c,b,a){Object.createProto=function(a){if(1!==arguments.length)throw new RangeError;if(!a||"object"!==typeof a)throw new TypeError;if(Object.create)return Object.create(a);var b=function(){};b.prototype=a;return new b};"undefined"===typeof Object.getPrototypeOf&&(Object.getPrototypeOf="".__proto__?function(a){return a.__proto__}:function(a){return a.constructor.prototype});var e=Object.merge=function(){var a=arguments[arguments.length-1];!0===a&&(a=Infinity);var a="number"===typeof a?c.call(arguments):
0,b=d.call(arguments);if("object"!==typeof b)throw new TypeError("Object.merge: target must be an object");for(var h=arguments.length;h--;){var k=d.call(arguments);if("object"===typeof k)for(var m in k)a&&b.hasOwnProperty(m)&&"object"===typeof b[m]&&"object"===typeof k[m]&&null!==b[m]&&null!==k[m]?b[m]=e(b[m],k[m],a-1):b[m]=k[m]}return b};Object.forEach=function(a,e,c){var d=a&&"object"===typeof a&&!b(a);if(!d||!d||"function"!==typeof e)throw new TypeError;for(var m in a)e.call(c,m,a[m],a)};Object.clone=
function(a,b){if("object"!==typeof a)throw new TypeError("Object#clone: object to clone must be a object");var c="function"===typeof a.toClone?a.toClone():a.toClone;return e({},a,c,b)};Object.isArguments=function(b){return"[object Arguments]"===a.call(b)}})(Array.prototype.shift,Array.prototype.pop,Array.isArray,Object.prototype.toString);global.TypedArray=function(d){this.Int8Array=this.Int8Array||Array;this.Int16Array=this.Int16Array||Array;this.Int32Array=this.Int32Array||Array;this.Uint8Array=this.Uint8Array||Array;this.Uint16Array=this.Uint16Array||Array;this.Uint32Array=this.Uint32Array||Array;this.Float32Array=this.Float32Array||Array;this.Float64Array=this.Float64Array||Array;var c=d(2,8)-1,b=d(2,16)-1,a=d(2,32)-1,e=d(2,64)-1;return function(f,d,h){var k="u"===f[0].toLowerCase(),m=~f.toLowerCase().indexOf("float");k||(d*=2);
k=0;switch(!0){case !m&&d<=c:k=8;break;case !m&&d<=b:k=16;break;case d<=a:k=32;break;case m&&d<=e:k=64;break;default:return!1}return new (global[f.capitalize()+k+"Array"])(h)}}.call(global,Math.pow);Array.prototype.first=function(){return 0<this.length?this[0]:null};Array.prototype.last=function(){return 0<this.length?this[this.length-1]:null};Array.prototype.has=function(d){return-1!==this.indexOf(d)};Array.prototype.indexOfElems=function(d){var c=-1,b=arguments.length;a:for(;~(c=this.indexOf(d,c+1));){for(var a=1;a<b;a++)if(this[c+a]!==arguments[a])continue a;break}return c};Array.prototype.remove=function(d){for(var c=!1,b=0;-1!=(b=this.indexOf(d));)this.splice(b,1),c=!0;return c};
Array.prototype.add=function(d){return-1===this.indexOf(d)?(this.push(d),!0):!1};Array.prototype.clear=function(){for(;0<this.length;)this.pop();return this};Array.prototype.filter||(Array.prototype.filter=function(d){for(var c=[],b=0;b<this.length;b++)d(this[b])&&c.push(this[b]);return c});Array.prototype.random=function(){return this.length?this[Math.random()*this.length|0]:null};
Array.prototype.swap=function(d,c){var b=null;return d<this.length&&0<=d&&c<this.length&&0<=c?(b=this[d],this[d]=this[c],this[c]=b,!0):!1};Array.prototype.clone=function(d){d="boolean"===typeof d?d:!1;var c=this.concat();if(!d)return c;d="function"===typeof Object.clone;for(var b=0,a=c.length;b<a;b++)"object"===typeof c[b]&&(c[b]=Array.isArray(c[b])?c[b].clone():d&&Object.clone(c[b]));return c};
Array.prototype.forEach||(Array.prototype.forEach=function(d,c){if("function"!==typeof d)return this;for(var b=0;b<this.length;b++)d.call(c,this[b],b,this);return this});Array.prototype.without=function(d){if(!Array.isArray(d)||!d.length)return this.clone();d=d.slice(0);for(var c=[],b=0,a=this.length;b<a;b++){var e=this[b],f=d.indexOf(e);~f?f===d.length-1?d.pop():d[f]=d.pop():c.push(e)}return c};
Array.prototype.toObject=function(d,c){d="function"===typeof d?d:null;var b=(c="undefined"!==typeof c?Object(c):null)||{};if(!this.length)return b;for(var a=0,e=this.length;a<e;a++){var f=d?d(this[a],a,this):a;!1!==f&&(b[f]=this[a])}return b};Number.prototype.between=function(d,c){return this>=Math.min(d,c)&&this<=Math.max(d,c)};Number.prototype.sign=function(){return 0>this?-1:0<this?1:0};global.Matrix=function(){function d(c){this.m11=null!=c&&"number"==typeof c.m11?parseFloat(c.m11):this.m11;this.m12=null!=c&&"number"==typeof c.m12?parseFloat(c.m12):this.m12;this.m13=null!=c&&"number"==typeof c.m13?parseFloat(c.m13):this.m13;this.m21=null!=c&&"number"==typeof c.m21?parseFloat(c.m21):this.m21;this.m22=null!=c&&"number"==typeof c.m22?parseFloat(c.m22):this.m22;this.m23=null!=c&&"number"==typeof c.m23?parseFloat(c.m23):this.m23;this.m31=null!=c&&"number"==typeof c.m31?parseFloat(c.m31):
this.m31;this.m32=null!=c&&"number"==typeof c.m32?parseFloat(c.m32):this.m32;this.m33=null!=c&&"number"==typeof c.m33?parseFloat(c.m33):this.m33}d.prototype.m11=1;d.prototype.m12=0;d.prototype.m13=0;d.prototype.m21=0;d.prototype.m22=1;d.prototype.m23=0;d.prototype.m31=0;d.prototype.m32=0;d.prototype.m33=1;d.prototype.cos=Math.cos;d.prototype.sin=Math.sin;d.prototype.set=function(c,b,a,e,f,d,h,k,m){this.m11=parseFloat(c)||0;this.m12=parseFloat(b)||0;this.m13=parseFloat(a)||0;this.m21=parseFloat(e)||
0;this.m22=parseFloat(f)||0;this.m23=parseFloat(d)||0;this.m31=parseFloat(h)||0;this.m32=parseFloat(k)||0;this.m33=parseFloat(m)||0;return this};d.prototype.copy=function(c){return this.set(c.m11,c.m12,c.m13,c.m21,c.m22,c.m23,c.m31,c.m32,c.m33)};d.prototype.transform=function(c,b,a,e,f,d,h){h=h||this;c=parseFloat(c)||0;a=parseFloat(a)||0;f=parseFloat(f)||0;b=parseFloat(b)||0;e=parseFloat(e)||0;d=parseFloat(d)||0;var k=parseFloat(this.m31)||0,m=parseFloat(this.m32)||0,l=parseFloat(this.m33)||0;return h.set(this.m11*
c+this.m12*b+this.m13*k,this.m11*a+this.m12*e+this.m13*m,this.m11*f+this.m12*d+this.m13*l,this.m21*c+this.m22*b+this.m23*k,this.m21*a+this.m22*e+this.m23*m,this.m21*f+this.m22*d+this.m23*l,this.m31*c+this.m32*b+this.m33*k,this.m31*a+this.m32*e+this.m33*m,this.m31*f+this.m32*d+this.m33*l)};d.prototype.multiply=function(c,b){b=b||this;var a=parseFloat(c.m11)||0,e=parseFloat(c.m12)||0,f=parseFloat(c.m13)||0,d=parseFloat(c.m21)||0,h=parseFloat(c.m22)||0,k=parseFloat(c.m23)||0,m=parseFloat(c.m31)||0,l=
parseFloat(c.m32)||0,n=parseFloat(c.m33)||0;return b.set(this.m11*a+this.m12*d+this.m13*m,this.m11*e+this.m12*h+this.m13*l,this.m11*f+this.m12*k+this.m13*n,this.m21*a+this.m22*d+this.m23*m,this.m21*e+this.m22*h+this.m23*l,this.m21*f+this.m22*k+this.m23*n,this.m31*a+this.m32*d+this.m33*m,this.m31*e+this.m32*h+this.m33*l,this.m31*f+this.m32*k+this.m33*n)};d.prototype.rotate=function(c){return this.transform(this.cos(c),this.sin(c),-this.sin(c),this.cos(c),0,0)};d.prototype.translate=function(c,b){return this.transform(1,
0,0,1,parseInt(c)||0,parseInt(b)||0)};d.prototype.scale=function(c,b){return this.transform(parseFloat(c)||1,0,0,parseFloat(b)||1,0,0)};d.prototype.reset=function(){return this.set(1,0,0,0,1,0,0,0,1)};d.prototype.transpose=function(c){return(c||this).set(this.m11,this.m21,this.m31,this.m12,this.m22,this.m32,this.m13,this.m23,this.m33)};d.prototype.det=function(){return this.m11*this.m22*this.m33+this.m21*this.m32*this.m13+this.m31*this.m12*this.m23-this.m13*this.m22*this.m31-this.m23*this.m32*this.m11-
this.m33*this.m12*this.m21};d.prototype.minor=function(c,b){var a=1,e=2,f=1,d=2;1==c?(a=2,e=3):2==c&&(a=1,e=3);1==b?(f=2,d=3):2==b&&(f=1,d=3);return this["m"+a+f]*this["m"+e+d]-this["m"+a+d]*this["m"+e+f]};d.prototype.inverse=function(c){c=c||this;var b=this.det();this.transpose(c);var a=c.minor(1,1)/b,e=-c.minor(1,2)/b,f=c.minor(1,3)/b,d=-c.minor(2,1)/b,h=c.minor(2,2)/b,k=-c.minor(2,3)/b,m=c.minor(3,1)/b,l=-c.minor(3,2)/b,b=c.minor(3,3)/b;return c.set(a,e,f,d,h,k,m,l,b)};d.prototype.byVector=function(c,
b,a){a=a||Array(2);a[0]=this.m11*c+this.m12*b+this.m13;a[1]=this.m21*c+this.m22*b+this.m23;return a};return d}();global.Namespace=function(){function d(a){if(a)for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])}var c=String.prototype.split,b=Array.prototype.indexOf,a=["function","object"];d.prototype.get=function(a){return d.get(this,a)};d.prototype.set=function(a,b){return d.set(this,a,b)};d.prototype.unset=function(a){return d.unset(this,a)};d.get=function(a,d){var g=a,h=c.call(String(d),".");if(-1!==b.call(h,""))throw'Namespace.get: Empty key passed - "'+d+'"';for(var k=0,m=h.length;k<m;k++){var l=h[k];if(g&&
g.hasOwnProperty(l))g=g[l];else return}return g};d.set=function(e,d,g){var h=c.call(String(d),".");if(-1!==b.call(h,""))throw'Namespace.set: Empty key passed - "'+d+'"';d=0;for(var k=h.length-1;d<k;d++){var m=h[d];e=e&&e.hasOwnProperty(m)&&e[m]&&-1!==b.call(a,typeof e[m])?e[m]:e[m]={}}return e[h[d]]=g};d.unset=function(e,d){var g=e,h=c.call(String(d),".");if(-1!==b.call(h,""))throw'Namespace.unset: Empty key passed - "'+d+'"';for(var k=0,m=h.length-1;k<m;k++){var l=h[k];if(g&&g.hasOwnProperty(l)&&
g[l]&&-1!==b.call(a,typeof g[l]))g=g[l];else return null}delete g[h[m]];return g};d.Chain=function(a,b){var c=d.prototype;d.prototype=b;var h=new d(a);d.prototype=c;return h};return d}();global.Model=function(d,c,b,a,e){function f(b){this._subscriptions={};this._events={};this._queue=[];this._triggered=[];if(b&&b.on){var e=b.on,c;for(c in e)this.on(c,e[c])}if(b&&b.subscribers)for(c in e=b.subscribers,e){var d=e[c];if(a(d)){if(d[0]instanceof f){var g=d[0];d.unshift(this);d[1]=c;g.subscribe.apply(g,d);d.shift();d[0]=g}}else d instanceof f&&d.subscribe(this,c)}c=this.constructor.prototype;for(var p in c)this.hasOwnProperty(p)||"function"===typeof c[p]||(this[p]=b&&p in b&&typeof b[p]===
typeof c[p]?b[p]:c[p]);this.initialize(b);this.trigger(f.INITIALIZE)}function g(a,e,d){a._triggered.push(d);var l=a._events,n=a["on"+e];if("function"!==typeof n||!1!==n.apply(a,d)){var p=l[e];if(p&&p.length)for(l=0,n=p.length;l<n;l++){var q=p[l];"function"===typeof q?q.apply(a,d):(p.splice(l--,1),n--)}if(e=a._subscriptions[e])for(l=0,n=e.length;l<n;l+=3)e[l]instanceof f?((p=e[l+2])&&b.apply(p,d),g(e[l],e[l+1],p||d),p&&c.call(p,-d.length,d.length)):(e.splice(l,3),l-=3,n-=3)}d=a._triggered.pop();e=
a._queue;l=0;for(n=e.length;l<n;l+=2)e[l]===d&&(p=e[l+1],e.splice(l,2),l-=2,n-=2,a.trigger.apply(a,p));return a}f.INITIALIZE="initialize";f.prototype={constructor:f,initialize:function(a){},get:function(a){a+="";var b=this["get"+a.capitalize()];return"function"===typeof b?(arguments[0]=this,e.apply(b,arguments)):this[a]},set:function(a){a+="";var b=this["set"+a.capitalize()];if("function"===typeof b)arguments[0]=this,e.apply(b,arguments);else{if(!this.hasOwnProperty(a))throw new ReferenceError("Model::set: passed key doesn't exist in model");
this[a]=arguments[1]}return this},on:function(a,b){if(!a)throw new TypeError("Model::on: event name is not defined");if("function"!==typeof b)throw new TypeError("Model::on: handler is not a function");a+="";var e=this._events;(e[a]||(e[a]=[])).add(b);return this},off:function(a,b){a&&(a+="");"function"!==typeof b&&(b=null);var e=this._events,c=e[a];if(arguments.length&&!a)throw new TypeError("Model::off: event name is empty");switch(arguments.length){case 0:for(a in e)e[a]=null;break;case 1:if(!c||
!c.length)break;for(var e=0,d=c.length;e<d;e++)c[e]=null;break;default:if(!b)throw new TypeError("Model::off: "+typeof b+" handler is not callable");e=c.indexOf(b);if(!~e)break;c[e]=null}return this},trigger:function(a){if(!a)throw new TypeError("Model::trigger: event is not defined");a+="";d.call(arguments);g(this,a,arguments);return this},queue:function(a){if(!a)throw new TypeError("Model::queue: event is not defined");arguments[0]=a+="";if(!this._triggered.length)return this.trigger.apply(this,
arguments);this._queue.push(this._triggered.last(),arguments);return this},subscribe:function(a,b,e){if(!b)throw new TypeError("Model::subscribe: event name is not defined");if(!(a instanceof f))throw new TypeError("Model::subscribe: model is not a Model instance");if(a===this)throw new ReferenceError("Model::subscribe: model can't subscribe itself");e=e||b;b+="";e+="";var d=a._subscriptions,d=d[b]||(d[b]=[]),g=d.indexOfElems(this,e);~g||(g=d.length);d[g]=this;d[g+1]=e;c.call(arguments,0,3);d[g+2]=
arguments.length?arguments:null;return this},unsubscribe:function(a,b,e){if(!b)throw new TypeError("Model::unsubscribe: event name is not defined");if(!(a instanceof f))throw new TypeError("Model::unsubscribe: model is not a Model");if(a===this)throw new ReferenceError("Model::unsubscribe: model can't unsubscribe itself");e=e||b;a=a._subscriptions[b+""];if(!a)return this;e=a.indexOfElems(this,e+"");if(!~e)return this;a[e]=a[++e]=a[++e]=null;return this}};return f}(Array.prototype.shift,Array.prototype.splice,
Array.prototype.push,Array.isArray,Function.prototype.call);global.Engine=function(d,c,b,a,e){var f=new Model;f.config={DEBUG:!0};f.loaded=!1;f.ready=function(a){"function"===typeof a&&(f.loaded?a.call(f):f.on("ready",a))};f.start=function(){f.loaded||(f.loaded=!0,f.trigger("ready"))};f.NOP=function(){};f.ERROR="error";f.WARN="warn";f.log=function(e,h){if(f.config.DEBUG&&arguments.length){var k=arguments;h=arguments[arguments.length-1];h!==f.ERROR&&h!==f.WARN||d.call(k);switch(h){case f.ERROR:var m=a.error;break;case f.WARN:m=a.warn;break;default:m=a.log}m||
(m=a.log,c.call(k,h.capitalize()+":"));b.call(m,a,k)}};f.now=e.now||function(){return(new e).valueOf()};return f}(Array.prototype.pop,Array.prototype.unshift,Function.prototype.apply,console,Date);Engine.Loop=function(){function d(){b=0;c.frame()}var c=new Model,b=0;c.VSYNC="vsync";c.REFLOW="reflow";c.frame=function(){c.trigger(c.VSYNC);c.trigger(c.REFLOW);return this};c.request=function(){if(b)return!1;b=setTimeout(d,17);return!0};return c}();Engine.Device=function(){var d=new Model;d.platform={type:"desktop",name:""};d.navigator={browser:{name:"",version:0},language:""};d.keyboard=!1;d.online=!0;d.pageVisible=!0;d.screen={width:0,height:0,innerWidth:0,innerHeight:0,pixelDepth:24,pixelRatio:1,orientation:0};d.features={canvas:!1,svg:!1,audio:!1,video:!1,compass:!1,fullscreen:!1,userMedia:!1,gamepad:!1,cache:{scripts:!1,files:!1,data:!1},geolocation:!1,notifications:!1,pageVisibility:!1,vibration:!1,telephony:!1,pointerLock:!1};return d}();Engine.Device.Fullscreen=function(){var d=new Model;d.viewport=null;d.STATUS_CHANGED="statuschanged";var c=d.request=function(a,b,c){if(d.viewport!==a)return c(Error("Feature not implemented"));d.trigger(d.STATUS_CHANGED,a);b()},b=d.exit=function(a,b){if(d.viewport)return b();d.trigger(d.STATUS_CHANGED);a()};d.toggle=function(a,e,f){return d.status?b(e,f):c(a,e,f)};return d}();Engine.Device.Geolocation=function(){var d=new Model;d.position=null;d.watching=!1;d.getPosition=function(c,b,a){c=d.position;null===c?b():a(c)};d.setPosition=function(c){d.position!==c&&(d.position=c,d.trigger("positionchanged"))};d.clearWatch=function(c,b){!1===d.watching?b():c()};return d}();Engine.Device.Notification=function(d,c){function b(a,b){b=b||!1;this.body="string"===typeof a?a:this.body;this.title=b&&"string"===typeof b.title?b.title:this.title;this.tag=b&&"string"===typeof b.tag?b.tag:this.tag;this.expireTime=b&&"number"===typeof b.expireTime&&0<=b.expireTime?b.expireTime:this.expireTime;this.iconURL=b&&"string"===typeof b.iconURL?b.iconURL:this.iconURL;this.autoshow=b&&"boolean"===typeof b.autoshow?b.autoshow:this.autoshow;this.onshow=b&&"function"===typeof b.onshow?b.onshow:
this.onshow;this.onerror=b&&"function"===typeof b.onerror?b.onerror:this.onerror;this.onclick=b&&"function"===typeof b.onclick?b.onclick:this.onclick;this.onclose=b&&"function"===typeof b.onclose?b.onclose:this.onclose;if(!c.features.notifications)return this.onerror&&this.onerror();if(null===this.title||"undefined"===typeof this.title)this.title=String(this.body),this.body=null;this.autoshow&&this.show()}b.property({title:void 0,body:void 0,tag:void 0,expireTime:0,iconURL:void 0,autoshow:!0,onshow:null,
onerror:null,onclick:null,onclose:null});b.method({show:function(){if("function"===typeof this.onshow)return this.onshow()},close:function(){if("function"===typeof this.onclose)return this.onclose()}});return b}(Engine,Engine.Device);Engine.Fill=function(d,c){function b(a){return String(a).toLowerCase().trim().replace(/\s*,\s*/g,",").replace(/\s*\(\s*/g,"(").replace(/\s+\)/g,")").replace(/\s\s+/g," ")}function a(a,b,e,f){this.r=c(0,d(parseInt(a)||0,255));this.g=c(0,d(parseInt(b)||0,255));this.b=c(0,d(parseInt(e)||0,255));this.a=c(0,d(parseInt(f)||0,255))}function e(a){this.src=String(a)}function f(a,b,e,c){this.type=String(a);this.from=b;this.to=e;this.steps=this.steps||[]}function g(a){return"stop("+a.stop+","+a.color+")"}function h(a,
b){return a.stop-b.stop}function k(a,b,e){this.x=parseInt(a)||0;this.y=parseInt(b)||0;this.r=c(0,parseInt(e)||0)}function m(a,b){this.stop=c(0,d(parseFloat(a)||0,1));this.color=b}function l(a){return a}var n={},p={},q={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",
chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",
dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",
lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",
mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",
royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",transparent:"rgba(0,0,0,0)",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},r;for(r in q)a[r.toUpperCase()]=
q[r];var u=Object.keys(q);r=u.join("|");u="("+u.join("|")+")";r=[r,"#(?:[0-9a-fA-F]{3}|[0-9a-fA-F]{6})|rgb\\(\\d+,\\d+,\\d+\\)|rgba\\(\\d+,\\d+,\\d+,[0-9\\.]+\\)|hsl\\(\\d+(?:deg)?,\\d+%?,\\d+%?\\)"].join("|");var u=[u,"(#)(?:([0-9a-fA-F])([0-9a-fA-F])([0-9a-fA-F])|([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2}))|(rgb)\\((\\d+),(\\d+),(\\d+)\\)|(rgba)\\((\\d+),(\\d+),(\\d+),([0-9\\.]+)\\)|(hsl)\\((\\d+)(?:deg)?,(\\d+)%?,(\\d+)%?\\)"].join("|"),G=RegExp("^(?:"+u+")$","i"),y=/^(?:image\(([^\)]*)\))$/i,
v=/(linear|radial)/i,A=/(-?\d+)\s(-?\d+)(?:\s(-?\d+))?/i,B="from\\(("+r+")\\)",w=RegExp(B,"i"),t="to\\(("+r+")\\)",x=RegExp(t,"i"),z="stop\\(([0-9\\.]+),("+r+")\\)",s=RegExp(z,"i"),u=["linear|radial|-?\\d+\\s-?\\d+(?:\\s-?\\d+)?","from\\((?:"+r+")\\)","to\\((?:"+r+")\\)","stop\\([0-9\\.]+,(?:"+r+")\\)"].join("|"),D=["(linear|radial)|(-?\\d+)\\s(-?\\d+)(?:\\s(-?\\d+))?",B,t,z].join("|"),B="gradient\\((?:"+u+")(?:,(?:"+u+"))*\\)",C=RegExp("^(?:"+("gradient\\(((?:"+u+")(?:,(?:"+u+"))*)\\)")+")$","i"),
E=["repeat","repeat-x","repeat-y","no-repeat"],u=E.join("|"),t="("+E.join("|")+")",O=RegExp("^(?:"+t+")$","i");r=[r,B,"image\\([^\\)]*\\)",u].join("|");var M=RegExp("^("+r+")(?:\\s("+r+"))?(?:\\s("+r+"))?(?:\\s("+r+"))?(?:\\s("+r+"))?(?:\\s("+r+"))?(?:\\s("+r+"))?(?:\\s("+r+"))?(?:\\s("+r+"))?(?:\\s("+r+"))?(?:\\s("+r+"))?(?:\\s("+r+"))?(?:\\s("+r+"))?$","i");n.REPEAT="repeat";n.COLOR="color";n.IMAGE="image";n.parse=function(c,d){d=d||{};c=b(c);var h=M.exec(c);if(!h)return null;h.shift();h.remove(void 0);
d[n.IMAGE]=null;d[n.COLOR]=a.parse("transparent");d[n.REPEAT]=E.first();for(var g=0,k=h.length;g<k;g++){var m=h[g];switch(!1){case !(c=f.parse(m)):case !(c=e.parse(m)):d[n.IMAGE]=c;break;case !(c=a.parse(m)):d[n.COLOR]=c;break;case !(c=l.parse(m)):d[n.REPEAT]=c}}return d};n.Color=a;a.prototype={toString:function(){return"rgba({},{},{},{})".format(this.r,this.g,this.b,this.a/255)}};a.parse=function(e,c){e=b(e);var d=G.exec(e);if(!d)return null;c=c||p[e]||(p[e]=new a(0,0,0,0));for(var f=0,h=0,g=d.length;f<
g;f++)void 0!==d[f]&&(d[h++]=d[f]);d.length=h;d.shift();f=d.shift();return(h=H.hasOwnProperty(f)?H[f]:null)?h.apply(c,d):f in q?a.parse(q[f],c):null};var H={hsl:function(){function b(a,e,c){0>c&&(c+=1);1<c&&(c-=1);return c<1/6?a+6*(e-a)*c:0.5>c?e:c<2/3?a+6*(e-a)*(2/3-c):a}return function(e,c,d){e=(parseFloat(e)||0)%360/360;c=(parseFloat(c)||0)/100;d=(parseFloat(d)||0)/100;if(0===c){e=c=d*=255;var f=255}else{var f=0.5>d?d*(1+c):d+c-d*c,h=2*d-f;d=255*b(h,f,e+1/3);c=255*b(h,f,e);e=255*b(h,f,e-1/3);f=
255}return this instanceof a?(a.call(this,d,c,e,f),this):new a(d,c,e,f)}}(),"#":function(b,e,c){b=1===b.length?b+b:b;e=1===e.length?e+e:e;c=1===c.length?c+c:c;b=parseInt(b,16)||0;e=parseInt(e,16)||0;c=parseInt(c,16)||0;return this instanceof a?(a.call(this,b,e,c,255),this):new a(b,e,c,255)},rgb:function(b,e,c){return this instanceof a?(a.call(this,b,e,c,255),this):new a(b,e,c,255)},rgba:function(b,e,c,d){return this instanceof a?(a.call(this,b,e,c,255*d),this):new a(b,e,c,255*d)},transparent:function(){return this instanceof
a?(a.call(this,0,0,0,0),this):new a(0,0,0,0)}};n.Image=e;e.prototype.toString=function(){return"image("+this.src+")"};e.parse=function(a,c){a=b(a);var d=y.exec(a);if(!d)return null;c=c||p[a]||(p[a]=new e);c.src=String(d[1]);return c};n.Gradient=f;f.prototype={add:function(a,b){this.steps.push(new m(a,b));this.steps.sort(h)},toString:function(){var a;a="gradient("+this.type;a=a+","+[this.from.x,this.from.y,this.from.r].join(" ");a+=",";a+=[this.to.x,this.to.y,this.to.r].join(" ");a+=",";a+=this.steps.map(g).join(",");
return a+=")"}};f.parse=function(e,c){e=b(e);var d=C.exec(e);if(!d)return null;d=d.last().match(RegExp(D,"gi"));if(!d)return null;for(var h=c?(f.call(c),c):p[e]||(p[e]=new f),g=0,l=d.length,n=null;g<l;g++){var n=d[g],m=null;switch(!1){case !(m=v.exec(n)):h.type=m.last();break;case !(m=A.exec(n)):m.shift();m=new k(m[0],m[1],m[2]);h.from?h.to=m:h.from=m;break;case !(m=w.exec(n)):n=0;m=a.parse(m.last());h.add(n,m);break;case !(m=x.exec(n)):n=1;m=a.parse(m.last());h.add(n,m);break;case !(m=s.exec(n)):n=
m[1],m=a.parse(m.last()),h.add(n,m)}}return h};f.Position=k;f.Stop=m;n.Repetition=l;l.parse=function(a){a=b(a);return(a=O.exec(a))?a[1]:null};return n}(Math.min,Math.max);(function(d,c){var b=d.requestAnimationFrame||d.webkitRequestAnimationFrame||d.mozRequestAnimationFrame||d.oRequestAnimationFrame||d.msRequestAnimationFrame||null;if(!b)return!1;var a=!1,e=function(){a=!1;c.frame()};c.request=function(){if(a)return!1;a=!0;b(e);return!0}})(this,Engine.Loop);(function(d,c){function b(b,c){if(b&&c){var d=document.createElement("meta");d.setAttribute("name",b);d.setAttribute("content",c);document.head.insertBefore(d,a);return d}}var a=document.head.children[1];b("viewport","width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no");b("HandheldFriendly","true");b("MobileOptimized",480);/iPod|iPad|iPhone/.test(navigator.userAgent)&&(b("apple-mobile-web-app-capable","yes"),b("apple-mobile-web-app-status-bar-style","black-translucent"))})(Engine,
Engine.Device);(function(d){d.userAgents={platform:{"windows nt 6.2":"Windows 8","windows nt 6.1":"Windows 7","windows nt 6.0":"Windows Vista","windows nt 5.2":"Windows 2003","windows nt 5.1":"Windows XP","windows nt 5.0":"Windows 2000","windows nt 4.0":"Windows NT","winnt4.0":"Windows NT","winnt 4.0":"Windows NT",winnt:"Windows NT","windows 98":"Windows 98",win98:"Windows 98","windows 95":"Windows 95",win95:"Windows 95",windows:"Unknown Windows OS","os x":"Mac OS X","intel mac":"Intel Mac","ppc mac":"PowerPC Mac",
powerpc:"PowerPC",ppc:"PowerPC",cygwin:"Cygwin",linux:"Linux",debian:"Debian",openvms:"OpenVMS",sunos:"Sun Solaris",amiga:"Amiga",beos:"BeOS",apachebench:"ApacheBench",freebsd:"FreeBSD",netbsd:"NetBSD",bsdi:"BSDi",openbsd:"OpenBSD","os/2":"OS/2",warp:"OS/2",aix:"AIX",irix:"Irix",osf:"DEC OSF","hp-ux":"HP-UX",hurd:"GNU/Hurd",unix:"Unknown Unix OS"},browser:{opera:"Opera",msie:"Internet Explorer","internet explorer":"Internet Explorer",iemobile:"Internet Explorer",shiira:"Shiira",firefox:"Firefox",
chimera:"Chimera",phoenix:"Phoenix",firebird:"Firebird",camino:"Camino",navigator:"Netscape",netscape:"Netscape",omniweb:"OmniWeb",chrome:"Chrome",safari:"Safari",cfnetwork:"Safari",konqueror:"Konqueror",epiphany:"Epiphany",galeon:"Galeon",mozilla:"Mozilla",icab:"iCab",lynx:"Lynx",links:"Links",hotjava:"HotJava",amaya:"Amaya",ibrowse:"IBrowse"},mobile:{iemobile:"Windows Phone OS","windows phone os":"Windows Phone OS",mobileexplorer:"Mobile Explorer",openwave:"Open Wave","opera mini":"Opera Mini",
operamini:"Opera Mini",elaine:"Palm",palmsource:"Palm","digital paths":"Palm",avantgo:"Avantgo",xiino:"Xiino",palmscape:"Palmscape",nokia:"Nokia",ericsson:"Ericsson",blackberry:"BlackBerry",motorola:"Motorola",iphone:"iPhone",ipad:"iPad",ipod:"iPod",android:"Android"}}})(Engine.Device);(function(d){var c,b=function(a,b,c){c[b]=a.toLowerCase()},a=function(a,b){var c=function(a,c){return b.indexOf(a)-b.indexOf(c)};1<a.length&&a.sort(c);return a};c=function(){var a=document.documentElement;return d.features=Object.merge(d.features,{canvas:!!window.CanvasRenderingContext2D,svg:!!window.SVGElement,audio:!!window.Audio,video:!!window.HTMLVideoElement,compass:"object"===typeof window.ondeviceorientation&&"object"===typeof window.ondevicemotion,fullscreen:!!(a.requestFullscreen||a.requestFullScreen||
a.mozRequestFullscreen||a.mozRequestFullScreen||a.webkitRequestFullscreen||a.webkitRequestFullScreen),userMedia:!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia),gamepad:!!(navigator.gamepads||navigator.webkitGamepads||navigator.mozGamepads),cache:{scripts:!!window.applicationCache,files:!!(window.requestFileSystem||window.webkitRequestFileSystem||window.mozRequestFileSystem),data:!!(window.localStorage||window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||
window.openDatabase)},geolocation:!!navigator.geolocation,notifications:!!window.Notification,pageVisibility:!!(document.visibilityState||document.mozVisibilityState||document.webkitVisibilityState),vibration:!!navigator.vibrate,telephony:!(!navigator.telephony&&!navigator.mozTelephony),pointerLock:!!(a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock)})}();(function(){var c,f,g,h,k=navigator.userAgent;g=d.userAgents.mobile;h=Object.keys(g);c=k.match(RegExp(h.join("|"),"ig"));
null!==c?f="mobile":(g=d.userAgents.platform,h=Object.keys(g),c=k.match(RegExp(h.join("|"),"ig")),null!==c&&(f="desktop"));null!==c&&(c.forEach(b),a(c,h),c=g[c.first()],null!==c.match(/iPod|iPad|iPhone/)&&(c="iOS"),d.platform=Object.merge(d.platform,{type:f,name:c}))})();(function(){(function(){var c,f,g=Object.keys(d.userAgents.browser);f=navigator.userAgent;c=f.match(RegExp(g.join("|"),"ig"));null!==c&&(c.forEach(b),a(c,g),c=c.first(),g=RegExp(c,"i").exec(f).index,f=f.substring(g+c.length+1),0<
f.length?(0<f.indexOf(" ")&&(f=f.substring(0,f.indexOf(" "))),f=parseFloat(f)):f=void 0,d.navigator.browser=Object.merge(d.navigator.browser,{name:d.userAgents.browser[c],version:f}))})();(function(){var a=navigator.userLanguage||navigator.systemLanguage||navigator.language;"undefined"!==typeof a&&(a=a.split("-"),"undefined"===typeof a[1]&&(a[1]=a[0]),a=a[0]+"_"+a[1].toUpperCase(),d.navigator.language=a)})()})();(function(){if("mobile"===d.platform.type){var a=function(a){d.keyboard!==a&&(d.keyboard=
a,d.trigger("keyboardstatuschanged"))};window.addEventListener("DOMContentLoaded",function(){document.body.addEventListener("touchstart",function(){a(!1)});document.body.addEventListener("keydown",function(){a(!0)})})}d.keyboard="mobile"!==d.platform.type})();"boolean"===typeof navigator.onLine&&function(){window.addEventListener("online",function(){d.online=navigator.onLine;d.trigger("online")});window.addEventListener("offline",function(){d.online=navigator.onLine;d.trigger("offline")});d.online=
navigator.onLine}();(function(){var a,b,c=screen.mozOrientation||screen.webkitOrientation||screen.orientation;"string"===typeof c?(a=function(){d.screen.orientation=function(){switch(c){case "portrait-primary":return 0;case "portrait-secondary":return 180;case "landscape-primary":return-90;case "landscape-secondary":return 90}}()},screen.addEventListener("orientationchanged",function(){a();d.trigger("screenorientationchanged",d.screen.orientation)}),a()):"undefined"!==typeof window.orientation?(a=
function(){d.screen.orientation=window.orientation},window.addEventListener("DOMContentLoaded",function(){document.body.addEventListener("orientationchange",function(){a();d.trigger("screenorientationchanged",window.orientation)});a()})):(a=function(){d.screen.orientation=b.clientWidth>b.clientHeight?90:0},window.addEventListener("DOMContentLoaded",function(){b=document.body;window.addEventListener("resize",function(){var b=d.screen.orientation;a();b!==d.screen.orientation&&d.trigger("screenorientationchanged",
b)});a()}));window.addEventListener("resize",function(){d.screen.innerWidth=window.innerWidth;d.screen.innerHeight=window.innerHeight;d.trigger("resize")});d.screen=Object.merge(d.screen,{width:screen.width,height:screen.height,innerWidth:window.innerWidth,innerHeight:window.innerHeight,pixelDepth:screen.pixelDepth||screen.colorDepth,pixelRatio:window.devicePixelRatio||1})})();c.pageVisibility&&function(){var a="visibilityState",b="visibilitychange";(function(){var c=document.webkitVisibilityState&&
"webkit"||document.mozVisibilityState&&"moz"||document.msVisibilityState&&"ms"||null;null!==c&&(a=c+a.capitalize(),b=c+b)})();document.addEventListener(b,function(b){b="visible"===document[a];d.pageVisible=b;d.trigger(b?"pagevisible":"pagehidden")})}();delete d.userAgents})(Engine.Device);(function(d,c){function b(){n={};for(var a=l.length;a--;)l.pop()()}var a=window.document,e=a.documentElement,f=null,g=null,h=null,k=null,m=null;(function(){function b(c,d){""!==v&&(c=c.capitalize());d=d||"";for(var f=0;f<l;f++)var h=v+c+n[f]+d;return h in a||h in e?h:null}for(var c=["moz","webkit"],d=c.length,n=["Fullscreen","FullScreen"],l=n.length,y=-1;y<d;y++){var v=c[y]||"";b("request")&&(f=b("request"),g=b("exit")||b("cancel"),h=b("","Element")||b("current","Element"),k=v+"fullscreenchange",
m=v+"fullscreenerror")}})();if(f&&g&&h&&k&&m){var l=[],n={};a[h]&&(c.viewport=!0,c.exit());e.addEventListener(k,function(){var e=a[h];c.viewport=e&&n[e];b()});e.addEventListener(m,function(){b()});Class.decorate(c,"request",function(a,b,c){b=this._super.bind(this,a,b,c);l.push(b);b=a.div;n[b]=a;b[f]()});Class.decorate(c,"exit",function(b,c){var e=this._super.bind(this,b,c);l.push(e);a[g]()})}})(Engine.Device,Engine.Device.Fullscreen);(function(d,c){if(d.features.geolocation){var b=null;Class.decorate(c,"getPosition",function(a,e,d){var g=this._super,h;h=navigator.geolocation[a?"watchPosition":"getCurrentPosition"](function(b){c.setPosition([b.coords.latitude,b.coords.longitude]);g(a,e,d)},function(){g(a,e,d)});a&&(b=h)});Class.decorate(c,"clearWatch",function(a){var e=this._super;null!==b&&!0===c.watching&&(c.watching=!1,navigator.geolocation.clearWatch(b));e(onerror,a)})}})(Engine.Device,Engine.Device.Geolocation);(function(d,c){d.features.notifications&&(c.decorate("show",function(){function b(){return d.onerror&&d.onerror()}function a(){var a=d.notification=new window.Notification(d.title,{body:d.body,tag:d.tag||"",iconUrl:d.iconURL});a.addEventListener("show",function(){return c.call(d)});a.addEventListener("error",b);a.addEventListener("click",function(){d.onclick&&d.onclick();return d.close()});d.expireTime&&a.addEventListener("show",function(){d.timeout=window.setTimeout(function(){return d.close()},
d.expireTime)});a.show()}var c=this._super,d=this,g=window.Notification.permission||window.Notification.permissionLevel&&window.Notification.permissionLevel();"granted"===g||"undefined"===typeof g?a():window.Notification.requestPermission(function(c){return"granted"===c?a():b()})}),c.decorate("close",function(){if(!this.notification)return this._super();var b=this._super,a=this,c=this.notification,d=c.timeout;c.addEventListener("close",function(){return b.call(a)});d&&window.clearTimeout(d);c.close();
return delete this.notification}))})(Engine.Device,Engine.Device.Notification);(function(d,c){Class.decorate(d,"request",function(b,a,e){b=b instanceof Engine.Viewport?b:null;a="function"===typeof a?a:c;e="function"===typeof e?e:c;if(!b)throw new TypeError("No viewport passed");if(d.viewport===b)return a();if(d.viewport)return b=this._super.bind(this,b,a,e),d.exit(b,e);this._super(b,a,e)});Class.decorate(d,"exit",function(b,a){b="function"===typeof b?b:c;a="function"===typeof a?a:c;if(!d.viewport)return b();this._super(b,a)})})(Engine.Device.Fullscreen,Engine.NOP);Engine.Error=function(d,c,b){function a(c,f){f||(f=c,c="");this.type=String(c||this.type);this.name=a.NAME.format(this.type.capitalize());this.message=String(arguments.length?f:this.message);b.DEBUG&&Engine.log(this+"",Engine.ERROR);this.model instanceof d&&this.model.trigger(this.name.toLowerCase(),this)}a.NAME="Engine{0}Error";a.property({type:"",model:null,message:"",toString:function(){return this.name+(this.message&&": "+this.message)}});return a}(Model,Error,Engine.config);Engine.Error.Reference=function(d){function c(){d.apply(this,arguments)}Class.extend(c,d);c.property("type","reference");return c}(Engine.Error);Engine.Error.Syntax=function(d){function c(){d.apply(this,arguments)}Class.extend(c,d);c.property("type","syntax");return c}(Engine.Error);Engine.Error.Range=function(d){function c(){d.apply(this,arguments)}Class.extend(c,d);c.property("type","range");return c}(Engine.Error);Engine.Error.Type=function(d){function c(){d.apply(this,arguments)}Class.extend(c,d);c.property("type","type");return c}(Engine.Error);Engine.Error.NotImplemented=function(d){function c(){d.apply(this,arguments)}Class.extend(c,d);c.property("type","notImplemented");return c}(Engine.Error);Engine.Timer=function(d,c,b,a,e){function f(a){this.duration=a&&"duration"in a?c(1,parseFloat(a.duration)||0):c(1,parseFloat(this.duration)||0);this.delay=a&&"delay"in a?c(1,parseInt(a.delay)||0):c(1,parseInt(this.delay)||0);this.autoplay=a&&"autoplay"in a?Boolean(a.autoplay):this.autoplay;this.type=a&&"type"in a?String(a.type):String(this.type);this.loop=a&&"loop"in a?Boolean(a.loop):Boolean(this.loop);this.iterations=a&&"iterations"in a?c(0,b(parseFloat(a.iterations))||0):c(0,b(parseFloat(this.iterations))||
0);this.playing=!1;this.count=this.stepprogress=this.progress=0;Model.call(this,a);this.autoplay&&this.play()}var g=f.STANDARD="standard",h=f.LOOP="loop",k=f.STEP="step",m=f.STOP="stop",l=f.PLAY="play",n=f.PAUSE="pause",p=f.START="timerstart",q=f.STOP="timerstop",r={};Class.extend(f,Model);f.property({type:g,duration:1E3,loop:!1,iterations:Infinity,delay:1,autoplay:!1});f.method({reset:function(){this.count=this.stepprogress=this.progress=0},play:function(){if(!this.playing){var a=r.hasOwnProperty(this.type)?
r[this.type]:r[this.type]=[];a.add(this);1===a.length&&f.start(this.type);this.playing=!0;this.trigger(l);return!0}return!1},pause:function(){if(this.playing){var b=r.hasOwnProperty(this.type)?r[this.type]:r[this.type]=[],c=a.call(b,this);~c&&(b[c]=null);this.playing=!1;this.queue(n);return!0}return!1},stop:function(){if(this.playing){var b=r.hasOwnProperty(this.type)?r[this.type]:r[this.type]=[],c=a.call(b,this);~c&&(b[c]=null);this.playing=!1;this.stepprogress=this.progress=0;this.queue(m);return!0}return!1}});
f.evaluate=function(a,b){var c=r.hasOwnProperty(a)?r[a]:null;if(!c||!c.length)return!1;for(var f=c.length;0<f--;){var g=c[f];if(g){var n=g.progress+=b;g.stepprogress+=b;g.stepprogress>=g.delay&&(g.progress=d(g.progress,g.duration),g.trigger(k),g.stepprogress%=g.delay);n>=g.duration&&(g.loop?(g.trigger(h),g.count++,g.progress=n%g.duration,g.count>=g.iterations&&g.stop()):g.stop())}else e.call(c,f,1)}return!!c.length};f.start=function(a){Engine.trigger(p,a)};f.stop=function(a){Engine.trigger(q,a)};
return f}(Math.min,Math.max,Math.floor,Array.prototype.indexOf,Array.prototype.splice);(function(d,c,b){function a(){var a=b()-g;g+=a;c.evaluate(f,a)||c.stop(c.STANDARD)}var e=0,f=c.STANDARD,g=0;d.on(c.START,function(c){if(c!==f)return!1;e||(g=b(),e=setInterval(a,17));return!0}).on(c.STOP,function(a){if(a!==f)return!1;clearInterval(e);e=0;return!0})})(Engine,Engine.Timer,Engine.now);(function(d,c,b,a){function e(){var d=a()-g;g+=d;b.evaluate(f,d)?c.request():b.stop(b.VSYNC)}var f=b.VSYNC="vsync",g=null;d.on(b.START,function(b){if(b!==f)return!1;c.on(c.VSYNC,e);if(c.request()||null===g)g=a();return!0}).on(b.STOP,function(a){if(a!==f)return!1;c.off(c.VSYNC,e);g=null;return!0})})(Engine,Engine.Loop,Engine.Timer,Engine.now);Engine.Timer.Animation=function(d,c,b,a){function e(a){var b=this.frames=!a||"object"!==typeof a.frames&&"function"!==typeof a.frames?this.frames:a.frames;c(b)&&(this.frames=f(b));this.easing=a&&"function"===typeof a.easing?a.easing:this.easing;this.frameEasing=a&&"function"===typeof a.frameEasing?a.frameEasing:this.frameEasing;d.call(this,a);this.frameDuration=(this.frameDuration=parseFloat(a&&"frameDuration"in a?a.frameDuration:this.frames&&"object"===typeof this.frames?this.duration/Object.keys(this.frames).length:
this.frameDuration))||this.duration}function f(a){var b=a.length;return a.toObject(function(a,c){return parseFloat((c/b).toFixed(2))})}Class.extend(e,d);var g=e.EASING={linear:function(a,b){return a},nothing:function(a,b){return 0},easeIn:function(a,c){return b(a/c,3)*c},easeOut:function(a,c){return(1-b(1-a/c,3))*c}};e.property({type:d.VSYNC,frames:null,easing:g.linear,frameEasing:null,frameprogress:0,frameDuration:0});e.method({onstep:function(){var b=this.frameEasing||this.easing;switch(typeof this.frames){case "function":var c=
this.easing.call(null,this.progress,this.duration),d=a(c/this.frameDuration),e=c-d*this.frameDuration;c===this.frameDuration&&(d--,e=this.progress);this.frameprogress=e;this.frames(d,this.frameEasing?b(e,this.frameDuration):e);break;case "object":c=this.progress/this.duration;for(e in this.frames){e=parseFloat(e);if(e>c)break;d=e}e===d&&(e=1);this.frameDuration=(e-d)*this.duration;this.frameprogress=(c-d)*this.duration;b=b(this.frameprogress,this.frameDuration);this.frames[d].call(this,b)}this._super()}});
return e}(Engine.Timer,Array.isArray,Math.pow,Math.floor);Engine.Timer.Animation.Property=function(d,c){function b(a,b,f,g,h){var k=a;k.constructor!==Object&&(k={model:a,property:b,from:f,to:g,duration:h});this.model=k&&k.model&&k.model instanceof Model?k.model:this.model;if(!(this.model instanceof Model))throw new c.Type("Engine.Timer.Animation.Property: model is not specified");this.property=String(k&&k.property?k.property:this.property);if(!this.property.length)throw new c.Type("Engine.Timer.Animation.Property: property to animate is not specified");
if(!(this.property in this.model))throw new c.Reference("Engine.Timer.Animation.Property: passed model doesn't have such property to animate");this.from=k&&"from"in k?k.from:this.from||this.model[this.property];this.to=k&&"to"in k?k.to:this.to;d.call(this,k)}Class.extend(b,d);b.property({model:null,property:"",from:null,to:null});return b}(Engine.Timer.Animation,Engine.Error);Engine.Timer.Animation.Property.Number=function(d,c){function b(a){d.apply(this,arguments);if("number"!==typeof this.model[this.property])throw new c.Type("Engine.Timer.Animation.Property.Number: specified property to animate is not a number");this.from=parseFloat(this.from)||0;this.to=parseFloat(this.to)||0}Class.extend(b,d);b.property({frames:function(a,b){this.model.set(this.property,this.from+(a*this.frameDuration+b)/this.duration*(this.to-this.from))}});return b}(Engine.Timer.Animation.Property,
Engine.Error);Engine.Box=function(){function d(b,c,d,k){this.x=e(parseFloat(b)||0);this.y=e(parseFloat(c)||0);this.w=a(parseFloat(b+d)||0)-this.x;this.h=a(parseFloat(c+k)||0)-this.y}var c=Math.max,b=Math.min,a=Math.ceil,e=Math.floor;d.overlap=function(a,b,c,d,e,l,n,p){return a<e+n&&a+c>e&&b<l+p&&b+d>l};d.extend=function(a,b,c,d,e,l,n,p){return a<e&&a+c>e+n&&b<l&&b+d>l+p};d.method({overlap:function(a){return d.overlap(this.x,this.y,this.w,this.h,a.x,a.y,a.w,a.h)},extend:function(a){return d.extend(this.x,this.y,
this.w,this.h,a.x,a.y,a.w,a.h)},bound:function(a,d){var e=this.x,k=this.y,m=a.x,l=a.y;d=d||this;d.x=b(e,m);d.y=b(k,l);d.w=c(e+this.w,m+a.w)-d.x;d.h=c(k+this.h,l+a.h)-d.y;return d},clip:function(a,d){var e,k,m,l;m=this.x;l=this.y;var n=a.x,p=a.y;d=d||this;e=c(m,n);k=c(l,p);m=b(m+this.w,n+a.w)-e;l=b(l+this.h,p+a.h)-k;return 0>m||0>l?d.reset(0,0,0,0):d.reset(e,k,m,l)},copy:function(a){this.x=a.x;this.y=a.y;this.w=a.w;this.h=a.h},area:function(){return this.w*this.h},toString:function(){return"Box("+
this.x+","+this.y+","+this.w+","+this.h+")"},clone:function(){return new d(this.x,this.y,this.w,this.h)},equal:function(a){return a.x==this.x&&a.y==this.y&&a.w==this.w&&a.h==this.h},reset:function(a,b,c,d){this.x=parseInt(a)||0;this.y=parseInt(b)||0;this.w=0<=c?parseInt(c)||0:0;this.h=0<=d?parseInt(d)||0:0;return this}});return d}();Engine.Font=function(d){function c(a,c,e,f){1===arguments.length&&"object"===typeof a?(this.family=String(a&&"family"in a?a.family:this.family),this.size=String(a&&"size"in a?a.size:this.size).toLowerCase(),this.weight=String(a&&"weight"in a?a.weight:this.weight),this.style=String(a&&"style"in a?a.style:this.style),b(this),d.call(this,a)):(this.family=String(void 0!==a?a:this.family),this.size=String(void 0!==c?c:this.size).toLowerCase(),this.weight=String(void 0!==e?e:this.weight),this.style=String(void 0!==
f?f:this.style),b(this),d.call(this))}function b(b){b.size=a.test(b.size)?b.size:c.SIZE;b.weight=e.has(b.weight)?b.weight:e.first();b.style=f.has(b.style)?b.style:f.first()}var a=/(?:[1-9][0-9]+|[0-9])px|pt/;c.SIZE="12px";var e=[c.REGULAR="regular",c.BOLD="bold"],f=[c.NORMAL="normal",c.ITALIC="italic"];Class.extend(c,d);c.property({family:"",size:c.SIZE,weight:c.REGULAR,style:c.NORMAL});return c}(Model);Engine.Network=function(){return new Model}();Engine.Network.Url=function(d){var c=d.xUrl=RegExp("{}?{}?{}?{}?{}?{}?".format("(?:([a-z0-9]+\\:?)?\\/\\/)","([^\\/\\:]+)","(?:\\:([0-9]+))","([^\\?]+)","(?:(\\?[^\\#]+))","(?:(#.*))"),"i");return{parse:function(b){b=String(b);var a=c.exec(b)||[];b=String(a[1]||"").toLowerCase();var d=a[2]||"",f=a[3]||"",g=a[4]||"",h=a[5]||"",a=a[6]||"",k=f?d+":"+f:d;return{protocol:b,host:k,hostname:d,port:f,pathname:g,search:h,hash:a,origin:b+"//"+k,href:b+"//"+k+g+h+a}},toQuery:function(b){if(!b)return"";var a=
"",c;for(c in b)a+=c+"="+b[c]+"&";return a.slice(0,-1)},fromQuery:function(b){b=String(b);var a={};if(""===b)return a;b=b.split("&");for(var c=0,d=b.length;c<d;c++){var g=b[c].split("=");a[g[0]||""]=g[1]||""}return a}}}(Engine.Network);Engine.Network.Resource=function(){function d(c){this.src=String(c&&"src"in c?c.src:this.src);this.method=String(c&&"method"in c?c.method:this.method);this.data=c&&"data"in c?c.data:this.data;this.type=String(c&&"type"in c?c.type:this.type);this.headers=c&&"headers"in c?c.headers:this.headers;this.headers="object"===typeof this.headers?this.headers:null;this.autoload=Boolean(c&&"autoload"in c?c.autoload:this.autoload);this.pending=!1;this.response=null;this.complete=!1;Model.call(this,c);""===this.src&&
Engine.log("Resource was created without URL. Set config.src parameter during instancing to resolve.",Engine.WARN);this.autoload&&this.load()}Class.extend(d,Model);d.JSON="json";d.TEXT="text";d.DATA="data";d.AUTO="auto";d.GET="get";d.POST="post";d.LOAD="load";d.ERROR="error";d.PROGRESS="progress";d.ABORT="abort";d.property({src:"",headers:null,method:d.GET,type:d.AUTO,data:null,autoload:!0});d.property("on"+d.LOAD,function(c){this.response=c;this.pending=!1;this.complete=!0});d.property("on"+d.ERROR,
function(c){this.response=null;this.complete=this.pending=!1});d.method({load:function(){if(this.pending||!this.src)return!1;this.pending=!0;this.complete=!1;this.response=null;return!0},abort:function(){if(!this.pending)return!1;this.complete=this.pending=!1;this.response=null;return!0}});return d}();Engine.Network.Resource.Error={};Engine.Network.Resource.Error.Request=function(d){function c(b){d.call(this,"Request finished with [{}] status".format(b));this.status=parseInt(b)||0}Class.extend(c,d);c.property("type","networkResourceRequest");c.property("status",0);return c}(Engine.Error);Engine.Network.Resource.Error.Parse=function(d){function c(b){d.call(this,b)}Class.extend(c,d);c.property("type","networkResourceParse");return c}(Engine.Error);Engine.Network.Socket=function(){function d(c){this.src=c&&"src"in c?c.src:this.src;Model.call(this,c);""===this.src&&Engine.log("Socket was created without URL. Set config.src parameter during instancing to resolve.",Engine.WARN)}Class.extend(d,Model);d.property("src","");d.method({connect:function(c){},send:function(c){},close:function(){}});return d}();Engine.Element=function(){function d(c){this.global=new Matrix;this.name=c&&"name"in c?String(c.name):this.name;this.id=c&&"id"in c?null!==c.id?String(c.id):null:null!==this.id?String(this.id):null;this.parent=c&&c.parent&&c.parent instanceof Engine.Node?c.parent:this.parent;this.zindex=!c||"number"!==typeof c.zindex&&null!==c.zindex?this.zindex:c.zindex;d.register(this.id,this);this.selectable=c&&"boolean"===typeof c.selectable?c.selectable:this.selectable;Model.call(this,c);this.parent&&this.parent.appendChild(this)}
Class.extend(d,Model);d.elements={};d.SELECTED="selected";d.DESELECTED="deselected";d.property({selectable:!1,global:null,matrix:null,id:null,name:null,root:null,parent:null,zindex:null});d.getElementById=function(c){return this.elements[c]||null};d.register=function(c,b){null!==c&&(this.elements[c]=b)};d.unregister=function(c,b){null!==c&&this.elements[c]===b&&delete this.elements[c]};d.method({destroy:function(){d.unregister(this.id,this);this.parent&&this.parent.removeChild(this)},getElementById:function(c){return d.getElementById(c)},
next:function(){return this.parent&&this.parent.children[this.parent.children.indexOf(this)+1]||null},update:function(){var c=this.parent&&this.parent.root||this.parent||null;this.root!==c&&this.deselect();this.root=c;this.parent?this.global=this.matrix?this.parent.global.multiply(this.matrix,this.global):this.global.copy(this.parent.global):this.global.reset()},prev:function(){return this.parent&&this.parent.children[this.parent.children.indexOf(this)-1]||null},setId:function(c){c=null===c?c:String(c);
if(this.id===c)return!1;d.unregister(this.id,this);this.id=c;d.register(this.id,this);return!0},setZindex:function(c){c=null!==c?parseInt(c)||0:c;if(this.zindex===c)return!1;this.zindex=c;this.update();return!0},extractZindex:function(){for(var c=this;null!==c&&null===c.zindex;)c=c.parent;return c?parseInt(c.zindex)||0:0},index:function(){return this.parent?this.parent.children.indexOf(this):0},firstParentOfType:function(c){if("function"!==typeof c)return null;for(var b=this;b=b.parent;)if(b instanceof
c)return b;return null},setName:function(c){c=null!==c?String(c):c;var b=this.name;if(b===c)return!1;this.name=c;var a=this.parent;a&&(a[b]===this&&delete a[b],!a.hasOwnProperty(c)&&(a[c]=this));return!0},select:function(){if(!(this.root instanceof Engine.Scene&&this.selectable))return!1;if(this.root.selected.has(this))return!0;if(null===this.root.multiSelect)return!1;!this.root.multiSelect&&this.root.selected.length&&this.root.deselectAll();this.root.selected.push(this);this.trigger(d.SELECTED);
return!0},deselect:function(){if(!(this.root instanceof Engine.Scene&&this.root.selected.has(this)))return!1;this.root.selected.remove(this);this.trigger(d.DESELECTED);return!0}});return d}();Engine.Node=function(d,c){function b(a){this.children=[];d.call(this,a);if(null!=a&&a.children instanceof Array){a=a.children;for(var b=0;b<a.length;b++)a[b]instanceof d&&this.appendChild(a[b])}}Class.extend(b,d);b.method({update:function(a){a=a||this;this._super(a);for(var b=this.children,c=b.length;c--;)b[c].update(a)},appendChild:function(a,b){b="undefined"===typeof b?this.children.length:b;if(this.children.has(a))return null;null!==a.parent&&a.parent!==this&&a.parent.removeChild(a);this.children.splice(b,
0,a);a.parent=this;null!==a.name&&!this.hasOwnProperty(a.name)&&(this[a.name]=a);a.update(this);return a},removeChild:function(a){if(!this.children.has(a))return null;this.children.remove(a);a.parent=null;null!==a.name&&this[a.name]===a&&delete this[a.name];a.update(this);return a},destroy:function(){for(var a=this.children,b=a.length;0<b--;)a[b].destroy();this._super()},clear:function(){for(var a=this.children,b=a.length;0<b--;)a[b].destroy();a.length&&Engine.log("Engine.Node::clear: Node is not clear enough",
Engine.WARN)},getBb:function(){for(var a=new c(0,0,0,0),b=0,d=this.children,g=d.length;b<g;b++){var h=d[b].getBb();a.w&&a.h?a.bound(h):a.copy(h)}return a}});return b}(Engine.Element,Engine.Box);Engine.Scene=Engine.Node.Scene=function(d,c,b,a){function e(a){this.space={};this.space[e.GEOMETRY]=new b;this.space[e.MEDIA]=new b;this.space[e.CAMERA]=new b;this.multiSelect=!a||"boolean"!==typeof a.multiSelect&&null!==a.multiSelect?this.multiSelect:a.multiSelect;this.selected=[];d.call(this,a);if(!this.selectable)throw"Scene: Root element must be selectable";}Class.extend(e,d);e.GEOMETRY="geometry";e.MEDIA="media";e.CAMERA="camera";e.property({selectable:!0,multiSelect:!1,selected:null});e.method({setMultiSelect:function(a){if("boolean"!==
typeof a&&null!==a)throw new TypeError;this.multiSelect=a;if(!a&&this.selected.length){if(!1===a){if(1===this.selected.length)return;var b=this.selected.first(),c=function(a){return a!==b}}this.deselectAll(c)}},search:function(a,b){b="undefined"==typeof b?e.GEOMETRY:b;var c=this.space[b];return c?(a=null===a?c.get_tree():a,c.search(a)):[]},sort:function(a){return a.sort(this.compare)},compare:function(a,b){var c=b.extractZindex()-a.extractZindex();if(c)return c;for(var c=[],d=[];a;)c.push(a.index()),
a=a.parent;for(;b;)d.push(b.index()),b=b.parent;for(;0<c.length||0<d.length;)if(a=parseInt(c.pop())||0,b=parseInt(d.pop())||0,b-a)return b-a;return 0},spaceInsert:function(a,c,d){(this.space[a]=this.space[a]||new b).insert(c,d)},spaceClear:function(a,b,c){(a=this.space[a])&&b.w&&b.h&&a.remove(b,c)},captureGeometryByPixel:function(a){var b=new Matrix,d=[0,0],e=new c(0,0,1,1);return function(c,l,n,p){n=Array.isArray(n)?n:null;p="function"===typeof p?p:null;e.x=c;e.y=l;c=this.sort(this.search(e));l=
null;for(var q=0,r=c.length;q<r;q++)if(l=c[q],l.captureEvents&&!(n&&n.has(l)||p&&!p(l))&&(l.global.inverse(b).byVector(e.x,e.y,d),l.captureUI(a(d[0]),a(d[1]))))return l;return null}}(Math.round),deselectAll:function(a){a="function"===typeof a?a:null;for(var b=0;b<this.selected.length;b++){var c=this.selected[b];(!a||a(c))&&c.deselect()&&b--}return!this.selected.length},select:function(){throw"Scene: Root element can't be selected";},deselect:function(){throw"Scene: Root element can't be deselected";
},getSelectedGeometries:function(){function a(c){if(c instanceof Engine.Geometry)return b.push(c);c.children&&c.children.forEach(a)}var b=[];this.selected.forEach(a);return b}});return e}(Engine.Node,Engine.Box,RTree,Engine.Fill);Engine.Transform=Engine.Node.Transform=function(d){function c(b){this.matrix=new Matrix(b);d.call(this,b)}Class.extend(c,d);c.method({setTransform:function(b,a,c,d,g,h){this.matrix.set(b,c,g,a,d,h,0,0,1);this.update(this);return this},transform:function(b,a,c,d,g,h){this.matrix.transform(b,a,c,d,g,h);this.update(this);return this},multiply:function(b,a){this.matrix.multiply(b);this.update(this);return this},rotate:function(b){this.matrix.rotate(b);this.update(this);return this},translate:function(b,
a){this.matrix.translate(b,a);this.update(this);return this},scale:function(b,a){this.matrix.scale(b,a);this.update(this);return this},reset:function(){this.matrix.reset();this.update(this);return this}});return c}(Engine.Node);Engine.Node.Transform.Anchor=function(d,c){function b(a){var c=a&&a.anchors||this.anchors;this.anchors={};this[b.LEFT]=a&&a.hasOwnProperty(b.LEFT)?parseInt(a[b.LEFT])||0:this[b.LEFT];this[b.TOP]=a&&a.hasOwnProperty(b.TOP)?parseInt(a[b.TOP])||0:this[b.TOP];this.width=a&&a.hasOwnProperty("width")&&0<=a.width?parseInt(a.width)||0:this.width;this.height=a&&a.hasOwnProperty("height")&&0<=a.height?parseInt(a.height)||0:this.height;this[b.RIGHT]=this[b.LEFT]+this.width;this[b.BOTTOM]=this[b.TOP]+this.height;
this.marginLeft=a&&a.hasOwnProperty("marginLeft")?parseInt(a.marginLeft)||0:this.marginLeft;this.marginRight=a&&a.hasOwnProperty("marginRight")?parseInt(a.marginRight)||0:this.marginRight;this.marginTop=a&&a.hasOwnProperty("marginTop")?parseInt(a.marginTop)||0:this.marginTop;this.marginBottom=a&&a.hasOwnProperty("marginBottom")?parseInt(a.marginBottom)||0:this.marginBottom;d.call(this,a);if(c)for(var f in c)this.connect(f,c[f])}Class.extend(b,d);b.HANCHORS=[b.LEFT="left",b.CENTERH="centerh",b.RIGHT=
"right"];b.VANCHORS=[b.TOP="top",b.CENTERV="centerv",b.BOTTOM="bottom"];b.EXTRAANCHORS=[b.CENTERIN="centerin",b.FILL="fill",b.FILLWIDTH="fillwidth",b.FILLHEIGHT="fillheight"];b.SYMBOLS=[b.PARENT="parent",b.NEXT="next",b.PREV="prev"];b.ANCHORS=b.HANCHORS.concat(b.VANCHORS,b.EXTRAANCHORS);b.SEPARATOR=".";b.property(b.LEFT,0);b.property(b.CENTERH,0);b.property(b.RIGHT,0);b.property(b.TOP,0);b.property(b.CENTERV,0);b.property(b.BOTTOM,0);b.property({marginLeft:0,marginRight:0,marginTop:0,marginBottom:0,
width:0,height:0});b.method({setBounds:function(a,c,d,g){a=parseInt(a)||0;c=parseInt(c)||0;d=parseInt(d)||0;g=parseInt(g)||0;this[b.LEFT]=a;this[b.TOP]=c;this[b.RIGHT]=d>=this[b.LEFT]?d:this[b.LEFT];this[b.BOTTOM]=g>=this[b.TOP]?g||0:this[b.TOP];this.width=this[b.RIGHT]-this[b.LEFT];this.height=this[b.BOTTOM]-this[b.TOP];this[b.CENTERH]=this[b.LEFT]+this.width/2;this[b.CENTERV]=this[b.TOP]+this.height/2;this.matrix.set(1,0,this[b.LEFT],0,1,this[b.TOP],0,0,1)},setPosition:function(a,b){this.setBounds(a,
b,a+this.width,b+this.height);this.update()},setSize:function(a,c){this.setBounds(this[b.LEFT],this[b.TOP],this[b.LEFT]+a,this[b.TOP]+c);this.update()},update:function(a){this.calculate();if(null!=this.parent&&(null==a||a.parent!=this.parent))for(var c=null,d=this.parent.children,g=0;g<d.length;g++)c=d[g],!0==c instanceof b&&c!==this&&c.update(this);this._super(a)},calculate:function(){var a={};a[b.LEFT]=null;a[b.CENTERH]=null;a[b.RIGHT]=null;a[b.TOP]=null;a[b.CENTERV]=null;a[b.BOTTOM]=null;for(var c=
b.SEPARATOR,d=0,g="",h="",d="",h=null,k=0,m="",k=0;k<b.HANCHORS.length;k++)if(m=b.HANCHORS[k],g=this.anchors[m])d=g.indexOf(c),h=g.slice(0,d),d=g.slice(d+1),h=this.getBySymbol(h)||this.getElementById(h),h instanceof b&&(a[m]=h==this.parent?h[d]-h[b.LEFT]:h.parent==this.parent?h[d]:a[m]);null!==a[b.LEFT]?(a[b.LEFT]+=this.marginLeft,a[b.RIGHT]=null!==a[b.RIGHT]?a[b.RIGHT]:null!==a[b.CENTERH]?a[b.CENTERH]+(a[b.CENTERH]-a[b.LEFT]):a[b.LEFT]+this.width):null!==a[b.RIGHT]?(a[b.RIGHT]-=this.marginRight,
a[b.LEFT]=null!==a[b.LEFT]?a[b.LEFT]:null!==a[b.CENTERH]?a[b.CENTERH]+(a[b.CENTERH]-a[b.RIGHT]):a[b.RIGHT]-this.width):null!==a[b.CENTERH]?(a[b.LEFT]=a[b.CENTERH]-this.width/2+this.marginLeft-this.marginRight,a[b.RIGHT]=a[b.CENTERH]+this.width/2+this.marginLeft-this.marginRight):(a[b.LEFT]=this[b.LEFT],a[b.RIGHT]=this[b.RIGHT]);for(k=0;k<b.VANCHORS.length;k++)if(m=b.VANCHORS[k],g=this.anchors[m])d=g.indexOf(c),h=g.slice(0,d),d=g.slice(d+1),h=this.getBySymbol(h)||this.getElementById(h),h instanceof
b&&(a[m]=h==this.parent?h[d]-h[b.TOP]:h.parent==this.parent?h[d]:a[m]);null!==a[b.TOP]?(a[b.TOP]+=this.marginTop,a[b.BOTTOM]=null!==a[b.BOTTOM]?a[b.BOTTOM]:null!==a[b.CENTERV]?a[b.CENTERV]+(a[b.CENTERV]-a[b.TOP]):a[b.TOP]+this.height):null!==a[b.BOTTOM]?(a[b.BOTTOM]-=this.marginBottom,a[b.TOP]=null!==a[b.TOP]?a[b.TOP]:null!==a[b.CENTERV]?a[b.CENTERV]+(a[b.CENTERV]-a[b.BOTTOM]):a[b.BOTTOM]-this.height):null!==a[b.CENTERV]?(a[b.TOP]=a[b.CENTERV]-this.height/2+this.marginTop-this.marginBottom,a[b.BOTTOM]=
a[b.CENTERV]+this.height/2+this.marginTop-this.marginBottom):(a[b.TOP]=this[b.TOP],a[b.BOTTOM]=this[b.BOTTOM]);this.setBounds(a[b.LEFT],a[b.TOP],a[b.RIGHT],a[b.BOTTOM])},getBySymbol:function(a){var c=null;switch(a){case b.PARENT:c=this.parent;break;case b.NEXT:c=this.next();break;case b.PREV:c=this.prev()}return c instanceof b?c:null},connect:function(a,c){if("string"!=typeof c||""==c)return!1;var d=b.SEPARATOR,g=c.indexOf(d),h=-1==g?c:c.slice(0,g),g=-1==g?"":c.slice(g+1);if(b.HANCHORS.has(a)&&b.HANCHORS.has(g)||
b.VANCHORS.has(a)&&b.VANCHORS.has(g))this.anchors[a]=c,this.update();else if(b.EXTRAANCHORS.has(a)){switch(a){case b.CENTERIN:this.anchors[b.CENTERH]=h+d+b.CENTERH;this.anchors[b.CENTERV]=h+d+b.CENTERV;break;case b.FILLWIDTH:this.anchors[b.LEFT]=h+d+b.LEFT;this.anchors[b.RIGHT]=h+d+b.RIGHT;break;case b.FILLHEIGHT:this.anchors[b.TOP]=h+d+b.TOP;this.anchors[b.BOTTOM]=h+d+b.BOTTOM;break;case b.FILL:this.anchors[b.LEFT]=h+d+b.LEFT,this.anchors[b.RIGHT]=h+d+b.RIGHT,this.anchors[b.TOP]=h+d+b.TOP,this.anchors[b.BOTTOM]=
h+d+b.BOTTOM}this.update()}},disconnect:function(a){if(!1==b.ANCHORS.has(a))return!1;switch(a){case b.CENTERIN:delete this.anchors[b.CENTERH];delete this.anchors[b.CENTERV];break;case b.FILLWIDTH:delete this.anchors[b.LEFT];delete this.anchors[b.RIGHT];break;case b.FILLHEIGHT:delete this.anchors[b.TOP];delete this.anchors[b.BOTTOM];break;case b.FILLHEIGHT:delete this.anchors[b.LEFT];delete this.anchors[b.RIGHT];delete this.anchors[b.TOP];delete this.anchors[b.BOTTOM];break;default:delete this.anchors[a]}}});
return b}(Engine.Node.Transform,Engine.Scene);Engine.Geometry=function(d,c,b){function a(a){this.bb=new b(0,0,0,0);this.captureEvents=null!=a&&"boolean"==typeof a.captureEvents?a.captureEvents:this.captureEvents;this.vAlign=a&&"vAlign"in a?String(a.vAlign):String(this.vAlign);this.vAlign=l.has(this.vAlign)?this.vAlign:l[0];this.hAlign=a&&"hAlign"in a?String(a.hAlign):String(this.hAlign);this.hAlign=m.has(this.hAlign)?this.hAlign:m[0];this.zindex=a&&a.zindex?parseInt(a.zindex)||0:this.zindex;this.left=a&&"left"in a?parseInt(a.left)||0:this.left;
this.top=a&&"top"in a?parseInt(a.top)||0:this.top;this.width=a&&"width"in a?f(0,parseInt(a.width)||0):f(0,parseInt(this.width)||0);this.height=a&&"height"in a?f(0,parseInt(a.height)||0):f(0,parseInt(this.height)||0);this.right=this.left+this.width;this.bottom=this.top+this.height;d.call(this,a);e(this,this.hAlign,this.vAlign,this.width,this.height);if(!this.captureEvents&&this.selectable)throw"Geometry::initialize: Geometry can't be selectable and doesn't capture events simultaneously";}function e(b,
c,d,e,f){var h=b.left,g=b.top,n=b.left+e,k=b.top+f;switch(c){case a.LEFT:h=0;n=e;break;case a.RIGHT:h=-e;n=0;break;case a.CENTER:h=-e/2,n=-h}switch(d){case a.TOP:g=0;k=f;break;case a.BOTTOM:g=-f;k=0;break;case a.CENTER:g=-f/2,k=-g}b.setBounds(h,g,n,k)}var f=Math.max,g=Math.min,h=Math.floor,k=Math.ceil;Class.extend(a,d);var m=[a.NONE="none",a.LEFT="left",a.CENTER="center",a.RIGHT="right"],l=[a.NONE,a.TOP="top",a.BOTTOM="bottom",a.CENTER];a.property({types:[c.GEOMETRY],vAlign:a.NONE,hAlign:a.NONE,transform:null,
captureEvents:!0,opacity:1,left:0,top:0,right:0,bottom:0,width:0,height:0,bb:null});var n=[0,0];a.toBB=function(a,c,d,e,l,m){var v,A,B,w;m=m instanceof b?m:new b(0,0,0,0);l.byVector(a,c,n);v=A=n[0];B=w=n[1];l.byVector(d,c,n);v=g(v,n[0]);A=f(A,n[0]);B=g(B,n[1]);w=f(w,n[1]);l.byVector(a,e,n);v=g(v,n[0]);A=f(A,n[0]);B=g(B,n[1]);w=f(w,n[1]);l.byVector(d,e,n);v=g(v,n[0]);A=f(A,n[0]);B=g(B,n[1]);w=f(w,n[1]);m.w=k(A)-(m.x=h(v));m.h=k(w)-(m.y=h(B));return m};a.method({setOpacity:function(a){a=f(g(parseFloat(a)||
0,1),0);if(this.opacity===a)return!1;this.opacity=a;this.redraw();return!0},setAlign:function(a,b){a=m.has(a)?a:0;b=l.has(b)?b:0;if(this.hAlign===a&&this.vAlign===b)return!1;this.hAlign=a;this.vAlign=b;e(this,a,b,this.width,this.height);return!0},setBounds:function(b,c,d,e){b=parseInt(b)||0;c=parseInt(c)||0;d=f(b,parseInt(d)||0);e=f(c,parseInt(e)||0);if(this.left===b&&this.top===c&&this.right===d&&this.bottom===e)return!1;this.left=b;this.top=c;this.right=d;this.bottom=e;this.width=d-b;this.height=
e-c;this.clearBB(this.root);this.bb=a.toBB(this.left,this.top,this.right,this.bottom,this.global,this.bb);this.insertBB(this.root);return!0},setPosition:function(a,b){a=parseInt(a)||0;b=parseInt(b)||0;return this.setBounds(a,b,a+this.width,b+this.height)},setBox:function(a,b,c,d){return this.setBounds(a,b,a+c,b+d)},setSize:function(a,b){a=0<=a?parseInt(a)||0:0;b=0<=b?parseInt(b)||0:0;if(this.width===a&&this.height===b)return!1;e(this,this.hAlign,this.vAlign,a,b);return!0},captureUI:function(a,b){return a>=
this.left&&a<this.right&&b>=this.top&&b<this.bottom},getPixel:function(a,b,c){c=c||[];c[0]=0;c[1]=0;c[2]=0;c[3]=0;return c},clearBB:function(a){if(a instanceof c){for(var b=0,d=this.bb,e=this.types,f=e.length;b<f;b++)a.spaceClear(e[b],d,this);return!0}return!1},insertBB:function(a){if(a instanceof c){for(var b=0,d=this.bb,e=this.types,f=e.length;b<f;b++)a.spaceInsert(e[b],d,this);return!0}return!1},update:function(b){this.clearBB(this.root);this._super(b);this.bb=a.toBB(this.left,this.top,this.right,
this.bottom,this.global,this.bb);this.insertBB(this.root)},redraw:function(a,b,c,d){return this.width&&this.height},getBb:function(){return this.bb}});return a}(Engine.Element,Engine.Scene,Engine.Box);Engine.Geometry.Shape=function(d,c,b){function a(a){this.image=c.Image.parse(a&&"image"in a?a.image:this.image);this.repeat=c.Repetition.parse(a&&"repeat"in a?a.repeat:this.repeat);this.color=c.Color.parse(a&&"color"in a?a.color:this.color);this.stroke=c.Color.parse(a&&"stroke"in a?a.stroke:this.stroke);a&&"fill"in a&&c.parse(String(a.fill),this);this.offsetX=parseInt(a&&"offsetX"in a?a.offsetX:this.offsetX)||0;this.offsetY=parseInt(a&&"offsetY"in a?a.offsetY:this.offsetY)||0;d.call(this,a)}Class.extend(a,
d);a.property({image:"",color:"rgba(0,0,0,0)",repeat:"repeat",stroke:"rgba(0,0,0,0)",offsetX:0,offsetY:0});a.method({setColor:function(a){if(a===this.color)return!1;this.color=a instanceof c.Color?a:c.Color.parse(a);this.redraw();return!0},setImage:function(a){if(a===this.image)return!1;this.image=a instanceof c.Image?a:c.Image.parse(a);this.redraw();return!0},setRepeat:function(a){if(a===this.repeat)return!1;this.repeat=c.Repetition.parse(a);this.redraw();return!0},setFill:function(a){this.color=
this.repeat=this.image=null;c.parse(a,this);this.redraw();return!0},setStroke:function(a){if(a===this.stroke)return!1;this.stroke=a instanceof c.Color?a:c.Color.parse(a);this.redraw();return!0},setOffset:function(a,b){a=parseInt(a)||0;b=parseInt(b)||0;if(this.offsetX===a&&this.offsetY===b)return!1;this.offsetX=a;this.offsetY=b;this.redraw();return!0},setOffsetX:function(a){a=parseInt(a)||0;return this.setOffset(a,this.offsetY)},setOffsetY:function(a){a=parseInt(a)||0;return this.setOffset(this.offsetX,
a)}});b.property({image:"",color:"rgba(0,0,0,0)",repeat:"repeat"});b.method({initialize:function(a){this.image=c.Image.parse(a&&"image"in a?a.image:this.image);this.repeat=c.Repetition.parse(a&&"repeat"in a?a.repeat:this.repeat);this.color=c.Color.parse(a&&"color"in a?a.color:this.color);this.stroke=c.Color.parse(a&&"stroke"in a?a.stroke:this.stroke);a&&"fill"in a&&c.parse(String(a.fill),this);this._super(a)},setColor:function(a){if(a===this.color)return!1;this.color=a instanceof c.Color?a:c.Color.parse(a);
this.redraw();return!0},setImage:function(a){if(a===this.image)return!1;this.image=a instanceof c.Image?a:c.Image.parse(a);this.redraw();return!0},setRepeat:function(a){if(a===this.repeat)return!1;this.repeat=c.Repetition.parse(a);this.redraw();return!0},setFill:function(a){this.color=this.repeat=this.image=null;c.parse(a,this);this.redraw();return!0},redraw:function(){}});return a}(Engine.Geometry,Engine.Fill,Engine.Scene);Engine.Geometry.Rectangle=Engine.Geometry.Shape.Rectangle=function(d,c){function b(a){c.call(this,a)}Class.extend(b,c);return b}(Engine.Geometry,Engine.Geometry.Shape);Engine.Geometry.Polygon=Engine.Geometry.Shape.Polygon=function(d,c,b,a){function e(a){c.call(this,a);a&&"points"in a&&this.setPoints(a.points)}Class.extend(e,c);e.property("points",null);e.method("setPoints",function(c){var d=0,e=0,k=0,m=0;if(c=this.points)for(var l=0,n=c.length;l<n;l++)var p=c[l],q=p[0],p=p[1],d=b(d,q)-1,e=a(e,q)+1,k=b(k,p)-1,m=a(m,p)+1;this.setBounds(d,k,e,m)});return e}(Engine.Geometry,Engine.Geometry.Shape,Math.min,Math.max);Engine.Geometry.Oval=Engine.Geometry.Shape.Oval=function(d,c){function b(a){d.call(this,a);var b=this.originX=parseInt(a&&"originX"in a?a.originX:this.originX)||0,c=this.originY=parseInt(a&&"originY"in a?a.originY:this.originY)||0;a&&"radius"in a&&(this.radiusY=this.radiusX=parseInt(a.radius)||0);var g=this.radiusX=parseInt(a&&"radiusX"in a?a.radiusX:this.radiusX)||0;a=this.radiusY=parseInt(a&&"radiusY"in a?a.radiusY:this.radiusY)||0;this.setBounds(b-g,c-a,b+g,c+a)}Class.extend(b,d);b.property({originX:0,
originY:0,radiusX:0,radiusY:0});b.method({setOrigin:function(a,b){a=parseInt(a)||0;b=parseInt(b)||0;var c=this.radiusX,d=this.radiusY;return this.setBounds(a-c,b-d,a+c,b+d)},setRadius:function(a,b){a=c(0,parseInt(a)||0);b=void 0===b?a:c(0,parseInt(b)||0);var d=this.originX,g=this.originY;return this.setBounds(d-a,g-b,d+a,g+b)},setBounds:function(a,b,c,d){if(!this._super(a,b,c,d))return!1;a=this.width/2;b=this.height/2;this.originX=this.left+a;this.originY=this.top+b;this.radiusX=a;this.radiusY=b;
return!0}});return b}(Engine.Geometry.Shape,Math.max);Engine.Geometry.Shape.Text=function(d,c,b,a,e){function f(b){this.font=b&&"font"in b?b.font:this.font;this.font=this.font instanceof c?this.font:null;this.textColor=String(b&&"textColor"in b?b.textColor:this.textColor);this.text=String(b&&"text"in b?b.text:this.text);this.minWidth=a(0,parseFloat(b&&"minWidth"in b?b.minWidth:this.minWidth)||0);this.minHeight=a(0,parseFloat(b&&"minHeight"in b?b.minHeight:this.minHeight)||0);this.maxWidth=a(0,parseFloat(b&&"maxWidth"in b?b.maxWidth:this.maxWidth)||0);
this.maxHeight=a(0,parseFloat(b&&"maxHeight"in b?b.maxHeight:this.maxHeight)||0);this.spacing=parseInt(b&&"spacing"in b?b.spacing:this.spacing)||0;this.lineHeight=a(-1,parseInt(b&&"lineHeight"in b?b.lineHeight:this.lineHeight)||0);this.textAlign=String(b&&"textAlign"in b?b.textAlign:this.textAlign);this.textAlign=g.has(this.textAlign)?this.textAlign:g[0];if(b&&"padding"in b){var e=parseInt(b.padding)||0;this.paddingBottom=this.paddingRight=this.paddingTop=this.paddingLeft=e}this.paddingLeft=parseInt(b&&
"paddingLeft"in b?b.paddingLeft:this.paddingLeft)||0;this.paddingTop=parseInt(b&&"paddingTop"in b?b.paddingTop:this.paddingTop)||0;this.paddingRight=parseInt(b&&"paddingRight"in b?b.paddingRight:this.paddingRight)||0;this.paddingBottom=parseInt(b&&"paddingBottom"in b?b.paddingBottom:this.paddingBottom)||0;d.call(this,b)}Class.extend(f,d);f.AUTO=-1;var g=[f.LEFT="left",f.RIGHT="right",f.CENTER="center",f.JUSTIFY="justify",f.PRE="pre"];f.COLOR="black";f.READY="ready";f.property({font:null,textColor:f.COLOR,
text:"",minWidth:0,minHeight:0,maxWidth:Infinity,maxHeight:Infinity,spacing:0,lineHeight:f.AUTO,textAlign:f.LEFT,paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:0});f.method({setFont:function(a){a=a instanceof c?a:null;if(this.font===a)return!1;this.font=a;return!0},setTextColor:function(a){a=String(a);if(this.textColor===a)return!1;this.textColor=a;return!0},setText:function(a){a=String(a);if(this.text===a)return!1;this.text=a;return!0},setSpacing:function(a){a=parseInt(a)||0;if(this.spacing===
a)return!1;this.spacing=a;return!0},setLineHeight:function(a){a=parseInt(a)||0;if(this.lineHeight===a)return!1;this.lineHeight=a;return!0},setTextAlign:function(a){a=String(a);a=g.has(a)?a:g[0];if(this.textAlign===a)return!1;this.textAlign=a;return!0},setPadding:function(a,b,c,d){for(;0<arguments.length&&void 0===arguments[arguments.length-1];)e.call(arguments);switch(arguments.length){case 2:c=a;d=b;break;case 1:d=c=b=a}a=parseInt(a)||0;b=parseInt(b)||0;c=parseInt(c)||0;d=parseInt(d)||0;if(this.paddingLeft===
a&&this.paddingTop===b&&this.paddingRight===c&&this.paddingBottom===d)return!1;this.paddingLeft=a;this.paddingTop=b;this.paddingRight=c;this.paddingBottom=d;return!0},setMinWidth:function(b){b=a(0,parseFloat(b)||0);if(this.minWidth===b)return!1;this.minWidth=b;return!0},setMinHeight:function(b){b=a(0,parseFloat(b)||0);if(this.minHeight===b)return!1;this.minHeight=b;return!0},setMaxWidth:function(b){b=a(0,parseFloat(b)||0);if(this.maxWidth===b)return!1;this.maxWidth=b;return!0},setMaxHeight:function(b){b=
a(0,parseFloat(b)||0);if(this.maxHeight===b)return!1;this.maxHeight=b;return!0}});return f}(Engine.Geometry.Shape,Engine.Font,Math.min,Math.max,Array.prototype.pop);Engine.Image=Engine.Geometry.Image=function(d){function c(b){this.src=b&&"src"in b?String(b.src):String(this.src);this.complete=!1;d.call(this,b)}Class.extend(c,d);c.LOAD="load";c.ERROR="error";c.property({complete:!1,src:""});c.method("setSrc",function(b){b=String(b);if(this.src===b||""===b)return!1;this.complete=!1;this.src=b;return!0});return c}(Engine.Geometry);Engine.Geometry.Image.Sprite=function(d){function c(b){this.offsetx=b&&"offsetx"in b?parseInt(b.offsetx)||0:parseInt(this.offsetx)||0;this.offsety=b&&"offsety"in b?parseInt(b.offsety)||0:parseInt(this.offsety)||0;d.call(this,b)}Class.extend(c,d);c.property({offsetx:0,offsety:0});c.method("setOffset",function(b,a){b=parseInt(b)||0;a=parseInt(a)||0;if(this.offsetx===b&&this.offsety===a)return!1;this.offsetx=b;this.offsety=a;this.redraw();return!0});return c}(Engine.Geometry.Image);Engine.Geometry.Media=function(d,c,b,a,e,f,g,h,k,m,l,n){function p(b){this.ambient=b&&"ambient"in b?Boolean(b.ambient):Boolean(this.ambient);this.loop=b&&"loop"in b?Boolean(b.loop):Boolean(this.loop);this.autoplay=b&&"autoplay"in b?Boolean(b.autoplay):Boolean(this.autoplay);this.volume=b&&"volume"in b?e(0,a(parseFloat(b.volume)||0,1)):e(0,a(parseFloat(this.volume)||0,1));this.src=b&&"src"in b?String(b.src):String(this.src);d.call(this,b);this.autoplay&&this.play()}Class.extend(p,d);p.property({types:[c.MEDIA],
src:"",volume:1,globalVolume:0,balanceRadius:0,balanceAngle:3*l,ambient:!1,loop:!1,playing:!1,autoplay:!1});p.method({setSrc:function(a){a=String(a);if(this.src===a||""===a)return!1;this.src=a;return!0},setVolume:function(b){b=e(a(parseFloat(b)||0,1),0);if(b===this.volume)return!1;this.volume=b;return!0},update:function(a){this._super(a);this.calculateRenderBalance()},calculateRenderBalance:function(){var b=l,d=1;if(this.root instanceof c)if(this.ambient)this.balanceRadius=1-this.volume;else{var b=
this.bb,h=this.root.search(b,c.CAMERA),n=d=0,k=h.length;if(k){for(var p=0,A=0;A<k;A++)var B=h[A],w=B.view,t=B.x,x=B.y,z=b.x,s=b.y,D=b.w,C=b.h,E=w.w,w=w.h,t=t>z&&t<z+D?0:f(z-t)<f(z+D-t)?z-t:z+D-t,x=x>s&&x<s+C?0:f(s-x)<f(s+C-x)?s-x:s+C-x,d=d+t/(E/2),n=n+x/(w/2),p=p+B.volume;p/=k;b=d||n?m(d/g(d*d+n*n)):0;d=a(e(0,e(f(d),f(n))/k),1);d+=(1-d)*(1-p);b=0<n?2*l-b+2*l:b}else b=l,d=1}if(b===this.balanceAngle&&d===this.balanceRadius)return!1;this.balanceAngle=b;this.balanceRadius=d;return!0},play:function(){return this.playing?
!1:this.playing=!0},pause:function(){return this.playing?!1:!(this.playing=!1)},stop:function(){return this.pause()}});return p}(Engine.Geometry,Engine.Scene,Engine.Box,Math.min,Math.max,Math.abs,Math.sqrt,Math.pow,Math.tan,Math.acos,Math.PI/2,2*Math.PI);Engine.Geometry.Sound=Engine.Geometry.Media.Sound=function(d,c,b,a,e,f){function g(a){this.priority=a&&"priority"in a?parseInt(a.priority)||0:parseInt(this.priority)||0;this.radius=a&&"radius"in a?f(0,parseInt(a.radius)||0):f(0,parseInt(this.radius)||0);c.call(this,a);this.setRadius(this.radius)}function h(a){a&&a.component&&(a.pause(),a.component.removeSound(a))}function k(b){if(b._sound)return b;if(""===b.src)return b._sound=null;for(var c,d=0,f=m.length;d<f;d++){var g=m[d++];if(g.src===b.src&&
g.loop===b.loop){c=g;break}}b._sound=new Engine.Sound({refersTo:c,src:b.src,loop:b.loop,volume:b.volume,position:{x:e(b.balanceAngle)*b.balanceRadius,y:a(b.balanceAngle)*b.balanceRadius,z:-0.5}});m.add(b._sound.component);return b}Class.extend(g,c);g.property({_sound:null,filter:void 0,priority:0,radius:1});g.method({setSrc:function(a){if(!this._super(a))return!1;this._sound&&(h(this._sound),this._sound=null);this.src.length&&(k(this),this.playing&&this._sound&&this._sound.play());return!0},destroy:function(){this._super();
this._sound&&(h(this._sound),this._sound=null)},setVolume:function(a){return this._super(a)?(this._sound&&(this._sound.setVolume(this.volume),0===this.volume?this._sound.pause():this.playing&&!this._sound.playing&&this._sound.play()),!0):!1},calculateRenderBalance:function(){return this._super()?(this._sound&&(1===this.balanceRadius?this._sound.pause():(this.playing&&!this._sound.playing&&this._sound.play(),this._sound.setPosition(e(this.balanceAngle)*this.balanceRadius,a(this.balanceAngle)*this.balanceRadius,
-0.5))),!0):!1},setRadius:function(a){a=parseInt(f(a,0))||0;return this.setBounds(-a,-a,a,a)},play:function(a,b){if(!this._super())return!1;!this._sound&&k(this);this._sound&&this._sound.play(!this.loop&&0);return!0},pause:function(){return this._super()?(this._sound&&this._sound.pause(),!0):!1},stop:function(){return this._super()?(this._sound&&this._sound.stop(),!0):!1}});var m=[];return g}(Engine.Geometry,Engine.Geometry.Media,Engine.Scene,Math.sin,Math.cos,Math.max);Engine.Geometry.Media.Video=function(d,c){function b(a){d.call(this,a)}Class.extend(b,d);b.AUTO=1;b.property({autosize:b.AUTO,types:[c.GEOMETRY,c.MEDIA]});return b}(Engine.Geometry.Media,Engine.Scene);Engine.Viewport=function(d,c,b,a){function e(b,c,d,g){if("string"===typeof b)return"number"===typeof c?e.call(this,{id:b,width:c,height:d,cameras:g}):e.call(this,{id:b,cameras:c});this.cameras=[];this.id=String(b&&"id"in b?b.id:this.id);this.width=a(0,parseInt(b&&"width"in b?b.width:this.width)||0);this.height=a(0,parseInt(b&&"height"in b?b.height:this.height)||0);this.background=String(b&&"background"in b?b.background:this.background);this.fullscreen=b&&("width"in b||"height"in b)?!1:Boolean(this.fullscreen);
this.fullscreen=Boolean(b&&"fullscreen"in b?b.fullscreen:this.fullscreen);Model.call(this,b);this.fullscreen&&f(this);if(g=b&&"cameras"in b?b.cameras:null)for(b=0,c=parseInt(g.length)||0;b<c;b++)this.addCamera(g[b])}function f(a){g.add(a);a.setSize(c.screen.innerWidth,c.screen.innerHeight)}Class.extend(e,Model);e.property({id:"",width:0,height:0,background:"rgba(0, 0, 0, 0)",fullscreen:!0});e.method({setSize:function(b,c){b=a(0,parseInt(b)||0);c=a(0,parseInt(c)||0);if(this.width===b&&this.height===
c)return!1;this.width=b;this.height=c;for(var d=0,e=this.cameras,f=e.length;d<f;d++){var g=e[d];g.fullscreen&&g.setSize(b,c)}return!0},setFullscreen:function(a){a=Boolean(a);if(this.fullscreen===a)return!1;(this.fullscreen=a)?f(this):g.remove(this);return!0},setBackground:function(a){a=String(a);if(this.background===a)return!1;this.background=a;return!0},addCamera:function(a){if(a.parent===this)return!1;a.parent&&a.parent.removeCamera(a);this.cameras.add(a);a.parent=this;a.fullscreen&&a.setSize(this.width,
this.height);return!0},removeCamera:function(a){if(a.parent!==this)return!1;this.cameras.remove(a);a.parent=null;return!0},getCameraByPixel:function(){var a=new d(0,0,1,1),b=new d(0,0,0,0);return function(c,d,e){if("number"!==typeof c||"number"!==typeof d)return!1;e=Array.isArray(e)?e:null;a.x=c;a.y=d;for(c=this.cameras.length;c--;)if(d=this.cameras[c],!e||!e.has(d))if(b.x=d.left,b.y=d.top,b.w=d.width,b.h=d.height,a.overlap(b))return d;return null}}()});var g=[];c.on("resize",function(){for(var a=
c.screen.innerWidth,b=c.screen.innerHeight,d=0;d<g.length;d++)g[d].setSize(a,b)});return e}(Engine.Box,Engine.Device,Math.min,Math.max);Engine.Camera=function(d,c,b,a,e,f){function g(e){this.view=new d(0,0,0,0);this.volume=a(0,b(parseFloat(e&&"volume"in e?e.volume:this.volume),1));this.zoom=a(0,b(parseFloat(e&&"zoom"in e?e.zoom:this.zoom),Infinity));this.fullscreen=e&&("width"in e||"height"in e)?!1:Boolean(this.fullscreen);this.fullscreen=Boolean(e&&"fullscreen"in e?e.fullscreen:this.fullscreen);this.x=parseFloat(e&&"x"in e?e.x:this.x)||0;this.y=parseFloat(e&&"y"in e?e.y:this.y)||0;this.left=parseInt(e&&"left"in e?e.left:this.left)||
0;this.top=parseInt(e&&"top"in e?e.top:this.top)||0;this.width=a(0,parseInt(e&&"width"in e?e.width:this.width));this.height=a(0,parseInt(e&&"height"in e?e.height:this.height));this.lookingAt=e&&"lookAt"in e&&e.lookAt instanceof c?e.lookAt:null;m(this);k(this);l(this,this.view);Model.call(this,e)}function h(a){a.lookingAt&&a.lookingAt.spaceClear(c.CAMERA,a.view,a)}function k(a){a.lookingAt&&a.lookingAt.spaceInsert(c.CAMERA,a.view,a)}function m(a){var b=a.view,c=a.zoom,d=b.w=e(a.width/c),c=b.h=e(a.height/
c);b.x=e(a.x-d/2);b.y=e(a.y-c/2)}function l(a,b){var d=a.lookingAt;if(d)for(var d=d.search(b,c.MEDIA),e=0;e<d.length;e++)d[e].calculateRenderBalance()}Engine.Camera=g;Class.extend(g,Model);g.property({volume:1,lookingAt:null,view:null,x:0,y:0,zoom:1,parent:null,left:0,top:0,width:0,height:0,fullscreen:!0});g.method({setOffset:function(a,b){a=parseInt(a)||0;b=parseInt(b)||0;if(this.left===a&&this.top===b)return!1;this.left=a;this.top=b;return!0},setVolume:function(c){c=a(0,b(parseFloat(c)||0,1));if(c===
this.volume)return!1;this.volume=c;l(this,this.view);return!0},lookAt:function(a){a=a instanceof c?a:null;if(this.lookingAt===a)return!1;this.lookingAt instanceof c&&(h(this),l(this,this.view));this.lookingAt=a;this.lookingAt instanceof c&&(k(this),l(this,this.view));return!0},setFullscreen:function(a){a=Boolean(a);if(this.fullscreen==a)return!1;if(this.fullscreen=a)a=this.parent,this.setSize(a.width,a.height);return!0},setZoom:function(c){c=a(0,b(parseFloat(c)||0,Infinity));if(this.zoom===c)return!1;
this.zoom=c;c=this.view;var d=c.clone();h(this);m(this);k(this);l(this,d);l(this,c);return!0},setSize:function(b,c){b=a(0,parseInt(b)||0);c=a(0,parseInt(c)||0);if(this.width===b&&this.height===c)return!1;this.width=b;this.height=c;var d=this.view,e=d.clone();h(this);m(this);k(this);l(this,e);l(this,d);this.trigger("resize",b,c);return!0},moveTo:function(a,b){a=parseFloat(a)||0;b=parseFloat(b)||0;if(this.x===a&&this.y===b)return!1;this.x=a;this.y=b;var c=this.view,d=c.clone();h(this);m(this);k(this);
l(this,d);l(this,c);this.trigger("move",a,b);return!0},moveBy:function(a,b){a=parseFloat(a)||0;b=parseFloat(b)||0;return this.moveTo(this.x+a,this.y+b)},projectX:function(a){a=parseInt(a)||0;return(a-this.view.x)*this.zoom},projectY:function(a){a=parseInt(a)||0;return(a-this.view.y)*this.zoom},toSceneX:function(a){a=parseInt(a)||0;return a/this.zoom+this.view.x},toSceneY:function(a){a=parseInt(a)||0;return a/this.zoom+this.view.y}});return g}(Engine.Box,Engine.Scene,Math.min,Math.max,Math.round,Math.abs);(function(d){var c=Engine.Renderer=new Model;c.createContext=function(){return d.createElement("canvas").getContext("2d")};c.ctx=c.createContext()})(document);(function(d){d.decorate("initialize",function(c){this.div=this.id&&document.getElementById(this.id)||document.createElement("div");this.div.setAttribute("style",["width : "+this.width+"px","height : "+this.height+"px","background : "+this.background,"position : relative;margin : 0px;padding : 0px;overflow : hidden"].join(";"));this._super(c)});d.decorate("setSize",function(c,b){if(!this._super(c,b))return!1;var a=this.div.style;a.width=this.width+"px";a.height=this.height+"px";return!0});d.decorate("setBackground",
function(c){if(!this._super(c))return!1;this.div.style.background=this.background;return!0});d.decorate("addCamera",function(c){if(!this._super(c))return!1;this.div.appendChild(c.div);return!0});d.decorate("removeCamera",function(c){if(!this._super(c))return!1;this.div.removeChild(c.div);return!0})})(Engine.Viewport);(function(d,c,b,a,e,f,g,h,k){function m(a,b){for(var c=a.length;0<c--;){var d=a[c];if(d.overlap(b))return b.bound(d),p.push(a[c]),a.splice(c,1),m(a,b)}a.push(b);return a}function l(b,c,e,f,g){var h=p.pop();h?a.call(h,c,e,f,g):h=new a(c,e,f,g);m(b.stack,h);r.add(b);d.request()}function n(b,c,d,f,g,m,n,p,q){if(a.overlap(c,d,f,g,m,n,p,q)){var r=b.canvas,s=h.width=r.width,D=h.height=r.height;s&&D&&k.drawImage(r,0,0);r.width=p;r.height=q;h.width&&h.height&&b.ctx.drawImage(h,c-m,d-n)}var r=c+f,s=d+g,D=
m+p,C=n+q;m<c&&l(b,m,d,e(c-m,p),g);D>r&&l(b,r,d,e(D-(c-f),p),g);n<d&&l(b,m,n,p,e(d-n,q));C>s&&l(b,m,s,p,e(C-s,q))}var p=[];c.property({debug:!1,translateX:0,translateY:0});c.decorate("initialize",function(a){this._super(a);this.stack=[];this.canvas=document.createElement("canvas");this.canvas.setAttribute("style","width:100%;height:100%;");this.canvas.width=this.view.w;this.canvas.height=this.view.h;this.ctx=this.canvas.getContext("2d");this.div=document.createElement("div");this.div.setAttribute("style",
"position:absolute;left:"+this.left+"px;top:"+this.top+"px;width:"+this.width+"px;height:"+this.height+"px;overflow:hidden;");this.div.appendChild(this.canvas);a=this.renderview=this.view.clone();l(this,a.x,a.y,a.w,a.h)});c.decorate("setOffset",function(a,b){if(!this._super(a,b))return!1;var c=this.div.style;c.left=this.left+"px";c.top=this.top+"px";return!0});c.decorate("lookAt",function(a){if(!this._super(a))return!1;a=this.renderview;l(this,a.x,a.y,a.w,a.h);return!0});c.decorate("moveTo",function(a,
b){var c=this.x,d=this.y;if(this._super(a,b)||this.translateX||this.translateY){if(this._isScrolled){var e=this.zoom,c=parseFloat((this.x-c)*e)||0,d=parseFloat((this.y-d)*e)||0;q(this,this.translateX-c,this.translateY-d)}else{q(this,0,0);var d=this.renderview,e=d.x,c=d.y,f=d.w,g=d.h;d.copy(this.view);n(this,e,c,f,g,d.x,d.y,f,g)}return!0}return!1});c.decorate("setSize",function(a,b){if(!this._super(a,b))return!1;var c=this.renderview,d=c.x,e=c.y,f=c.w,g=c.h;c.copy(this.view);n(this,d,e,f,g,c.x,c.y,
c.w,c.h);c=this.div.style;c.width=this.width+"px";c.height=this.height+"px";return!0});c.decorate("setZoom",function(a){if(this._super(a)){a=this.renderview;var b=a.x,c=a.y,d=a.w,e=a.h;a.copy(this.view);n(this,b,c,d,e,a.x,a.y,a.w,a.h);return!0}return!1});c.method("redraw",function(a){l(this,a.x,a.y,a.w,a.h)});var q=function(){var a="transform",b="translate({x}px,{y}px)";(function(c){var d=document.createElement("div"),e;for(e in c)if("string"===typeof d.style[e])return a=e,b=c[e],!0})({"-webkit-transform":"translate3d({0}px,{1}px,0px)",
"-moz-transform":"translate3d({0}px,{1}px,0px)","-o-transform":"translate({0}px,{1}px)","-ms-transform":"translate({0}px,{1}px)",transform:"translate({0}px,{1}px)"});return function(c,d,e){d=parseFloat(d)||0;e=parseFloat(e)||0;if(c.translateX===d&&c.translateY===e)return!1;c.translateX=d;c.translateY=e;c.canvas.style[a]=b.replace("{0}",g(d)).replace("{1}",g(e));return!0}}(),r=[];d.on(d.REFLOW,function(){if(r.length)for(var a=null,c=null;r.length;)for(a=r.shift(),c=a.stack;c.length;){var d=a,e=c.shift(),
f=d.lookingAt instanceof b?d.lookingAt:null;if(f){var g=e.x,h=e.y,k=e.w,m=e.h;if(k&&m){var l=d.ctx,n=f.search(e),q=n.length,C=d.renderview;p.push(e);q&&f.sort(n);l.save();l.translate(-C.x,-C.y);l.clearRect(g,h,k,m);l.beginPath();l.rect(g,h,k,m);l.clip();f.render(l);for(l.closePath();q--;)e=n[q],e.opacity&&(f=e.global,l.save(),l.transform(f.m11,f.m21,f.m12,f.m22,f.m13,f.m23),l.beginPath(),l.rect(e.left,e.top,e.width,e.height),l.clip(),l.closePath(),l.globalAlpha=e.opacity,e.render(l),l.restore());
d.debug&&(l.fillStyle="rgba({}, {}, {}, {})".format(255*Math.random()|0,255*Math.random()|0,255*Math.random()|0,0.2),l.fillRect(g,h,k,m));l.restore()}}}})})(Engine.Loop,Engine.Camera,Engine.Scene,Engine.Box,Math.min,Math.max,Math.round,Engine.Renderer.ctx.canvas,Engine.Renderer.ctx);Engine.Renderer.Cache=function(d,c){function b(a,b,c){var f=new d;f.addEventListener("load",e);f.addEventListener("error",g);f.addEventListener("load",b);f.addEventListener("error",c);f.src=a;return f}function a(){e.call(this);var b=this.src;if(b=k.hasOwnProperty(b)?k[b]:null)for(var c=0,d=b.length;c<d;c++)b[c].trigger("load");this.removeEventListener("load",a);this.removeEventListener("error",f)}function e(){var a=this.src,a=h.hasOwnProperty(a)?h[a]:h[a]=document.createElement("canvas");a.width=
this.width;a.height=this.height;a.getContext("2d").drawImage(this,0,0)}function f(){g.call(this);var b=this.src;if(b=k.hasOwnProperty(b)?k[b]:null)for(var c=0,d=b.length;c<d;c++)b[c].trigger("error");this.removeEventListener("load",a);this.removeEventListener("error",f)}function g(){var a=this.src,a=h.hasOwnProperty(a)?h[a]:h[a]=document.createElement("canvas");a.width=0;a.height=0}var h={},k={};return{get:function(a){a=String(a);return h.hasOwnProperty(a)?h[a]:null},load:function(a,c,d){a=String(a);
if(""===a)return!1;var e=h.hasOwnProperty(a)?h[a]:null;if(e)return e;c=b(a,c,d);k[c.src]=k[a];return h[a]=h[c.src]=document.createElement("canvas")},set:function(a,b){a=String(a);if(""===a)return!1;var d=h.hasOwnProperty(a)?h[a]:h[a]=c.createElement("canvas");d.width=b.width;d.height=b.height;d.getContext("2d").drawImage(b,0,0);if(d=k.hasOwnProperty(a)?k[a]:null)for(var e=0,f=d.length;e<f;e++)d[e].trigger("load")},bind:function(c,d){c=String(c);if(""===c)return!1;(k.hasOwnProperty(c)?k[c]:k[c]=[]).add(d);
var e=h.hasOwnProperty(c)?h[c]:null;e||(e=b(c,a,f),k[e.src]=k[c],e=h[c]=h[e.src]=document.createElement("canvas"),e.width=e.height=0);e.width&&e.height&&d.trigger("load")},unbind:function(a,b){a=String(a);if(""===a)return!1;var c=k.hasOwnProperty(a)?k[a]:null;c&&c.remove(b);return!0},create:b}}(Image,document);Engine.Font.PATH="fonts/";(function(d,c,b,a,e,f,g){var h=d.ctx,k=h.canvas;c.prototype.debug=!1;c.prototype.render=function(a,b,c,d,e){this.debug&&(a.fillStyle="rgba({}, {}, {}, {})".format(255*f()|0,255*f()|0,255*f()|0,0.2),a.fillRect(this.left,this.top,this.width,this.height))};c.prototype.redraw=function(a,b,d,e){arguments.length?(a=parseInt(a)||0,b=parseInt(b)||0,d=g(0,parseInt(d)||0),e=g(0,parseInt(e)||0),m(this,c.toBB(this.left+a,this.top+b,this.left+a+d,this.top+b+e,this.global))):m(this,this.bb)};c.prototype.getPixel=
function(a,b,c){h.save();k.width=1;k.height=1;h.translate(-a,-b);this.render(h,a,b,1,1);h.restore();a=h.getImageData(0,0,1,1).data;c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c};var m=d.updateDirtyRectangle=function(b,c){if(!b.types.has(a.GEOMETRY)||!1===b.root instanceof a)return!1;for(var d=b.root.search(c,a.CAMERA),e=d.length;e--;)d[e].redraw(c)}})(Engine.Renderer,Engine.Geometry,Engine.Box,Engine.Scene,Engine.Camera,Math.random,Math.max);(function(d,c,b,a){function e(c){c._pattern=null;var d=c.image;d instanceof a.Image&&b.Cache.unbind(d.src,c)}function f(c){var d=c.image;if(d instanceof a.Image)c instanceof Model||(c=c._image=new Engine.Image({src:d.src})),b.Cache.bind(d.src,c);else if(d instanceof a.Gradient){var e=d.from,f=d.to,l=d.steps;switch(d.type){case "radial":c=c._pattern=b.ctx.createRadialGradient(e.x,e.y,e.r,f.x,f.y,f.r);break;default:c=c._pattern=b.ctx.createLinearGradient(e.x,e.y,f.x,f.y)}d=0;for(e=l.length;d<e;d++)f=
l[d],c.addColorStop(f.stop,f.color)}}d.property({_pattern:null,onload:function(){this._pattern=b.ctx.createPattern(b.Cache.get(this.image.src),this.repeat);this.redraw();return!0}});d.decorate({initialize:function(a){this._super(a);f(this)},setFill:function(a){e(this);this._super(a);f(this)},setImage:function(a){e(this);this._super(a);f(this)},setRepeat:function(a){e(this);this._super(a);f(this)},clearBB:function(a){if(!this._super(a))return!1;b.updateDirtyRectangle(this,this.bb);return!0},insertBB:function(a){if(!this._super(a))return!1;
b.updateDirtyRectangle(this,this.bb);return!0}});b.parseFill=function(a){e(a);f(a)};c.property({_pattern:null,onload:function(){this._pattern=b.ctx.createPattern(b.Cache.get(this.image.src),this.repeat);this.redraw();return!0}});c.decorate({initialize:function(a){this._super(a);f(this)},setFill:function(a){e(this);this._super(a);f(this)},setImage:function(a){e(this);this._super(a);f(this)},setRepeat:function(a){e(this);this._super(a);f(this)},redraw:function(){for(var a=this.search(null,c.CAMERA),
b=0,d=a.length;b<d;b++)a[b].redraw(a[b].view)}});c.method({render:function(a){this.color&&(a.save(),a.fillStyle=this.color+"",a.fill(),a.restore());this._pattern&&(a.save(),a.fillStyle=this._pattern,a.fill(),a.restore())}})})(Engine.Geometry.Shape,Engine.Node.Scene,Engine.Renderer,Engine.Fill);(function(d,c){d.decorate({render:function(b){b.translate(this.left,this.top);b.fillStyle=String(this.color);b.fillRect(0,0,this.width,this.height);var a=this.offsetX,c=this.offsetY;b.translate(a,c);b.fillStyle=this._pattern;b.fillRect(-a,-c,this.width,this.height);b.translate(-a,-c);b.strokeStyle=String(this.stroke);b.strokeRect(1,1,this.width-2,this.height-2);b.translate(-this.left,-this.top);this._super(b)}})})(Engine.Geometry.Rectangle,Engine.Renderer.updateDirtyRectangle);(function(d){d.decorate("render",function(c){var b=this.points;if(!b||2>b.length)return!1;c.save();c.beginPath();c.moveTo.apply(c,b[0]);for(var a=1,d=b.length;a<d;a++)c.lineTo.apply(c,b[a]);c.lineTo.apply(c,b[0]);c.closePath();c.fillStyle=String(this.color);c.fill();c.fillStyle=this._pattern;c.fill();c.strokeStyle=String(this.stroke);c.stroke();c.restore();this._super(c)})})(Engine.Geometry.Polygon);(function(d){d.decorate({render:function(c){var b=this.left,a=this.top,d=this.originX-b,f=this.originY-a,g=this.radiusX-1,h=this.radiusY-1,k=0.5522848*g,m=0.5522848*h,l=d+g,n=f+h,g=d-g,h=f-h;c.save();c.translate(b,a);c.beginPath();c.moveTo(g,f);c.bezierCurveTo(g,f-m,d-k,h,d,h);c.bezierCurveTo(d+k,h,l,f-m,l,f);c.bezierCurveTo(l,f+m,d+k,n,d,n);c.bezierCurveTo(d-k,n,g,f+m,g,f);c.closePath();c.clip();c.fillStyle=String(this.color);c.fill();k=this.offsetX;m=this.offsetY;c.translate(k,m);c.fillStyle=this._pattern;
c.fillRect(-k,-m,this.width,this.height);c.translate(-k,-m);c.restore();c.strokeStyle=String(this.stroke);c.stroke();this._super(c)}})})(Engine.Geometry.Oval);(function(d,c,b,a,e,f){function g(c){var f=d.getFont(c.font,c.textColor);if(!f.ready)return c.setBounds(0,0,0,0);for(var g=f.base,l=f.response,f=l.pages,m=l.common,p=l.chars,w=l.kernings,t=c.paddingLeft,x=c.paddingTop,z=c.paddingRight,s=c.paddingBottom,D=c.spacing,C=c.lineHeight===d.AUTO?parseInt(m.lineHeight):c.lineHeight,E=c.textAlign,O=c.minWidth,M=c.minHeight,H=c.maxWidth,Q=c.maxHeight,m=E!==d.PRE?String(c.text).trim().replace(q,h):String(c.text),K=E!==d.PRE?m.match(q)||[]:[m],F=t,L=x,m=t,l=x,
I=[],J=null,P=0;P<K.length;P++)switch(J=J||[],!0){case K[P]===n:F=t;L+=C;break;default:var N=new k(K[P],p,w,D,C,E===d.PRE?H:Infinity),R=N.x,T=N.y,S=N.w,U=N.h;0<P&&F+R+S>t+H&&(I.add(J),J=[],F=t,L+=C);if(!J.length&&r.test(N.text))continue;N.ox=F;N.oy=L;J.push(N);m=e(t+O+z,a(e(m,F+R+S+z),t+H+z));l=e(t+M+z,a(e(l,L+T+U+s),x+Q+s));F+=R+S;I.add(J)}if(E!==d.PRE)for(p=m,w=0;w<I.length;w++)switch(t=I[w],t.length&&(r.test(t.first().text)&&t.shift(),t.length&&r.test(t.last().text)&&t.pop()),E){case d.RIGHT:x=
t.last();s=p-z;x=s-(x.ox+x.x+x.w);for(s=0;s<t.length;s++)t[s].ox+=x;break;case d.CENTER:x=t.last();s=p-z;x=(s-(x.ox+x.x+x.w))/2;for(s=0;s<t.length;s++)t[s].ox+=x;break;case d.JUSTIFY:if(w===I.length-1)break;x=t.last();s=p-z;x=s-(x.ox+x.x+x.w);for(s=1;s<t.length;s++)t[s].ox+=parseInt(x*(s/(t.length-1)))}z=c._canvas;z.width=m;z.height=l;z=c._ctx;for(E=0;E<I.length;E++)for(p=I[E],w=0;w<p.length;w++)for(t=p[w],x=t.ox,s=t.oy,D=0;D<t.length;D++)F=t[D],C=b.get(g+f[F.page].file),O=x+F.dx,M=s+F.dy,H=F.sx,
Q=F.sy,K=F.sw,F=F.sh,K&&F&&z.drawImage(C,H,Q,K,F,O,M,K,F);c.setSize(m,l)||c.redraw()}function h(a){switch(!0){case a===n:return n;case r.test(a):return l;default:return a}}function k(b,c,d,g,h,k){this.length=this.oy=this.ox=0;this.text=b;var l=0,q=0,r=0,z=0,s=0,D=0,C=0;b=b.split("");for(var E=0,O=b.length;E<O;E++)switch(!0){case b[E]===n:s=0;D+=h;l=a(s,l);q=a(D,q);r=e(r,s);z=e(z,D+h);break;default:var M=b[E].charCodeAt(0),H=c[M]||c[p],Q=parseInt(H.x),K=parseInt(H.y),F=parseInt(H.width),L=parseInt(H.height),
I=parseInt(H.xoffset),J=parseInt(H.yoffset),P=parseInt(H.xadvance),H=parseInt(H.page),C=parseInt(d[[C,M]])||0;s+I+F>k?(s=I,D+=h):s+=I;l=a(s,l);q=a(D,q);r=e(r,s+F);z=e(z,D+J+L);f.call(this,new m(s,D+J,Q,K,F,L,H));s+=P;s+=C;s+=g;C=M}this.x=l;this.y=q;this.w=r-l;this.h=z-q}function m(a,b,c,d,e,f,g){this.dx=a;this.dy=b;this.sx=c;this.sy=d;this.sw=e;this.sh=f;this.page=g}var l=" ",n="\n",p=l.charCodeAt(0);d.property("on"+d.READY,function(){g(this)});d.decorate({initialize:function(a){this._ctx=c.createContext();
this._canvas=this._ctx.canvas;var b=d.getFont(this.font,this.textColor);b&&(b.ready?this.trigger(d.READY):this.subscribe(b,d.READY));this._super(a)},setFont:function(a){var b=d.getFont(this.font,this.textColor);if(!this._super(a))return!1;this.unsubscribe(b,d.READY);(a=d.getFont(this.font,this.textColor))&&(a.ready?this.trigger(d.READY):this.subscribe(a,d.READY));return!0},setTextColor:function(a){var b=d.getFont(this.font,this.textColor);if(!this._super(a))return!1;this.unsubscribe(b,d.READY);(a=
d.getFont(this.font,this.textColor))&&(a.ready?this.trigger(d.READY):this.subscribe(a,d.READY));return!0},setText:function(a){if(!this._super(a))return!1;g(this);return!0},setSpacing:function(a){if(!this._super(a))return!1;g(this);return!0},setLineHeight:function(a){if(!this._super(a))return!1;g(this);return!0},setTextAlign:function(a){if(!this._super(a))return!1;g(this);return!0},setPadding:function(a,b,c,d){if(!this._super(a,b,c,d))return!1;g(this);return!0},setMinWidth:function(a){if(!this._super(a))return!1;
g(this);return!0},setMinHeight:function(a){if(!this._super(a))return!1;g(this);return!0},setMaxWidth:function(a){if(!this._super(a))return!1;g(this);return!0},setMaxHeight:function(a){if(!this._super(a))return!1;g(this);return!0},render:function(a){a.translate(this.left,this.top);a.fillStyle=String(this.color);a.fillRect(0,0,this.width,this.height);var b=this.offsetX,c=this.offsetY;a.translate(b,c);a.fillStyle=this._pattern;a.fillRect(-b,-c,this.width,this.height);a.translate(-b,-c);b=this._canvas;
b.width&&b.height&&a.drawImage(b,0,0);a.strokeStyle=String(this.stroke);a.strokeRect(1,1,this.width-2,this.height-2);a.translate(-this.left,-this.top);this._super(a)},setSize:function(a,b){if(!this._super(a,b))return!1;this.redraw();return!0}});var q=/(\n|\s+|\S+)/g,r=/^\s+$/})(Engine.Geometry.Shape.Text,Engine.Renderer,Engine.Renderer.Cache,Math.min,Math.max,Array.prototype.push);(function(d,c,b,a){function e(a){c.call(this,{src:a});this.ready=!1;this.base=String(this.src).replace(k,"");this.pages=[]}function f(a){for(var b={},c=0,d=a.length;c<d;c++){var e=a[c];b[e.id]=e}return b}function g(a){for(var b={},c=0,d=a.length;c<d;c++){var e=a[c];b[[e.first,e.second]]=e.amount}return b}var h={},k=/[^\/]+$/;Class.extend(e,c);e.method({onload:function(a){function c(){if(0<--r)return!1;e.ready=!0;e.trigger(d.READY);return!0}var e=this,h=a.pages,k=this.base,r=h.length;a.chars=f(a.chars["char"]);
a.kernings=a.kernings?g(a.kernings.kerning||[]):{};this._super(a);for(a=0;a<h.length;a++)(function(a){a=k+a.file;if(b.get(a))return c();b.load(a,c)})(h[a])}});d.getFont=function(b,c){var d=a.PATH+"{}/{}/{}/{}/{}".format(b.family,b.weight,b.style,c,b.size)+".json";return""===d?null:h.hasOwnProperty(d)?h[d]:h[d]=new e(d)}})(Engine.Geometry.Shape.Text,Engine.Network.Resource,Engine.Renderer.Cache,Engine.Font);(function(d,c,b,a){d.property({onload:function(){this.complete=!0;var a=this.canvas=c.Cache.get(this.src);a?this.setSize(a.width,a.height):this.setSize(0,0)}});d.decorate({initialize:function(){this.canvas=null;var a=this.src;a&&c.Cache.bind(a,this)},setSrc:function(a){var b=this.src;if(!this._super(a))return!1;a=this.src;b&&c.Cache.unbind(b,this);this.canvas=null;a&&c.Cache.bind(a,this);return!0},render:function(a){var b=this.canvas;b&&b.width&&b.height&&a.drawImage(b,this.left,this.top);this._super(a)},
setBounds:function(a,b,c,d){return this._super(a,b,c,d)?!0:!1},clearBB:function(a){if(!this._super(a))return!1;b(this,this.bb);return!0},insertBB:function(a){if(!this._super(a))return!1;b(this,this.bb);return!0}})})(Engine.Image,Engine.Renderer,Engine.Renderer.updateDirtyRectangle,Engine.Geometry);(function(d,c,b,a,e){c.property({onload:function(){this.complete=!0;this.canvas=d.Cache.get(this.src);this.redraw()}});var f=b.prototype.render;c.decorate("render",function(b){var c=this.canvas;if(!c)return!1;var d=c.width,m=c.height;if(!d||!m)return!1;var l=this.offsetx,n=this.offsety,p=a(e(0,-l),d),q=a(e(0,-n),m),d=a(e(0,-l+this.width),d)-p,m=a(e(0,-n+this.height),m)-q;d&&m&&b.drawImage(c,p,q,d,m,this.left+p+l,this.top+q+n,d,m);f.call(this,b)})})(Engine.Renderer,Engine.Image.Sprite,Engine.Geometry,
Math.min,Math.max);(function(d){function c(a){}var b={loadstart:c,progress:c,suspend:c,stalled:c,durationchange:c,loadedmetadata:c,canplay:c,canplaythrough:c,play:c,playing:function(a){this.playing=!0},seeking:c,seeked:function(a){this.redraw(0,0,this.width,this.height)},loadend:c,timeout:c,emptied:c,pause:function(a){this.playing=!1},stop:c,loadeddata:function(a){switch(this.autosize){case d.AUTO:this.setSize(this.video.videoWidth,this.video.videoHeight)}},waiting:c,timeupdate:function(a){this.redraw(0,0,this.width,
this.height)},ended:function(a){this.playing=!1},ratechange:c,volumechange:c};d.decorate("setSrc",function(a){this.video&&(this.video.pause(),delete this.video,this.setSize(0,0));this._super(a);this.video=document.createElement("video");this.video.loop=this.loop;this.video.src=this.src;for(var c in b)this.video.on(c,b[c].bind(this))});d.prototype.play=function(){this.video&&(this.video.volume=this.globalVolume,this.video.play())};d.prototype.pause=function(){this.video&&this.video.pause()};d.prototype.stop=
function(){this.video&&(this.video.pause(),this.video.currentTime=0)};d.decorate("render",function(a){this.video&&a.drawImage(this.video,0,0,this.video.videoWidth,this.video.videoHeight,this.left,this.top,this.width,this.height);this._super(a)})})(Engine.Geometry.Media.Video);(function(d,c,b,a,e){function f(c){c=this.self;if(!c.pending||this instanceof b&&this.readyState!==l)return!1;var f=parseInt(this.status)||200;switch(!0){case n.test(f):try{var g=d.parse(c,this)}catch(h){c.trigger(d.ERROR,new e(h.message));break}c.trigger(d.LOAD,g);break;case p.test(f):c.trigger(d.ERROR,new a(f))}}function g(a){this.self.trigger(d.PROGRESS,a?a.position||a.loaded:1,a?a.totalSize||a.total:1)}function h(a){this.self.trigger(d.ERROR,a)}function k(a){this.self.trigger(d.ABORT)}var m=d.XHR=
"_xhr",l=4,n=/^[23]\d+$/,p=/^[45]\d+$/;d.property(m,null);d.decorate("load",function(){if(!this._super())return!1;var a=this[m]=d.transport(this);a.self=this;a.onload=f;a.onreadystatechange=f;a.onerror=h;a.onprogress=g;a.onabort=k;var b=this.method,e=this.src,l={};switch(b){case d.GET:var n=e.indexOf("?"),p=e.indexOf("#"),n=~n?n+1:e.length,p=~p?p:e.length,l=c.fromQuery(e.slice(n,p).split("&")),l=c.toQuery(Object.merge(l,this.data)),e=e.slice(0,n)+l+e.slice(p);break;case d.POST:l=c.toQuery(this.data)}a.open(b,
e,!0);d.prepare(this,a);a.send(l);return!0});d.decorate("abort",function(){if(!this._super())return!1;this[m]&&this[m].abort();return!0})}).call(this,Engine.Network.Resource,Engine.Network.Url,global.XMLHttpRequest||Engine.NOP,Engine.Network.Resource.Error.Request,Engine.Network.Resource.Error.Parse);(function(d,c,b,a){var e="Internet Explorer"===b.navigator.browser.name,f=parseInt(b.navigator.browser.version),g=c.parse(a);d.transport=function(a){a=c.parse(a.src);return e&&10>f&&a.host&&a.host!==g.host?new XDomainRequest:new XMLHttpRequest}})(Engine.Network.Resource,Engine.Network.Url,Engine.Device,global.location);(function(d,c,b){var a={};a[d.TEXT]="text";a[d.JSON]="json";a[d.DATA]="arraybuffer";a[d.AUTO]="";d.prepare=function(b,f){switch(!0){case f instanceof c:var g=b.headers;if(f.setRequestHeader){if(g)for(var h in g)f.setRequestHeader(h,g[h]);b.method===d.POST&&f.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")}f.responseType=a[b.type]||a[d.AUTO]}}})(Engine.Network.Resource,global.XMLHttpRequest||Engine.NOP,global.XDomainRequest||Engine.NOP);(function(d,c,b,a){function e(a){return"function"===typeof h&&a.response instanceof h?new Uint8Array(a.response):g&&a instanceof XMLHttpRequest?(new VBArray(a.responseBody)).toArray():a.responseText.toByteArray()}function f(a){a=a.response||a.responseText;return"object"===typeof a?a:JSON.parse(a)}var g="Internet Explorer"===c.navigator.browser.name,h=b.ArrayBuffer,k=/text/,m=/json/;d.parse=function(b,c){switch(b.type){case d.DATA:return e(c);case d.JSON:return f(c);case d.TEXT:return c.responseText;
case d.AUTO:var g=String(c instanceof a?c.contentType:c.getResponseHeader("Content-type"));return k.test(g)?c.responseText:m.test(g)?f(c):e(c)}}})(Engine.Network.Resource,Engine.Device,global,global.XDomainRequest||Engine.NOP);(function(d){function c(){this.trigger("open")}function b(a){this.trigger("message",a)}function a(){this.trigger("error")}function e(){this.trigger("close")}d.prototype.sock=null;d.decorate({connect:function(d){if(this.sock)return!1;this.sock=new SockJS(this.src,null,d);this.sock.onopen=c.bind(this);this.sock.onmessage=b.bind(this);this.sock.onclose=e.bind(this);this.sock.onerror=a.bind(this);return!0},send:function(a){this.sock.send(a)},close:function(){this.sock.close();delete this.sock.onopen;
delete this.sock.onmessage;delete this.sock.onclose;delete this.sock.onerror;delete this.sock}})})(Engine.Network.Socket);Engine.I18n=function(d,c,b){var a=null,e={},f={tr:function(){return(a?a.tr:f.Translator.prototype.tr).apply(null,arguments)},changeLang:function(a){a=null!==a?f.getTranslator(a):null;return f.setDefaultTranslator(a)},setDefaultTranslator:function(b){if(null===b)return a=null;if(!(b instanceof f.Translator))throw new d.Type;if(!f.getTranslator(b.code))throw new d.Reference("Engine.I18n.setDefaultTranslator: specified "+b.code+" language translator doesn't exist; Create it using `Engine.I18n.translatorFactory()` method.");
a=b},translatorFactory:function(){b.call(arguments,null);var a=new (c.apply(f.Translator,arguments)),d=f.getTranslator(a.code);if(d)return Object.merge(d,a),Engine.log("Engine.I18n: translator for "+d.code+" language already exists; Before created translator has been overridden.",Engine.WARN),d;f.registerTranslator(a);return a},getTranslator:function(a){return e[a+""]},getDefaultTranslator:function(){return a},registerTranslator:function(b){if(!(b instanceof f.Translator))throw new d.Type;if(f.getTranslator(b.code))throw new d.Reference;
e[b.code]=b;a||f.setDefaultTranslator(b)},unregisterTranslator:function(b){if(!(b instanceof f.Translator))throw new d.Type;if(!f.getTranslator(b.code))throw new d.Reference;e[b.code]=null;a===b&&f.setDefaultTranslator(null)}};return f}(Engine.Error,Function.prototype.bind,Array.prototype.unshift);Engine.I18n.Translator=function(d,c,b,a,e){function f(a,b,d){var e=Object(a);"object"!==typeof a&&(e={code:a,rules:b,strings:d});Model.call(this,e);if(!h.test(this.code+""))throw new c.Type("Engine.I18n.Translator: language code is invalid");b=this.rules;this.rules=null;if(!this.setRules(b))throw new c.Type("Engine.I18n.Translator: specified `rules` has to be an array of functions");d=this.strings;this.strings=null;if(!this.setStrings(d))throw new c.Type("Engine.I18n.Translator: `strings` has to be an object");
this.tr=this.tr.bind(this)}function g(a){return"function"===typeof a&&"boolean"===typeof a(0)}Class.extend(f,Model);f.DEFAULT_CONTEXT="";var h=/^[a-z]{2}_[A-Z]{2}$/;f.property({code:"",rules:null,strings:null,defaultContext:f.DEFAULT_CONTEXT});f.parseRulesFromJSON=function(a){if("string"===typeof a)try{a=JSON.parse(a)}catch(d){throw new c.Type("Engine.I18n.Translator.parseRulesFromJSON: specified `rules` can't be parsed from JSON");}if(!b(a)||!a.every(e))throw new c.Type("Engine.I18n.Translator.parseRulesFromJSON: array of strings expected");
for(var f=0,g=a.length;f<g;f++){var h=a[f],q=new Function("n","return "+h+";");try{eval("funcEval = "+q),(void 0)(0)}catch(r){throw new c.Type("Engine.I18n.Translator.parseRulesFromJSON: "+f+" element of `rules` ("+h+") can't be parsed into function");}if("boolean"!==typeof q(0))throw new c.Type("Engine.I18n.Translator.parseRulesFromJSON: element index "+f+" of `rules` ("+h+") doesn't return boolean value");a[f]=q}return a};f.method({setRules:function(c){if(this.rules===c||!b(c)||!c.every(a)||!c.every(g))return!1;
this.rules=c;return!0},setStrings:function(a){if(this.strings===a||"object"!==typeof a||b(a))return!1;this.strings=a;return!0},tr:function(){return function(a,d,e,g){var h=Object(this);if("undefined"===typeof a)throw new c.Type("Engine.I18n.Translator::tr: Nothing to translate");if(null!=d&&"string"!==typeof d)throw new c.Type("Engine.I18n.Translator::tr: disambiguation is not a string");if(null!=e&&("number"!==typeof e||!isFinite(e)))throw new c.Type("Engine.I18n.Translator::tr: count is not a proper number");
if(null!=g&&"object"!==typeof g)throw new c.Type("Engine.I18n.Translator::tr: format is not an object");a+="";d=d||h.defaultContext||f.DEFAULT_CONTEXT;e=e||0;g=g||null;var q=h.strings&&h.strings[a];if(q)if("object"!==typeof q||b(q)||(q=q[d]),"string"===typeof q)a=q;else{if(d=b(q))if(d=h.rules){a:{h=h.rules;d=e;if(h.length)for(var r=0,u=h.length;r<u;r++)if(h[r](d)){h=r;break a}h=void 0}d=q[h]}a=d||a}a=a.replace("{n}",e);return g?a.format(g):a}}()});return f}(Engine.I18n,Engine.Error,Array.isArray,
Function.isFunction,String.isString);Engine.Input=function(){var d=new Model;d.events={};d.propagateEvent=function(c,b){if(!(c instanceof d.Event))throw new TypeError("Input#propagateEvent: Event to propagate must be a Input#Event instance");if(!b||!b.length||!c.propagate)return c.propagate;for(var a=0,e=b.length,f;a<e;a++)if(f=b[a],c.fire(f),!c.propagate)return f;return c.propagate};return d}();Engine.Input.Event=function(d){function c(b){this.type=b&&"string"===typeof b.type?b.type:this.type;this.propagate=b&&"boolean"===typeof b.propagate?b.propagate:this.propagate;this.prevent=b&&"boolean"===typeof b.prevent?b.prevent:this.prevent;this.defaultAction=b&&"function"===typeof b.defaultAction?b.defaultAction:this.defaultAction;if(!this.type.length)throw new d.Type("Input#Event: type is required");}c.property({type:"",propagate:!0,prevent:!1});c.property("toClone",{propagate:c.prototype.propagate,
prevent:c.prototype.prevent});c.method({stopPropagation:function(){return this.propagate=!1},preventDefault:function(){return this.prevent=!0},defaultAction:Engine.NOP,fire:function(b){if(!(b instanceof Model))return!1;b.queue(this.type,this);!this.prevent&&"function"===typeof this.defaultAction&&this.defaultAction(b)}});return c}(Engine.Error);Engine.Input.Event.Focus=function(d){function c(b){d.call(this,b)}Class.extend(c,d);c.FOCUS="focus";c.BLUR="blur";c.property("propagate",!1);return c}(Engine.Input.Event);Engine.Input.Event.Mouse=function(d,c,b,a,e,f,g,h,k){function m(k){d.call(this,k);this.button=k&&"number"===typeof k.button?k.button:this.button;this.timestamp=k&&"number"===typeof k.timestamp?k.timestamp:this.timestamp;this.x=k&&"number"===typeof k.x?k.x:this.x;this.y=k&&"number"===typeof k.y?k.y:this.y;this.movementX=k&&"number"===typeof k.movementX?k.movementX:this.movementX;this.movementY=k&&"number"===typeof k.movementY?k.movementY:this.movementY;this.viewX=k&&"number"===typeof k.viewX?k.viewX:
this.viewX;this.viewY=k&&"number"===typeof k.viewY?k.viewY:this.viewY;this.cameraX=k&&"number"===typeof k.cameraX?k.cameraX:this.cameraX;this.cameraY=k&&"number"===typeof k.cameraY?k.cameraY:this.cameraY;this.sceneX=k&&"number"===typeof k.sceneX?k.sceneX:this.sceneX;this.sceneY=k&&"number"===typeof k.sceneY?k.sceneY:this.sceneY;this.parent=k&&k.parent instanceof m?k.parent:this.parent;this.viewport=k&&k.viewport instanceof b?k.viewport:this.viewport;this.camera=k&&k.camera instanceof e?k.camera:this.camera;
this.scene=k&&k.scene instanceof a?k.scene:this.scene;this.nodes=k&&h(k.nodes)?k.nodes:this.nodes;this.geometry=k&&k.geometry instanceof f?k.geometry:this.geometry;switch(!0){case this.viewport&&!(this.viewport instanceof b):case this.camera&&!(this.camera instanceof e):case this.scene&&!(this.scene instanceof a):case this.geometry&&!(this.geometry instanceof f):case this.nodes&&!h(this.nodes):case this.parent&&!(this.parent instanceof m):throw new c.Type("Engine.Input.Event.Mouse: invalid config object");
}this.timestamp=g()}Class.extend(m,d);m.BUTTON={LEFT:0,MIDDLE:1,RIGHT:2};m.MOUSEDOWN="mousedown";m.MOUSEUP="mouseup";m.MOUSEMOVE="mousemove";m.property({button:m.BUTTON.LEFT,timestamp:0,x:0,y:0,movementX:0,movementY:0,viewX:0,viewY:0,cameraX:0,cameraY:0,sceneX:0,sceneY:0,parent:null,viewport:null,camera:null,scene:null,nodes:null,geometry:null});m.method({getElements:function(){var a=[];this.geometry&&a.push(this.geometry);this.nodes&&this.nodes.length&&k.apply(a,this.nodes);this.scene&&a.push(this.scene);
return a},getModels:function(){var a=this.getElements();this.camera&&a.push(this.camera);this.viewport&&a.push(this.viewport);return a}});return m}(Engine.Input.Event,Engine.Error,Engine.Viewport,Engine.Scene,Engine.Camera,Engine.Geometry,Engine.now,Array.isArray,Array.prototype.push);Engine.Input.Event.Mouse.Drag=function(d){function c(b){d.call(this,b)}Class.extend(c,d);c.DRAGSTART="dragstart";c.DRAGEND="dragend";c.DRAGMOVE="dragmove";return c}(Engine.Input.Event.Mouse);Engine.Input.Event.Keyboard=function(d,c,b){function a(a){c.call(this,a);this.key=a&&"string"===typeof a.key?a.key:this.key;this.keyCode=a&&"number"===typeof a.keyCode?a.keyCode:this.keyCode;this.text=a&&"string"===typeof a.text?a.text:this.text;this.modifiers=a&&"number"===typeof a.modifiers?a.modifiers:this.modifiers;a=this.keyCode|0;this.key=e[a]||(a?b(a):this.key)}Class.extend(a,c);a.KEYDOWN="keydown";a.KEYPRESS="keypress";a.KEYUP="keyup";a.CTRL_MODIFIER=1;a.ALT_MODIFIER=2;a.SHIFT_MODIFIER=4;
var e=a.SPECIAL_KEY_CODES={8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",17:"CTRL",18:"ALT",19:"PAUSE",20:"CAPS_LOCK",27:"ESC",32:"SPACE",33:"PAGE_UP",34:"PAGE_DOWN",35:"END",36:"HOME",37:"ARROW_LEFT",38:"ARROW_UP",39:"ARROW_RIGHT",40:"ARROW_DOWN",45:"INSERT",46:"DELETE",91:"SUPER_LEFT",92:"SUPER_RIGHT",93:"SELECT",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NUM_LOCK",145:"SCROLL_LOCK"};a.property({key:"",keyCode:0,text:"",modifiers:0});
return a}(Engine.Input,Engine.Input.Event,String.fromCharCode);Engine.Input.Pointer=function(d){var c=new Model;c.viewport=null;c.LOCK="lock";c.UNLOCK="unlock";c.isLocked=function(){return!!c.viewport};c.lock=function(b,a,d){c.viewport===b?(c.trigger(c.LOCK),a()):d();return this};c.unlock=function(b,a){c.viewport?a():(c.trigger(c.UNLOCK),b());return this};c.toggle=function(b,a,d){return c.viewport?c.unlock(a,d):c.lock(b,a,d)};return c}(Engine.Error);(function(d,c){d.events.mouse=[c.MOUSEDOWN,c.MOUSEUP,c.MOUSEMOVE];d.pressed=null;d.DELTA=10;d.on(c.MOUSEDOWN,function(b){this.pressed=b});d.on(c.MOUSEUP,function(b){this.pressed=null});Class.decorate(d,"propagateEvent",function(b,a){b instanceof c&&!a&&(a=b.getModels());return this._super(b,a)})})(Engine.Input,Engine.Input.Event.Mouse);(function(d){d.property({captureTransparent:!0})})(Engine.Camera);(function(d,c,b,a,e){d.dragged=!1;var f=new a(0,0,d.DELTA,d.DELTA),g=new a(0,0,1,1),h=null;d.on(c.MOUSEDOWN,function(a){f.x=a.x-f.w/2;f.y=a.y-f.h/2;if(a.camera)for(var b=a.getModels(),c=b.length,d;c--;)if(d=b[c],d.selectable||d.scrollable)return h=a});d.on(c.MOUSEUP,function(a){h=null;if(d.dragged){var c=e(a);c.type=b.DRAGEND;(new b(c)).fire(d.dragged);d.dragged=null;a.stopPropagation()}});d.on(c.MOUSEMOVE,function(a){if(h||d.dragged){if(d.dragged)return a=e(a),a.type=b.DRAGMOVE,(new b(a)).fire(d.dragged);
g.x=a.x;g.y=a.y;if(!g.overlap(f)){a=[];for(var c=h.getModels(),l=0,n=c.length;l<n;l++)c[l].scrollable&&a.push(c[l]);if(!a.length)return h=null;c=e(h);c.type=b.DRAGSTART;d.dragged=this.propagateEvent(new b(c),a);h=null;if(!(d.dragged instanceof Model))return d.dragged=null}}});Class.decorate(d,"on"+c.MOUSEMOVE,function(a){d.dragged&&a.stopPropagation();this._super(a)})})(Engine.Input,Engine.Input.Event.Mouse,Engine.Input.Event.Mouse.Drag,Engine.Box,Object.clone);(function(d,c,b,a){function e(a){this._isScrolled=!0;a.stopPropagation()}function f(a){this._isScrolled=!1;this.moveTo(this.x,this.y)}function g(a){var b=this.zoom;this.moveBy(-a.movementX/b,-a.movementY/b)}c.decorate("initialize",function(b){this._super&&this._super(b);this.scrollable&&(this.on(a.DRAGSTART,e),this.on(a.DRAGEND,f),this.on(a.DRAGMOVE,g))});c.property({scrollable:!0,_isScrolled:!1})})(Engine.Input,Engine.Camera,Engine.Input.Event.Mouse,Engine.Input.Event.Mouse.Drag);(function(d,c,b){c.MOUSEOVER="mouseover";c.MOUSEOUT="mouseout";c.MOUSEENTER="mouseenter";c.MOUSELEAVE="mouseleave";var a=null;["on"+c.MOUSEDOWN,"on"+c.MOUSEMOVE].forEach(function(e){Class.decorate(d,e,function(d){this._super(d);if(d.propagate){var e=a&&a.getModels().without(d.getModels()),h=d.getModels().without(a&&a.getModels());if(e&&e.length){var k=b(d);k.type=c.MOUSEOUT;this.propagateEvent(new c(k),a.getModels());k=b(a);k.type=c.MOUSELEAVE;this.propagateEvent(new c(k),e)}h&&h.length&&(e=b(d),
e.type=c.MOUSEOVER,this.propagateEvent(new c(e),d.getModels()),e=b(d),e.type=c.MOUSEENTER,this.propagateEvent(new c(e),h));a=d}})})})(Engine.Input,Engine.Input.Event.Mouse,Object.clone);(function(d,c,b){d.events.mouse.push(c.MOUSECLICK="mouseclick");var a=null;d.on(c.MOUSEDOWN,function(b){b.propagate&&(a=b)});d.on(c.MOUSEUP,function(d){d.propagate&&(d=b(d),d.type=c.MOUSECLICK,d.parent=a,(new c(d)).fire(this))})})(Engine.Input,Engine.Input.Event.Mouse,Object.clone);(function(d,c,b){if(!c.MOUSECLICK)throw"Engine.Input: `mousedblclick` requires `mouseclick` event";d.events.mouse.push(c.MOUSEDBLCLICK="mousedblclick");var a=null;d.on(c.MOUSECLICK,function(d){if(!a||500<d.timestamp-a.timestamp)return a=d;d=b(d);d.type=c.MOUSEDBLCLICK;d.parent=a;(new c(d)).fire(this)})})(Engine.Input,Engine.Input.Event.Mouse,Object.clone);(function(d,c,b,a){function e(){f&&clearTimeout(f);k=f=null}d.events.mouse.push(c.MOUSEHOLD="mousehold");var f=0,g=new b(0,0,d.DELTA,d.DELTA),h=new b(0,0,1,1),k=null;d.on(c.MOUSEDOWN,function(b){var d=this;f&&clearTimeout(f);f=setTimeout(function(){if(k){var f=a(k);f.type=c.MOUSEHOLD;f.parent=k!==b&&b;(new c(f)).fire(d)}e()},1E3);g.x=b.x-g.w/2;g.y=b.y-g.h/2;k=b});d.on(c.MOUSEUP,e);d.on(c.MOUSEMOVE,function(a){k&&(k=a,h.x=a.x,h.y=a.y,h.overlap(g)||e())})})(Engine.Input,Engine.Input.Event.Mouse,Engine.Box,
Object.clone);(function(d,c,b,a,e){function f(a,b){return a.parent?a[b]===a.parent[b]:!0}function g(a,b){switch(b){case "viewport":a.viewport=null;case "camera":a.camera=null,a.cameraX=a.cameraY=0;case "scene":a.scene=null,a.sceneX=a.sceneY=0;case "geometry":a.geometry=null;case "nodes":a.nodes=null}}function h(c,d){var k=c.viewport;if(!k||!f(c,"viewport"))return"viewport";if(b.viewport===k)return"camera";k=c.camera=c.camera||k.getCameraByPixel(c.viewX,c.viewY,d);if(!k||!f(c,"camera"))return"camera";c.cameraX=
c.cameraX||c.viewX-k.left;c.cameraY=c.cameraY||c.viewY-k.top;var m=c.scene=c.scene||k.lookingAt;if(!m||!f(c,"scene"))return"scene";c.sceneX=c.sceneX||k.toSceneX(c.cameraX);c.sceneY=c.sceneY||k.toSceneY(c.cameraY);if(!((c.geometry=c.geometry||m.captureGeometryByPixel(c.sceneX,c.sceneY))instanceof e&&f(c,"geometry"))){if(k.captureTransparent)return"geometry";d.push(k);g(c,"camera");return h(c,d)}for(k=c.geometry;k&&(k=k.parent)&&!(k instanceof a);){var l=l||[];l.add(k)}c.nodes=l;if(!l||!l.length)return"nodes"}
function k(a){m.clear();g(a,h(a,m));this._super(a)}var m=[];c=d.events.mouse;for(var l=c.length;l--;)Class.decorate(d,"on"+c[l],k)})(Engine.Input,Engine.Input.Event.Mouse,Engine.Input.Pointer,Engine.Scene,Engine.Geometry);(function(d,c,b,a){if(!a.MOUSECLICK)throw"Engine#Input: broken dependencies for select elements on mouse event";})(Engine.Input,Engine.Scene,Engine.Element,Engine.Input.Event.Mouse);(function(d,c,b){function a(b){return b.root.selected.has(b)?!0:(b=b.children)?b.some(a):!1}function e(b){var c=b.scene;c&&null!==c.multiSelect&&(c=this.children,!this.selectable||this.root.selected.has(this)||c&&c.some(a)||(this.select(),g=b))}function f(a){var b=a.scene;b&&a.parent!==g&&b.multiSelect&&(this.root.selected.has(this)&&this.deselect(),g=null)}var g=null;d.decorate("initialize",function(a){this._super(a);this instanceof c||!this.selectable||(this.on(b.MOUSEDOWN,e),this.on(b.MOUSECLICK,
f))})})(Engine.Element,Engine.Scene,Engine.Input.Event.Mouse);(function(d,c){function b(a){return a instanceof d?!1:a.selectable?!0:(a=a.children)?a.some(b):!1}function a(a){a.propagate&&this.selected.length&&!this.multiSelect&&(a.geometry&&a.getElements().some(b)||this.deselectAll())}d.decorate("initialize",function(b){this._super(b);this.on(c.MOUSECLICK,a)})})(Engine.Scene,Engine.Input.Event.Mouse);(function(d,c,b,a){d.focused=null;d.getFocusedLeaf=function(){for(var a=this;a.focused||a.lookingAt;)a=a.focused||a.lookingAt;return a};d.setFocusOn=function(){var a={type:""};return function(d){if(null!==d&&!(d instanceof c))throw"Input#setFocusOn: viewport to focus must be a viewport";if(this.focused===d)return!0;this.focused&&(a.type=b.BLUR,(new b(a)).fire(this.focused),this.focused=null);d&&(this.focused=d,a.type=b.FOCUS,(new b(a)).fire(d));return!0}}();d.on(a.MOUSEDOWN,function(a){var b=a.camera;
if(b)return b.focus();(b=this.focused)&&b.focused&&b.setFocusOn(null);if(a=a.viewport)return a.focus();this.focused&&this.setFocusOn(null)})})(Engine.Input,Engine.Viewport,Engine.Input.Event.Focus,Engine.Input.Event.Mouse);(function(d,c,b){c.property("focusable",!1);c.method({focus:function(){return this.root instanceof b?this.root.setFocusOn(this):!1},blur:function(){return this.root instanceof b&&this.root.focused===this?this.root.setFocusOn(null):!1}});c.decorate("update",function(){var a=this.root;this._super();a instanceof b&&this.root!==a&&a.focused===this&&a.setFocusOn(null)})})(Engine.Input,Engine.Element,Engine.Scene);(function(d,c,b,a,e){function f(a){do if(a.focusable&&a.root&&a.focus())return!0;while(a=a.parent);return!1}function g(a){if(a.geometry&&(f(a.geometry)||(a=this.captureGeometryByPixel(a.sceneX,a.sceneY,[a.geometry],f))&&this.setFocusOn(a)))return;this.setFocusOn(null)}c.property({focusable:!0,focused:null});c.method({setFocusOn:function(){var c={type:""};return function(d){if(!this.focusable)return!1;if(null!==d){if(!(d.root&&d instanceof b&&d.root===this))return!1;var e=d;do if(!e.focusable)return!1;
while(e=e.parent);if(this.focused===d)return!0;for(var e=this.space.camera.get_tree().nodes,f=e.length,g;e[--f]&&(g=e[f].leaf)&&(!g.parent||g.parent.focused!==g););if(0>f)return!1}this.focused&&(c.type=a.BLUR,(new a(c)).fire(this.focused),this.focused=null);d&&(this.focused=d,c.type=a.FOCUS,(new a(c)).fire(d));return!0}}(),focus:function(){throw"Scene::focus: Can't focus root element";},blur:function(){throw"Scene::focus: Can't blur root element";}});c.decorate("initialize",function(a){this._super(a);
this.on(e.MOUSEDOWN,g)})})(Engine.Input,Engine.Scene,Engine.Element,Engine.Input.Event.Focus,Engine.Input.Event.Mouse);(function(d,c,b,a){b.property("focusable",!0);b.method({focus:function(){return this.parent?this.parent.setFocusOn(this):!1},blur:function(){return this.parent&&this.parent.focused===this?this.parent.setFocusOn(null):!1}});b.method("on"+a.BLUR,function(){this.lookingAt&&this.lookingAt.setFocusOn(null)})})(Engine.Input,Engine.Element,Engine.Camera,Engine.Input.Event.Focus);(function(d,c,b,a){c.decorate("initialize",function(a){this._super(a);!d.focus&&this.focus()});c.property({focusable:!0,focused:null});c.method({setFocusOn:function(){var c={type:""};return function(d){if(!this.focusable||!this.focus())return!1;if(null!==d){if(!(d instanceof b)||d.parent!==this)return!1;if(this.focused===d)return!0}this.focused&&(c.type=a.BLUR,(new a(c)).fire(this.focused),this.focused=null);d&&(this.focused=d,c.type=a.FOCUS,(new a(c)).fire(d));return!0}}(),focus:function(){return d.setFocusOn(this)},
blur:function(){return d.focused===this?d.setFocusOn(null):!1}});c.decorate({addCamera:function(a){var b=this._super(a);if(!b)return b;!this.focused&&this.setFocusOn(a);return b},removeCamera:function(a){a=this._super(a);if(!a)return a;this.setFocusOn(null);return a}});c.method("on"+a.BLUR,function(){this.setFocusOn(null)})})(Engine.Input,Engine.Viewport,Engine.Camera,Engine.Input.Event.Focus);(function(d,c){function b(b){var c=b.type===a|0&&m;switch(b.key){case "CTRL":l=g&c;break;case "ALT":n=h&c;break;case "SHIFT":p=k&c}b.modifiers=l|n|p}var a=c.KEYDOWN,e=c.KEYPRESS,f=c.KEYUP,g=c.CTRL_MODIFIER,h=c.ALT_MODIFIER,k=c.SHIFT_MODIFIER,m=g|h|k;d.events.keyboard=[a,e,f];var l=0,n=0,p=0;d["on"+a]=b;d["on"+e]=b;d["on"+f]=b})(Engine.Input,Engine.Input.Event.Keyboard);(function(d,c){function b(a){var b=this.getFocusedLeaf();b!==this&&this.propagateEvent(a,[b])}d.events.keyboard.forEach(function(a){d.on(a,b)})})(Engine.Input,Engine.Input.Event.Keyboard);(function(d){(function b(a){var e,f;for(f in a)if(a.hasOwnProperty(f))if(e=a[f],"object"===typeof e)b(e);else d.on(e,d.propagateEvent)})(d.events)})(Engine.Input);(function(d,c,b){function a(a,f){f.preventDefault();if(g!==f){var l=this instanceof c?this:null;h.type=a;h.button=f.button;h.movementX=f.movementX||f.mozMovementX||f.webkitMovementX;h.movementY=f.movementY||f.mozMovementY||f.webkitMovementY;h.movementX=null!=h.movementX?h.movementX:f[e]-h.x||0;h.movementY=null!=h.movementY?h.movementY:f.pageY-h.y||0;h.x=f[e];h.y=f.pageY;h.viewport=l;h.viewX=l&&f[e]-l.div.offsetLeft;h.viewY=l&&f.pageY-l.div.offsetTop;(new b(h)).fire(d);g=f}}if("undefined"===typeof window.ontouchstart){var e=
"pageX",f=document.documentElement,g=null,h={};c.decorate("initialize",function(c){this._super&&this._super(c);this.div.addEventListener("mousedown",a.bind(this,b.MOUSEDOWN));this.div.addEventListener("mouseup",a.bind(this,b.MOUSEUP));this.div.addEventListener("mousemove",a.bind(this,b.MOUSEMOVE))});f.addEventListener("mousedown",a.bind(null,b.MOUSEDOWN));f.addEventListener("mouseup",a.bind(null,b.MOUSEUP));f.addEventListener("mousemove",a.bind(null,b.MOUSEMOVE))}})(Engine.Input,Engine.Viewport,Engine.Input.Event.Mouse);(function(d,c,b,a){function e(a,e){if(this instanceof c){var n=e.touches.item(0)||e.changedTouches.item(0);g.x=n[f];g.y=n.pageY;h.x=this.div.offsetLeft;h.y=this.div.offsetTop;h.w=this.div.offsetWidth;h.h=this.div.offsetHeight;var p=g.overlap(h)?this:null;k.type=a;k.x=n[f];k.y=n.pageY;k.viewport=p;k.viewX=p&&n[f]-p.div.offsetLeft;k.viewY=p&&n.pageY-p.div.offsetTop;(new b(k)).fire(d);"touchend"===e.type&&(new b({type:b.MOUSEMOVE,propagate:!1,x:Infinity,y:Infinity})).fire(d)}}if("undefined"!==typeof window.ontouchstart){var f=
"pageX",g=new a(0,0,1,1),h=new a(0,0,0,0),k={};c.decorate("initialize",function(a){this._super&&this._super(a);this.div.addEventListener("touchstart",e.bind(this,b.MOUSEDOWN));this.div.addEventListener("touchend",e.bind(this,b.MOUSEUP));this.div.addEventListener("touchmove",e.bind(this,b.MOUSEMOVE));this.div.addEventListener("touchmove",function(a){a.preventDefault()})})}})(Engine.Input,Engine.Viewport,Engine.Input.Event.Mouse,Engine.Box);(function(d,c,b){function a(a){return(a.keyCode||a.which||a.key&&a.key.toUpperCase().charCodeAt()||0)|0}function e(e,k,m){var n=a(k);if(n){k=e===g;l.type=e;l.keyCode=n;l.text=k?m&&(m["char"]||b(m.charCode)):"";e=new c(l);if(k){l.type=h;var p=new c(l);p.text=""}e.fire(d);p&&f(p,m);return p||e}}function f(a,c){if(!a||!c)return!1;var e=c&&(c["char"]||b(c.charCode));if(a.text===e)return!1;a.text=e;a.fire(d);return!0}var g=c.KEYDOWN,h=c.KEYPRESS,k=c.KEYUP,m=document.documentElement,l={},n=null,p=null,
q={},r=[8,9];m.addEventListener("keydown",function(b){var c=a(b);r.has(c)&&b.preventDefault();p=null;!q[c]&&setTimeout(function(){q[c]=e(g,b,p)},0);n=b});m.addEventListener("keyup",function(b){e(k,b,p);n=0;p=null;q[a(b)]=null});m.addEventListener("keypress",function(b){p=b;var c=q[a(n)];c&&f(c,b)})})(Engine.Input,Engine.Input.Event.Keyboard,String.fromCharCode);(function(d,c){function b(){var b=l.shift(),c=l.shift(),e=!!a[f];d.viewport=e?b:null;if(c)return c();d.trigger(d[e?"LOCK":"UNLOCK"])}var a=window.document,e=a.documentElement,f="pointerLockElement"in a&&"pointerLockElement"||"webkitPointerLockElement"in a&&"webkitPointerLockElement"||"mozPointerLockElement"in a&&"mozPointerLockElement",g="onpointerlockchange"in a&&"pointerlockchange"||"onwebkitpointerlockchange"in a&&"webkitpointerlockchange"||"onmozpointerlockchange"in a&&"mozpointerlockchange",
h="onpointerlockerror"in a&&"pointerlockerror"||"onwebkitpointerlockerror"in a&&"webkitpointerlockerror"||"onmozpointerlockerror"in a&&"mozpointerlockerror",k=e.requestPointerLock||e.webkitRequestPointerLock||e.mozRequestPointerLock,m=a.exitPointerLock||a.webkitExitPointerLock||a.mozExitPointerLock;if(!(f&&g&&h&&k&&m))return Engine.log("Engine.Input.Pointer: implementation not available");var l=[];a[f]&&(d.viewport=!0,d.unlock());a.addEventListener(g,b);a.addEventListener(h,b);Class.decorate(d,"lock",
function(a,b,c){l.push(a,this._super.bind(this,a,b,c));k.call(a.div);return this});Class.decorate(d,"unlock",function(b,c){l.push(null,this._super.bind(this,b,c));m.call(a);return this})})(Engine.Input.Pointer,Engine.NOP);(function(d,c,b,a){Class.decorate(d,"lock",function(e,f,g){e=e||Input.focused;f="function"===typeof f?f:a;g="function"===typeof g?g:a;if(!(e instanceof c))throw new b.Type("Engine.Input.Pointer: viewport must be a instance of Engine.Viewport");if(!e)throw new b.Reference("Engine.Input.Pointer: viewport to lock pointer doesn't exists");return d.viewport===e?(f(),this):this._super(e,f,g)});Class.decorate(d,"unlock",function(b,c){b="function"===typeof b?b:a;c="function"===typeof c?c:a;return d.viewport?
this._super(b,c):(b(),this)})})(Engine.Input.Pointer,Engine.Viewport,Engine.Error,Engine.NOP);Engine.Sound=function(d){function c(b){if(!b||!b.src)throw new TypeError;Model.call(this,b);this.component=null;(this.refersTo=this.refersTo instanceof c.Component?this.refersTo:null)&&!c.Component.compare(this.refersTo,this)&&(this.refersTo=null,Engine.log("Sound can't refers to component with different src, loop or filter; new Component created",Engine.WARN));this.refersTo||(this.refersTo=new c.Component({src:this.src,loop:this.loop,filter:this.filter}));this.refersTo.addSound(this);this.subscribe(this.refersTo,
c.ENDED);this.subscribe(this.refersTo,c.LOADED);this.subscribe(this.refersTo,c.LOADERROR);if(this.autoplay)this.on(c.LOADED,this.play)}Class.extend(c,Model);c._implemented=!1;c.ENDED="ended";c.LOADED="loaded";c.LOADERROR="loaderror";c.property({refersTo:null,component:null,src:"",loop:!1,filter:null,autoload:!0,autoplay:!1,playing:!1});c.now=function(){return d()/1E3};c.method({load:function(b,a){return this.component&&this.component.load(b,a)},play:function(b){!this.component&&this.refersTo.addSound(this);
return(this.playing=!0)&&this.refersTo.play(b)},pause:function(b){this.playing=!1;return this.component&&this.component.pause(b)},stop:function(){this.playing=!1;return this.component&&!1!==this.component.stop()?this.component.removeSound(this):!1},toString:function(){var b="Sound `"+this.src+"`";this.loop&&(b+="; looped");this.filter&&(b+="; with filter `"+this.filter+"`");return b}});return c}(Engine.now);Engine.Sound.Error=function(d){function c(b,a){this.name="Sound"+b;this.message=a}Class.extend(c,Error);c.UNKNOWN_ERROR="UnknownError";c.TYPE_ERROR="TypeError";c.RANGE_ERROR="RangeError";c.REFERENCE_ERROR="ReferenceError";c.REQUEST_ERROR="RequestError";c.NOT_IMPLEMENTED_ERROR="NotImplementedError";c.raise=function(b,a,e){if(1>arguments.length)throw new RangeError;"object"!==typeof b&&(e=a,a=b,b=[]);e||(e=a,a=c.UNKNOWN_ERROR);d.call(b,new c(a,e));return b};c.exists=function(b){if("object"!==typeof b)throw new TypeError;
for(var a=0,d=b.length;a<d;a++)if(b[a]instanceof c)return a;return!1};c.findAll=function(b){if("object"!==typeof b)throw new TypeError;for(var a=null,d=0,f=b.length;d<f;d++)b[d]instanceof c&&(a=a||[],a.push(b[d]));return a};return c}(Array.prototype.push);(function(d,c,b){d.globalVolume=1;d.VOLUME_DEFAULT=1;d.VOLUME_MIN=0;d.VOLUME_MAX=1;d.property("volume",d.VOLUME_DEFAULT);d.setGlobalVolume=function(a){if(1>arguments.length)throw new RangeError;d.globalVolume=c(b(parseFloat(a||0),d.VOLUME_MAX),d.VOLUME_MIN)};d.method("setVolume",function(a){if(1>arguments.length)throw new RangeError;this.volume=c(b(parseFloat(a||0),d.VOLUME_MAX),d.VOLUME_MIN)})})(Engine.Sound,Math.max,Math.min);(function(d,c,b,a,e){var f=d.globalPosition={x:0,y:0,z:0,r:0};d.decorate("initialize",function(a){this._super(a);a=a&&a.position;this.position={x:a&&parseFloat(a.x||0)||0,y:a&&parseFloat(a.x||0)||0,z:a&&parseFloat(a.x||0)||0,r:d.calculateRadius(a)}});d.property("position",null);d.calculateRadius=function(d){return d&&b(c(a(e(parseFloat(d.x||0),2)+e(parseFloat(d.y||0),2)+e(parseFloat(d.z||0),2)),0),1)};d.setGlobalPosition=function(a,e,k){f.x=c(b(parseFloat(a||0),1),-1);f.y=c(b(parseFloat(e||0),1),
-1);f.z=c(b(parseFloat(k||0),1),-1);f.r=d.calculateRadius(f)};d.method("setPosition",function(a,e,f){this.position.x=c(b(parseFloat(a||0),1),-1);this.position.y=c(b(parseFloat(e||0),1),-1);this.position.z=c(b(parseFloat(f||0),1),-1);this.position.r=d.calculateRadius(this.position)})})(Engine.Sound,Math.max,Math.min,Math.sqrt,Math.pow);Engine.Sound.Component=function(d,c){function b(a){Model.call(this,a);this.sounds=[];this.autoload&&this.load()}Class.extend(b,Model);b.property({sounds:null,src:"",loop:!1,filter:null,startTime:0,offset:0,duration:0,loaded:!1,loading:!1,playing:!1,_audio:null,onended:function(){for(var a=0,b=this.sounds,c=b.length;a<c;a++)b[0].stop()}});b.compare=function(a,b){this&&2>arguments.length&&(b=a,a=this);return b instanceof d&&b.src===a.src&&b.loop===a.loop&&b.filter===a.filter};b.method({compare:b.compare,
addSound:function(a){if(!(a instanceof d))throw new TypeError;if(a.refersTo!==this)throw new ReferenceError;if(!this.compare(a))throw new ReferenceError;if(this.sounds.has(a))return!1;var b=this.sounds.push(a);a.component=this;a.autoload&&a.load();a.autoplay&&a.play(0);return b},removeSound:function(a){if(!this.sounds.has(a))return!1;if(a.playing)return a.stop();this.sounds.remove(a);a.component=null;return!0},load:function(a,b){this.loading=!1;this.loaded=!0;a&&a();this.trigger(d.LOADED)},play:function(a){this.startTime=
d.now();return this.playing=!0},pause:function(){this.playing=!1;this.offset+=d.now()-this.startTime;this.offset%=this.duration;this.startTime=0;return!0},stop:function(){this.pause()&&(this.offset=0)},getUri:function(a){"undefined"===typeof a&&(a="");return a+""}});return b}(Engine.Sound,Engine.Sound.Error);(function(d,c){function b(a){for(var b=a.sounds,c=b.length,d=0,h=0,k=0,m;k<c;k++)m=b[k],m.playing&&(d++,h+=m.volume);d&&a.setVolume(h/d)}d.property("volume",c.VOLUME_DEFAULT);d.method("setVolume",function(a){this.volume=a});d.decorate({addSound:function(a){(a=this._super(a))&&b(this);return a},removeSound:function(a){(a=this._super(a))&&b(this);return a}});c.decorate("setVolume",function(a){this._super(a);this.component&&b(this.component)})})(Engine.Sound.Component,Engine.Sound);(function(d,c){function b(a){function b(a){for(var e=h=0,k=0,m;k<d;k++)m=c[k],m.playing&&(h++,e+=m.position[a]);return e}var c=a.sounds,d=c.length,h=0,k=b("x"),m=b("y"),l=b("z");h&&a.setPosition(k/h,m/h,l/h)}d.property("position",null);d.method("setPosition",function(a,b,d){this.position.x=a;this.position.y=b;this.position.z=d;this.position.r=c.calculateRadius(this.position)});d.decorate({initialize:function(a){this._super(a);this.position={x:0,y:0,z:0,r:0}},addSound:function(a){(a=this._super(a))&&
b(this);return a},removeSound:function(a){(a=this._super(a))&&b(this);return a}});c.decorate("setPosition",function(a,c,d){this._super(a,c,d);this.component&&b(this.component)})})(Engine.Sound.Component,Engine.Sound);(function(d,c,b){var a=b._validator=function(a){return function(){var c="function"===typeof arguments[1]?arguments[1]:null;d._implemented&&d._implemented.methods.has(a)||b.raise(arguments,b.NOT_IMPLEMENTED_ERROR,"This method is not implemented");if(b.exists(arguments)){var g=b.findAll(arguments);c&&c.apply(null,g);(c=d[a.toUpperCase()+"ERROR"])&&this.trigger(c,g);return g}return this._super.apply(this,arguments)}};c.decorate({load:a("load"),play:a("play"),pause:a("pause")})})(Engine.Sound,Engine.Sound.Component,
Engine.Sound.Error);(function(d,c,b){c.decorate("setVolume",b("setVolume"));Class.decorate(d,"setGlobalVolume",b("setGlobalVolume"))})(Engine.Sound,Engine.Sound.Component,Engine.Sound.Error._validator);(function(d,c,b){c.decorate("setPosition",b("setPosition"));Class.decorate(d,"setGlobalPosition",b("setGlobalPosition"))})(Engine.Sound,Engine.Sound.Component,Engine.Sound.Error._validator);(function(d,c){"undefined"!==typeof Audio&&(d.TYPE=function(){var b=new Audio,a={mp3:"audio/mpeg",ogg:'audio/ogg; codecs="vorbis"'},c,d;for(c=1;2>=c;c+=1)for(d in a)if(a.hasOwnProperty(d)){var g=a[d];if(b.canPlayType(g)===(1===c?"probably":"maybe"))return{ext:d,mime:g}}return null}(),d.TYPE&&c.decorate("getUri",function(b){return this._super(b)+"."+d.TYPE.ext}))})(Engine.Sound,Engine.Sound.Component);(function(d,c){if(!d._implemented&&d.TYPE){d.WEBAUDIO_IMPLEMENTATION={name:"WebAudioAPI",methods:["play","pause"]};var b=this.AudioContext||this.webkitAudioContext||this.mozAudioContext;if(b){d._implemented=d.WEBAUDIO_IMPLEMENTATION;var a=d._ctx=new b,e=Object.getPrototypeOf(Object.getPrototypeOf(a.destination)).constructor,b=a.createBufferSource().constructor;e===Object&&(e=null);a.joinNode=function(a,b,c){b.right.disconnect(c);b.right.connect(a);b.right=a;a.connect(c);return a};a.createGain=a.createGain||
a.createGainNode;b.prototype.start||(b.prototype.start=b.prototype.noteOn);b.prototype.stop||(b.prototype.stop=b.prototype.noteOff);c.decorate({load:function(){this._audio.buffer&&(this.duration=this._audio.buffer.duration);this._super.apply(this,arguments)},play:function(){var b=this;this._audio.source.start(a.currentTime,this.offset);this.loop||(this._audio.onend=setTimeout(function(){b.trigger(d.ENDED)},1E3*(this.duration-this.offset)));return this._super.apply(this,arguments)},pause:function(a){function b(){var a=
d.source;if(!c.playing&&a){a.stop(0);clearTimeout(d.onend);for(var f in d)(e?d[f]instanceof e:~d[f].constructor.toString().indexOf("NodeConstructor"))&&delete d[f]}}var c=this,d=this._audio,m=this._super.apply(this,arguments);0<a?setTimeout(b,1E3*a):b();return m}});Class.decorate(d,"now",function(){return a.currentTime})}}}).call(this,Engine.Sound,Engine.Sound.Component);(function(d,c,b,a){if(d._implemented===d.WEBAUDIO_IMPLEMENTATION){d.WEBAUDIO_IMPLEMENTATION.methods.push("load");var e={};c.decorate("load",function(){function c(b,f,g){p++;return e[k.src]?f(e[k.src]):new a({src:b,type:"data",on:{load:function(a){d._ctx.decodeAudioData(a.buffer,f,g)},error:g}})}function g(a,b){e[k.src]=b;k._audio[a]=b;++n===p&&m.apply(k,l)}function h(){b.raise(l,b.REQUEST_ERROR,"Can't load sound file");p=-1;m.apply(k,l)}var k=this,m=this._super,l=arguments;this._audio={};for(var n=
0,p=0,q=0,r=arguments.length;q<r;q++){var u=arguments[q];u&&u.uri&&u.name&&c(u.uri,g.bind(null,u.name),h)}})}})(Engine.Sound,Engine.Sound.Component,Engine.Sound.Error,Engine.Network.Resource);(function(d,c,b){if(d._implemented===d.WEBAUDIO_IMPLEMENTATION){var a=b.sources=b.createGain();a.right=a;a.connect(b.destination);c.decorate({load:function(){Array.prototype.push.call(arguments,{name:"buffer",uri:this.getUri(this.src)});return this._super.apply(this,arguments)},play:function(){if(!this._audio.source){var c=this._audio.source=b.createBufferSource();c.connect(a);c.right=c;c.loop=this.loop;c.buffer=this._audio.buffer}return this._super.apply(this,arguments)}})}})(Engine.Sound,Engine.Sound.Component,
Engine.Sound._ctx);(function(d,c,b,a,e,f){function g(a,b){a.setPosition(b.x,b.y,b.z);a.refDistance=1-b.r}if(d._implemented===d.WEBAUDIO_IMPLEMENTATION){d.WEBAUDIO_IMPLEMENTATION.methods.push("setPosition","setGlobalPosition");var h=a.joinNode(a.createPanner(),a.sources,a.destination);h.panningModel=h.EQUALPOWER;c.decorate({play:function(){var b=this._super.apply(this,arguments);if(!this._audio.panner){var c=this._audio.panner=a.joinNode(a.createPanner(),this._audio.source,a.sources);c.refDistance=0;g(c,this.position)}return b},
setPosition:function(a,b,c){a=this._super(a,b,c);this._audio&&this._audio.panner&&g(this._audio.panner,this.position);return a}});Class.decorate(d,"setGlobalPosition",function(){var a=this._super.apply(this,arguments);g(h,d.globalPosition);return a});g(h,d.globalPosition)}})(Engine.Sound,Engine.Sound.Component,Engine.Sound.now,Engine.Sound._ctx,Engine.Loop,Math.min);(function(d,c,b){if(d._implemented===d.WEBAUDIO_IMPLEMENTATION){d.WEBAUDIO_IMPLEMENTATION.methods.push("setVolume","setGlobalVolume");var a=b.joinNode(b.createGain(),b.sources,b.destination);c.decorate({play:function(){var a=this._super.apply(this,arguments);this._audio.volume||(this._audio.volume=b.joinNode(b.createGain(),this._audio.source,b.sources),this._audio.volume.gain.setValueAtTime(this.volume,b.currentTime));return a},setVolume:function(a){a=this._super(a);this._audio&&this._audio.volume&&
this._audio.volume.gain.setValueAtTime(this.volume,b.currentTime);return a}});Class.decorate(d,"setGlobalVolume",function(c){c=this._super(c);a.gain.setValueAtTime(d.globalVolume,b.currentTime);return c});a.gain.setValueAtTime(d.globalVolume,b.currentTime)}})(Engine.Sound,Engine.Sound.Component,Engine.Sound._ctx);(function(d,c,b){d._implemented===d.WEBAUDIO_IMPLEMENTATION&&c.decorate({load:function(){this.filter&&Array.prototype.push.call(arguments,{name:"filter",uri:this.getUri(this.filter)});return this._super.apply(this,arguments)},play:function(){var a=this._super.apply(this,arguments);!this._audio.convolver&&this._audio.filter&&((this._audio.convolver=b.joinNode(b.createConvolver(),this._audio.source,b.sources)).buffer=this._audio.filter);return a}})})(Engine.Sound,Engine.Sound.Component,Engine.Sound._ctx);(function(d,c,b){!d._implemented&&d.TYPE&&(d.NODE_IMPLEMENTATION={name:"Node",methods:["load","play","pause"]},d._implemented=d.NODE_IMPLEMENTATION,c.decorate({load:function(){function a(){h.removeEventListener("canplaythrough",a);c.duration=h.duration;f.apply(c,g)}var c=this,f=this._super,g=arguments,h=this._audio=new Audio;h.src=this.getUri(this.src);h.loop=this.loop;h.volume=this.volume;h.addEventListener("ended",this.trigger.bind(this,d.ENDED));h.addEventListener("error",function(){b.raise(g,
b.REQUEST_ERROR,"Can't load sound file");f.apply(c,g)});h.addEventListener("canplaythrough",a)},play:function(){this._audio.currentTime=this.offset;this._audio.play();return this._super.apply(this,arguments)},pause:function(a){function b(){c.playing||c._audio.pause()}var c=this,d=this._super();0<a?setTimeout(b,1E3*a):b();return d}}))})(Engine.Sound,Engine.Sound.Component,Engine.Sound.Error);(function(d,c){function b(a){var b=a.volume*d.globalVolume,b=b*(1-d.globalPosition.r),b=b*(1-a.position.r);a._audio.volume=b}function a(){for(var a=this._super.apply(this,arguments),c=d._instances,g=0,h=c.length;g<h;g++)b(c[g]);return a}d._implemented===d.NODE_IMPLEMENTATION&&(d.NODE_IMPLEMENTATION.methods.push("setVolume","setGlobalVolume"),d.NODE_IMPLEMENTATION.methods.push("setPosition","setGlobalPosition"),c.decorate({play:function(){var a=this._super.apply(this,arguments);b(this);return a},setVolume:function(a){a=
this._super(a);b(this);return a},setPosition:function(a,c,d){a=this._super(a,c,d);b(this);return a}}),Class.decorate(d,{setGlobalVolume:a,setGlobalPosition:a}))})(Engine.Sound,Engine.Sound.Component);(function(d,c){d.decorate({load:function(b,a){b="function"===typeof b?b:null;a="function"===typeof a?a:null;if(this.loaded)return b&&b();if(this.loading){if(!b&&!a)return;b&&this.on(d.LOADED,b);return a&&this.on(d.LOADERROR,a)}this.loading=!0;this._super(b,a)},play:function(b){if(this.refersTo.loaded)return this.playing&&"number"===typeof b&&this.stop(),this._super(b)},pause:function(){if(this.playing&&this.refersTo.loaded)return this._super()}})})(Engine.Sound,Engine.Sound.Error);(function(d,c,b,a){c.decorate({load:function(a,b){a="function"===typeof a?a:null;b="function"===typeof b?b:null;if(this.loaded)return a&&a();if(this.loading){if(!a&&!b)return;a&&this.on(d.LOADED,a);return b&&this.on(d.LOADERROR,b)}this.loading=!0;this._super(a,b)},play:function(a){for(var b=!1,c=0,h=this.sounds,k=h.length;c<k&&!(b=h[c].playing);c++);if(!b)return!1;if("number"!==typeof a||0>a)a=void 0;if("undefined"===typeof a&&this.playing)return!0;"undefined"!==typeof a&&(this.offset=a%this.duration||
0);return this.loaded?this._super(a):this.on(d.LOADED,this.play.bind(this,a))},pause:function(a){if(this.playing&&this.loaded&&!this.paused){for(var b=!1,c=0,d=this.sounds,k=d.length;c<k&&!(b=d[c].playing);c++);return b?!1:this._super("number"===typeof a&&0<a?a:0)}}})})(Engine.Sound,Engine.Sound.Component,Engine.Sound.Error,Math.max);Engine.Particles=function(){function d(c){Model.call(this,c)}Class.extend(d,Model);return d}();Engine.Particles=function(d,c){function b(a){d.call(this,a);this.timer.set("duration",this.emitDelay)}Class.extend(b,d);b.BEFORE_EMIT="beforeemit";b.EMIT="emit";b.BEFORE_CREATE_PARTICLE="beforecreateparticle";b.CREATE_PARTICLE="createparticle";b.property({amount:10,iterations:Infinity,emitDelay:1E3,emitters:null});var a=[];b.method({onstep:function(){this._super();if(!this.emitters.length&&this.timer.count>=this.iterations)return this.stop()},onplay:function(){this._super();this.emitters=[];this.emit()},
onstop:function(){this._super();this.emitters=b.prototype.emitters},onloop:function(){this._super();this.timer.count<this.iterations&&this.emit()},onemitterdestroyed:function(b){a.push(b);5<a.length&&a.shift()},emit:function(){if(this.timer.playing){this.trigger(b.BEFORE_EMIT);var c=this.amount,d;a:{d=0;for(var g=a.length;d<g;d++){var h=a[d];if(h.amount===c){d===a.length-1?a.pop():a[d]=a.pop();d=h;break a}}d=void 0}d=d||{amount:c};this.emitters.push(d);this.trigger(b.EMIT,d,this.amount);for(g=0;g<
c;g++)this.trigger(b.BEFORE_CREATE_PARTICLE,g),this.trigger(b.CREATE_PARTICLE,d,g)}}});return b}(Engine.Particles,Engine.now);Engine.Particles=function(d,c){function b(a){var b=function(a,b,c,d){a=d[c]-b;d[c]=0>a?0:a};b.shortcutArguments=["timeleft"];this.funcs.push(b);d.call(this,a)}Class.extend(b,d);b.EMITTER_DESTROYED="emitterdestroyed";b.property({lifetime:5E3});b.method({onemit:function(a,b){this._super(a,b);a.lifetime=a.lifetime||new TypedArray("uint",this.lifetime,b);a.timeleft=a.timeleft||new TypedArray("uint",this.lifetime,b)},oncreateparticle:function(a,b){this._super(a,b);a.lifetime[b]=a.timeleft[b]=c(0,this.lifetime)},
onstep:function(){this._super();var a=0,c=this.emitters,d=c.length;a:for(;a<d;a++){for(var g=0,h=c[a].timeleft,k=h.length;g<k;g++)if(h[g])continue a;g=c[a];a===c.length-1?c.pop():c[a]=c.pop();this.queue(b.EMITTER_DESTROYED,g);a--;d--}}});return b}(Engine.Particles,Math.max);Engine.Particles=function(d){function c(b){d.call(this,b);this.timer.set("delay",this.redrawDelay)}Class.extend(c,d);c.property({geometry:null,redrawDelay:1,parent:null,left:0,top:0,width:1,height:1});c.method({onstep:function(){this._super();this.geometry.redraw()},onplay:function(){this._super();this.geometry=new Engine.Particles.Geometry({emitters:this.emitters,parent:this.parent,left:this.left,top:this.top,width:this.width,height:this.height})},onstop:function(){this._super();this.geometry.destroy()}});
return c}(Engine.Particles);Engine.Particles=function(d){function c(b){d.call(this,b)}Class.extend(c,d);c.property({fill:"red 2px 2px",_fills:null});c.method({onemit:function(b,a){this._super(b,a);b.shape=b.shape||Array(a)},onplay:function(){this._fills={};this._super()},onstop:function(){this._super();this._fills=c.prototype._fills},oncreateparticle:function(b,a){this._super(b,a);var c;if(c=this._fills[this.fill])return b.shape[a]=c;b.shape[a]=this._fills[this.fill]=Engine.Particles.Fill.parse(this.fill)}});return c}(Engine.Particles);Engine.Particles=function(d,c,b){function a(a){var b=a&&"dy"in a?a.dy:this.dy;!1!==(a&&"dx"in a?a.dx:this.dx)&&!1!==b&&(b=function(a,b,c,d,e){d&&e&&(c*=2,d[c]+=e[c]*b/1E3,d[c+1]+=e[c+1]*b/1E3)},b.shortcutArguments=["position","move"],this.funcs.push(b));d.call(this,a);this.dx=a&&"undefined"!==typeof a.dx?a.dx:this.dx;this.dy=a&&"undefined"!==typeof a.dy?a.dy:this.dy;this.originX=a&&"number"===typeof a.originX?a.originX:this.width/2;this.originY=a&&"number"===typeof a.originY?a.originY:this.height/
2}Class.extend(a,d);a.property({originX:null,originY:null,dx:100,dy:100});a.method({onemit:function(a,b){this._super(a,b);var d=c(this.width,this.height);a.position=a.position||new TypedArray("float",d,2*b);a.move=a.move||new TypedArray("int",d,2*b)},oncreateparticle:function(a,b){this._super(a,b);b*=2;a.position[b]=this.originX;a.move[b]=this.dx;b++;a.position[b]=this.originY;a.move[b]=this.dy},verifyPosition:function(a,c,d,h){"undefined"===typeof d&&(d=this.dx);"undefined"===typeof h&&(h=this.dy);
return b(d)+(a+1)/2>this.width/2||b(h)+(c+1)/2>this.height/2?!1:!0}});return a}(Engine.Particles,Math.max,Math.abs);Engine.Particles=function(d){function c(b){if(!1!==(b&&"opacity"in b?b.opacity:this.opacity)){var a=function(a,b,c,d,k){d&&(d[c]*=1-b/k[c])};a.shortcutArguments=["opacity","timeleft"];this.funcs.push(a)}d.call(this,b);this.opacity=b&&"undefined"!==typeof b.opacity?b.opacity:this.opacity}Class.extend(c,d);c.property({opacity:1});c.method({onemit:function(b,a){this._super(b,a);!1===this.opacity?b.opacity&&(b.opacity=null):b.opacity=b.opacity||new TypedArray("float",1,a)},oncreateparticle:function(b,
a){this._super(b,a);!1!==this.opacity&&(b.opacity[a]="number"===typeof this.opacity?this.opacity:c.prototype.opacity)}});return c}(Engine.Particles);Engine.Particles=function(d,c){function b(a){var b=Math.PI;if(!1!==(a&&"rotate"in a?a.rotate:this.rotate)){var c=function(a,c,d,f,l){f&&(f[d]+=l[d]*c/1E3,f[d]%=2*b)};c.shortcutArguments=["rotation","rotate"];this.funcs.push(c)}d.call(this,a);this.rotate=a&&"undefined"!==typeof a.rotate?a.rotate:this.rotate}Class.extend(b,d);b.property({rotate:0});b.method({onemit:function(a,b){this._super(a,b);!1===this.rotate?(a.rotate&&(a.rotate=null),a.rotation&&(a.rotation=null)):(a.rotate=a.rotate||new TypedArray("float",
2*c,b),a.rotation=a.rotation||new TypedArray("float",2*c,b))},oncreateparticle:function(a,b){this._super(a,b);a.rotate&&(a.rotate[b]=this.rotate,a.rotation[b]=0)}});return b}(Engine.Particles,Math.PI);Engine.Particles=function(d,c){function b(a){var b=this.timer=new c({type:c.VSYNC,loop:!0,subscribers:{reset:this,play:this,pause:this,stop:this,step:this,loop:this}});this.reset=b.reset.bind(b);this.play=b.play.bind(b);this.pause=b.pause.bind(b);this.stop=b.stop.bind(b);d.call(this,a)}Class.extend(b,d);b.STEP="step";b.LOOP="loop";b.PLAY="play";b.STOP="stop";b.property({timer:null,autoplay:!0,oninitialize:function(a){this.autoplay&&setTimeout(this.timer.play.bind(this.timer),0)},reset:null,play:null,
pause:null,stop:null});return b}(Engine.Particles,Engine.Timer);Engine.Particles=function(d,c,b){function a(a){this.funcs=[];d.call(this,a);a&&b(a.funcs)&&c.apply(this.funcs,a.funcs)}Class.extend(a,d);a.property({funcs:null});a.method({onstep:function(){var a=arguments,b=this.funcs,c=b.length;this._super();a[1]=this.timer.stepprogress;for(var d=0,k=this.emitters,m=k.length;d<m;d++)for(var l=a[0]=k[d],n=0;n<c;n++){var p=b[n],q=p.shortcutArguments;a.length=3;if(q){a.length=q.length+3;for(var r=0,u=q.length;r<u;r++)a[r+3]=l[q[r]]}q=l.timeleft;r=0;for(u=q.length;r<
u;r++)q[r]&&(a[2]=r,p.apply(null,a))}}});return a}(Engine.Particles,Array.prototype.push,Array.isArray);Engine.Particles.Geometry=function(d){function c(b){d.call(this,b)}Class.extend(c,d);c.property({emitters:null});return c}(Engine.Geometry);Engine.Particles.Fill=function(d){d={parse:d.parse.bind(d)};var c=/\s(\d+)px\s(\d+)px$/;Class.decorate(d,"parse",function(b,a){var d=c.exec(b);d&&(b=b.substring(0,b.length-d[0].length));var f=this._super(b,a);f.image instanceof Engine.Fill.Gradient&&"radial"===f.image.type&&(f.left=0,f.top=0);d&&(f.width=parseInt(d[1]),f.height=parseInt(d[2]));return f});return d}(Engine.Fill);(function(d,c){d.decorate("oncreateparticle",function(b,a){this._super(b,a);var d=b.shape[a];if(!("_pattern"in d)){c(d);var f=d._image;if(f){if(f.complete)return d.width=f.width,d.height=f.height;f.on("load",function(){d._image=this;d.width=this.width;d.height=this.height})}}})})(Engine.Particles,Engine.Renderer.parseFill);(function(d,c){d.decorate("render",function(b){this._super(b);var a=this.emitters;if(a&&a.length)for(var c=0,d=a.length;c<d;c++)for(var g=a[c],h=g.shape,k=g.opacity,m=g.rotation,l=g.position,g=g.timeleft,n=0,p=g.length,q=0;n<p;q=2*++n)if(g[n]){var r=h[n];b.globalAlpha=k?k[n]:1;var u=this.left+l[q]|0,G=this.top+l[q+1]|0,q=r.width|0,y=r.height|0;q&&y&&(b.save(),b.translate(u,G),m&&b.rotate(m[n]),b.translate(-q/2,-y/2),(u=r._image)?b.drawImage(u.canvas,0,0):(b.fillStyle=r._pattern||r.color+"",b.fillRect(0,
0,q,y)),b.restore())}})})(Engine.Particles.Geometry,Engine.Fill);Engine.Path=function(){var d=new Model;d.Metric={};d.METRIC="euclidean";d.distance=function(c,b,a,e,f){return(f=d.Metric[f]||d.Metric[d.METRIC]||null)?f.distance(c,b,a,e):0};return d}();(function(d){var c=Math.sqrt,b=Math.pow,a=Math.abs;d.Metric.euclidean={directions:[[1,0,1],[0,1,1],[-1,0,1],[0,-1,1],[1,1,Math.SQRT2],[-1,-1,Math.SQRT2],[-1,1,Math.SQRT2],[1,-1,Math.SQRT2]],distance:function(a,d,g,h){return c(b(a-g,2)+b(d-h,2))}};d.Metric.manhattan={directions:[[1,0,1],[0,1,1],[-1,0,1],[0,-1,1]],distance:function(b,c,d,h){return a(b-d)+a(c-h)}}})(Engine.Path);(function(d){function c(a,b){return 1}function b(a,b){return b.h-a.h||b.g-a.g}function a(a,b){b="function"===typeof b?b:f;for(var c=[];a;)c.unshift(b(a)),a=a.parent;return c}function e(a,b,c,d,e,f){this.x=a;this.y=b;this.g=c;this.h=d;this.parent=e;this.cost=f}function f(a){return[a.x,a.y]}d.MAX=500;d.INVALID=-1;d.search=function(f,h,k,m,l,n){if(f===k&&h===m)return[];l="function"===typeof l?l:c;var p=d.Metric[d.METRIC]||null;if(!p)throw'Engine.Path.search: no "'+d.METRIC+'" metric found';var q=p.directions,
r=q.length,p=p.distance,u=Math.max(0,parseFloat(d.MAX)||0),G=d.INVALID,y=0,v=p.call(null,f,h,k,m);f=[new e(f,h,y,v,null,0)];h={};for(var A={},B=f.last();f.length&&0<u--;){var w=f.pop(),t=w.x,x=w.y;B.h>w.h&&(B=w);if(t===k&&x===m)return a(w,n);h[w]=w;for(var z=0;z<r;z++){var s=q[z],y=s[0],v=s[1],D=s[2],s=t+y,C=x+v;if(!h[s+","+C]&&!A[s+","+C]){var E=l.call(this,s,C,y,v);A[s+","+C]=!0;Number(E)!==G&&(y=w.g+E*D,v=p.call(null,s,C,k,m),f.push(new e(s,C,y,v,w,E)))}}f.sort(b)}return a(B,n)};e.prototype.toString=
function(){return this.x+","+this.y}})(Engine.Path);Engine.Isometry=function(d,c){var b={TILE_WIDTH:64,TILE_HEIGHT:40,X:"x",Y:"y",Z:"z",W:"w",H:"h",D:"d",LAYER:"layer",LABEL:"ISOMETRY",project:function(a,c,f,g){a=parseFloat(a)||0;c=parseFloat(c)||0;f=parseFloat(f)||0;g=g||[0,0];g[0]=d(b.TILE_WIDTH/2*a-b.TILE_WIDTH/2*c);g[1]=d(b.TILE_HEIGHT/2*a+b.TILE_HEIGHT/2*c-b.TILE_HEIGHT*f);return g},coords:function(a,c,d){a=parseInt(a)||0;c=parseInt(c)||0;d=d||[0,0,0];d[0]=1/b.TILE_WIDTH*a+1/b.TILE_HEIGHT*c;d[1]=-1/b.TILE_WIDTH*a+1/b.TILE_HEIGHT*c;d[2]=0;return d},
UNIT:{valueOf:function(){return b.TILE_WIDTH/c}}};return b}(Math.round,Math.SQRT2);Engine.Isometry.Node=function(d,c,b,a,e){function f(a){var f=d.X,m=d.Y,l=d.Z,n=d.W,p=d.H,q=d.D,r=d.LAYER,f=this[f]=a&&f in a?parseFloat(a[f])||0:parseFloat(this[f])||0,m=this[m]=a&&m in a?parseFloat(a[m])||0:parseFloat(this[m])||0,u=this[l]=a&&l in a?parseFloat(a[l])||0:parseFloat(this[l])||0,n=this[n]=a&&n in a?e(0,parseFloat(a[n])||0):e(0,parseFloat(this[n])||0),p=this[p]=a&&l in a?e(0,parseFloat(a[l])||0):e(0,parseFloat(this[l])||0);this[q]=a&&l in a?e(0,parseFloat(a[l])||0):e(0,parseFloat(this[l])||
0);this[r]=a&&r in a?parseInt(a[r])||0:parseInt(this[r])||0;this.bb=new b(f,m,n,p);c.call(this,a);d.project(f,m,u,g);this.setTransform(1,0,0,1,g[0],g[1])}var g=[0,0];Class.extend(f,c);f.method({setCube:function(a,b,c,f,n,p){var q=d.X,r=d.Y,u=d.Z,G=d.W,y=d.H,v=d.D;a=parseFloat(a)||0;b=parseFloat(b)||0;c=parseFloat(c)||0;f=e(0,parseFloat(f)||0);n=e(0,parseFloat(n)||0);p=e(0,parseFloat(p)||0);if(a===this[q]&&b===this[r]&&c===this[u]&&f===this[G]&&n===this[y]&&p==this[v])return!1;this[q]=a;this[r]=b;
this[u]=c;this[G]=f;this[y]=n;this[v]=p;d.project(a,b,c,g);this.setTransform(1,0,0,1,g[0],g[1]);return!0},setPosition:function(a,b,c){return this.setCube(a,b,c,this[d.W],this[d.H],this[d.D])},setSize:function(a,b,c){return this.setCube(this[d.X],this[d.Y],this[d.Z],a,b,c)},setLayer:function(a){var b=d.LAYER;a=parseInt(a)||0;if(a===this[b])return!1;this[b]=a;this.update();return!0},update:function(a){var b=d.X,c=d.Y,e=d.W,g=d.H,p=d.LABEL,q=this.bb,r=this.root;r&&r.spaceClear(p,q,this);this._super(a);
a=this.firstParentOfType(f);q.reset(a?a.bb.x+this[b]:this[b],a?a.bb.y+this[c]:this[c],this[e],this[g]);(b=this.root)&&b.spaceInsert(p,q,this)}});return f}(Engine.Isometry,Engine.Transform,Engine.Box,Engine.Scene,Math.max);Engine.Isometry.Scene=function(d,c,b,a){function e(a){c.call(this,a);this.space[d.LABEL]=new RTree(4)}Class.extend(e,c);e.method({sort:function(c){for(var e=0,h=c.length;e<h;e++)for(var k=0;k<h;k++)if(e!==k){var m=c[e],l=c[k],n;n=m;var p=l,q=d.X,r=d.Y,u=d.W,G=d.H,y=d.LAYER,v=n.firstParentOfType(b),A=p.firstParentOfType(b);if(v===A)n=this.compare(n,p);else{var B=v?v[q]:0,w=v?v[r]:0,t=v?v[u]:0,x=v?v[G]:0,q=A?A[q]:0,r=A?A[r]:0,u=A?A[u]:0,G=A?A[G]:0;n=a.call((A?A[y]:0)-(v?v[y]:0)||(B>=q+u&&w+x>r||w>=
r+G&&B+t>q?-1:B+t<=q||w+x<=r||B<q||w<r?1:0)||this.compare(n,p))}~n||(c[e]=l,c[k]=m)}return c}});return e}(Engine.Isometry,Engine.Scene,Engine.Isometry.Node,Number.prototype.sign);Engine.Isometry.Transform=function(d,c,b,a,e){function f(a){var b=this.align=a&&"align"in a?String(a.align):String(this.align);h.has(this.align)||(this.align=h.last());c.call(this,a);g(this,b)}function g(c,f){var g=b.LEFT,n=b.TOP,p=d.TILE_HEIGHT/d.TILE_WIDTH;switch(f){case h[0]:g=b.RIGHT;n=b.BOTTOM;c.setTransform(1,-p,0,1,0,0);c.scale(1/a,p*a);break;case h[1]:g=b.LEFT;n=b.BOTTOM;c.setTransform(1,p,0,1,0,0);c.scale(1/a,p*a);break;case h[2]:g=b.LEFT,n=b.TOP,c.setTransform(1,0,0,p,0,0),c.rotate(e)}c.halign=
g;c.valign=n;return!0}var h=["x","y","z"];Class.extend(f,c);f.property({align:h.last(),halign:b.LEFT,valign:b.TOP});f.method({setAlign:function(a){a=h.has(a)?a:h.last();if(a===this.align)return!1;this.align=a;g(this,a);return!0},appendChild:function(a){if(!this._super(a))return!1;a instanceof b&&a.setAlign(this.hAlign,this.vAlign);return!0}});f.X=Class.extend(function(a){f.call(this,a)},f);f.X.property("align",h[0]);f.Y=Class.extend(function(a){f.call(this,a)},f);f.Y.property("align",h[1]);f.Z=Class.extend(function(a){f.call(this,
a)},f);f.Z.property("align",h[2]);return f}(Engine.Isometry,Engine.Transform,Engine.Geometry,Math.SQRT2,Math.PI/4);Engine.Isometry.Camera=function(d,c,b,a,e){function f(a){c.call(this,a)}Class.extend(f,c);f.method({getVisibleArea:function(){var c=d.coords(this.toSceneX(0),this.toSceneY(0)),f=d.coords(this.toSceneX(0),this.toSceneY(this.height)),k=d.coords(this.toSceneX(this.width),this.toSceneY(0)),m=d.coords(this.toSceneX(this.width),this.toSceneY(this.height)),l=a(c[0],f[0],k[0],m[0]),n=a(c[1],f[1],k[1],m[1]),p=e(c[0],f[0],k[0],m[0]),c=e(c[1],f[1],k[1],m[1]);return new b(l,n,p-l,c-n)},isAreaVisible:function(c,
f,k,m){c=parseFloat(c)||0;f=parseFloat(f)||0;k=e(0,parseFloat(k)||0);m=e(0,parseFloat(m)||0);var l=d.project(c,f),n=d.project(c,f+m),p=d.project(c+k,f);m=d.project(c+k,f+m);c=a(l[0],n[0],p[0],m[0]);f=a(l[1],n[1],p[1],m[1]);k=e(l[0],n[0],p[0],m[0]);l=e(l[1],n[1],p[1],m[1]);n=this.view;return b.overlap(c,f,k-c,l-f,n.x,n.y,n.w,n.h)}});return f}(Engine.Isometry,Engine.Camera,Engine.Box,Math.min,Math.max);Engine.Sna=function(){var d=new Model;d.BYTESPERPIXEL=4;d.FRAMEDELAY=80;d.DURATION="duration";d.SOUND="sound";d.TICK=1;return d}();Engine.Sna.Resource=function(d){function c(a){this.states=this.sets=null;d.call(this,a)}var b={};Class.extend(c,d);c.property({type:"data"});c.method({getState:function(a){return this.states&&this.states.hasOwnProperty(a)?this.states[a]:null}});c.load=function(a){return b.hasOwnProperty(a)?b[a]:b[a]=new c({src:a})};return c}(Engine.Network.Resource);Engine.Sna.Animation=function(d,c,b,a,e){function f(b){var d=b&&b.loop?b.loop:null;this.begin=d?parseInt(d[0])||0:0;this.end=d?parseInt(d[1])||0:0;this.cycle=d?0<=d[2]?2:1:2;this.repeat=d?0===d[2]||-1===d[2]?Infinity:e(d[2]):0;this.last=a(b&&1<=b.length?parseInt(b.length)-1||0:0,this.end);this.number=this.repeat;this.direction=1;this.frame=0;c.call(this,b)}Class.extend(f,c);f.property({type:"animation",loop:!0,delay:d.FRAMEDELAY,duration:d.FRAMEDELAY,onloop:function(){var a=this.frame;switch(this.cycle){case 2:a=
a===this.end&&0<--this.number?this.begin:a+this.direction;break;case 1:a===this.begin&&a+this.direction<this.begin?0<--this.number?(this.direction*=-1,a+=this.direction):(this.direction=1,a=this.end+this.direction):(a===this.end&&a+this.direction>this.end&&(0<--this.number?this.direction*=-1:this.direction=1),a+=this.direction)}if(0>a||a>this.last)return this.stop();this.frame=a;this.trigger("frame",this.frame)}});f.method({setFrame:function(a){a=parseInt(a)||0;if(this.frame===a)return!1;this.frame=
a;this.trigger("frame",a);return!0},setLoop:function(b){null===b?(this.end=this.begin=0,this.cycle=1,this.last=this.repeat=0,this.reset(),this.stop()):(this.begin=b?parseInt(b[0])||0:0,this.end=b?parseInt(b[1])||0:0,this.cycle=b?0<=b[2]?2:1:2,this.repeat=b?0===b[2]||-1===b[2]?Infinity:e(b[2]):0,this.last=a(this.last,this.end),this.reset(),this.play())},reset:function(){this.direction=1;this.number=this.repeat;this.frame=0;this.trigger("frame",this.frame);this._super()},play:function(){return this.repeat&&
this._super()?(this.trigger("frame",this.frame),!0):!1},stop:function(){return this._super()?(this.frame=0,this.trigger("frame",this.frame),!0):!1}});return f}(Engine.Sna,Engine.Timer,Math.min,Math.max,Math.abs);Engine.Sna.Layer=function(d){function c(b){this.frames=b&&b.frames instanceof Array?b.frames:[];this.frame=0;var a=this.meta=this.frames[this.frame];d.call(this,b);a&&this.setBox(a.x,a.y,a.w,a.h)&&this.redraw()}Class.extend(c,d);c.method({setFrame:function(b){b=parseInt(b)||0;if(this.frame===b)return!1;this.frame=b;b=this.meta=(b=this.frames)&&b[this.frame]||null;this.redraw();b&&this.setBox(b.x,b.y,b.w,b.h)&&this.redraw();return!0}});return c}(Engine.Geometry);Engine.Sna.Sound=function(d){function c(b){this.frame=0;this.frames=b&&"frames"in b?b.frames:"";this.src=this.frames instanceof Array?this.frames[this.frame]||"":this.frames;this.autoplay=this.loop=!(this.frames instanceof Array);d.call(this,b)}Class.extend(c,d);c.method({setFrame:function(b){if(this.loop)return!0;var a=this.frames;b=a&&a[b]||null;if(!b)return!1;this.setSrc(b);this.play();return!0}});return c}(Engine.Geometry.Sound);Engine.Sna.Node=function(d,c,b,a,e,f,g,h){function k(a){this.state=a&&"state"in a?String(a.state):String(this.state);this.src=a&&"src"in a?String(a.src):String(this.src);this.sound=a&&"sound"in a?Boolean(a.sound):Boolean(this.sound);this.animation=new e;c.call(this,a);this.subscribe(this.animation,"stop");this.subscribe(this.animation,"frame");this.on("frame",m);this.on("load",l);this.on("error",n);r(this,this.src)}function m(c){var e=b.load(this.src).getState(this.state);if(!e)return!1;var g=this.animation,
h=this.animation,k=d.FRAMEDELAY;e=e.duration;e="number"===typeof e?parseFloat(e)||1:null!==e&&null!==e[c]?parseFloat(e[c])||1:1;g.duration=h.delay=k*e*this.tick*d.TICK;g=this.children;for(h=g.length;0<h--;)k=g[h],(k instanceof a||k instanceof f)&&k.setFrame(c)}function l(){q(this);p(this,this.state)}function n(){}function p(c,d){var e=b.load(c.src).states,e=e.hasOwnProperty(d)?e[d]:null;if(!e)return!1;var g=e.layers||null;if(g)for(var h in g)c.appendChild(new a(g[h]));h=e.sound||null;c.sound&&h&&
c.appendChild(new f({frames:h,width:e.width,height:e.height}));c.animation.setLoop(e.loop);c.setSize(e.width,e.height);return!0}function q(b){for(var c=b.children,d=c.length;0<d--;){var e=c[d];(e instanceof a||e instanceof f)&&e.destroy()}b.animation.setLoop(null);return!0}function r(a,c){var d=b.load(c);a.subscribe(d,"load");d.complete&&p(a,a.state)}Class.extend(k,c);k.property({tick:1,state:"",src:"",opacity:1,sound:!0});k.method({setLoop:function(a){this.animation.setLoop(a)},appendChild:function(b){if(!this._super(b))return null;
b instanceof a&&b.setOpacity(this.opacity);return b},setOpacity:function(b){b=h(0,g(parseFloat(b)||0,1));if(this.opacity===b)return!1;this.opacity=b;for(var c=this.children,d=c.length,e=0;e<d;e++)c[e]instanceof a&&c[e].setOpacity(b);return!0},setState:function(a){a=String(a);if(a===this.state)return!1;this.state=a;q(this);p(this,a)},setSrc:function(a){a=String(a);if(this.src===a)return!1;this.unsubscribe(b.load(this.src),"load");this.src=a;r(this,a)}});return k}(Engine.Sna,Engine.Transform.Anchor,
Engine.Sna.Resource,Engine.Sna.Layer,Engine.Sna.Animation,Engine.Sna.Sound,Math.min,Math.max);(function(d,c){c.parseMeta=function(b){for(var a={sets:[],states:{}},d=0,f=a.states,g=0;g<b.length;g++){for(var h=b[g],k=h[2],m=h[3],h={name:h[0],loop:h[1],layers:{},duration:1,sound:null,width:k[0],height:k[1]},l=0;l<m.length;l++){var n=m[l],p=n[0];switch(p){case c.DURATION:h.duration=n[1];break;case c.SOUND:h.sound=n[1];break;default:for(var n=n[1],q=h.layers[p]={frames:[],width:k[0],height:k[1]},r=0;r<n.length;r++){for(var u=n[r],G=u[0],y=u[1],u=u[2];G<q.length;)q.push(v);var v={x:y[0],y:y[1],
w:y[2],h:y[3],offset:d,diff:u};q.frames.push(v);for(G=0;G<u.length;G++)y=u[G],d+=y[2]*y[3]*c.BYTESPERPIXEL}h.layers[p]=q;a.sets.push(q)}}f[h.name]=h}return a};c.parseSets=function(b,a,e){for(var f=0;f<b.length;f++)for(var g=b[f],h=g.frames,k=d.ctx.createImageData(g.width,g.height),m=k.data,l=0;l<h.length;l++){for(var n=h[l],p=n.diff,q=0;q<p.length;q++)for(var r=p[q],u=r[0],G=r[1],y=r[2],r=r[3],v=0;v<r;v++)for(var A=c.BYTESPERPIXEL*((G+v)*g.width+u),B=0;B<y;B++)for(var w=0;w<c.BYTESPERPIXEL;w++)m[A++]^=
a[e++];p=document.createElement("canvas");q=p.getContext("2d");p.width=n.w;p.height=n.h;q.putImageData(k,-n.x,-n.y,n.x,n.y,n.w,n.h);n.canvas=p;n.data=q.getImageData(0,0,p.width,p.height).data}return b}})(Engine.Renderer,Engine.Sna);(function(d,c,b,a){c.decorate("initialize",function(a){this._super(a);this.offset=0});c.decorate("onload",function(b){this.offset=2+(b[0]<<8)+b[1];var c=a.unpack((b.subarray||b.slice).call(b,2,this.offset)),c=d.parseMeta(c);this.states=c.states;this.sets=c.sets;d.parseSets(this.sets,b,this.offset);this._super(b)})})(Engine.Sna,Engine.Sna.Resource,Engine.Renderer,msgpack);(function(d){d.decorate("initialize",function(c){this._super(c);this.canvas=(c=this.meta)&&c.canvas||null});d.decorate("setFrame",function(c){return this._super(c)?(this.canvas=(c=this.meta)&&c.canvas||null,!0):!1});d.decorate("render",function(c){var b=this.canvas;b&&b.width&&b.height&&c.drawImage(b,this.left,this.top);return this._super(c)});d.decorate("getPixel",function(c,b,a){c-=this.left;b-=this.top;var d=this.meta||null;a=a||[];if(!d)return a[0]=0,a[1]=0,a[2]=0,a[3]=0,a;var f=d.data;c=4*(b*
d.w+c);a[0]=f[c++];a[1]=f[c++];a[2]=f[c++];a[3]=f[c];return a})})(Engine.Sna.Layer);Engine.UI=function(){return{}}();Engine.UI.Layout=function(d,c){function b(a){d.call(this,a);this.setFill(this.fill)}Class.extend(b,d);b.property({fill:null,onresize:function(a,b,c){a=this.camera.view;b=a.x;c=a.y;this.setBounds(b,c,b+a.w,c+a.h);this.update(this)}});b.method("setFill",function(a){this.camera&&this.unsubscribe(this.camera,"resize");(this.camera=a instanceof c?a:null)&&(this.subscribe(this.camera,"resize"),this.onresize(this.camera.width,this.camera.height,this.camera))});return b}(Engine.Node.Transform.Anchor,Engine.Camera);Engine.UI.Box=function(d,c){function b(a){d.call(this,a);a&&a.on&&(a.on=null);this.appendChild(new c(Object.merge({},a,d.prototype,{name:"background",fill:this.fill,stroke:this.stroke,width:this.width,height:this.height},!1)))}Class.extend(b,d);b.property({fill:"",stroke:""});b.method({setFill:function(a){this.background.setFill(a)},setStroke:function(a){this.background.setStroke(a)},setBounds:function(a,b,c,d){this._super(a,b,c,d);this.background&&this.background.setSize(this.width,this.height)}});
return b}(Engine.Node.Transform.Anchor,Engine.Geometry.Rectangle);Engine.UI.Text=function(d,c,b,a,e,f){function g(a){d.call(this,a);this.on(b.READY,k);this.appendChild(new b(h(this,a)));a=this[g.LABEL];for(var c=0,e=l.length;c<e;c++){var f=l[c];f in b.prototype&&(this[f]=a[f])}}function h(a,c){for(var d={},e=0,f=l.length;e<f;e++){var h=l[e];c&&h in c&&(d[h]=c[h])}d.name=g.LABEL;(d.subscribers={})[b.READY]=a;return d}function k(){var a=this[g.LABEL];a&&this.setSize(a.width,a.height)}function m(){var b=arguments,c=a.call(b),d=f.call(b,1);!d.length&&d.push.apply(d,
b);return function(){var a=this[g.LABEL],f=a[c];e.apply(arguments,b);if(!f.apply(a,arguments))return!1;for(var f=0,h=d.length;f<h;f++){var l=d[f];this[l]=a[l]}k.call(this);return!0}}var l="font text minWidth minHeight maxWidth maxHeight spacing lineHeight textAlign padding paddingLeft paddingRight paddingTop paddingBottom fill image color repeat stroke".split(" ");Class.extend(g,d);g.LABEL="label";c=0;for(var n=l.length;c<n;c++){var p=l[c];p in b.prototype&&g.property(p,b.prototype[p])}g.method({setFont:m("set",
"font"),setText:m("set","text"),setFill:m("set","fill","image","color","repeat"),setStroke:m("set","stroke"),setSpacing:m("set","spacing"),setLineHeight:m("set","lineHeight"),setTextAlign:m("set","textAlign"),setPadding:m("set","padding","paddingLeft","paddingTop","paddingRight","paddingBottom"),setMinWidth:m("set","minWidth"),setMinHeight:m("set","minHeight"),setMaxWidth:m("set","maxWidth"),setMaxHeight:m("set","maxHeight")});return g}(Engine.Node.Transform.Anchor,Engine.Font,Engine.Geometry.Shape.Text,
Array.prototype.shift,Array.prototype.unshift,Array.prototype.splice);Engine.UI.Widget=function(d,c){function b(a){d.Box.call(this,a);this.font=this.font instanceof c?this.font:b.prototype.font;this.input=a&&a.hasOwnProperty("input")?a.input:this.input}Class.extend(b,d.Box);b.property({font:null,input:null});b.method("getInput",function(){return this.input});return b}(Engine.UI,Engine.Font);Engine.UI.Widget.Fieldset=function(d){function c(b){d.call(this,b);this.fields={}}Class.extend(c,d);c.property({focusable:!0,fields:null});c.method({getInput:function(){var b=this.fields,a=this.input={},c,d;for(c in b)b.hasOwnProperty(c)&&(d=b[c],a[c]=d.getInput?d.getInput():d.input);return this._super()},appendChild:function(b,a){b instanceof d&&b.name&&(this.fields[b.name]=b,b.fieldset=this);return this._super(b,a)},removeChild:function(b){this.fields[b.name]&&(b.fieldset=null,delete this.fields[b.name]);
return this._super(b)}});return c}(Engine.UI.Widget);Engine.UI.Widget.Checkbox=function(d,c){function b(a){c.call(this,a);this.input&&this.trigger(b.CHECKED)}Class.extend(b,c);b.CHECKED="checked";b.UNCHECKED="unchecked";b.property({onmousedown:function(){this._super();this.toggleInput()},input:!1});b.method("toggleInput",function(){this.input=!this.input;this.trigger(this.input?b.CHECKED:b.UNCHECKED)});return b}(Engine.UI,Engine.UI.Widget);Engine.UI.Widget.Radio=function(d){function c(b){d.call(this,b);this.checked&&this.trigger(c.CHECKED)}Class.extend(c,d);c.CHECKED="checked";c.UNCHECKED="unchecked";c.property({input:!1,fieldset:null,checked:!1,onmousedown:function(){this._super();this.setChecked()}});c.method({getInput:function(){return this.checked?this._super():null},setChecked:function(){if(!this.checked){var b=this.fieldset;if(b&&this.name){var a=b.fields[this.name];a&&a.checked&&(a.checked=!1,a.trigger(c.UNCHECKED));b.fields[this.name]=
this}this.checked=!0;this.trigger(c.CHECKED)}}});return c}(Engine.UI.Widget);Engine.UI.Widget.Select=function(d,c,b){function a(b){c.call(this,b);this.appendChild(new a.Text(Object.merge({font:this.font},b&&b.text)));this.optionsChildren={};this.option=this.option||{};this.option.text=this.option.text||{};this.option.text.font=this.font}function e(a){var b=a.getFirstOptionChild();b&&(b.marginTop=a.height-a.text.bottom,b.update())}Class.extend(a,c);var f=null;a.property({focusable:!0,option:null,options:null,optionsChildren:null,opened:!1,onfocus:function(){this.open()},onblur:function(){this.close()},
onmousedown:function(){this.open()},onmouseclick:function(a){f!==a.parent&&this.close()}});a.method({getFirstOptionChild:function(){for(var b=0,c=this.children.length;b<c;b++)if(this.children[b]instanceof a.Option)return this.children[b];return null},toggle:function(){return this[this.opened?"close":"open"]()},open:function(){if(!this.opened&&Object.keys(this.options).length){this.opened=!0;f=b.pressed;for(var c in this.options)if(this.options.hasOwnProperty(c)){var d;this.appendChild(d=new a.Option(this.option));
d.optionName=c;d.text.setText(String(this.options[c]));this.optionsChildren[c]=d;this.input===c&&d.trigger(a.Option.CHECKED)}e(this)}},close:function(){if(this.opened){this.opened=!1;for(var a in this.optionsChildren)this.optionsChildren.hasOwnProperty(a)&&(this.removeChild(this.optionsChildren[a]),delete this.optionsChildren[a])}},setInput:function(a,b){this.text.setText(b);this.input=a;e(this)}});return a}(Engine.UI,Engine.UI.Widget,Engine.Input);Engine.UI.Widget.Select.Text=function(d){function c(b){d.call(this,b)}Class.extend(c,d);c.property({name:"text",text:"",anchors:{centerv:"parent.centerv",left:"parent.left"},marginLeft:15});return c}(Engine.UI.Text);Engine.UI.Widget.Select.Option=function(d,c){function b(a){d.call(this,a);this.appendChild(new c(a&&a.text))}Class.extend(b,d);b.CHECKED="checked";b.UNCHECKED="unchecked";b.property({optionName:null,anchors:{centerh:"parent.centerh",top:"prev.bottom"},onmousedown:function(a){(a=this.parent.input)&&this.parent.optionsChildren[a].trigger(b.UNCHECKED);this.parent.setInput(this.optionName,this.text.label.text);this.trigger(b.CHECKED)}});return b}(Engine.UI.Box,Engine.UI.Widget.Select.Text);Engine.UI.Widget.Text=function(d,c,b,a){function e(a){d.call(this,a);this.appendChild(new e.Text(Object.merge({font:this.font},a&&a.text)));this.appendChild(new e.Pointer(a&&a.pointer));this.pointer.timer.text=this.text;this.text.setText(a&&a.text&&"undefined"!==typeof a.text.text?a.text.text:this.input)}Class.extend(e,d);e.property({focusable:!0,onkeypress:function(a){var b=this.text.getPointerText();a.text&&(b=this.text.getPointerText(),this.text.setText(b.prev+a.text+b.next),this.pointer.move(a.text.length))},
onkeydown:function(a){var b=this.text,c=this.text.getPointerText();switch(a.key){case "BACKSPACE":b.setText(c.prev.substring(0,c.prev.length-1)+c.next);case "ARROW_LEFT":this.pointer.move(-1);break;case "DELETE":b.setText(c.prev+c.next.substring(1,c.next.length));break;case "ARROW_RIGHT":this.pointer.move(1);break;case "HOME":this.pointer.move(-this.pointer.position);break;case "END":this.pointer.move(this.text.label.children.length-this.pointer.position)}},onfocus:function(){this.pointer.append()},
onblur:function(){this.pointer.remove()},onmousedown:function(a){a=a.sceneX-this.left-this.text.left;var b=this.pointer,c=this.text.label.children,d=c.length;if(0>=a)b.move(-b.position);else if(c.length&&a>=c.last().right)b.move(d-b.position);else for(;1<d--;){var e=c[d];if(c[d-1].right<=a&&e.right>=a){b.move(d-b.position);break}}}});e.method({setInput:function(a){this.input!==a&&(this.text.setText(a),this.pointer.move(this.text.label.children.length-this.pointer.position))}});return e}(Engine.UI.Widget,
Engine.UI,Engine.Timer,Engine.Font);(function(d,c){function b(){g.stop();e=null;clearTimeout(f);f=0}var a=d.REPEAT_EVENT_TIMEOUT=500,e=null,f=0,g=new Engine.Timer({duration:Infinity,delay:50,on:{step:function(){e&&e.fire(Engine.Input.getFocusedLeaf())}}});d.decorate({onkeydown:function(b){e=b;f||(f=setTimeout(g.play.bind(g),a));this._super(b)},onkeypress:function(a){a.text&&(e=a);this._super(a)},onblur:function(){b();this._super()}});d.property("onkeyup",function(a){b()})})(Engine.UI.Widget.Text,Engine.Input);Engine.UI.Widget.Text.Text=function(d){function c(b){d.call(this,b)}Class.extend(c,d);c.property({name:"text",anchors:{centerv:"parent.centerv",left:"parent.left"},marginLeft:15,marginRight:15,_lastActionTime:0});c.method({getPointerText:function(){var b=this.label.text,a=this.parent.pointer.position;return{prev:b.substring(0,a),next:b.substring(a,b.length)}},setText:function(b){this._super(b);if(this.parent&&this.right+this.marginRight>=this.parent.right)return this.setText(b.substring(0,b.length-
1));this.parent&&(this.parent.input=this.label.text)}});return c}(Engine.UI.Text);Engine.UI.Widget.Text.Pointer=function(d,c){function b(a){d.call(this,a);this["default"]={fill:this.fill};this.timer=new b.Timer({pointer:this});this.setFill(this.TRANSPARENT)}Class.extend(b,d);b.property({TRANSPARENT:"rgba(0, 0, 0, 0)",name:"pointer",width:1,height:25,fill:"white",anchors:{centerv:"parent.centerv"},"default":null,position:null});b.method({append:function(){var a=this.parent.text,b=a.label;if(!b.font.complete)return b.on("load",this.append.bind(this));null===this.position&&(this.position=
b.children.length);a=b.children[this.position-1];this.setPosition((a?a.right:-2)+b.parent.left,this.top);this.timer.play();this.setFill(this["default"].fill)},remove:function(){this.position=null;this.timer.stop();this.setFill(this.fill=this.TRANSPARENT)},move:function(a){if("undefined"!==typeof a){a=parseInt(a,10);var b=this.parent.text;0>=this.position&&0>a||this.position>=b.label.children.length&&0<a||(this.position+=a,b=b.label.children[this.position-1],this.setPosition((b?b.right:-2)+b.label.parent.left,
this.top),b._lastActionTime=c())}}});return b}(Engine.UI.Box,Engine.now);Engine.UI.Widget.Text.Pointer.Timer=function(d,c){function b(a){d.call(this,a)}Class.extend(b,d);b.property({delay:500,loop:!0,text:null,pointer:null,onstep:function(){var a=this.pointer;if(this.text&&1E3>=c()-this.text._lastActionTime)return a.setFill(a["default"].fill);a.setFill(a.fill=a.fill===a["default"].fill?a.TRANSPARENT:a["default"].fill)}});return b}(Engine.Timer,Engine.now);Engine.UI.Widget.Scrollbar=function(d){function c(a){d.call(this,a);this.appendChild(new c.Thumb(a&&a.thumb));this.setValue(this.value)}Class.extend(c,d);c.VALUECHANGED="valuechanged";c.property({min:0,max:100,value:0,width:300,height:20,fill:"gray",scrollable:!0,_padding:0});var b=function(){var a=new Matrix,b=[];return function(c){this.global.inverse(a).byVector(c.sceneX,c.sceneY,b);c=b[0];var d=this._padding,h=this.width-this._padding;c<d&&(c=d);c>h&&(c=h);c=this.calculateValue(c+this.left);this.setValue(c)}}();
c.method({calculateValue:function(a){return(a-this.left-this._padding)/(this.width-2*this._padding)*(this.max-this.min)+this.min},setValue:function(a){"number"!==typeof a&&Engine.log(new TypeError,Engine.ERROR);(a<this.min||a>this.max)&&Engine.log(new RangeError,Engine.ERROR);this.thumb instanceof c.Thumb||Engine.log(new ReferenceError,Engine.ERROR);this.value=a;this.thumb.setPosition((this.width-2*this._padding)*(a-this.min)/(this.max-this.min)+this.thumb.marginH/2,this.thumb.top);this.trigger(c.VALUECHANGED,
a)},onmousedown:b,ondragstart:function(a){a.stopPropagation()},ondragmove:b});return c}(Engine.UI.Widget);Engine.UI.Widget.Scrollbar.Thumb=function(d,c){function b(a){c.call(this,a)}Class.extend(b,c);b.property({name:"thumb",width:50,height:d.prototype.height,fill:"red",marginH:0,anchors:{centerv:"parent.centerv"}});b.decorate({setBounds:function(){this._super.apply(this,arguments);this.parent&&(this.parent._padding=this.width/2+this.marginH/2)}});return b}(Engine.UI.Widget.Scrollbar,Engine.UI.Box);Engine.Storage=function(d){var c=new Model;c.TEXT="textType";c.OBJECT="objectType";c.set=function(b,a,c,f,g){g(new d.NotImplemented);return this};c.get=function(b,a,c){c(new d.NotImplemented);return this};c.remove=function(b,a,c){c(new d.NotImplemented);return this};c.clear=function(b,a){a(new d.NotImplemented);return this};return c}(Engine.Error);(function(d,c){function b(a){a()}function a(a,b){a(new c)}function e(a,b,c,d){q.open(n,function(e){e=e.put(b,a);e.onerror=d;e.onsuccess=c},d)}function f(a,b,c){q.open(p,function(d){d=d.get(a);d.onerror=c;d.onsuccess=function(a){a=a.target.result;if("undefined"===typeof a)return c();b(a)}},c)}function g(a,b,c){q.open(n,function(d){d=d.delete(a);d.onerror=c;d.onsuccess=b},c)}function h(a,b){q.open(n,function(c){c=c.clear();c.onerror=b;c.onsuccess=a},b)}if(!d._implemented){var k=this.indexedDB||this.webkitIndexedDB||
this.mozIndexedDB||this.msIndexedDB,m=this.IDBTransaction||this.webkitIDBTransaction,l=this.IDBFactory;if(k){d._implemented="html-indexeddb";var n=m.READ_WRITE||"readwrite",p=m.READ_ONLY||"readonly",q={NEW_API:!(!l||!l.prototype.deleteDatabase),DB_NAME:"SGP_Storage",DB_VERSION:1,STORE_NAME:"SGP",idb:null,open:function(a,b,c){if(this.idb)return this.transaction(a,b,c);var d=this.NEW_API?k.open(this.DB_NAME,this.DB_VERSION):k.open(this.DB_NAME);d.onupgradeneeded=function(a){a.target.result.createObjectStore(q.STORE_NAME)};
d.onerror=c;d.onsuccess=function(d){var e=q.idb=d.target.result;if(q.NEW_API||q.DB_VERSION===parseInt(e.version))return q.transaction(a,b,c);d=e.setVersion(q.DB_VERSION);d.onerror=c;d.onsuccess=function(d){e.createObjectStore(q.STORE_NAME);d.target.transaction.onsuccess=q.transaction.bind(q,a,b,c)}}},transaction:function(a,b,c){if(!this.idb)throw new ReferenceError;a=a||n;a=this.idb.transaction(q.STORE_NAME,a===n?n:p).objectStore(q.STORE_NAME);b(a)}};Class.decorate(d,"set",function(c,f,g,h,k){if(g!==
d.TEXT&&g!==d.OBJECT)return this._super.apply.bind(this._super,this,arguments)(c,f,g,h,k);h=b.bind(null,h);k=a.bind(null,k);e(c,f,h,k);return this});Class.decorate(d,"get",function(b,c,d){d=a.bind(null,d);f(b,c,d);return this});Class.decorate(d,"remove",function(c,d,e){d=b.bind(null,d);e=a.bind(null,e);g(c,d,e);return this});Class.decorate(d,"clear",function(c,d){c=b.bind(null,c);d=a.bind(null,d);h(c,d);return this})}}}).call(this,Engine.Storage,Engine.Error);(function(d,c,b){function a(a){a()}function e(a,b){a(new c)}function f(a,c,d,e,g){var h=arguments;g=g||1;var k=setTimeout(function(){e=d=b;if(1===g)return f(a,c,h[2],h[3],2);h[3]()},700);d=function(){clearTimeout(k);h[2]()};e=function(){clearTimeout(k);h[3].apply(null,arguments)};l.open("readwrite",function(){l.executeSql("INSERT OR REPLACE INTO {} (key, value) VALUES (?,?)".format(escape(l.STORE_NAME)),[a,c],d,e)},e)}function g(a,b,c){l.open("readonly",function(){l.executeSql("SELECT value FROM {} WHERE key=?".format(escape(l.STORE_NAME)),
[a],function(a,d){if(!d.rows.length)return c();var e=d.rows.item(0);b(e.value)},c)},c)}function h(a,b,c){l.open("readwrite",function(){l.executeSql("DELETE FROM {} WHERE key=?".format(escape(l.STORE_NAME)),[a],b,c)},c)}function k(a,b){l.open("readwrite",function(){l.executeSql("DELETE FROM {}".format(escape(l.STORE_NAME)),null,a,b)},b)}if(!d._implemented){var m=this.openDatabase||this.openDatabaseSync;if(m){d._implemented="html-websql";var l={ASYNC_MODE:!!this.openDatabase,DB_NAME:"SGP_Storage",STORE_NAME:"SGP",
sqldb:null,tx:null,open:function(a,b,c){if(this.sqldb)return this.transaction(a,b,c);this.sqldb=m(this.DB_NAME,"1.0",this.DB_NAME,1048576);this.transaction("readwrite",function(){l.executeSql("CREATE TABLE IF NOT EXISTS {} (key TEXT PRIMARY KEY, value TEXT)".format(escape(l.STORE_NAME)),null,b,c)},c)},transaction:function(a,b,c){var d=this;this.sqldb["readonly"===a?"readTransaction":"transaction"](function(a){d.tx=a;b()})},executeSql:function(a,b,c,d){b=b||[];if(this.ASYNC_MODE)this.tx.executeSql(a,
b,c,d);else try{var e=this.tx.executeSql(a,b);c(this.tx,e)}catch(f){d(f)}}};Class.decorate(d,"set",function(b,c,g,h,k){if(g!==d.TEXT)return this._super.apply(this,arguments);h=a.bind(null,h);k=e.bind(null,k);f(b,c,h,k);return this});Class.decorate(d,"get",function(a,b,c){c=e.bind(null,c);g(a,b,c);return this});Class.decorate(d,"remove",function(b,c,d){c=a.bind(null,c);d=e.bind(null,d);h(b,c,d);return this});Class.decorate(d,"clear",function(b,c){b=a.bind(null,b);c=e.bind(null,c);k(b,c);return this})}}}).call(this,
Engine.Storage,Engine.Error,Engine.NOP);(function(d,c,b){Class.decorate(d,"set",function(a,e,f,g,h){if("undefined"===typeof a||"undefined"===typeof e)throw new c.Type;"string"!==typeof f&&(h=g,g=f,f=d.TEXT);a&&"object"===typeof a&&(a=JSON.stringify(a));g="function"===typeof g?g:b;h="function"===typeof h?h:b;f===d.TEXT&&"object"===typeof e&&(e=JSON.stringify(e));return this._super(a,e,f,g,h)});Class.decorate(d,"get",function(a,d,f){if("undefined"===typeof a)throw new c.Type;a&&"object"===typeof a&&(a=JSON.stringify(a));d="function"===typeof d?
d:b;f="function"===typeof f?f:b;return this._super(a,d,f)});Class.decorate(d,"remove",function(a,d,f){if("undefined"===typeof a)throw new c.Type;a&&"object"===typeof a&&(a=JSON.stringify(a));d="function"===typeof d?d:b;f="function"===typeof f?f:b;return this._super(a,d,f)});Class.decorate(d,"clear",function(a,c){a="function"===typeof a?a:b;c="function"===typeof c?c:b;return this._super(a,c)})})(Engine.Storage,Engine.Error,Engine.NOP);Engine.Compass=function(d){function c(b){d.call(this,b);this.gamma=this.beta=this.alpha=0;this.acceleration={x:0,y:0,z:0,alpha:0,beta:0,gamma:0}}c.ORIENTATION="orientation";c.MOTION="motion";Class.extend(c,d);c.property({alpha:0,beta:0,gamma:0,acceleration:{x:0,y:0,z:0,alpha:0,beta:0,gamma:0},isEnabled:!1});c.method({enable:function(){return this.isEnabled?!1:this.isEnabled=!0},disable:function(){if(!this.isEnabled)return!1;this.isEnabled=!1;return!0},toggle:function(){this.isEnabled?this.disable():
this.enable()},destroy:function(){this.disable()}});return c}(Model);(function(d){function c(b){var c=e(b.alpha),h=e(b.beta);b=e(b.gamma);for(var k=0,m=a.length;k<m;k++){var l=a[k];if(l.alpha!==c||l.beta!==h||l.gamma!==b)l.alpha=c,l.beta=h,l.gamma=b,l.trigger(d.ORIENTATION,c,h,b)}}function b(b){var c=b.rotationRate;b=b.acceleration;for(var h=e(c.alpha),k=e(c.beta),c=e(c.gamma),m=e(b.x),l=e(b.y),n=e(b.z),p=0,q=a.length;p<q;p++){var r=a[p];b=r.acceleration;if(b.alpha!==h||b.beta!==k||b.gamma!==c||b.x!==m||b.y!==l||b.z!==n)b.alpha=h,b.beta=k,b.gamma=c,b.x=m,b.y=l,b.z=
n,r.trigger(d.MOTION,m,l,n,h,k,c)}}var a=[],e=Math.round;d.decorate({enable:function(){if(!this._super())return!1;a.add(this);1===a.length&&(window.addEventListener("deviceorientation",c),window.addEventListener("devicemotion",b));return!0},disable:function(){if(!this._super())return!1;a.remove(this);a||(window.removeEventListener("deviceorientation",c),window.removeEventListener("devicemotion",b));return!0}})})(Engine.Compass);(function(d){function c(){this.removeEventListener&&(this.removeEventListener("DOMContentLoaded",c),this.removeEventListener("load",c));d.start()}this.addEventListener("DOMContentLoaded",c);this.addEventListener("load",c,!1)}).call(this,Engine);}).call(this);
