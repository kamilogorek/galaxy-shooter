/**@license
* Solpeo Engine
* v1.0 pre2
* Copyright (c) 2009-2013 Solpeo sp. z o.o.
* http://www.solpeo.com
*
* License rights of Application is non-payable and non-exclusive license for
* indefinite period of time for use of Application on the territory of the
* whole world, solely for the purposes of internal usage of non-commercial
* character.
* Any download or installation or usage of Application is deemed acceptance
* of License Terms, which you can find under address
* http://cdn.solpeo.com/engine/solpeo_engine-1.0.pre2.license.txt
*
* If you are using the Application, you are obliged to:
* a) present in Application and/or Modification information about copyrights
* entitled to SOLPEO by showing the following text: All rights reserved
* SOLPEO 2013,
* (b) place on Modification the following communicate: "Provided by SOLPEO",
* which shall be placed on user's interface bar
* (c) define the company of Licensor under name SOLPEO, as a source of origin
* of Application being also a base for any Modification
* (d) disseminate SOLPEO's logo available under address
* http://cdn.solpeo.com/logo/logopack_v1.zip as a part of Application
* and/or Modification without introducing any changes, in
* particular concerning its form and/or content.*
**/

global=window;global.RTree=function(b){var c=3,a=6;isNaN(b)||(c=Math.floor(b/2),a=b);var d={x:0,y:0,w:0,h:0,id:"root",nodes:[]},e=function(){var a={};return function(e){var d=0;e in a?d=a[e]++:a[e]=0;return e+"_"+d}}();RTree.Rectangle.squarified_ratio=function(a,e,d){var c=(a+e)/2;a*=e;return a*d/(a/(c*c))};var f=function(a,e,d){var f=[],b=[],s=[];if(!a||!RTree.Rectangle.overlap_rectangle(a,d))return s;a={x:a.x,y:a.y,w:a.w,h:a.h,target:e};b.push(d.nodes.length);f.push(d);do if(d=f.pop(),e=b.pop()-1,"target"in a)for(;0<=
e;){var p=d.nodes[e];if(RTree.Rectangle.overlap_rectangle(a,p))if(a.target&&"leaf"in p&&p.leaf===a.target||!a.target&&("leaf"in p||RTree.Rectangle.contains_rectangle(p,a))){"nodes"in p?(s=h(p,!0,[],p),d.nodes.splice(e,1)):s=d.nodes.splice(e,1);RTree.Rectangle.make_MBR(d.nodes,d);delete a.target;d.nodes.length<c&&(a.nodes=h(d,!0,[],d));break}else"nodes"in p&&(b.push(e),f.push(d),d=p,e=p.nodes.length);e-=1}else if("nodes"in a){d.nodes.splice(e+1,1);0<d.nodes.length&&RTree.Rectangle.make_MBR(d.nodes,
d);for(e=0;e<a.nodes.length;e++)g(a.nodes[e],d);a.nodes.length=0;0==f.length&&1>=d.nodes.length?(a.nodes=h(d,!0,a.nodes,d),d.nodes.length=0,f.push(d),b.push(1)):0<f.length&&d.nodes.length<c?(a.nodes=h(d,!0,a.nodes,d),d.nodes.length=0):delete a.nodes}else RTree.Rectangle.make_MBR(d.nodes,d);while(0<f.length);return s},h=function(a,e,d,f){var c=[];if(!RTree.Rectangle.overlap_rectangle(a,f))return d;c.push(f.nodes);do{f=c.pop();for(var b=f.length-1;0<=b;b--){var g=f[b];RTree.Rectangle.overlap_rectangle(a,
g)&&("nodes"in g?c.push(g.nodes):"leaf"in g&&(e?d.push(g):d.push(g.leaf)))}}while(0<c.length);return d},g=function(e,d){var f;if(0==d.nodes.length)d.x=e.x,d.y=e.y,d.w=e.w,d.h=e.h,d.nodes.push(e);else{var b=-1,g=[],h;g.push(d);var p=d.nodes;do{-1!=b&&(g.push(p[b]),p=p[b].nodes,b=-1);for(var t=p.length-1;0<=t;t--){var v=p[t];if("leaf"in v){b=-1;break}var q=RTree.Rectangle.squarified_ratio(v.w,v.h,v.nodes.length+1),u=Math.max(v.x+v.w,e.x+e.w)-Math.min(v.x,e.x),y=Math.max(v.y+v.h,e.y+e.h)-Math.min(v.y,
e.y),v=RTree.Rectangle.squarified_ratio(u,y,v.nodes.length+2);if(0>b||Math.abs(v-q)<h)h=Math.abs(v-q),b=t}}while(-1!=b);b=e;do{if(f&&"nodes"in f&&0==f.nodes.length)for(h=f,f=g.pop(),p=0;p<f.nodes.length;p++){if(f.nodes[p]===h||0==f.nodes[p].nodes.length){f.nodes.splice(p,1);break}}else f=g.pop();if("leaf"in b||"nodes"in b||"[object Array]"===Object.prototype.toString.call(b)){if("[object Array]"===Object.prototype.toString.call(b)){for(h=0;h<b.length;h++)RTree.Rectangle.expand_rectangle(f,b[h]);f.nodes=
f.nodes.concat(b)}else RTree.Rectangle.expand_rectangle(f,b),f.nodes.push(b);if(f.nodes.length<=a)b={x:f.x,y:f.y,w:f.w,h:f.h};else{h=b=f.nodes;p=h.length-1;t=0;q=h.length-1;v=0;y=u=void 0;for(u=h.length-2;0<=u;u--)y=h[u],y.x>h[t].x?t=u:y.x+y.w<h[p].x+h[p].w&&(p=u),y.y>h[v].y?v=u:y.y+y.h<h[q].y+h[q].h&&(q=u);u=Math.abs(h[p].x+h[p].w-h[t].x);y=Math.abs(h[q].y+h[q].h-h[v].y);u>y?p>t?(u=h.splice(p,1)[0],y=h.splice(t,1)[0]):(y=h.splice(t,1)[0],u=h.splice(p,1)[0]):q>v?(u=h.splice(q,1)[0],y=h.splice(v,1)[0]):
(y=h.splice(v,1)[0],u=h.splice(q,1)[0]);for(h=[{x:u.x,y:u.y,w:u.w,h:u.h,nodes:[u]},{x:y.x,y:y.y,w:y.w,h:y.h,nodes:[y]}];0<b.length;){for(var p=b,t=h[0],q=h[1],u=RTree.Rectangle.squarified_ratio(t.w,t.h,t.nodes.length+1),y=RTree.Rectangle.squarified_ratio(q.w,q.h,q.nodes.length+1),D=void 0,A=void 0,v=void 0,z=p.length-1;0<=z;z--){var x=p[z],C,w;C=Math.min(t.x,x.x);w=Math.min(t.y,x.y);C=Math.max(t.x+t.w,x.x+x.w)-C;w=Math.max(t.y+t.h,x.y+x.h)-w;w=Math.abs(RTree.Rectangle.squarified_ratio(C,w,t.nodes.length+
2)-u);var B;B=Math.min(q.x,x.x);C=Math.min(q.y,x.y);B=Math.max(q.x+q.w,x.x+x.w)-B;x=Math.max(q.y+q.h,x.y+x.h)-C;x=Math.abs(RTree.Rectangle.squarified_ratio(B,x,q.nodes.length+2)-y);if(!A||!D||Math.abs(x-w)<D)A=z,D=Math.abs(x-w),v=x<w?q:t}u=p.splice(A,1)[0];t.nodes.length+p.length+1<=c?(t.nodes.push(u),RTree.Rectangle.expand_rectangle(t,u)):q.nodes.length+p.length+1<=c?(q.nodes.push(u),RTree.Rectangle.expand_rectangle(q,u)):(v.nodes.push(u),RTree.Rectangle.expand_rectangle(v,u))}b=h;1>g.length&&(f.nodes.push(h[0]),
g.push(f),b=h[1])}}else RTree.Rectangle.expand_rectangle(f,b),b={x:f.x,y:f.y,w:f.w,h:f.h}}while(0<g.length)}};this.get_tree=function(){return d};this.set_tree=function(a,e){e||(e=d);var f=e;f.nodes=a.nodes;f.x=a.x;f.y=a.y;f.w=a.w;f.h=a.h;return f};this.search=function(a,e,f){if(1>arguments.length)throw"Wrong number of arguments. RT.Search requires at least a bounding rectangle.";switch(arguments.length){case 1:arguments[1]=!1;case 2:arguments[2]=[];case 3:arguments[3]=d;default:arguments.length=4}return h.apply(this,
arguments)};this.toJSON=function(a,f){var c=[],b=[],h={},g=3,p=1,t="";if(a&&!RTree.Rectangle.overlap_rectangle(a,d))return"";f?(g+=4,b.push(f.nodes.length),c.push(f.nodes),t+="var main_tree = {x:"+f.x.toFixed()+",y:"+f.y.toFixed()+",w:"+f.w.toFixed()+",h:"+f.h.toFixed()+",nodes:["):(b.push(d.nodes.length),c.push(d.nodes),t+="var main_tree = {x:"+d.x.toFixed()+",y:"+d.y.toFixed()+",w:"+d.w.toFixed()+",h:"+d.h.toFixed()+",nodes:[");do{var v=c.pop(),q=b.pop()-1;for(0<=q&&q<v.length-1&&(t+=",");0<=q;){var u=
v[q];if(!a||RTree.Rectangle.overlap_rectangle(a,u))if(u.nodes)if(p>=g){var y=e("saved_subtree"),t=t+("{x:"+u.x.toFixed()+",y:"+u.y.toFixed()+",w:"+u.w.toFixed()+",h:"+u.h.toFixed()+",load:'"+y+".js'}");h[y]=this.toJSON(a,u);0<q&&(t+=",")}else t+="{x:"+u.x.toFixed()+",y:"+u.y.toFixed()+",w:"+u.w.toFixed()+",h:"+u.h.toFixed()+",nodes:[",p+=1,b.push(q),c.push(v),v=u.nodes,q=u.nodes.length;else u.leaf?(y=u.leaf.toJSON?u.leaf.toJSON():JSON.stringify(u.leaf),t+="{x:"+u.x.toFixed()+",y:"+u.y.toFixed()+",w:"+
u.w.toFixed()+",h:"+u.h.toFixed()+",leaf:"+y+"}",0<q&&(t+=",")):u.load&&(t+="{x:"+u.x.toFixed()+",y:"+u.y.toFixed()+",w:"+u.w.toFixed()+",h:"+u.h.toFixed()+",load:'"+u.load+"'}",0<q&&(t+=","));q-=1}0>q&&(t+="]}",p-=1)}while(0<c.length);var t=t+";",D;for(D in h)t+="\nvar "+D+" = function(){"+h[D]+" return(main_tree);};";return t};this.remove=function(a,e){if(1>arguments.length)throw"Wrong number of arguments. RT.remove requires at least a bounding rectangle.";switch(arguments.length){case 1:arguments[1]=
!1;case 2:arguments[2]=d;default:arguments.length=3}if(!1===arguments[1]){var c=0,b=[];do c=b.length,b=b.concat(f.apply(this,arguments));while(c!=b.length);return b}return f.apply(this,arguments)};this.insert=function(a,e){if(2>arguments.length)throw"Wrong number of arguments. RT.Insert requires at least a bounding rectangle and an object.";return g({x:a.x,y:a.y,w:a.w,h:a.h,leaf:e},d)}};
RTree.Rectangle=function(b,c,a,d){var e,f,h,g,k,m;b.x?(e=b.x,h=b.y,0!==b.w&&!b.w&&b.x2?(k=b.x2-b.x,m=b.y2-b.y):(k=b.w,m=b.h)):(e=b,h=c,k=a,m=d);f=e+k;g=h+m;this.x1=this.x=function(){return e};this.y1=this.y=function(){return h};this.x2=function(){return f};this.y2=function(){return g};this.w=function(){return k};this.h=function(){return m};this.toJSON=function(){return'{"x":'+e.toString()+', "y":'+h.toString()+', "w":'+k.toString()+', "h":'+m.toString()+"}"};this.overlap=function(a){return this.x()<
a.x2()&&this.x2()>a.x()&&this.y()<a.y2()&&this.y2()>a.y()};this.expand=function(a){var d=Math.min(this.x(),a.x()),f=Math.min(this.y(),a.y());k=Math.max(this.x2(),a.x2())-d;m=Math.max(this.y2(),a.y2())-f;e=d;h=f;return this};this.setRect=function(a,e,d,f){}};RTree.Rectangle.overlap_rectangle=function(b,c){return b.x<c.x+c.w&&b.x+b.w>c.x&&b.y<c.y+c.h&&b.y+b.h>c.y};RTree.Rectangle.contains_rectangle=function(b,c){return b.x+b.w<=c.x+c.w&&b.x>=c.x&&b.y+b.h<=c.y+c.h&&b.y>=c.y};
RTree.Rectangle.expand_rectangle=function(b,c){var a=Math.min(b.x,c.x),d=Math.min(b.y,c.y);b.w=Math.max(b.x+b.w,c.x+c.w)-a;b.h=Math.max(b.y+b.h,c.y+c.h)-d;b.x=a;b.y=d;return b};RTree.Rectangle.make_MBR=function(b,c){if(1>b.length)return{x:0,y:0,w:0,h:0};c?c.x=b[0].x:c={x:b[0].x,y:b[0].y,w:b[0].w,h:b[0].h};c.y=b[0].y;c.w=b[0].w;c.h=b[0].h;for(var a=b.length-1;0<a;a--)RTree.Rectangle.expand_rectangle(c,b[a]);return c};var JSON;JSON||(JSON={});
(function(){function b(a,e){var d,g,s,p,t=f,v,q=e[a];q&&"object"==typeof q&&"function"==typeof q.toJSON&&(q=q.toJSON(a));"function"==typeof k&&(q=k.call(e,a,q));switch(typeof q){case "string":return c(q);case "number":return isFinite(q)?String(q):"null";case "boolean":case "null":return String(q);case "object":if(!q)return"null";f+=h;v=[];if("[object Array]"===Object.prototype.toString.apply(q)){p=q.length;for(d=0;d<p;d+=1)v[d]=b(d,q)||"null";s=0===v.length?"[]":f?"[\n"+f+v.join(",\n"+f)+"\n"+t+"]":
"["+v.join(",")+"]";f=t;return s}if(k&&"object"==typeof k)for(p=k.length,d=0;d<p;d+=1)"string"==typeof k[d]&&(g=k[d],s=b(g,q),s&&v.push(c(g)+(f?": ":":")+s));else for(g in q)Object.prototype.hasOwnProperty.call(q,g)&&(s=b(g,q),s&&v.push(c(g)+(f?": ":":")+s));s=0===v.length?"{}":f?"{\n"+f+v.join(",\n"+f)+"\n"+t+"}":"{"+v.join(",")+"}";f=t;return s}}function c(a){e.lastIndex=0;return e.test(a)?'"'+a.replace(e,function(a){var e=g[a];return"string"==typeof e?e:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+
'"':'"'+a+'"'}function a(a){return 10>a?"0"+a:a}"use strict";"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f,h,g={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},k;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,e,d){var c;h=f="";if("number"==typeof d)for(c=0;c<d;c+=1)h+=" ";else"string"==typeof d&&(h=d);k=e;if(!e||"function"==typeof e||"object"==typeof e&&"number"==typeof e.length)return b("",{"":a});throw Error("JSON.stringify");});"function"!=
typeof JSON.parse&&(JSON.parse=function(a,e){function f(a,d){var c,b,g=a[d];if(g&&"object"==typeof g)for(c in g)Object.prototype.hasOwnProperty.call(g,c)&&(b=f(g,c),void 0!==b?g[c]=b:delete g[c]);return e.call(a,d,g)}var c;a=String(a);d.lastIndex=0;d.test(a)&&(a=a.replace(d,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return c=eval("("+a+")"),"function"==typeof e?f({"":c},""):c;throw new SyntaxError("JSON.parse");})})();
SockJS=function(){var b=document,c=window,a={},d=function(){};d.prototype.addEventListener=function(e,d){this._listeners||(this._listeners={});e in this._listeners||(this._listeners[e]=[]);var f=this._listeners[e];-1===a.arrIndexOf(f,d)&&f.push(d)};d.prototype.removeEventListener=function(e,d){if(this._listeners&&e in this._listeners){var f=this._listeners[e],c=a.arrIndexOf(f,d);-1!==c&&(1<f.length?this._listeners[e]=f.slice(0,c).concat(f.slice(c+1)):delete this._listeners[e])}};d.prototype.dispatchEvent=
function(a){var e=a.type,d=Array.prototype.slice.call(arguments,0);this["on"+e]&&this["on"+e].apply(this,d);if(this._listeners&&e in this._listeners)for(var f=0;f<this._listeners[e].length;f++)this._listeners[e][f].apply(this,d)};var e=function(a,e){this.type=a;if("undefined"!=typeof e)for(var d in e)e.hasOwnProperty(d)&&(this[d]=e[d])};e.prototype.toString=function(){var a=[],e;for(e in this)if(this.hasOwnProperty(e)){var d=this[e];"function"==typeof d&&(d="[function]");a.push(e+"="+d)}return"SimpleEvent("+
a.join(", ")+")"};var f=function(a){this.events=a||[]};f.prototype.emit=function(e){var d=Array.prototype.slice.call(arguments,1);!this.nuked&&this["on"+e]&&this["on"+e].apply(this,d);-1===a.arrIndexOf(this.events,e)&&a.log("Event "+JSON.stringify(e)+" not listed "+JSON.stringify(this.events)+" in "+this)};f.prototype.nuke=function(a){this.nuked=!0;for(a=0;a<this.events.length;a++)delete this[this.events[a]]};a.random_string=function(a,e){e=e||37;var d,f=[];for(d=0;d<a;d++)f.push("abcdefghijklmnopqrstuvwxyz0123456789_".substr(Math.floor(Math.random()*
e),1));return f.join("")};a.random_number=function(a){return Math.floor(Math.random()*a)};a.random_number_string=function(e){var d=(""+(e-1)).length;return(Array(d+1).join("0")+a.random_number(e)).slice(-d)};a.getOrigin=function(a){return(a+"/").split("/").slice(0,3).join("/")};a.isSameOriginUrl=function(a,e){return e||(e=c.location.href),a.split("/").slice(0,3).join("/")===e.split("/").slice(0,3).join("/")};a.getParentDomain=function(a){return/^[0-9.]*$/.test(a)||/^\[/.test(a)||!/[.]/.test(a)?a:
a.split(".").slice(1).join(".")};a.objectExtend=function(a,e){for(var d in e)e.hasOwnProperty(d)&&(a[d]=e[d]);return a};a.polluteGlobalNamespace=function(){"_jp"in c||(c._jp={})};a.closeFrame=function(a,e){return"c"+JSON.stringify([a,e])};a.userSetCode=function(a){return 1E3===a||3E3<=a&&4999>=a};a.countRTO=function(a){var e;return 100<a?e=3*a:e=a+200,e};a.log=function(){c.console&&console.log&&console.log.apply&&console.log.apply(console,arguments)};a.bind=function(a,e){return a.bind?a.bind(e):function(){return a.apply(e,
arguments)}};a.flatUrl=function(a){return-1===a.indexOf("?")&&-1===a.indexOf("#")};a.amendUrl=function(e){var d=b.location;if(!e)throw Error("Wrong url for SockJS");if(!a.flatUrl(e))throw Error("Only basic urls are supported in SockJS");return 0===e.indexOf("//")&&(e=d.protocol+e),0===e.indexOf("/")&&(e=d.protocol+"//"+d.host+e),e=e.replace(/[/]+$/,""),e};a.arrIndexOf=function(a,e){for(var d=0;d<a.length;d++)if(a[d]===e)return d;return-1};a.arrSkip=function(e,d){var f=a.arrIndexOf(e,d);return-1===
f?e.slice():e.slice(0,f).concat(e.slice(f+1))};a.isArray=Array.isArray||function(a){return 0<={}.toString.call(a).indexOf("Array")};a.delay=function(a,e){return"function"==typeof a&&(e=a,a=0),setTimeout(e,a)};var h=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,g={"\x00":"\\u0000","\u0001":"\\u0001","\u0002":"\\u0002","\u0003":"\\u0003","\u0004":"\\u0004","\u0005":"\\u0005","\u0006":"\\u0006","\u0007":"\\u0007","\b":"\\b",
"\t":"\\t","\n":"\\n","\x0B":"\\u000b","\f":"\\f","\r":"\\r","\u000e":"\\u000e","\u000f":"\\u000f","\u0010":"\\u0010","\u0011":"\\u0011","\u0012":"\\u0012","\u0013":"\\u0013","\u0014":"\\u0014","\u0015":"\\u0015","\u0016":"\\u0016","\u0017":"\\u0017","\u0018":"\\u0018","\u0019":"\\u0019","\u001a":"\\u001a","\u001b":"\\u001b","\u001c":"\\u001c","\u001d":"\\u001d","\u001e":"\\u001e","\u001f":"\\u001f",'"':'\\"',"\\":"\\\\","\u007f":"\\u007f","\u0080":"\\u0080","\u0081":"\\u0081","\u0082":"\\u0082",
"\u0083":"\\u0083","\u0084":"\\u0084","\u0085":"\\u0085","\u0086":"\\u0086","\u0087":"\\u0087","\u0088":"\\u0088","\u0089":"\\u0089","\u008a":"\\u008a","\u008b":"\\u008b","\u008c":"\\u008c","\u008d":"\\u008d","\u008e":"\\u008e","\u008f":"\\u008f","\u0090":"\\u0090","\u0091":"\\u0091","\u0092":"\\u0092","\u0093":"\\u0093","\u0094":"\\u0094","\u0095":"\\u0095","\u0096":"\\u0096","\u0097":"\\u0097","\u0098":"\\u0098","\u0099":"\\u0099","\u009a":"\\u009a","\u009b":"\\u009b","\u009c":"\\u009c","\u009d":"\\u009d",
"\u009e":"\\u009e","\u009f":"\\u009f","\u00ad":"\\u00ad","\u0600":"\\u0600","\u0601":"\\u0601","\u0602":"\\u0602","\u0603":"\\u0603","\u0604":"\\u0604","\u070f":"\\u070f","\u17b4":"\\u17b4","\u17b5":"\\u17b5","\u200c":"\\u200c","\u200d":"\\u200d","\u200e":"\\u200e","\u200f":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","\u202a":"\\u202a","\u202b":"\\u202b","\u202c":"\\u202c","\u202d":"\\u202d","\u202e":"\\u202e","\u202f":"\\u202f","\u2060":"\\u2060","\u2061":"\\u2061","\u2062":"\\u2062","\u2063":"\\u2063",
"\u2064":"\\u2064","\u2065":"\\u2065","\u2066":"\\u2066","\u2067":"\\u2067","\u2068":"\\u2068","\u2069":"\\u2069","\u206a":"\\u206a","\u206b":"\\u206b","\u206c":"\\u206c","\u206d":"\\u206d","\u206e":"\\u206e","\u206f":"\\u206f","\ufeff":"\\ufeff","\ufff0":"\\ufff0","\ufff1":"\\ufff1","\ufff2":"\\ufff2","\ufff3":"\\ufff3","\ufff4":"\\ufff4","\ufff5":"\\ufff5","\ufff6":"\\ufff6","\ufff7":"\\ufff7","\ufff8":"\\ufff8","\ufff9":"\\ufff9","\ufffa":"\\ufffa","\ufffb":"\\ufffb","\ufffc":"\\ufffc","\ufffd":"\\ufffd",
"\ufffe":"\\ufffe","\uffff":"\\uffff"},k=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,
m,l=JSON&&JSON.stringify||function(a){return h.lastIndex=0,h.test(a)&&(a=a.replace(h,function(a){return g[a]})),'"'+a+'"'},n=function(a){var e,d={},f=[];for(e=0;65536>e;e++)f.push(String.fromCharCode(e));return a.lastIndex=0,f.join("").replace(a,function(a){return d[a]="\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4),""}),a.lastIndex=0,d};a.quote=function(a){a=l(a);return k.lastIndex=0,k.test(a)?(m||(m=n(k)),a.replace(k,function(a){return m[a]})):a};var r="websocket xdr-streaming xhr-streaming iframe-eventsource iframe-htmlfile xdr-polling xhr-polling iframe-xhr-polling jsonp-polling".split(" ");
a.probeProtocols=function(){for(var a={},e=0;e<r.length;e++){var d=r[e];a[d]=q[d]&&q[d].enabled()}return a};a.detectProtocols=function(a,e,d){var f={},c=[];e||(e=r);for(var b=0;b<e.length;b++){var g=e[b];f[g]=a[g]}var h=function(a){var e=a.shift();f[e]?c.push(e):0<a.length&&h(a)};return!1!==d.websocket&&h(["websocket"]),f["xhr-streaming"]&&!d.null_origin?c.push("xhr-streaming"):!f["xdr-streaming"]||d.cookie_needed||d.null_origin?h(["iframe-eventsource","iframe-htmlfile"]):c.push("xdr-streaming"),
f["xhr-polling"]&&!d.null_origin?c.push("xhr-polling"):!f["xdr-polling"]||d.cookie_needed||d.null_origin?h(["iframe-xhr-polling","jsonp-polling"]):c.push("xdr-polling"),c};a.createHook=function(){var e="a"+a.random_string(8);if(!("_sockjs_global"in c)){var d={};c._sockjs_global=function(a){return a in d||(d[a]={id:a,del:function(){delete d[a]}}),d[a]}}return c._sockjs_global(e)};a.attachMessage=function(e){a.attachEvent("message",e)};a.attachEvent=function(a,e){"undefined"!=typeof c.addEventListener?
c.addEventListener(a,e,!1):(b.attachEvent("on"+a,e),c.attachEvent("on"+a,e))};a.detachMessage=function(e){a.detachEvent("message",e)};a.detachEvent=function(a,e){"undefined"!=typeof c.addEventListener?c.removeEventListener(a,e,!1):(b.detachEvent("on"+a,e),c.detachEvent("on"+a,e))};var s={},p=!1,t=function(){for(var a in s)s[a](),delete s[a]},v=function(){p||(p=!0,t())};a.attachEvent("beforeunload",v);a.attachEvent("unload",v);a.unload_add=function(e){var d=a.random_string(8);return s[d]=e,p&&a.delay(t),
d};a.unload_del=function(a){a in s&&delete s[a]};a.createIframe=function(e,d){var f=b.createElement("iframe"),c,g,h=function(){clearTimeout(c);try{f.onload=null}catch(a){}f.onerror=null},k=function(){f&&(h(),setTimeout(function(){f&&f.parentNode.removeChild(f);f=null},0),a.unload_del(g))};return f.src=e,f.style.display="none",f.style.position="absolute",f.onerror=function(){f&&(k(),d("onerror"))},f.onload=function(){clearTimeout(c);c=setTimeout(function(){f&&(k(),d("onload timeout"))},2E3)},b.body.appendChild(f),
c=setTimeout(function(){f&&(k(),d("timeout"))},15E3),g=a.unload_add(k),{post:function(a,e){try{f&&f.contentWindow&&f.contentWindow.postMessage(a,e)}catch(d){}},cleanup:k,loaded:h}};a.createHtmlfile=function(e,d){var f=new ActiveXObject("htmlfile"),b,g,h,k=function(){clearTimeout(b)},m=function(){f&&(k(),a.unload_del(g),h.parentNode.removeChild(h),h=f=null,CollectGarbage())};f.open();f.write('<html><script>document.domain="'+document.domain+'";\x3c/script></html>');f.close();f.parentWindow._jp=c._jp;
var l=f.createElement("div");return f.body.appendChild(l),h=f.createElement("iframe"),l.appendChild(h),h.src=e,b=setTimeout(function(){f&&(m(),d("timeout"))},15E3),g=a.unload_add(m),{post:function(a,e){try{h&&h.contentWindow&&h.contentWindow.postMessage(a,e)}catch(d){}},cleanup:m,loaded:k}};v=function(){};v.prototype=new f(["chunk","finish"]);v.prototype._start=function(e,d,f,b){var g=this;try{g.xhr=new XMLHttpRequest}catch(h){}if(!g.xhr)try{g.xhr=new c.ActiveXObject("Microsoft.XMLHTTP")}catch(k){}if(c.ActiveXObject||
c.XDomainRequest)d+=(-1===d.indexOf("?")?"?":"&")+"t="+ +new Date;g.unload_ref=a.unload_add(function(){g._cleanup(!0)});try{g.xhr.open(e,d,!0)}catch(m){g.emit("finish",0,"");g._cleanup();return}b&&b.no_credentials||(g.xhr.withCredentials="true");if(b&&b.headers)for(var l in b.headers)g.xhr.setRequestHeader(l,b.headers[l]);g.xhr.onreadystatechange=function(){if(g.xhr){var a=g.xhr;switch(a.readyState){case 3:try{var e=a.status,d=a.responseText}catch(f){}d&&0<d.length&&g.emit("chunk",e,d);break;case 4:g.emit("finish",
a.status,a.responseText),g._cleanup(!1)}}};g.xhr.send(f)};v.prototype._cleanup=function(e){if(this.xhr){a.unload_del(this.unload_ref);this.xhr.onreadystatechange=function(){};if(e)try{this.xhr.abort()}catch(d){}this.unload_ref=this.xhr=null}};v.prototype.close=function(){this.nuke();this._cleanup(!0)};(a.XHRCorsObject=function(){var e=this,d=arguments;a.delay(function(){e._start.apply(e,d)})}).prototype=new v;(a.XHRLocalObject=function(e,d,f){var c=this;a.delay(function(){c._start(e,d,f,{no_credentials:!0})})}).prototype=
new v;v=a.XDRObject=function(e,d,f){var c=this;a.delay(function(){c._start(e,d,f)})};v.prototype=new f(["chunk","finish"]);v.prototype._start=function(e,d,f){var c=this,b=new XDomainRequest;d+=(-1===d.indexOf("?")?"?":"&")+"t="+ +new Date;var g=b.ontimeout=b.onerror=function(){c.emit("finish",0,"");c._cleanup(!1)};b.onprogress=function(){c.emit("chunk",200,b.responseText)};b.onload=function(){c.emit("finish",200,b.responseText);c._cleanup(!1)};c.xdr=b;c.unload_ref=a.unload_add(function(){c._cleanup(!0)});
try{c.xdr.open(e,d),c.xdr.send(f)}catch(h){g()}};v.prototype._cleanup=function(e){if(this.xdr){a.unload_del(this.unload_ref);this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null;if(e)try{this.xdr.abort()}catch(d){}this.unload_ref=this.xdr=null}};v.prototype.close=function(){this.nuke();this._cleanup(!0)};a.isXHRCorsCapable=function(){return c.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:c.XDomainRequest&&b.domain?2:w.enabled()?3:4};var q=function(e,d,f){var c=this,
b;c._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0};f&&a.objectExtend(c._options,f);c._base_url=a.amendUrl(e);c._server=c._options.server||a.random_number_string(1E3);c._options.protocols_whitelist&&c._options.protocols_whitelist.length?b=c._options.protocols_whitelist:("string"==typeof d&&0<d.length?b=[d]:a.isArray(d)?b=d:b=null,b&&c._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.'));
c._protocols=[];c.protocol=null;c.readyState=q.CONNECTING;c._ir=Q(c._base_url);c._ir.onfinish=function(e,d){c._ir=null;e?(c._options.info&&(e=a.objectExtend(e,c._options.info)),c._options.rtt&&(d=c._options.rtt),c._applyInfo(e,d,b),c._didClose()):c._didClose(1002,"Can't connect to server",!0)}};q.prototype=new d;q.version="0.3.1";q.CONNECTING=0;q.OPEN=1;q.CLOSING=2;q.CLOSED=3;q.prototype._debug=function(){this._options.debug&&a.log.apply(a,arguments)};q.prototype._dispatchOpen=function(){this.readyState===
q.CONNECTING?(this._transport_tref&&(clearTimeout(this._transport_tref),this._transport_tref=null),this.readyState=q.OPEN,this.dispatchEvent(new e("open"))):this._didClose(1006,"Server lost session")};q.prototype._dispatchMessage=function(a){this.readyState===q.OPEN&&this.dispatchEvent(new e("message",{data:a}))};q.prototype._dispatchHeartbeat=function(a){this.readyState===q.OPEN&&this.dispatchEvent(new e("heartbeat",{}))};q.prototype._didClose=function(d,f,c){var b=this;if(b.readyState!==q.CONNECTING&&
b.readyState!==q.OPEN&&b.readyState!==q.CLOSING)throw Error("INVALID_STATE_ERR");b._ir&&(b._ir.nuke(),b._ir=null);b._transport&&(b._transport.doCleanup(),b._transport=null);var g=new e("close",{code:d,reason:f,wasClean:a.userSetCode(d)});if(!a.userSetCode(d)&&b.readyState===q.CONNECTING&&!c){if(b._try_next_protocol(g))return;g=new e("close",{code:2E3,reason:"All transports failed",wasClean:!1,last_event:g})}b.readyState=q.CLOSED;a.delay(function(){b.dispatchEvent(g)})};q.prototype._didMessage=function(a){switch(a.slice(0,
1)){case "o":this._dispatchOpen();break;case "a":a=JSON.parse(a.slice(1)||"[]");for(var e=0;e<a.length;e++)this._dispatchMessage(a[e]);break;case "m":a=JSON.parse(a.slice(1)||"null");this._dispatchMessage(a);break;case "c":a=JSON.parse(a.slice(1)||"[]");this._didClose(a[0],a[1]);break;case "h":this._dispatchHeartbeat()}};q.prototype._try_next_protocol=function(e){var d=this;d.protocol&&(d._debug("Closed transport:",d.protocol,""+e),d.protocol=null);for(d._transport_tref&&(clearTimeout(d._transport_tref),
d._transport_tref=null);;){e=d.protocol=d._protocols.shift();if(!e)return!1;if(q[e]&&!0===q[e].need_body&&(!b.body||"undefined"!=typeof b.readyState&&"complete"!==b.readyState))return d._protocols.unshift(e),d.protocol="waiting-for-load",a.attachEvent("load",function(){d._try_next_protocol()}),!0;if(q[e]&&q[e].enabled(d._options)){d._transport_tref=a.delay((d._options.rto||0)*(q[e].roundTrips||1)||5E3,function(){d.readyState===q.CONNECTING&&d._didClose(2007,"Transport timeouted")});var f=a.random_string(8),
f=d._base_url+"/"+d._server+"/"+f;return d._debug("Opening transport:",e," url:"+f," RTO:"+d._options.rto),d._transport=new q[e](d,f,d._base_url),!0}d._debug("Skipping transport:",e)}};q.prototype.close=function(e,d){if(e&&!a.userSetCode(e))throw Error("INVALID_ACCESS_ERR");return this.readyState!==q.CONNECTING&&this.readyState!==q.OPEN?!1:(this.readyState=q.CLOSING,this._didClose(e||1E3,d||"Normal closure"),!0)};q.prototype.send=function(e){if(this.readyState===q.CONNECTING)throw Error("INVALID_STATE_ERR");
return this.readyState===q.OPEN&&this._transport.doSend(a.quote(""+e)),!0};q.prototype._applyInfo=function(e,d,f){this._options.info=e;this._options.rtt=d;this._options.rto=a.countRTO(d);this._options.info.null_origin=!b.domain;d=a.probeProtocols();this._protocols=a.detectProtocols(d,f,e)};v=q.websocket=function(e,d){var f=this,b=d+"/websocket";"https"===b.slice(0,5)?b="wss"+b.slice(5):b="ws"+b.slice(4);f.ri=e;f.url=b;f.ws=new (c.WebSocket||c.MozWebSocket)(f.url);f.ws.onmessage=function(a){f.ri._didMessage(a.data)};
f.unload_ref=a.unload_add(function(){f.ws.close()});f.ws.onclose=function(){f.ri._didMessage(a.closeFrame(1006,"WebSocket connection broken"))}};v.prototype.doSend=function(a){this.ws.send("["+a+"]")};v.prototype.doCleanup=function(){var e=this.ws;e&&(e.onmessage=e.onclose=null,e.close(),a.unload_del(this.unload_ref),this.unload_ref=this.ri=this.ws=null)};v.enabled=function(){return!!c.WebSocket||!!c.MozWebSocket};v.roundTrips=2;var u=function(){};u.prototype.send_constructor=function(a){this.send_buffer=
[];this.sender=a};u.prototype.doSend=function(a){this.send_buffer.push(a);this.send_stop||this.send_schedule()};u.prototype.send_schedule_wait=function(){var e=this,d;e.send_stop=function(){e.send_stop=null;clearTimeout(d)};d=a.delay(25,function(){e.send_stop=null;e.send_schedule()})};u.prototype.send_schedule=function(){var a=this;if(0<a.send_buffer.length){var e="["+a.send_buffer.join(",")+"]";a.send_stop=a.sender(a.trans_url,e,function(){a.send_stop=null;a.send_schedule_wait()});a.send_buffer=
[]}};u.prototype.send_destructor=function(){this._send_stop&&this._send_stop();this._send_stop=null};var y=function(e,d,f){if(!("_send_form"in this)){var c=this._send_form=b.createElement("form"),g=this._send_area=b.createElement("textarea");g.name="d";c.style.display="none";c.style.position="absolute";c.method="POST";c.enctype="application/x-www-form-urlencoded";c.acceptCharset="UTF-8";c.appendChild(g);b.body.appendChild(c)}var c=this._send_form,g=this._send_area,h="a"+a.random_string(8);c.target=
h;c.action=e+"/jsonp_send?i="+h;var k;try{k=b.createElement('<iframe name="'+h+'">')}catch(m){k=b.createElement("iframe"),k.name=h}k.id=h;c.appendChild(k);k.style.display="none";try{g.value=d}catch(l){a.log("Your browser is seriously broken. Go home! "+l.message)}c.submit();var n=function(e){k.onerror&&(k.onreadystatechange=k.onerror=k.onload=null,a.delay(500,function(){k.parentNode.removeChild(k);k=null}),g.value="",f())};return k.onerror=k.onload=n,k.onreadystatechange=function(a){"complete"==k.readyState&&
n()},n},D=function(a){return function(e,d,f){return(new a("POST",e+"/xhr_send",d)).onfinish=function(a,e){f(a)},function(a){f(0,a)}}},A=function(e,d){var f,c=b.createElement("script"),g,h=function(a){g&&(g.parentNode.removeChild(g),g=null);c&&(clearTimeout(f),c.parentNode.removeChild(c),c.onreadystatechange=c.onerror=c.onload=c.onclick=null,c=null,d(a),d=null)},k=!1,m=null;c.id="a"+a.random_string(8);c.src=e;c.type="text/javascript";c.charset="UTF-8";c.onerror=function(e){m||(m=setTimeout(function(){k||
h(a.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1E3))};c.onload=function(e){h(a.closeFrame(1006,"JSONP script loaded abnormally (onload)"))};c.onreadystatechange=function(e){if(/loaded|closed/.test(c.readyState)){if(c&&c.htmlFor&&c.onclick){k=!0;try{c.onclick()}catch(d){}}c&&h(a.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}};if("undefined"==typeof c.async&&b.attachEvent)if(/opera/i.test(navigator.userAgent))g=b.createElement("script"),g.text="try{var a = document.getElementById('"+
c.id+"'); if(a)a.onerror();}catch(x){};",c.async=g.async=!1;else{try{c.htmlFor=c.id,c.event="onclick"}catch(l){}c.async=!0}"undefined"!=typeof c.async&&(c.async=!0);f=setTimeout(function(){h(a.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35E3);var n=b.getElementsByTagName("head")[0];return n.insertBefore(c,n.firstChild),g&&n.insertBefore(g,n.firstChild),h},v=q["jsonp-polling"]=function(e,d){a.polluteGlobalNamespace();this.ri=e;this.trans_url=d;this.send_constructor(y);this._schedule_recv()};
v.prototype=new u;v.prototype._schedule_recv=function(){var a=this;a._recv_stop=z(a.trans_url+"/jsonp",A,function(e){a._recv_stop=null;e&&(a._is_closing||a.ri._didMessage(e));a._is_closing||a._schedule_recv()})};v.enabled=function(){return!0};v.need_body=!0;v.prototype.doCleanup=function(){this._is_closing=!0;this._recv_stop&&this._recv_stop();this.ri=this._recv_stop=null;this.send_destructor()};var z=function(e,d,f){var b="a"+a.random_string(6);e=e+"?c="+escape("_jp."+b);d=d(e,function(a){delete c._jp[b];
f(a)});c._jp[b]=d;return function(){c._jp[b]&&c._jp[b](a.closeFrame(1E3,"JSONP user aborted read"))}},v=function(){};v.prototype=new u;v.prototype.run=function(a,e,d,f,c){this.ri=a;this.trans_url=e;this.send_constructor(D(c));this.poll=new M(a,f,e+d,c)};v.prototype.doCleanup=function(){this.poll&&(this.poll.abort(),this.poll=null)};var x=q["xhr-streaming"]=function(e,d){this.run(e,d,"/xhr_streaming",I,a.XHRCorsObject)};x.prototype=new v;x.enabled=function(){return c.XMLHttpRequest&&"withCredentials"in
new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)};x.roundTrips=2;x.need_body=!0;u=q["xdr-streaming"]=function(e,d){this.run(e,d,"/xhr_streaming",I,a.XDRObject)};u.prototype=new v;u.enabled=function(){return!!c.XDomainRequest};u.roundTrips=2;var C=q["xhr-polling"]=function(e,d){this.run(e,d,"/xhr",I,a.XHRCorsObject)};C.prototype=new v;C.enabled=x.enabled;C.roundTrips=2;x=q["xdr-polling"]=function(e,d){this.run(e,d,"/xhr",I,a.XDRObject)};x.prototype=new v;x.enabled=u.enabled;x.roundTrips=2;var w=
function(){};w.prototype.i_constructor=function(e,d,f){var c=this;c.ri=e;c.origin=a.getOrigin(f);c.base_url=f;c.trans_url=d;e=f+"/iframe.html";c.ri._options.devel&&(e+="?t="+ +new Date);c.window_id=a.random_string(8);e+="#"+c.window_id;c.iframeObj=a.createIframe(e,function(a){c.ri._didClose(1006,"Unable to load an iframe ("+a+")")});c.onmessage_cb=a.bind(c.onmessage,c);a.attachMessage(c.onmessage_cb)};w.prototype.doCleanup=function(){if(this.iframeObj){a.detachMessage(this.onmessage_cb);try{this.iframeObj.iframe.contentWindow&&
this.postMessage("c")}catch(e){}this.iframeObj.cleanup();this.onmessage_cb=this.iframeObj=this.iframeObj=null}};w.prototype.onmessage=function(a){if(a.origin===this.origin){var e=a.data.slice(0,8),d=a.data.slice(8,9);a=a.data.slice(9);if(e===this.window_id)switch(d){case "s":this.iframeObj.loaded();this.postMessage("s",JSON.stringify([q.version,this.protocol,this.trans_url,this.base_url]));break;case "t":this.ri._didMessage(a)}}};w.prototype.postMessage=function(a,e){this.iframeObj.post(this.window_id+
a+(e||""),this.origin)};w.prototype.doSend=function(a){this.postMessage("m",a)};w.enabled=function(){var a=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof c.postMessage||"object"==typeof c.postMessage)&&!a};var B,F=function(e,d){parent!==c?parent.postMessage(B+e+(d||""),"*"):a.log("Can't postMessage, no parent window.",e,d)},E=function(){};E.prototype._didClose=function(e,d){F("t",a.closeFrame(e,d))};E.prototype._didMessage=function(a){F("t",
a)};E.prototype._doSend=function(a){this._transport.doSend(a)};E.prototype._doCleanup=function(){this._transport.doCleanup()};a.parent_origin=void 0;q.bootstrap_iframe=function(){var e;B=b.location.hash.slice(1);a.attachMessage(function(d){if(d.source===parent&&("undefined"==typeof a.parent_origin&&(a.parent_origin=d.origin),d.origin===a.parent_origin)){var f=d.data.slice(0,8),b=d.data.slice(8,9);d=d.data.slice(9);if(f===B)switch(b){case "s":var g=JSON.parse(d),f=g[0],b=g[1];d=g[2];g=g[3];f!==q.version&&
a.log('Incompatibile SockJS! Main site uses: "'+f+'", the iframe: "'+q.version+'".');if(!a.flatUrl(d)||!a.flatUrl(g)){a.log("Only basic urls are supported in SockJS");break}if(!a.isSameOriginUrl(d)||!a.isSameOriginUrl(g)){a.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([c.location.href,d,g])+")");break}e=new E;e._transport=new E[b](e,d,g);break;case "m":e._doSend(d);break;case "c":e&&e._doCleanup(),e=null}}});F("s")};var K=function(e,d){var f=this;a.delay(function(){f.doXhr(e,
d)})};K.prototype=new f(["finish"]);K.prototype.doXhr=function(e,d){var f=this,c=(new Date).getTime(),b=new d("GET",e+"/info"),g=a.delay(8E3,function(){b.ontimeout()});b.onfinish=function(a,e){clearTimeout(g);g=null;if(200===a){var d=(new Date).getTime()-c,b=JSON.parse(e);"object"!=typeof b&&(b={});f.emit("finish",b,d)}else f.emit("finish")};b.ontimeout=function(){b.close();f.emit("finish")}};var N=function(e){var d=this,f=function(){var a=new w;a.protocol="w-iframe-info-receiver";var f=function(e){"string"==
typeof e&&"m"===e.substr(0,1)?(e=JSON.parse(e.substr(1)),d.emit("finish",e[0],e[1])):d.emit("finish");a.doCleanup();a=null};a.i_constructor({_options:{},_didClose:f,_didMessage:f},e,e)};b.body?f():a.attachEvent("load",f)};N.prototype=new f(["finish"]);var H=function(){var e=this;a.delay(function(){e.emit("finish",{},2E3)})};H.prototype=new f(["finish"]);var Q=function(e){if(a.isSameOriginUrl(e))return new K(e,a.XHRLocalObject);switch(a.isXHRCorsCapable()){case 1:return new K(e,a.XHRCorsObject);case 2:return new K(e,
a.XDRObject);case 3:return new N(e);default:return new H}};(E["w-iframe-info-receiver"]=function(e,d,f){(new K(f,a.XHRLocalObject)).onfinish=function(a,d){e._didMessage("m"+JSON.stringify([a,d]));e._didClose()}}).prototype.doCleanup=function(){};f=q["iframe-eventsource"]=function(){this.protocol="w-iframe-eventsource";this.i_constructor.apply(this,arguments)};f.prototype=new w;f.enabled=function(){return"EventSource"in c&&w.enabled()};f.need_body=!0;f.roundTrips=3;(E["w-iframe-eventsource"]=function(e,
d){this.run(e,d,"/eventsource",G,a.XHRLocalObject)}).prototype=new v;f=q["iframe-xhr-polling"]=function(){this.protocol="w-iframe-xhr-polling";this.i_constructor.apply(this,arguments)};f.prototype=new w;f.enabled=function(){return c.XMLHttpRequest&&w.enabled()};f.need_body=!0;f.roundTrips=3;(E["w-iframe-xhr-polling"]=function(e,d){this.run(e,d,"/xhr",I,a.XHRLocalObject)}).prototype=new v;f=q["iframe-htmlfile"]=function(){this.protocol="w-iframe-htmlfile";this.i_constructor.apply(this,arguments)};
f.prototype=new w;f.enabled=function(){return w.enabled()};f.need_body=!0;f.roundTrips=3;(E["w-iframe-htmlfile"]=function(e,d){this.run(e,d,"/htmlfile",J,a.XHRLocalObject)}).prototype=new v;var M=function(a,e,d,f){this.ri=a;this.Receiver=e;this.recv_url=d;this.AjaxObject=f;this._scheduleRecv()};M.prototype._scheduleRecv=function(){var a=this,e=a.poll=new a.Receiver(a.recv_url,a.AjaxObject);e.onmessage=function(e){a.ri._didMessage(e.data)};e.onclose=function(d){a.poll=e=e.onmessage=e.onclose=null;
a.poll_is_closing||("permanent"===d.reason?a.ri._didClose(1006,"Polling error ("+d.reason+")"):a._scheduleRecv())}};M.prototype.abort=function(){this.poll_is_closing=!0;this.poll&&this.poll.abort()};var G=function(d){var f=this,c=new EventSource(d);c.onmessage=function(a){f.dispatchEvent(new e("message",{data:unescape(a.data)}))};f.es_close=c.onerror=function(d,b){var g=b?"user":2!==c.readyState?"network":"permanent";f.es_close=c.onmessage=c.onerror=null;c.close();c=null;a.delay(200,function(){f.dispatchEvent(new e("close",
{reason:g}))})}};G.prototype=new d;G.prototype.abort=function(){this.es_close&&this.es_close({},!0)};var L,J=function(d){var f=this;a.polluteGlobalNamespace();f.id="a"+a.random_string(6,26);d+=(-1===d.indexOf("?")?"?":"&")+"c="+escape("_jp."+f.id);if(void 0===L)if("ActiveXObject"in c)try{L=!!new ActiveXObject("htmlfile")}catch(b){}else L=!1;var g=L?a.createHtmlfile:a.createIframe,h;c._jp[f.id]={start:function(){h.loaded()},message:function(a){f.dispatchEvent(new e("message",{data:a}))},stop:function(){f.iframe_close({},
"network")}};f.iframe_close=function(a,d){h.cleanup();f.iframe_close=h=null;delete c._jp[f.id];f.dispatchEvent(new e("close",{reason:d}))};h=g(d,function(a){f.iframe_close({},"permanent")})};J.prototype=new d;J.prototype.abort=function(){this.iframe_close&&this.iframe_close({},"user")};var I=function(a,d){var f=this,c=0;f.xo=new d("POST",a,null);f.xo.onchunk=function(a,d){if(200===a)for(;;){var b=d.slice(c),g=b.indexOf("\n");if(-1===g)break;c+=g+1;b=b.slice(0,g);f.dispatchEvent(new e("message",{data:b}))}};
f.xo.onfinish=function(a,d){f.xo.onchunk(a,d);f.xo=null;f.dispatchEvent(new e("close",{reason:200===a?"network":"permanent"}))}};return I.prototype=new d,I.prototype.abort=function(){this.xo&&(this.xo.close(),this.dispatchEvent(new e("close",{reason:"user"})),this.xo=null)},q.getUtils=function(){return a},q.getIframeTransport=function(){return w},q}();"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1);"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS});global.Class=function(){function b(a){return a&&"object"===typeof a&&!Array.isArray(a)}function c(a,d){if(!b(a)||"function"!==typeof d)throw new TypeError;Object.forEach(a,function(a,e,c){c.hasOwnProperty(a)&&d(a,e)});return!0}var a=function(){},d={extend:function(a,d){if(2!==arguments.length)throw new RangeError;if("function"!==typeof a||"function"!==typeof d)throw new TypeError;var c=Object.createProto(d.prototype);c.constructor=a;c._super=null;a.prototype=c;return a},decorate:function(e,d,h){if(b(d))return c(d,
this.decorate.bind(this,e));"function"===typeof e&&"function"!==typeof e[d]&&(e=e.prototype);if(3!==arguments.length)throw new RangeError;if("string"!==typeof d||"function"!==typeof h)throw new TypeError;var g=e.hasOwnProperty(d)&&"function"===typeof e[d]?e[d]:null,k=Object.getPrototypeOf(e);return e[d]=function(){if(null===this||"undefined"===typeof this)return h.apply(this,arguments);var e=this._super,c=!g&&k&&"function"===typeof k[d]&&k[d];this._super=g||c||a;c=h.apply(this,arguments);this._super=
e;return c}}};Function.prototype.property=function(a,d){if(b(a))return c(a,this.property.bind(this));if("string"!==typeof a)throw new TypeError;if(this.prototype.hasOwnProperty(a))throw new ReferenceError;this.prototype[a]=d};Function.prototype.method=function(a,f){if(b(a))return c(a,this.method.bind(this));if(this.prototype.hasOwnProperty(a))throw new ReferenceError;return d.decorate(this.prototype,a,f)};Function.prototype.decorate=function(a,f){if(b(a))return c(a,this.decorate.bind(this));if("function"!==
typeof this.prototype[a])throw new ReferenceError;return d.decorate(this.prototype,a,f)};return d}();(function(){Function.prototype.bind||(Function.prototype.bind=function(){var b=this,c=Array.prototype.shift.call(arguments),a=Array.prototype.slice.call(arguments,0);return function(){return b.apply(c,Array.prototype.concat.call(a,Array.prototype.slice.call(arguments,0)))}})})();(function(){var b={},c=this.Uint8Array||Array;String.prototype.capitalize=function(){return this.length?b[this]||(b[this]=this[0].toUpperCase()+this.slice(1)):this};String.prototype.format=function(){var a=arguments,d=a.length;if(d){var e=this,f=e.match(/{[^}]*}/g),c=f?f.length:0,b=0;if("object"===typeof a[0])for(;b<c;){var d=f[b].replace(/{/,"").replace(/}/,""),k=isNaN(parseInt(d))?"{"+d+"}":"{["+b+"]}",k=RegExp(k,"g"),e=e.replace(k,a[0][d]);b++}else{if(!f||f.length!==d)throw new RangeError("Engine.Lib.format: wrong number of arguments, "+
e);for(;b<d;)2==f[b].length?e=e.replace("{}",a[b]):(k=RegExp("{["+b+"]}","g"),e=e.replace(k,a[b])),b++}return e}return this};String.prototype.toByteArray=function(){for(var a=0,d=this.length,e=new c(d);a<d;a++)e[a]=this.charCodeAt(a)&255;return e}}).call(this);(function(b,c,a,d){Object.createProto=function(a){if(1!==arguments.length)throw new RangeError;if(!a||"object"!==typeof a)throw new TypeError;if(Object.create)return Object.create(a);var e=function(){};e.prototype=a;return new e};"undefined"===typeof Object.getPrototypeOf&&(Object.getPrototypeOf="".__proto__?function(a){return a.__proto__}:function(a){return a.constructor.prototype});var e=Object.merge=function(){var a=arguments[arguments.length-1];!0===a&&(a=Infinity);var a="number"===typeof a?c.call(arguments):
0,d=b.call(arguments);if("object"!==typeof d)throw new TypeError("Object.merge: target must be an object");for(var g=arguments.length;g--;){var k=b.call(arguments);if("object"===typeof k)for(var m in k)a&&d.hasOwnProperty(m)&&"object"===typeof d[m]&&"object"===typeof k[m]&&null!==d[m]&&null!==k[m]?d[m]=e(d[m],k[m],a-1):d[m]=k[m]}return d};Object.forEach=function(e,d,c){var b=e&&"object"===typeof e&&!a(e);if(!b||!b||"function"!==typeof d)throw new TypeError;for(var m in e)d.call(c,m,e[m],e)};Object.clone=
function(a,d){if("object"!==typeof a)throw new TypeError("Object#clone: object to clone must be a object");var c="function"===typeof a.toClone?a.toClone():a.toClone;return e({},a,c,d)};Object.isArguments=function(a){return"[object Arguments]"===d.call(a)}})(Array.prototype.shift,Array.prototype.pop,Array.isArray,Object.prototype.toString);global.TypedArray=function(b){this.Int8Array=this.Int8Array||Array;this.Int16Array=this.Int16Array||Array;this.Int32Array=this.Int32Array||Array;this.Uint8Array=this.Uint8Array||Array;this.Uint16Array=this.Uint16Array||Array;this.Uint32Array=this.Uint32Array||Array;this.Float32Array=this.Float32Array||Array;this.Float64Array=this.Float64Array||Array;var c=b(2,8)-1,a=b(2,16)-1,d=b(2,32)-1,e=b(2,64)-1;return function(f,b,g){var k="u"===f[0].toLowerCase(),m=~f.toLowerCase().indexOf("float");k||(b*=2);
k=0;switch(!0){case !m&&b<=c:k=8;break;case !m&&b<=a:k=16;break;case b<=d:k=32;break;case m&&b<=e:k=64;break;default:return!1}return new (global[f.capitalize()+k+"Array"])(g)}}.call(global,Math.pow);Array.prototype.first=function(){return 0<this.length?this[0]:null};Array.prototype.last=function(){return 0<this.length?this[this.length-1]:null};Array.prototype.has=function(b){return-1!==this.indexOf(b)};Array.prototype.remove=function(b){for(var c=!1,a=0;-1!=(a=this.indexOf(b));)this.splice(a,1),c=!0;return c};Array.prototype.add=function(b){return-1===this.indexOf(b)?(this.push(b),!0):!1};Array.prototype.clear=function(){for(;0<this.length;)this.pop();return this};
Array.prototype.filter||(Array.prototype.filter=function(b){for(var c=[],a=0;a<this.length;a++)b(this[a])&&c.push(this[a]);return c});Array.prototype.random=function(){return this.length?this[Math.random()*this.length|0]:null};Array.prototype.swap=function(b,c){var a=null;return b<this.length&&0<=b&&c<this.length&&0<=c?(a=this[b],this[b]=this[c],this[c]=a,!0):!1};
Array.prototype.clone=function(b){b="boolean"===typeof b?b:!1;var c=this.concat();if(!b)return c;b="function"===typeof Object.clone;for(var a=0,d=c.length;a<d;a++)"object"===typeof c[a]&&(c[a]=Array.isArray(c[a])?c[a].clone():b&&Object.clone(c[a]));return c};Array.prototype.forEach||(Array.prototype.forEach=function(b,c){if("function"!==typeof b)return this;for(var a=0;a<this.length;a++)b.call(c,this[a],a,this);return this});
Array.prototype.without=function(b){if(!Array.isArray(b)||!b.length)return this.clone();b=b.slice(0);for(var c=[],a=0,d=this.length;a<d;a++){var e=this[a],f=b.indexOf(e);~f?f===b.length-1?b.pop():b[f]=b.pop():c.push(e)}return c};Number.prototype.between=function(b,c){return this>=Math.min(b,c)&&this<=Math.max(b,c)};Number.prototype.sign=function(){return 0>this?-1:0<this?1:0};global.Matrix=function(){function b(c){this.m11=null!=c&&"number"==typeof c.m11?parseFloat(c.m11):this.m11;this.m12=null!=c&&"number"==typeof c.m12?parseFloat(c.m12):this.m12;this.m13=null!=c&&"number"==typeof c.m13?parseFloat(c.m13):this.m13;this.m21=null!=c&&"number"==typeof c.m21?parseFloat(c.m21):this.m21;this.m22=null!=c&&"number"==typeof c.m22?parseFloat(c.m22):this.m22;this.m23=null!=c&&"number"==typeof c.m23?parseFloat(c.m23):this.m23;this.m31=null!=c&&"number"==typeof c.m31?parseFloat(c.m31):
this.m31;this.m32=null!=c&&"number"==typeof c.m32?parseFloat(c.m32):this.m32;this.m33=null!=c&&"number"==typeof c.m33?parseFloat(c.m33):this.m33}b.prototype.m11=1;b.prototype.m12=0;b.prototype.m13=0;b.prototype.m21=0;b.prototype.m22=1;b.prototype.m23=0;b.prototype.m31=0;b.prototype.m32=0;b.prototype.m33=1;b.prototype.cos=Math.cos;b.prototype.sin=Math.sin;b.prototype.set=function(c,a,d,e,f,b,g,k,m){this.m11=parseFloat(c)||0;this.m12=parseFloat(a)||0;this.m13=parseFloat(d)||0;this.m21=parseFloat(e)||
0;this.m22=parseFloat(f)||0;this.m23=parseFloat(b)||0;this.m31=parseFloat(g)||0;this.m32=parseFloat(k)||0;this.m33=parseFloat(m)||0;return this};b.prototype.copy=function(c){return this.set(c.m11,c.m12,c.m13,c.m21,c.m22,c.m23,c.m31,c.m32,c.m33)};b.prototype.transform=function(c,a,d,e,f,b,g){g=g||this;c=parseFloat(c)||0;d=parseFloat(d)||0;f=parseFloat(f)||0;a=parseFloat(a)||0;e=parseFloat(e)||0;b=parseFloat(b)||0;var k=parseFloat(this.m31)||0,m=parseFloat(this.m32)||0,l=parseFloat(this.m33)||0;return g.set(this.m11*
c+this.m12*a+this.m13*k,this.m11*d+this.m12*e+this.m13*m,this.m11*f+this.m12*b+this.m13*l,this.m21*c+this.m22*a+this.m23*k,this.m21*d+this.m22*e+this.m23*m,this.m21*f+this.m22*b+this.m23*l,this.m31*c+this.m32*a+this.m33*k,this.m31*d+this.m32*e+this.m33*m,this.m31*f+this.m32*b+this.m33*l)};b.prototype.multiply=function(c,a){a=a||this;var d=parseFloat(c.m11)||0,e=parseFloat(c.m12)||0,f=parseFloat(c.m13)||0,b=parseFloat(c.m21)||0,g=parseFloat(c.m22)||0,k=parseFloat(c.m23)||0,m=parseFloat(c.m31)||0,l=
parseFloat(c.m32)||0,n=parseFloat(c.m33)||0;return a.set(this.m11*d+this.m12*b+this.m13*m,this.m11*e+this.m12*g+this.m13*l,this.m11*f+this.m12*k+this.m13*n,this.m21*d+this.m22*b+this.m23*m,this.m21*e+this.m22*g+this.m23*l,this.m21*f+this.m22*k+this.m23*n,this.m31*d+this.m32*b+this.m33*m,this.m31*e+this.m32*g+this.m33*l,this.m31*f+this.m32*k+this.m33*n)};b.prototype.rotate=function(c){return this.transform(this.cos(c),this.sin(c),-this.sin(c),this.cos(c),0,0)};b.prototype.translate=function(c,a){return this.transform(1,
0,0,1,parseInt(c)||0,parseInt(a)||0)};b.prototype.scale=function(c,a){return this.transform(parseFloat(c)||1,0,0,parseFloat(a)||1,0,0)};b.prototype.reset=function(){return this.set(1,0,0,0,1,0,0,0,1)};b.prototype.transpose=function(c){return(c||this).set(this.m11,this.m21,this.m31,this.m12,this.m22,this.m32,this.m13,this.m23,this.m33)};b.prototype.det=function(){return this.m11*this.m22*this.m33+this.m21*this.m32*this.m13+this.m31*this.m12*this.m23-this.m13*this.m22*this.m31-this.m23*this.m32*this.m11-
this.m33*this.m12*this.m21};b.prototype.minor=function(c,a){var d=1,e=2,f=1,b=2;1==c?(d=2,e=3):2==c&&(d=1,e=3);1==a?(f=2,b=3):2==a&&(f=1,b=3);return this["m"+d+f]*this["m"+e+b]-this["m"+d+b]*this["m"+e+f]};b.prototype.inverse=function(c){c=c||this;var a=this.det();this.transpose(c);var d=c.minor(1,1)/a,e=-c.minor(1,2)/a,f=c.minor(1,3)/a,b=-c.minor(2,1)/a,g=c.minor(2,2)/a,k=-c.minor(2,3)/a,m=c.minor(3,1)/a,l=-c.minor(3,2)/a,a=c.minor(3,3)/a;return c.set(d,e,f,b,g,k,m,l,a)};b.prototype.byVector=function(c,
a,d){d=d||Array(2);d[0]=this.m11*c+this.m12*a+this.m13;d[1]=this.m21*c+this.m22*a+this.m23;return d};return b}();global.Namespace=function(){function b(a){if(a)for(var d in a)a.hasOwnProperty(d)&&(this[d]=a[d])}var c=String.prototype.split,a=Array.prototype.indexOf,d=["function","object"];b.prototype.get=function(a){return b.get(this,a)};b.prototype.set=function(a,d){return b.set(this,a,d)};b.prototype.unset=function(a){return b.unset(this,a)};b.get=function(e,d){var b=e,g=c.call(String(d),".");if(-1!==a.call(g,""))throw'Namespace.get: Empty key passed - "'+d+'"';for(var k=0,m=g.length;k<m;k++){var l=g[k];if(b&&
b.hasOwnProperty(l))b=b[l];else return}return b};b.set=function(e,f,b){var g=c.call(String(f),".");if(-1!==a.call(g,""))throw'Namespace.set: Empty key passed - "'+f+'"';f=0;for(var k=g.length-1;f<k;f++){var m=g[f];e=e&&e.hasOwnProperty(m)&&e[m]&&-1!==a.call(d,typeof e[m])?e[m]:e[m]={}}return e[g[f]]=b};b.unset=function(e,f){var b=e,g=c.call(String(f),".");if(-1!==a.call(g,""))throw'Namespace.unset: Empty key passed - "'+f+'"';for(var k=0,m=g.length-1;k<m;k++){var l=g[k];if(b&&b.hasOwnProperty(l)&&
b[l]&&-1!==a.call(d,typeof b[l]))b=b[l];else return null}delete b[g[m]];return b};b.Chain=function(a,d){var c=b.prototype;b.prototype=d;var g=new b(a);b.prototype=c;return g};return b}();global.Model=function(b){function c(a){this._subscriptions={};this._events={};this._queue=[];this._triggered=[];if(a&&a.on){var e=a.on,b;for(b in e)this.addEventListener(b,e[b])}if(a&&a.subscribers)for(b in e=a.subscribers,e)e[b]&&e[b].subscribe(b,this);b=this.constructor.prototype;for(var h in b)this.hasOwnProperty(h)||"function"===typeof b[h]||(this[h]=a&&h in a&&typeof a[h]===typeof b[h]?a[h]:b[h]);this.initialize(a);this.trigger(c.INITIALIZE)}function a(d,e){this._triggered.push(e);var b=this._events,
h=this["on"+d]||null;if("function"!==typeof h||!1!==h.apply(this,e)){var g=b[d]||null;if(g&&g.length)for(b=0,h=g.length;b<h;b++){var k=g[b];"function"===typeof k?k.apply(this,e):(g.splice(b--,1),h--)}if(g=this._subscriptions[d]||null)for(b=0,h=g.length;b<h;b++)k=g[b],k instanceof c?a.call(k,d,e):(g.splice(b--,1),h--)}e=this._triggered.pop();g=this._queue;b=0;for(h=g.length;b<h;b+=2)g[b]===e&&(k=g[b+1],g.splice(b,2),b-=2,h-=2,this.trigger.apply(this,k));return this}c.INITIALIZE="initialize";c.prototype=
{constructor:c,initialize:function(a){},get:function(a){var e=this["get"+String(a).capitalize()];return"function"===typeof e?(b.call(arguments),e.apply(this,arguments)):this[a]},set:function(a){var e=this["set"+String(a).capitalize()];return"function"===typeof e?(b.call(arguments),e.apply(this,arguments)):this[a]=arguments[1]},addEventListener:function(a,e){if("function"!==typeof e)return!1;var b=this._events;return(b[a]||(b[a]=[])).add(e)},removeEventListener:function(a,e){if("function"!==typeof e)return!1;
var b=this._events[a]||null;if(!b)return!1;var c=b.indexOf(e);if(-1===c)return!1;b[c]=null;return!0},trigger:function(){return a.call(this,b.call(arguments),arguments)},subscribe:function(a,e){if("string"!==typeof a||""===a||!(e instanceof c))return!1;var b=e._subscriptions;return(b[a]||(b[a]=[])).add(this)},unsubscribe:function(a,e){if("string"!==typeof a||""===a||!(e instanceof c))return!1;var b=e._subscriptions[a]||null;if(!b)return!1;var h=b.indexOf(this);if(-1===h)return!1;b[h]=null;return!0},
queue:function(){if(!this._triggered.length)return this.trigger.apply(this,arguments);this._queue.push(this._triggered.last(),arguments);return this}};return c}(Array.prototype.shift);global.when=function(b){return function(c,a,d){b.call(arguments);"function"===typeof c&&(a=null);a&&b.call(arguments);a=a&&c?c[a]||a:c;return new Promise(c,a,arguments)}}(Array.prototype.shift);global.Promise=function(b,c,a,d){function e(a,b,c){if("function"!==typeof b)throw new TypeError("Promise: not function found");var m=this;c||(c=[]);Array.isArray(c)||(c=d.call(c));m.stack=m.stack||[];m.state=e.PENDING;var l=b.apply.bind(b,b?a:void 0,c);!1===(a&&a.toPromise||e.TO_PROMISE)(m,l,a,b,c)&&f(function(){try{var a=l()}catch(e){return m.reject(e)}m.resolve(a)})}var f=global.process?process.nextTick:function(a){setTimeout(a,0)};e.UNKNOWN_ERROR="UnknownError";e.PENDING="pending";e.FULFILLED=
"fulfilled";e.REJECTED="rejected";e.DONE="_promisedone";e.TO_PROMISE=function(a,e,d,b,l){var n=b.input();d=n.length;b=n[d-1];n=n[d-2];b=b&&b.toLowerCase();n=n&&n.toLowerCase();switch(!0){case b&&n&&~n.indexOf("success")&&!!~b.indexOf("error"):l[d-2]=function(){a.resolve(arguments)};l[d-1]=function(e){a.reject(e)};f(e);break;case b&&!!~b.indexOf("callback"):l[d-1]=function(e){if(e)return a.reject(e);c.call(arguments);a.resolve(arguments)};f(e);break;default:return!1}};e.prototype.state=e.PENDING;e.prototype.stack=
null;e.prototype.value=null;e.prototype.exception=null;e.prototype.then=function(a,d){a="function"===typeof a?a:null;d="function"===typeof d?d:null;switch(this.state){case e.PENDING:this.stack.push(a,d);break;case a&&e.FULFILLED:e.call(this,null,a,this.value);break;case d&&e.REJECTED:e.call(this,null,d,[this.exception])}return this};e.prototype.resolve=function(a){this.state!==e.PENDING||this.transfer(a)||(a=Array.isArray(a)||Object.isArguments(a)?a:arguments,this.state=e.FULFILLED,this.value=a,a[0]!==
e.DONE&&this.next())};e.prototype.reject=function(a){this.state!==e.PENDING||this.transfer(a)||(this.state=e.REJECTED,this.exception=this.parseError(a),this.next())};e.prototype.transfer=function(a){if(!(a instanceof e))return!1;b.apply(a.stack,this.stack);this.stack.clear();return!0};e.prototype.next=function(){this.state!==e.PENDING&&this.then(this.stack.shift(),this.stack.shift())};e.prototype.parseError=function(a){return a instanceof Error?a:{name:a.name||e.UNKNOWN_ERROR,message:"undefined"!==
typeof a.message?a.message:a}};return e}(Array.prototype.push,Array.prototype.shift,Array.prototype.unshift,Array.prototype.slice);global.Engine=function(b,c,a,d,e){var f=new Model;f.config={lang:"en_UK",DEBUG:!0,I18N_PATH:"/i18n/"};f.loaded=!1;f.ready=function(a){"function"===typeof a&&(f.loaded?a.call(f):f.addEventListener("ready",a))};f.start=function(){f.loaded||(f.loaded=!0,f.trigger("ready"))};f.changeLang=function(a){f.I18n.setLang(a);f.config.lang=a};f.NOP=function(){};f.ERROR="error";f.WARN="warn";f.log=function(e,g){if(f.config.DEBUG&&arguments.length){var k=arguments;g=arguments[arguments.length-1];g!==f.ERROR&&g!==
f.WARN||b.call(k);switch(g){case f.ERROR:var m=d.error;break;case f.WARN:m=d.warn;break;default:m=d.log}m||(m=d.log,c.call(k,g.capitalize()+":"));a.call(m,d,k)}};f.now=e.now||function(){return(new e).valueOf()};return f}(Array.prototype.pop,Array.prototype.unshift,Function.prototype.apply,console,Date);Engine.Loop=function(){function b(){a=0;c.vsync()}var c=new Model,a=0;c.VSYNC="vsync";c.vsync=function(){c.trigger(c.VSYNC);return this};c.request=function(){if(a)return!1;a=setTimeout(b,17);return!0};return c}();Engine.Device=function(){var b=new Model;b.platform={type:"desktop",name:""};b.navigator={browser:{name:"",version:0},language:""};b.keyboard=!1;b.online=!0;b.pageVisible=!0;b.screen={width:0,height:0,innerWidth:0,innerHeight:0,pixelDepth:24,pixelRatio:1,orientation:0};b.compass={orientation:{alpha:0,beta:0,gamma:0},motion:{alpha:0,beta:0,gamma:0,x:0,y:0,z:0}};b.features={canvas:!1,svg:!1,audio:!1,video:!1,compass:!1,fullscreen:!1,userMedia:!1,gamepad:!1,cache:{scripts:!1,files:!1,data:!1},geolocation:!1,
notifications:!1,pageVisibility:!1,vibration:!1,telephony:!1,pointerLock:!1};return b}();Engine.Device.Fullscreen=function(){var b=new Model;b.viewport=null;b.STATUS_CHANGED="statuschanged";var c=b.request=function(a,e,c){if(b.viewport!==a)return c(Error("Feature not implemented"));b.trigger(b.STATUS_CHANGED,a);e()},a=b.exit=function(a,e){if(b.viewport)return e();b.trigger(b.STATUS_CHANGED);a()};b.toggle=function(d,e,f){return b.status?a(e,f):c(d,e,f)};return b}();Engine.Device.Geolocation=function(){var b=new Model;b.position=null;b.watching=!1;b.getPosition=function(c,a,d){c=b.position;null===c?a():d(c)};b.setPosition=function(c){b.position!==c&&(b.position=c,b.trigger("positionchanged"))};b.clearWatch=function(c,a){!1===b.watching?a():c()};return b}();Engine.Device.Notification=function(b,c){function a(a,e){e=e||!1;this.body="string"===typeof a?a:this.body;this.title=e&&"string"===typeof e.title?e.title:this.title;this.tag=e&&"string"===typeof e.tag?e.tag:this.tag;this.expireTime=e&&"number"===typeof e.expireTime&&0<=e.expireTime?e.expireTime:this.expireTime;this.iconURL=e&&"string"===typeof e.iconURL?e.iconURL:this.iconURL;this.autoshow=e&&"boolean"===typeof e.autoshow?e.autoshow:this.autoshow;this.onshow=e&&"function"===typeof e.onshow?e.onshow:
this.onshow;this.onerror=e&&"function"===typeof e.onerror?e.onerror:this.onerror;this.onclick=e&&"function"===typeof e.onclick?e.onclick:this.onclick;this.onclose=e&&"function"===typeof e.onclose?e.onclose:this.onclose;if(!c.features.notifications)return this.onerror&&this.onerror();if(null===this.title||"undefined"===typeof this.title)this.title=String(this.body),this.body=null;this.autoshow&&this.show()}a.property({title:void 0,body:void 0,tag:void 0,expireTime:0,iconURL:void 0,autoshow:!0,onshow:null,
onerror:null,onclick:null,onclose:null});a.method({show:function(){if("function"===typeof this.onshow)return this.onshow()},close:function(){if("function"===typeof this.onclose)return this.onclose()}});return a}(Engine,Engine.Device);Engine.Device.Pointer=function(){var b=new Model;b.isLocked=!1;b.lock=function(b){return b&&b("NOT_SUPPORTED_ERR")};b.unlock=function(b){return b&&b("NOT_SUPPORTED_ERR")};b.toggleLock=function(c){return b.isLocked?b.exit(c):b.request(c)};return b}();Engine.Fill=function(b,c){function a(a){return String(a).toLowerCase().trim().replace(/\s*,\s*/g,",").replace(/\s*\(\s*/g,"(").replace(/\s+\)/g,")").replace(/\s\s+/g," ")}function d(a,e,d,f){this.r=c(0,b(parseInt(a)||0,255));this.g=c(0,b(parseInt(e)||0,255));this.b=c(0,b(parseInt(d)||0,255));this.a=c(0,b(parseInt(f)||0,255))}function e(a){this.src=String(a)}function f(a,e,d,b){this.type=String(a);this.from=e;this.to=d;this.steps=this.steps||[]}function h(a,e){return a.stop-e.stop}function g(a,e,d){this.x=
parseInt(a)||0;this.y=parseInt(e)||0;this.r=c(0,parseInt(d)||0)}function k(a,e){this.stop=c(0,b(parseFloat(a)||0,1));this.color=e}function m(a){return a}var l={},n={},r={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",
cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",
floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",
lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",
mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",
seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",transparent:"#000000",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},s=Object.keys(r),p=s.join("|"),s="("+s.join("|")+")",p=[p,"#(?:[0-9a-fA-F]{3}|[0-9a-fA-F]{6})|rgb\\(\\d+,\\d+,\\d+\\)|rgba\\(\\d+,\\d+,\\d+,[0-9\\.]+\\)|hsl\\(\\d+(?:deg)?,\\d+%?,\\d+%?\\)"].join("|"),
s=[s,"(#)(?:([0-9a-fA-F])([0-9a-fA-F])([0-9a-fA-F])|([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2}))|(rgb)\\((\\d+),(\\d+),(\\d+)\\)|(rgba)\\((\\d+),(\\d+),(\\d+),([0-9\\.]+)\\)|(hsl)\\((\\d+)(?:deg)?,(\\d+)%?,(\\d+)%?\\)"].join("|"),t=RegExp("^(?:"+s+")$","i"),v=/^(?:image\(([^\)]*)\))$/i,q=/(linear|radial)/i,u=/(\d+)\s(\d+)(?:\s(\d+))?/i,y="from\\(("+p+")\\)",D=RegExp(y,"i"),A="to\\(("+p+")\\)",z=RegExp(A,"i"),x="stop\\(([0-9\\.]+),("+p+")\\)",C=RegExp(x,"i"),s=["linear|radial|\\d+\\s\\d+(?:\\s\\d+)?",
"from\\((?:"+p+")\\)","to\\((?:"+p+")\\)","stop\\([0-9\\.]+,(?:"+p+")\\)"].join("|"),w=["(linear|radial)|(\\d+)\\s(\\d+)(?:\\s(\\d+))?",y,A,x].join("|"),y="gradient\\((?:"+s+")(?:,(?:"+s+"))*\\)",B=RegExp("^(?:"+("gradient\\(((?:"+s+")(?:,(?:"+s+"))*)\\)")+")$","i"),F=["repeat","repeat-x","repeat-y","no-repeat"],s=F.join("|"),A="("+F.join("|")+")",E=RegExp("^(?:"+A+")$","i"),p=[p,y,"image\\([^\\)]*\\)",s].join("|"),K=RegExp("^("+p+")(?:\\s("+p+"))?(?:\\s("+p+"))?(?:\\s("+p+"))?(?:\\s("+p+"))?(?:\\s("+
p+"))?(?:\\s("+p+"))?(?:\\s("+p+"))?(?:\\s("+p+"))?(?:\\s("+p+"))?(?:\\s("+p+"))?(?:\\s("+p+"))?(?:\\s("+p+"))?$","i");l.REPEAT="repeat";l.COLOR="color";l.IMAGE="image";l.parse=function(b,c){c=c||{};b=a(b);var g=K.exec(b);if(!g)return null;g.shift();g.remove(void 0);c[l.IMAGE]=null;c[l.COLOR]=d.parse("transparent");c[l.REPEAT]=F.first();for(var h=0,k=g.length;h<k;h++){var n=g[h];switch(!1){case !(b=f.parse(n)):case !(b=e.parse(n)):c[l.IMAGE]=b;break;case !(b=d.parse(n)):c[l.COLOR]=b;break;case !(b=
m.parse(n)):c[l.REPEAT]=b}}return c};l.Color=d;d.prototype={toString:function(){return function(){return"rgba({},{},{},{})".format(this.r,this.g,this.b,this.a/255)}}()};d.parse=function(e,b){e=a(e);var c=t.exec(e);if(!c)return null;b=b||n[e]||(n[e]=new d(0,0,0,0));c.remove(void 0);c.shift();var f=c.shift(),g=N.hasOwnProperty(f)?N[f]:null;return g?g.apply(b,c):f in r?d.parse(r[f],b):null};var N={hsl:function(){function a(e,d,b){0>b&&(b+=1);1<b&&(b-=1);return b<1/6?e+6*(d-e)*b:0.5>b?d:b<2/3?e+6*(d-
e)*(2/3-b):e}return function(e,b,c){e=(parseFloat(e)||0)%360/360;b=(parseFloat(b)||0)/100;c=(parseFloat(c)||0)/100;if(0===b){e=b=c*=255;var f=255}else{var f=0.5>c?c*(1+b):c+b-c*b,g=2*c-f;c=255*a(g,f,e+1/3);b=255*a(g,f,e);e=255*a(g,f,e-1/3);f=255}return this instanceof d?(d.call(this,c,b,e,f),this):new d(c,b,e,f)}}(),"#":function(a,e,b){a=1===a.length?a+a:a;e=1===e.length?e+e:e;b=1===b.length?b+b:b;a=parseInt(a,16)||0;e=parseInt(e,16)||0;b=parseInt(b,16)||0;return this instanceof d?(d.call(this,a,
e,b,255),this):new d(a,e,b,255)},rgb:function(a,e,b){return this instanceof d?(d.call(this,a,e,b,255),this):new d(a,e,b,255)},rgba:function(a,e,b,c){return this instanceof d?(d.call(this,a,e,b,255*c),this):new d(a,e,b,255*c)},transparent:function(){return this instanceof d?(d.call(this,0,0,0,0),this):new d(0,0,0,0)}};l.Image=e;e.parse=function(d,b){d=a(d);var c=v.exec(d);if(!c)return null;b=b||n[d]||(n[d]=new e);e.call(b,c[1]);return b};l.Gradient=f;f.prototype={add:function(a,e){this.steps.push(new k(a,
e));this.steps.sort(h)}};f.parse=function(e,b){e=a(e);var c=B.exec(e);if(!c)return null;c=c.last().match(RegExp(w,"gi"));if(!c)return null;for(var h=b?(f.call(b),b):n[e]||(n[e]=new f),k=0,m=c.length,l=null;k<m;k++){var l=c[k],t=null;switch(!1){case !(t=q.exec(l)):h.type=t.last();break;case !(t=u.exec(l)):t.shift();t=new g(t[0],t[1],t[2]);h.from?h.to=t:h.from=t;break;case !(t=D.exec(l)):l=0;t=d.parse(t.last());h.add(l,t);break;case !(t=z.exec(l)):l=1;t=d.parse(t.last());h.add(l,t);break;case !(t=C.exec(l)):l=
t[1],t=d.parse(t.last()),h.add(l,t)}}return h};f.Position=g;f.Stop=k;l.Repetition=m;m.parse=function(e){e=a(e);return(e=E.exec(e))?e[1]:null};return l}(Math.min,Math.max);(function(b,c){var a=b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame||b.oRequestAnimationFrame||b.msRequestAnimationFrame||null;if(!a)return!1;var d=!1,e=function(){d=!1;c.vsync()};Class.decorate(c,"request",function(){if(d)return!1;d=!0;a(e);return!0})})(this,Engine.Loop);(function(b,c){function a(a,b){if(a&&b){var c=document.createElement("meta");c.setAttribute("name",a);c.setAttribute("content",b);document.head.insertBefore(c,d);return c}}var d=document.head.children[1];a("viewport","width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no");a("HandheldFriendly","true");a("MobileOptimized",480);/iPod|iPad|iPhone/.test(navigator.userAgent)&&(a("apple-mobile-web-app-capable","yes"),a("apple-mobile-web-app-status-bar-style","black-translucent"))})(Engine,
Engine.Device);(function(b){b.userAgents={platform:{"windows nt 6.2":"Windows 8","windows nt 6.1":"Windows 7","windows nt 6.0":"Windows Vista","windows nt 5.2":"Windows 2003","windows nt 5.1":"Windows XP","windows nt 5.0":"Windows 2000","windows nt 4.0":"Windows NT","winnt4.0":"Windows NT","winnt 4.0":"Windows NT",winnt:"Windows NT","windows 98":"Windows 98",win98:"Windows 98","windows 95":"Windows 95",win95:"Windows 95",windows:"Unknown Windows OS","os x":"Mac OS X","intel mac":"Intel Mac","ppc mac":"PowerPC Mac",
powerpc:"PowerPC",ppc:"PowerPC",cygwin:"Cygwin",linux:"Linux",debian:"Debian",openvms:"OpenVMS",sunos:"Sun Solaris",amiga:"Amiga",beos:"BeOS",apachebench:"ApacheBench",freebsd:"FreeBSD",netbsd:"NetBSD",bsdi:"BSDi",openbsd:"OpenBSD","os/2":"OS/2",warp:"OS/2",aix:"AIX",irix:"Irix",osf:"DEC OSF","hp-ux":"HP-UX",hurd:"GNU/Hurd",unix:"Unknown Unix OS"},browser:{opera:"Opera",msie:"Internet Explorer","internet explorer":"Internet Explorer",iemobile:"Internet Explorer",shiira:"Shiira",firefox:"Firefox",
chimera:"Chimera",phoenix:"Phoenix",firebird:"Firebird",camino:"Camino",navigator:"Netscape",netscape:"Netscape",omniweb:"OmniWeb",chrome:"Chrome",safari:"Safari",cfnetwork:"Safari",konqueror:"Konqueror",epiphany:"Epiphany",galeon:"Galeon",mozilla:"Mozilla",icab:"iCab",lynx:"Lynx",links:"Links",hotjava:"HotJava",amaya:"Amaya",ibrowse:"IBrowse"},mobile:{iemobile:"Windows Phone OS","windows phone os":"Windows Phone OS",mobileexplorer:"Mobile Explorer",openwave:"Open Wave","opera mini":"Opera Mini",
operamini:"Opera Mini",elaine:"Palm",palmsource:"Palm","digital paths":"Palm",avantgo:"Avantgo",xiino:"Xiino",palmscape:"Palmscape",nokia:"Nokia",ericsson:"Ericsson",blackberry:"BlackBerry",motorola:"Motorola",iphone:"iPhone",ipad:"iPad",ipod:"iPod",android:"Android"}}})(Engine.Device);(function(b){var c,a=function(a,d,b){b[d]=a.toLowerCase()},d=function(a,d){var b=function(a,e){return d.indexOf(a)-d.indexOf(e)};1<a.length&&a.sort(b);return a};c=function(){var a=document.documentElement;return b.features=Object.merge(b.features,{canvas:!!window.CanvasRenderingContext2D,svg:!!window.SVGElement,audio:!!window.Audio,video:!!window.HTMLVideoElement,compass:"object"===typeof window.ondeviceorientation&&"object"===typeof window.ondevicemotion,fullscreen:!!(a.requestFullscreen||a.requestFullScreen||
a.mozRequestFullscreen||a.mozRequestFullScreen||a.webkitRequestFullscreen||a.webkitRequestFullScreen),userMedia:!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia),gamepad:!!(navigator.gamepads||navigator.webkitGamepads||navigator.mozGamepads),cache:{scripts:!!window.applicationCache,files:!!(window.requestFileSystem||window.webkitRequestFileSystem||window.mozRequestFileSystem),data:!!(window.localStorage||window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||
window.openDatabase)},geolocation:!!navigator.geolocation,notifications:!!window.Notification,pageVisibility:!!(document.visibilityState||document.mozVisibilityState||document.webkitVisibilityState),vibration:!!navigator.vibrate,telephony:!(!navigator.telephony&&!navigator.mozTelephony),pointerLock:!!(a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock)})}();(function(){var e,c,h,g,k=navigator.userAgent;h=b.userAgents.mobile;g=Object.keys(h);e=k.match(RegExp(g.join("|"),"ig"));
null!==e?c="mobile":(h=b.userAgents.platform,g=Object.keys(h),e=k.match(RegExp(g.join("|"),"ig")),null!==e&&(c="desktop"));null!==e&&(e.forEach(a),d(e,g),e=h[e.first()],null!==e.match(/iPod|iPad|iPhone/)&&(e="iOS"),b.platform=Object.merge(b.platform,{type:c,name:e}))})();(function(){(function(){var e,c,h=Object.keys(b.userAgents.browser);c=navigator.userAgent;e=c.match(RegExp(h.join("|"),"ig"));null!==e&&(e.forEach(a),d(e,h),e=e.first(),h=RegExp(e,"i").exec(c).index,c=c.substring(h+e.length+1),0<
c.length?(0<c.indexOf(" ")&&(c=c.substring(0,c.indexOf(" "))),c=parseFloat(c)):c=void 0,b.navigator.browser=Object.merge(b.navigator.browser,{name:b.userAgents.browser[e],version:c}))})();(function(){var a=navigator.userLanguage||navigator.systemLanguage||navigator.language;"undefined"!==typeof a&&(a=a.split("-"),"undefined"===typeof a[1]&&(a[1]=a[0]),a=a[0]+"_"+a[1].toUpperCase(),b.navigator.language=a)})()})();(function(){if("mobile"===b.platform.type){var a=function(a){b.keyboard!==a&&(b.keyboard=
a,b.trigger("keyboardstatuschanged"))};window.addEventListener("DOMContentLoaded",function(){document.body.addEventListener("touchstart",function(){a(!1)});document.body.addEventListener("keydown",function(){a(!0)})})}b.keyboard="mobile"!==b.platform.type})();"boolean"===typeof navigator.onLine&&function(){window.addEventListener("online",function(){b.online=navigator.onLine;b.trigger("online")});window.addEventListener("offline",function(){b.online=navigator.onLine;b.trigger("offline")});b.online=
navigator.onLine}();(function(){var a,d,c=screen.mozOrientation||screen.webkitOrientation||screen.orientation;"string"===typeof c?(a=function(){b.screen.orientation=function(){switch(c){case "portrait-primary":return 0;case "portrait-secondary":return 180;case "landscape-primary":return-90;case "landscape-secondary":return 90}}()},screen.addEventListener("orientationchanged",function(){a();b.trigger("screenorientationchanged",b.screen.orientation)}),a()):"undefined"!==typeof window.orientation?(a=
function(){b.screen.orientation=window.orientation},window.addEventListener("DOMContentLoaded",function(){document.body.addEventListener("orientationchange",function(){a();b.trigger("screenorientationchanged",window.orientation)});a()})):(a=function(){b.screen.orientation=d.clientWidth>d.clientHeight?90:0},window.addEventListener("DOMContentLoaded",function(){d=document.body;window.addEventListener("resize",function(){var d=b.screen.orientation;a();d!==b.screen.orientation&&b.trigger("screenorientationchanged",
d)});a()}));window.addEventListener("resize",function(){b.screen.innerWidth=window.innerWidth;b.screen.innerHeight=window.innerHeight;b.trigger("resize")});b.screen=Object.merge(b.screen,{width:screen.width,height:screen.height,innerWidth:window.innerWidth,innerHeight:window.innerHeight,pixelDepth:screen.pixelDepth||screen.colorDepth,pixelRatio:window.devicePixelRatio||1})})();c.compass&&function(){var a=Math.round;(function(){window.addEventListener("deviceorientation",function(d){var c=b.compass.orientation;
d={alpha:a(d.alpha),beta:a(d.beta),gamma:a(d.gamma)};if(c.alpha!==d.alpha||c.beta!==d.beta||c.gamma!==d.gamma)b.compass.orientation=Object.merge(b.compass.orientation,d),b.trigger("orientationchanged",d)})})();(function(){window.addEventListener("devicemotion",function(d){var c,g;c=d.rotationRate;g=d.acceleration;d=b.compass.motion;c={alpha:a(c.alpha),beta:a(c.beta),gamma:a(c.gamma)};g={x:a(g.x),y:a(g.y),z:a(g.z)};if(d.alpha!==c.alpha||d.beta!==c.beta||d.gamma!==c.gamma||d.x!==g.x||d.y!==g.y||d.z!==
g.z)d=Object.merge(c,g),b.compass.motion=Object.merge(b.compass.motion,d),b.trigger("motionchanged",d)})})()}();c.pageVisibility&&function(){var a="visibilityState",d="visibilitychange";(function(){var b=document.webkitVisibilityState&&"webkit"||document.mozVisibilityState&&"moz"||document.msVisibilityState&&"ms"||null;null!==b&&(a=b+a.capitalize(),d=b+d)})();document.addEventListener(d,function(d){d="visible"===document[a];b.pageVisible=d;b.trigger(d?"pagevisible":"pagehidden")})}();delete b.userAgents})(Engine.Device);(function(b,c){function a(){n={};for(var a=l.length;a--;)l.pop()()}var d=window.document,e=d.documentElement,f=null,h=null,g=null,k=null,m=null;(function(){function a(b,c){""!==u&&(b=b.capitalize());c=c||"";for(var f=0;f<n;f++)var g=u+b+l[f]+c;return g in d||g in e?g:null}for(var b=["moz","webkit"],c=b.length,l=["Fullscreen","FullScreen"],n=l.length,q=-1;q<c;q++){var u=b[q]||"";a("request")&&(f=a("request"),h=a("exit")||a("cancel"),g=a("","Element")||a("current","Element"),k=u+"fullscreenchange",
m=u+"fullscreenerror")}})();if(f&&h&&g&&k&&m){var l=[],n={};d[g]&&(c.viewport=!0,c.exit());e.addEventListener(k,function(){var e=d[g];c.viewport=e&&n[e];a()});e.addEventListener(m,function(){a()});Class.decorate(c,"request",function(a,d,e){d=this._super.bind(this,a,d,e);l.push(d);d=a.div;n[d]=a;d[f]()});Class.decorate(c,"exit",function(a,e){var b=this._super.bind(this,a,e);l.push(b);d[h]()})}})(Engine.Device,Engine.Device.Fullscreen);(function(b,c){if(b.features.geolocation){var a=null;Class.decorate(c,"getPosition",function(d,e,b){var h=this._super,g;g=navigator.geolocation[d?"watchPosition":"getCurrentPosition"](function(a){c.setPosition([a.coords.latitude,a.coords.longitude]);h(d,e,b)},function(){h(d,e,b)});d&&(a=g)});Class.decorate(c,"clearWatch",function(d){var e=this._super;null!==a&&!0===c.watching&&(c.watching=!1,navigator.geolocation.clearWatch(a));e(onerror,d)})}})(Engine.Device,Engine.Device.Geolocation);(function(b,c){b.features.notifications&&(c.decorate("show",function(){function a(){return b.onerror&&b.onerror()}function d(){var d=b.notification=new window.Notification(b.title,{body:b.body,tag:b.tag||"",iconUrl:b.iconURL});d.addEventListener("show",function(){return e.call(b)});d.addEventListener("error",a);d.addEventListener("click",function(){b.onclick&&b.onclick();return b.close()});b.expireTime&&d.addEventListener("show",function(){b.timeout=window.setTimeout(function(){return b.close()},
b.expireTime)});d.show()}var e=this._super,b=this,c=window.Notification.permission||window.Notification.permissionLevel&&window.Notification.permissionLevel();"granted"===c||"undefined"===typeof c?d():window.Notification.requestPermission(function(e){return"granted"===e?d():a()})}),c.decorate("close",function(){if(!this.notification)return this._super();var a=this._super,d=this,e=this.notification,b=e.timeout;e.addEventListener("close",function(){return a.call(d)});b&&window.clearTimeout(b);e.close();
return delete this.notification}))})(Engine.Device,Engine.Device.Notification);(function(b,c){function a(){var a=!!h[l];if(a!==c.isLocked)return(c.isLocked=a)?c.trigger(k):c.trigger(m),a}function d(){a();var d=f.first();if(d)return d(),f.shift(),f.forEach(function(a){f.remove(a);return a("UNNECESSARY_COMMAND_ERR")})}function e(){return f.forEach(function(a){f.remove(a);return a("ACCESS_DENIED_ERR")})}if(b.features.pointerLock){var f=[],h=window.document,g=h.documentElement,k="mouselock",m="mouseunlock",l="undefined"!==typeof h.pointerLockElement&&"pointerLockElement"||"undefined"!==
typeof h.webkitPointerLockElement&&"webkitPointerLockElement"||"undefined"!==typeof h.mozPointerLockElement&&"mozPointerLockElement",n=g.requestPointerLock||g.webkitRequestPointerLock||g.mozRequestPointerLock,r=h.exitPointerLock||h.webkitExitPointerLock||h.mozExitPointerLock,s="undefined"!==typeof h.onpointerlockchange&&"pointerlockchange"||"undefined"!==typeof h.onwebkitpointerlockchange&&"webkitpointerlockchange"||"undefined"!==typeof h.onmozpointerlockchange&&"mozpointerlockchange",p="undefined"!==
typeof h.onpointerlockerror&&"pointerlockerror"||"undefined"!==typeof h.onwebkitpointerlockerror&&"webkitpointerlockerror"||"undefined"!==typeof h.onmozpointerlockerror&&"mozpointerlockerror";a();h.addEventListener(s,d);h.addEventListener(p,e);c.lock=function(a){if(!0===c.isLocked)return a&&a("UNNECESSARY_COMMAND_ERR");a&&f.push(a);n.call(g)};c.unlock=function(a){if(!1===c.isLocked)return a&&a("UNNECESSARY_COMMAND_ERR");a&&f.push(a);r.call(h)}}})(Engine.Device,Engine.Device.Pointer);(function(b,c){Class.decorate(b,"request",function(a,d,e){a=a instanceof Engine.Viewport?a:null;d="function"===typeof d?d:c;e="function"===typeof e?e:c;if(!a)throw new TypeError("No viewport passed");if(b.viewport===a)return d();if(b.viewport)return a=this._super.bind(this,a,d,e),b.exit(a,e);this._super(a,d,e)});Class.decorate(b,"exit",function(a,d){a="function"===typeof a?a:c;d="function"===typeof d?d:c;if(!b.viewport)return a();this._super(a,d)})})(Engine.Device.Fullscreen,Engine.NOP);Engine.Error=function(b,c,a){function d(e,c){c||(c=e,e="");this.type=String(e||this.type);this.name=d.NAME.format(this.type.capitalize());this.message=String(arguments.length?c:this.message);a.DEBUG&&Engine.log(this+"",Engine.ERROR);this.model instanceof b&&this.model.trigger(this.name.toLowerCase(),this)}d.NAME="Engine{0}Error";d.property({type:"",model:null,message:"",toString:function(){return this.name+(this.message&&": "+this.message)}});return d}(Model,Error,Engine.config);Engine.Error.Reference=function(b){function c(){b.apply(this,arguments)}Class.extend(c,b);c.property("type","reference");return c}(Engine.Error);Engine.Error.Syntax=function(b){function c(){b.apply(this,arguments)}Class.extend(c,b);c.property("type","syntax");return c}(Engine.Error);Engine.Error.Range=function(b){function c(){b.apply(this,arguments)}Class.extend(c,b);c.property("type","range");return c}(Engine.Error);Engine.Error.Type=function(b){function c(){b.apply(this,arguments)}Class.extend(c,b);c.property("type","type");return c}(Engine.Error);Engine.Error.NotImplemented=function(b){function c(){b.apply(this,arguments)}Class.extend(c,b);c.property("type","notImplemented");return c}(Engine.Error);Engine.Timer=function(b,c,a,d){function e(a){this.duration=a&&"duration"in a?b(1,parseFloat(a.duration)||0):b(1,parseFloat(this.duration)||0);this.delay=a&&"delay"in a?b(1,parseInt(a.delay)||0):b(1,parseInt(this.delay)||0);this.autoplay=a&&"autoplay"in a?Boolean(a.autoplay):this.autoplay;this.type=a&&"type"in a?String(a.type):String(this.type);this.loop=a&&"loop"in a?Boolean(a.loop):Boolean(this.loop);this.iterations=a&&"iterations"in a?b(0,c(parseFloat(a.iterations))||0):b(0,c(parseFloat(this.iterations))||
0);this.playing=!1;this.count=this.stepprogress=this.progress=0;Model.call(this,a);this.autoplay&&this.play()}var f=e.STANDARD="standard",h=e.LOOP="loop",g=e.STEP="step",k=e.STOP="stop",m=e.PLAY="play",l=e.PAUSE="pause",n=e.START="timerstart",r=e.STOP="timerstop",s={};Class.extend(e,Model);e.property({type:f,duration:1E3,loop:!1,iterations:Infinity,delay:1,autoplay:!1});e.method({reset:function(){this.count=this.stepprogress=this.progress=0},play:function(){if(!this.playing){var a=s.hasOwnProperty(this.type)?
s[this.type]:s[this.type]=[];a.add(this);1===a.length&&e.start(this.type);this.playing=!0;this.trigger(m);return!0}return!1},pause:function(){if(this.playing){var d=s.hasOwnProperty(this.type)?s[this.type]:s[this.type]=[],e=a.call(d,this);~e&&(d[e]=null);this.playing=!1;this.queue(l);return!0}return!1},stop:function(){if(this.playing){var d=s.hasOwnProperty(this.type)?s[this.type]:s[this.type]=[],e=a.call(d,this);~e&&(d[e]=null);this.playing=!1;this.stepprogress=this.progress=0;this.queue(k);return!0}return!1}});
e.evaluate=function(a,e){var b=s.hasOwnProperty(a)?s[a]:null;if(!b||!b.length)return!1;for(var c=b.length;0<c--;){var f=b[c];if(f){f.progress+=e;f.stepprogress+=e;if(f.stepprogress>=f.delay){var k=f.stepprogress;f.stepprogress%=f.delay;f.trigger(g,k)}f.progress>=f.duration&&(f.loop?(f.count++,f.progress%=f.duration,f.trigger(h),f.count>=f.iterations&&f.stop()):f.stop())}else d.call(b,c,1)}return!!b.length};e.start=function(a){Engine.trigger(n,a)};e.stop=function(a){Engine.trigger(r,a)};return e}(Math.max,
Math.floor,Array.prototype.indexOf,Array.prototype.splice);(function(b,c,a){function d(){var b=a()-h;h+=b;e=c.evaluate(f,b)?setTimeout(d,17):0}var e=0,f=c.STANDARD,h=0;b.addEventListener(c.START,function(b){if(b!==f)return!1;e||(h=a(),e=setTimeout(d,17));return!0});b.addEventListener(c.STOP,function(a){if(a!==f)return!1;clearTimeout(e);e=0;return!0})})(Engine,Engine.Timer,Engine.now);(function(b,c,a,d){function e(){var e=d()-h;h+=e;a.evaluate(f,e)&&c.request()}var f=a.ANIMATION="animation",h=null;b.addEventListener(a.START,function(a){if(a!==f)return!1;c.addEventListener(c.VSYNC,e);if(c.request()||null===h)h=d();return!0});b.addEventListener(a.STOP,function(a){if(a!==f)return!1;c.removeEventListener(c.VSYNC,e);h=null;return!0})})(Engine,Engine.Loop,Engine.Timer,Engine.now);Engine.Box=function(){function b(a,b,c,k){Model.call(this);this.x=e(parseFloat(a)||0);this.y=e(parseFloat(b)||0);this.w=d(parseFloat(a+c)||0)-this.x;this.h=d(parseFloat(b+k)||0)-this.y}var c=Math.max,a=Math.min,d=Math.ceil,e=Math.floor;Class.extend(b,Model);b.overlap=function(a,d,e,b,c,l,n,r){return a<c+n&&a+e>c&&d<l+r&&d+b>l};b.extend=function(a,d,e,b,c,l,n,r){return a<c&&a+e>c+n&&d<l&&d+b>l+r};b.method({overlap:function(a){return b.overlap(this.x,this.y,this.w,this.h,a.x,a.y,a.w,a.h)},extend:function(a){return b.extend(this.x,
this.y,this.w,this.h,a.x,a.y,a.w,a.h)},bound:function(d,e){var b=this.x,k=this.y,m=d.x,l=d.y;e=e||this;e.x=a(b,m);e.y=a(k,l);e.w=c(b+this.w,m+d.w)-e.x;e.h=c(k+this.h,l+d.h)-e.y;return e},clip:function(d,e){var b,k,m,l;m=this.x;l=this.y;var n=d.x,r=d.y;e=e||this;b=c(m,n);k=c(l,r);m=a(m+this.w,n+d.w)-b;l=a(l+this.h,r+d.h)-k;return 0>m||0>l?e.reset(0,0,0,0):e.reset(b,k,m,l)},copy:function(a){this.x=a.x;this.y=a.y;this.w=a.w;this.h=a.h},area:function(){return this.w*this.h},toString:function(){return"Box("+
this.x+","+this.y+","+this.w+","+this.h+")"},clone:function(){return new b(this.x,this.y,this.w,this.h)},equal:function(a){return a.x==this.x&&a.y==this.y&&a.w==this.w&&a.h==this.h},reset:function(a,d,e,b){this.x=parseInt(a)||0;this.y=parseInt(d)||0;this.w=0<=e?parseInt(e)||0:0;this.h=0<=b?parseInt(b)||0:0;return this}});return b}();Engine.Font=function(b){function c(d,e,c,f){1===arguments.length&&"object"===typeof d?(this.family=String(d&&"family"in d?d.family:this.family),this.size=String(d&&"size"in d?d.size:this.size).toLowerCase(),this.weight=String(d&&"weight"in d?d.weight:this.weight),this.style=String(d&&"style"in d?d.style:this.style),a(this),b.call(this,d)):(this.family=String(void 0!==d?d:this.family),this.size=String(void 0!==e?e:this.size).toLowerCase(),this.weight=String(void 0!==c?c:this.weight),this.style=String(void 0!==
f?f:this.style),a(this),b.call(this))}function a(a){a.size=d.test(a.size)?a.size:c.SIZE;a.weight=e.has(a.weight)?a.weight:e.first();a.style=f.has(a.style)?a.style:f.first()}var d=/(?:[1-9][0-9]+|[0-9])px|pt/;c.SIZE="12px";var e=[c.REGULAR="regular",c.BOLD="bold"],f=[c.NORMAL="normal",c.ITALIC="italic"];Class.extend(c,b);c.property({family:"",size:c.SIZE,weight:c.REGULAR,style:c.NORMAL});return c}(Model);Engine.Network=function(){return new Model}();Engine.Network.Url=function(b){var c=b.xUrl=RegExp("{}?{}?{}?{}?{}?{}?".format("(?:([a-z0-9]+\\:?)?\\/\\/)","([^\\/\\:]+)","(?:\\:([0-9]+))","([^\\?]+)","(?:(\\?[^\\#]+))","(?:(#.*))"),"i");return{parse:function(a){a=String(a);var d=c.exec(a)||[];a=String(d[1]||"").toLowerCase();var e=d[2]||"",b=d[3]||"",h=d[4]||"",g=d[5]||"",d=d[6]||"",k=b?e+":"+b:e;return{protocol:a,host:k,hostname:e,port:b,pathname:h,search:g,hash:d,origin:a+"//"+k,href:a+"//"+k+h+g+d}},toQuery:function(a){if(!a)return"";var d=
"",e;for(e in a)d+=e+"="+a[e]+"&";return d.slice(0,-1)},fromQuery:function(a){a=String(a);var d={};if(""===a)return d;a=a.split("&");for(var e=0,b=a.length;e<b;e++){var c=a[e].split("=");d[c[0]||""]=c[1]||""}return d}}}(Engine.Network);Engine.Network.Resource=function(){function b(b){this.src=String(b&&"src"in b?b.src:this.src);this.method=String(b&&"method"in b?b.method:this.method);this.data=b&&"data"in b?b.data:this.data;this.type=String(b&&"type"in b?b.type:this.type);this.headers=b&&"headers"in b?b.headers:this.headers;this.headers="object"===typeof this.headers?this.headers:null;this.autoload=Boolean(b&&"autoload"in b?b.autoload:this.autoload);this.pending=!1;this.response=null;this.complete=!1;Model.call(this,b);""===this.src&&
Engine.log("Resource was created without URL. Set config.src parameter during instancing to resolve.",Engine.WARN);this.autoload&&this.load()}Class.extend(b,Model);b.JSON="json";b.TEXT="text";b.DATA="data";b.AUTO="auto";b.GET="get";b.POST="post";b.LOAD="load";b.ERROR="error";b.PROGRESS="progress";b.ABORT="abort";b.property({src:"",headers:null,method:b.GET,type:b.AUTO,data:null,autoload:!0});b.property("on"+b.LOAD,function(b){this.response=b;this.pending=!1;this.complete=!0});b.property("on"+b.ERROR,
function(b){this.response=null;this.complete=this.pending=!1});b.method({load:function(){if(this.pending||!this.src)return!1;this.pending=!0;this.complete=!1;this.response=null;return!0},abort:function(){if(!this.pending)return!1;this.complete=this.pending=!1;this.response=null;return!0}});return b}();Engine.Network.Resource.Error={};Engine.Network.Resource.Error.Request=function(b){function c(a){b.call(this,"Request finished with [{}] status".format(a));this.status=parseInt(a)||0}Class.extend(c,b);c.property("type","networkResourceRequest");c.property("status",0);return c}(Engine.Error);Engine.Network.Resource.Error.Parse=function(b){function c(a){b.call(this,a)}Class.extend(c,b);c.property("type","networkResourceParse");return c}(Engine.Error);Engine.Network.Socket=function(){function b(b){this.src=b&&"src"in b?b.src:this.src;Model.call(this,b);""===this.src&&Engine.log("Socket was created without URL. Set config.src parameter during instancing to resolve.",Engine.WARN)}Class.extend(b,Model);b.property("src","");b.method({connect:function(b){},send:function(b){},close:function(){}});return b}();Engine.Element=function(){function b(c){this.global=new Matrix;this.name=c&&"name"in c?String(c.name):this.name;this.id=c&&"id"in c?null!==c.id?String(c.id):null:null!==this.id?String(this.id):null;this.parent=c&&c.parent&&c.parent instanceof Engine.Node?c.parent:this.parent;this.zindex=!c||"number"!==typeof c.zindex&&null!==c.zindex?this.zindex:c.zindex;b.register(this.id,this);this.selectable=c&&"boolean"===typeof c.selectable?c.selectable:this.selectable;Model.call(this,c);this.parent&&this.parent.appendChild(this)}
Class.extend(b,Model);b.elements={};b.SELECTED="selected";b.DESELECTED="deselected";b.property({selectable:!1,global:null,matrix:null,id:null,name:null,root:null,parent:null,zindex:null});b.getElementById=function(b){return this.elements[b]||null};b.register=function(b,a){null!==b&&(this.elements[b]=a)};b.unregister=function(b,a){null!==b&&this.elements[b]===a&&delete this.elements[b]};b.method({destroy:function(){b.unregister(this.id,this);this.parent&&this.parent.removeChild(this)},getElementById:function(c){return b.getElementById(c)},
next:function(){return this.parent&&this.parent.children[this.parent.children.indexOf(this)+1]||null},update:function(){var b=this.parent&&this.parent.root||this.parent||null;this.root!==b&&this.deselect();this.root=b;this.parent?this.global=this.matrix?this.parent.global.multiply(this.matrix,this.global):this.global.copy(this.parent.global):this.global.reset()},prev:function(){return this.parent&&this.parent.children[this.parent.children.indexOf(this)-1]||null},setId:function(c){c=null===c?c:String(c);
if(this.id===c)return!1;b.unregister(this.id,this);this.id=c;b.register(this.id,this);return!0},setZindex:function(b){b=null!==b?parseInt(b)||0:b;if(this.zindex===b)return!1;this.zindex=b;this.update();return!0},extractZindex:function(){for(var b=this;null!==b&&null===b.zindex;)b=b.parent;return b?parseInt(b.zindex)||0:0},index:function(){return this.parent?this.parent.children.indexOf(this):0},firstParentOfType:function(b){if("function"!==typeof b)return null;for(var a=this;a=a.parent;)if(a instanceof
b)return a;return null},setName:function(b){b=null!==b?String(b):b;var a=this.name;if(a===b)return!1;this.name=b;var d=this.parent;d&&(d[a]===this&&delete d[a],!d.hasOwnProperty(b)&&(d[b]=this));return!0},select:function(){if(!(this.root instanceof Engine.Scene&&this.selectable))return!1;if(this.root.selected.has(this))return!0;if(null===this.root.multiSelect)return!1;!this.root.multiSelect&&this.root.selected.length&&this.root.deselectAll();this.root.selected.push(this);this.trigger(b.SELECTED);
return!0},deselect:function(){if(!(this.root instanceof Engine.Scene&&this.root.selected.has(this)))return!1;this.root.selected.remove(this);this.trigger(b.DESELECTED);return!0}});return b}();Engine.Node=function(b,c){function a(a){this.children=[];b.call(this,a);if(null!=a&&a.children instanceof Array){a=a.children;for(var e=0;e<a.length;e++)a[e]instanceof b&&this.appendChild(a[e])}}Class.extend(a,b);a.method({update:function(a){a=a||this;this._super(a);for(var e=this.children,b=e.length;b--;)e[b].update(a)},appendChild:function(a,e){e="undefined"===typeof e?this.children.length:e;if(this.children.has(a))return null;null!==a.parent&&a.parent!==this&&a.parent.removeChild(a);this.children.splice(e,
0,a);a.parent=this;null!==a.name&&!this.hasOwnProperty(a.name)&&(this[a.name]=a);a.update(this);return a},removeChild:function(a){if(!this.children.has(a))return null;this.children.remove(a);a.parent=null;null!==a.name&&this[a.name]===a&&delete this[a.name];a.update(this);return a},destroy:function(){for(var a=this.children,e=a.length;0<e--;)a[e].destroy();this._super()},clear:function(){for(var a=this.children,e=a.length;0<e--;)a[e].destroy();a.length&&Engine.log("Engine.Node::clear: Node is not clear enough",
Engine.WARN)},getBb:function(){for(var a=new c(0,0,0,0),e=0,b=this.children,h=b.length;e<h;e++){var g=b[e].getBb();a.w&&a.h?a.bound(g):a.copy(g)}return a}});return a}(Engine.Element,Engine.Box);Engine.Scene=Engine.Node.Scene=function(b,c,a,d){function e(d){this.space={};this.space[e.GEOMETRY]=new a;this.space[e.MEDIA]=new a;this.space[e.CAMERA]=new a;this.multiSelect=!d||"boolean"!==typeof d.multiSelect&&null!==d.multiSelect?this.multiSelect:d.multiSelect;this.selected=[];b.call(this,d);if(!this.selectable)throw"Scene: Root element must be selectable";}Class.extend(e,b);e.GEOMETRY="geometry";e.MEDIA="media";e.CAMERA="camera";e.property({selectable:!0,multiSelect:!1,selected:null});e.method({setMultiSelect:function(a){if("boolean"!==
typeof a&&null!==a)throw new TypeError;this.multiSelect=a;if(!a&&this.selected.length){if(!1===a){if(1===this.selected.length)return;var e=this.selected.first(),d=function(a){return a!==e}}this.deselectAll(d)}},search:function(a,d){d="undefined"==typeof d?e.GEOMETRY:d;var b=this.space[d];return b?(a=null===a?b.get_tree():a,b.search(a)):[]},sort:function(a){return a.sort(this.compare)},compare:function(a,e){var d=e.extractZindex()-a.extractZindex();if(d)return d;for(var d=[],b=[];a;)d.push(a.index()),
a=a.parent;for(;e;)b.push(e.index()),e=e.parent;for(;0<d.length||0<b.length;)if(a=parseInt(d.pop())||0,e=parseInt(b.pop())||0,e-a)return e-a;return 0},spaceInsert:function(e,d,b){(this.space[e]=this.space[e]||new a).insert(d,b)},spaceClear:function(a,e,d){(a=this.space[a])&&(e.w&&e.h)&&a.remove(e,d)},captureGeometryByPixel:function(a){var e=new Matrix,d=[0,0],b=new c(0,0,1,1);return function(c,l,n,r){n=Array.isArray(n)?n:null;r="function"===typeof r?r:null;b.x=c;b.y=l;c=this.sort(this.search(b));
l=null;for(var s=0,p=c.length;s<p;s++)if(l=c[s],l.captureEvents&&!(n&&n.has(l)||r&&!r(l))&&(l.global.inverse(e).byVector(b.x,b.y,d),l.captureUI(a(d[0]),a(d[1]))))return l;return null}}(Math.round),deselectAll:function(a){a="function"===typeof a?a:null;for(var e=0;e<this.selected.length;e++){var d=this.selected[e];(!a||a(d))&&d.deselect()&&e--}return!this.selected.length},select:function(){throw"Scene: Root element can't be selected";},deselect:function(){throw"Scene: Root element can't be deselected";
},getSelectedGeometries:function(){function a(d){if(d instanceof Engine.Geometry)return e.push(d);d.children&&d.children.forEach(a)}var e=[];this.selected.forEach(a);return e}});return e}(Engine.Node,Engine.Box,RTree,Engine.Fill);Engine.Transform=Engine.Node.Transform=function(b){function c(a){this.matrix=new Matrix(a);b.call(this,a)}Class.extend(c,b);c.method({setTransform:function(a,d,e,b,c,g){this.matrix.set(a,e,c,d,b,g,0,0,1);this.update(this);return this},transform:function(a,d,e,b,c,g){this.matrix.transform(a,d,e,b,c,g);this.update(this);return this},multiply:function(a,d){this.matrix.multiply(a);this.update(this);return this},rotate:function(a){this.matrix.rotate(a);this.update(this);return this},translate:function(a,
d){this.matrix.translate(a,d);this.update(this);return this},scale:function(a,d){this.matrix.scale(a,d);this.update(this);return this},reset:function(){this.matrix.reset();this.update(this);return this}});return c}(Engine.Node);Engine.Node.Transform.Anchor=function(b,c){function a(d){var e=d&&d.anchors||this.anchors;this.anchors={};this[a.LEFT]=d&&d.hasOwnProperty(a.LEFT)?parseInt(d[a.LEFT])||0:this[a.LEFT];this[a.TOP]=d&&d.hasOwnProperty(a.TOP)?parseInt(d[a.TOP])||0:this[a.TOP];this.width=d&&d.hasOwnProperty("width")&&0<=d.width?parseInt(d.width)||0:this.width;this.height=d&&d.hasOwnProperty("height")&&0<=d.height?parseInt(d.height)||0:this.height;this[a.RIGHT]=this[a.LEFT]+this.width;this[a.BOTTOM]=this[a.TOP]+this.height;
this.marginLeft=d&&d.hasOwnProperty("marginLeft")?parseInt(d.marginLeft)||0:this.marginLeft;this.marginRight=d&&d.hasOwnProperty("marginRight")?parseInt(d.marginRight)||0:this.marginRight;this.marginTop=d&&d.hasOwnProperty("marginTop")?parseInt(d.marginTop)||0:this.marginTop;this.marginBottom=d&&d.hasOwnProperty("marginBottom")?parseInt(d.marginBottom)||0:this.marginBottom;b.call(this,d);if(e)for(var c in e)this.connect(c,e[c])}Class.extend(a,b);a.HANCHORS=[a.LEFT="left",a.CENTERH="centerh",a.RIGHT=
"right"];a.VANCHORS=[a.TOP="top",a.CENTERV="centerv",a.BOTTOM="bottom"];a.EXTRAANCHORS=[a.CENTERIN="centerin",a.FILL="fill",a.FILLWIDTH="fillwidth",a.FILLHEIGHT="fillheight"];a.SYMBOLS=[a.PARENT="parent",a.NEXT="next",a.PREV="prev"];a.ANCHORS=a.HANCHORS.concat(a.VANCHORS,a.EXTRAANCHORS);a.SEPARATOR=".";a.property(a.LEFT,0);a.property(a.CENTERH,0);a.property(a.RIGHT,0);a.property(a.TOP,0);a.property(a.CENTERV,0);a.property(a.BOTTOM,0);a.property({marginLeft:0,marginRight:0,marginTop:0,marginBottom:0,
width:0,height:0});a.method({setBounds:function(d,e,b,c){d=parseInt(d)||0;e=parseInt(e)||0;b=parseInt(b)||0;c=parseInt(c)||0;this[a.LEFT]=d;this[a.TOP]=e;this[a.RIGHT]=b>=this[a.LEFT]?b:this[a.LEFT];this[a.BOTTOM]=c>=this[a.TOP]?c||0:this[a.TOP];this.width=this[a.RIGHT]-this[a.LEFT];this.height=this[a.BOTTOM]-this[a.TOP];this[a.CENTERH]=this[a.LEFT]+this.width/2;this[a.CENTERV]=this[a.TOP]+this.height/2;this.matrix.set(1,0,this[a.LEFT],0,1,this[a.TOP],0,0,1)},setPosition:function(a,e){this.setBounds(a,
e,a+this.width,e+this.height);this.update()},setSize:function(d,e){this.setBounds(this[a.LEFT],this[a.TOP],this[a.LEFT]+d,this[a.TOP]+e);this.update()},update:function(d){this.calculate();if(null!=this.parent&&(null==d||d.parent!=this.parent))for(var e=null,b=this.parent.children,c=0;c<b.length;c++)e=b[c],!0==e instanceof a&&e!==this&&e.update(this);this._super(d)},calculate:function(){var d={};d[a.LEFT]=null;d[a.CENTERH]=null;d[a.RIGHT]=null;d[a.TOP]=null;d[a.CENTERV]=null;d[a.BOTTOM]=null;for(var e=
a.SEPARATOR,b=0,c="",g="",b="",g=null,k=0,m="",k=0;k<a.HANCHORS.length;k++)if(m=a.HANCHORS[k],c=this.anchors[m])b=c.indexOf(e),g=c.slice(0,b),b=c.slice(b+1),g=this.getBySymbol(g)||this.getElementById(g),g instanceof a&&(d[m]=g==this.parent?g[b]-g[a.LEFT]:g.parent==this.parent?g[b]:d[m]);null!==d[a.LEFT]?(d[a.LEFT]+=this.marginLeft,d[a.RIGHT]=null!==d[a.RIGHT]?d[a.RIGHT]:null!==d[a.CENTERH]?d[a.CENTERH]+(d[a.CENTERH]-d[a.LEFT]):d[a.LEFT]+this.width):null!==d[a.RIGHT]?(d[a.RIGHT]-=this.marginRight,
d[a.LEFT]=null!==d[a.LEFT]?d[a.LEFT]:null!==d[a.CENTERH]?d[a.CENTERH]+(d[a.CENTERH]-d[a.RIGHT]):d[a.RIGHT]-this.width):null!==d[a.CENTERH]?(d[a.LEFT]=d[a.CENTERH]-this.width/2+this.marginLeft-this.marginRight,d[a.RIGHT]=d[a.CENTERH]+this.width/2+this.marginLeft-this.marginRight):(d[a.LEFT]=this[a.LEFT],d[a.RIGHT]=this[a.RIGHT]);for(k=0;k<a.VANCHORS.length;k++)if(m=a.VANCHORS[k],c=this.anchors[m])b=c.indexOf(e),g=c.slice(0,b),b=c.slice(b+1),g=this.getBySymbol(g)||this.getElementById(g),g instanceof
a&&(d[m]=g==this.parent?g[b]-g[a.TOP]:g.parent==this.parent?g[b]:d[m]);null!==d[a.TOP]?(d[a.TOP]+=this.marginTop,d[a.BOTTOM]=null!==d[a.BOTTOM]?d[a.BOTTOM]:null!==d[a.CENTERV]?d[a.CENTERV]+(d[a.CENTERV]-d[a.TOP]):d[a.TOP]+this.height):null!==d[a.BOTTOM]?(d[a.BOTTOM]-=this.marginBottom,d[a.TOP]=null!==d[a.TOP]?d[a.TOP]:null!==d[a.CENTERV]?d[a.CENTERV]+(d[a.CENTERV]-d[a.BOTTOM]):d[a.BOTTOM]-this.height):null!==d[a.CENTERV]?(d[a.TOP]=d[a.CENTERV]-this.height/2+this.marginTop-this.marginBottom,d[a.BOTTOM]=
d[a.CENTERV]+this.height/2+this.marginTop-this.marginBottom):(d[a.TOP]=this[a.TOP],d[a.BOTTOM]=this[a.BOTTOM]);this.setBounds(d[a.LEFT],d[a.TOP],d[a.RIGHT],d[a.BOTTOM])},getBySymbol:function(d){var e=null;switch(d){case a.PARENT:e=this.parent;break;case a.NEXT:e=this.next();break;case a.PREV:e=this.prev()}return e instanceof a?e:null},connect:function(d,e){if("string"!=typeof e||""==e)return!1;var b=a.SEPARATOR,c=e.indexOf(b),g=-1==c?e:e.slice(0,c),c=-1==c?"":e.slice(c+1);if(a.HANCHORS.has(d)&&a.HANCHORS.has(c)||
a.VANCHORS.has(d)&&a.VANCHORS.has(c))this.anchors[d]=e,this.update();else if(a.EXTRAANCHORS.has(d)){switch(d){case a.CENTERIN:this.anchors[a.CENTERH]=g+b+a.CENTERH;this.anchors[a.CENTERV]=g+b+a.CENTERV;break;case a.FILLWIDTH:this.anchors[a.LEFT]=g+b+a.LEFT;this.anchors[a.RIGHT]=g+b+a.RIGHT;break;case a.FILLHEIGHT:this.anchors[a.TOP]=g+b+a.TOP;this.anchors[a.BOTTOM]=g+b+a.BOTTOM;break;case a.FILL:this.anchors[a.LEFT]=g+b+a.LEFT,this.anchors[a.RIGHT]=g+b+a.RIGHT,this.anchors[a.TOP]=g+b+a.TOP,this.anchors[a.BOTTOM]=
g+b+a.BOTTOM}this.update()}},disconnect:function(b){if(!1==a.ANCHORS.has(b))return!1;switch(b){case a.CENTERIN:delete this.anchors[a.CENTERH];delete this.anchors[a.CENTERV];break;case a.FILLWIDTH:delete this.anchors[a.LEFT];delete this.anchors[a.RIGHT];break;case a.FILLHEIGHT:delete this.anchors[a.TOP];delete this.anchors[a.BOTTOM];break;case a.FILLHEIGHT:delete this.anchors[a.LEFT];delete this.anchors[a.RIGHT];delete this.anchors[a.TOP];delete this.anchors[a.BOTTOM];break;default:delete this.anchors[b]}}});
return a}(Engine.Node.Transform,Engine.Scene);Engine.Geometry=function(b,c,a){function d(d){this.bb=new a(0,0,0,0);this.captureEvents=null!=d&&"boolean"==typeof d.captureEvents?d.captureEvents:this.captureEvents;this.vAlign=d&&"vAlign"in d?String(d.vAlign):String(this.vAlign);this.vAlign=l.has(this.vAlign)?this.vAlign:l[0];this.hAlign=d&&"hAlign"in d?String(d.hAlign):String(this.hAlign);this.hAlign=m.has(this.hAlign)?this.hAlign:m[0];this.zindex=d&&d.zindex?parseInt(d.zindex)||0:this.zindex;this.left=d&&"left"in d?parseInt(d.left)||0:this.left;
this.top=d&&"top"in d?parseInt(d.top)||0:this.top;this.width=d&&"width"in d?f(0,parseInt(d.width)||0):f(0,parseInt(this.width)||0);this.height=d&&"height"in d?f(0,parseInt(d.height)||0):f(0,parseInt(this.height)||0);this.right=this.left+this.width;this.bottom=this.top+this.height;b.call(this,d);e(this,this.hAlign,this.vAlign,this.width,this.height);if(!this.captureEvents&&this.selectable)throw"Geometry::initialize: Geometry can't be selectable and doesn't capture events simultaneously";}function e(a,
e,b,c,f){var g=a.left,h=a.top,k=a.left+c,l=a.top+f;switch(e){case d.LEFT:g=0;k=c;break;case d.RIGHT:g=-c;k=0;break;case d.CENTER:g=-c/2,k=-g}switch(b){case d.TOP:h=0;l=f;break;case d.BOTTOM:h=-f;l=0;break;case d.CENTER:h=-f/2,l=-h}a.setBounds(g,h,k,l)}var f=Math.max,h=Math.min,g=Math.floor,k=Math.ceil;Class.extend(d,b);var m=[d.NONE="none",d.LEFT="left",d.CENTER="center",d.RIGHT="right"],l=[d.NONE,d.TOP="top",d.BOTTOM="bottom",d.CENTER];d.property({types:[c.GEOMETRY],vAlign:d.NONE,hAlign:d.NONE,transform:null,
captureEvents:!0,opacity:1,left:0,top:0,right:0,bottom:0,width:0,height:0,bb:null});var n=[0,0];d.toBB=function(e,d,b,c,l,m){var u,y,D,A;m=m instanceof a?m:new a(0,0,0,0);l.byVector(e,d,n);u=y=n[0];D=A=n[1];l.byVector(b,d,n);u=h(u,n[0]);y=f(y,n[0]);D=h(D,n[1]);A=f(A,n[1]);l.byVector(e,c,n);u=h(u,n[0]);y=f(y,n[0]);D=h(D,n[1]);A=f(A,n[1]);l.byVector(b,c,n);u=h(u,n[0]);y=f(y,n[0]);D=h(D,n[1]);A=f(A,n[1]);m.w=k(y)-(m.x=g(u));m.h=k(A)-(m.y=g(D));return m};d.method({setOpacity:function(a){a=f(h(parseFloat(a)||
0,1),0);if(this.opacity===a)return!1;this.opacity=a;this.redraw();return!0},setAlign:function(a,d){a=m.has(a)?a:0;d=l.has(d)?d:0;if(this.hAlign===a&&this.vAlign===d)return!1;this.hAlign=a;this.vAlign=d;e(this,a,d,this.width,this.height);return!0},setBounds:function(a,e,b,c){a=parseInt(a)||0;e=parseInt(e)||0;b=f(a,parseInt(b)||0);c=f(e,parseInt(c)||0);if(this.left===a&&this.top===e&&this.right===b&&this.bottom===c)return!1;this.left=a;this.top=e;this.right=b;this.bottom=c;this.width=b-a;this.height=
c-e;this.clearBB(this.root);this.bb=d.toBB(this.left,this.top,this.right,this.bottom,this.global,this.bb);this.insertBB(this.root);return!0},setPosition:function(a,e){a=parseInt(a)||0;e=parseInt(e)||0;return this.setBounds(a,e,a+this.width,e+this.height)},setBox:function(a,e,d,b){return this.setBounds(a,e,a+d,e+b)},setSize:function(a,d){a=0<=a?parseInt(a)||0:0;d=0<=d?parseInt(d)||0:0;if(this.width===a&&this.height===d)return!1;e(this,this.hAlign,this.vAlign,a,d);return!0},captureUI:function(a,e){return a>=
this.left&&a<this.right&&e>=this.top&&e<this.bottom},getPixel:function(a,e,d){d=d||[];d[0]=0;d[1]=0;d[2]=0;d[3]=0;return d},clearBB:function(a){if(a instanceof c){for(var e=0,d=this.bb,b=this.types,f=b.length;e<f;e++)a.spaceClear(b[e],d,this);return!0}return!1},insertBB:function(a){if(a instanceof c){for(var e=0,d=this.bb,b=this.types,f=b.length;e<f;e++)a.spaceInsert(b[e],d,this);return!0}return!1},update:function(a){this.clearBB(this.root);this._super(a);this.bb=d.toBB(this.left,this.top,this.right,
this.bottom,this.global,this.bb);this.insertBB(this.root)},redraw:function(a,e,d,b){return this.width&&this.height},getBb:function(){return this.bb}});return d}(Engine.Element,Engine.Scene,Engine.Box);Engine.Geometry.Shape=function(b,c,a){function d(a){this.image=c.Image.parse(this.image);this.repeat=c.Repetition.parse(this.repeat);this.color=c.Color.parse(this.color);this.stroke=a&&"stroke"in a?c.Color.parse(a.stroke):c.Color.parse(this.stroke);a&&"fill"in a&&c.parse(String(a.fill),this);b.call(this,a)}Class.extend(d,b);d.property({image:"",color:"rgba(0,0,0,0)",repeat:"repeat",stroke:"rgba(0,0,0,0)"});d.method({setColor:function(a){this.color=c.Color.parse(a);this.redraw();return!0},setImage:function(a){this.image=
c.Image.parse(a);this.redraw();return!0},setRepeat:function(a){this.repeat=c.Repetition.parse(a);this.redraw();return!0},setFill:function(a){this.color=this.repeat=this.image=null;c.parse(a,this);this.redraw();return!0},setStroke:function(a){this.stroke=c.Color.parse(a);this.redraw();return!0}});a.property({image:"",color:"rgba(0,0,0,0)",repeat:"repeat"});a.method({initialize:function(a){this.image=c.Image.parse(this.image);this.repeat=c.Repetition.parse(this.repeat);this.color=c.Color.parse(this.color);
this.stroke=a&&"stroke"in a?c.Color.parse(a.stroke):c.Color.parse(this.stroke);a&&"fill"in a&&c.parse(String(a.fill),this);this._super(a)},setColor:function(a){this.color=c.Color.parse(a);this.redraw();return!0},setImage:function(a){this.image=c.Image.parse(a);this.redraw();return!0},setRepeat:function(a){this.repeat=c.Repetition.parse(a);this.redraw();return!0},setFill:function(a){this.color=this.repeat=this.image=null;c.parse(a,this);this.redraw();return!0},redraw:function(){}});return d}(Engine.Geometry,
Engine.Fill,Engine.Scene);Engine.Geometry.Rectangle=Engine.Geometry.Shape.Rectangle=function(b,c){function a(a){c.call(this,a)}Class.extend(a,c);return a}(Engine.Geometry,Engine.Geometry.Shape);Engine.Geometry.Polygon=Engine.Geometry.Shape.Polygon=function(b,c,a,d){function e(a){c.call(this,a);a&&"points"in a&&this.setPoints(a.points)}Class.extend(e,c);e.property("points",null);e.method("setPoints",function(b){var e=0,c=0,k=0,m=0;if(b=this.points)for(var l=0,n=b.length;l<n;l++)var r=b[l],s=r[0],r=r[1],e=a(e,s)-1,c=d(c,s)+1,k=a(k,r)-1,m=d(m,r)+1;this.setBounds(e,k,c,m)});return e}(Engine.Geometry,Engine.Geometry.Shape,Math.min,Math.max);Engine.Geometry.Oval=Engine.Geometry.Shape.Oval=function(b,c){function a(a){b.call(this,a);var e=this.originX=parseInt(a&&"originX"in a?a.originX:this.originX)||0,c=this.originY=parseInt(a&&"originY"in a?a.originY:this.originY)||0;a&&"radius"in a&&(this.radiusY=this.radiusX=parseInt(a.radius)||0);var h=this.radiusX=parseInt(a&&"radiusX"in a?a.radiusX:this.radiusX)||0;a=this.radiusY=parseInt(a&&"radiusY"in a?a.radiusY:this.radiusY)||0;this.setBounds(e-h,c-a,e+h,c+a)}Class.extend(a,b);a.property({originX:0,
originY:0,radiusX:0,radiusY:0});a.method({setOrigin:function(a,b){a=parseInt(a)||0;b=parseInt(b)||0;var c=this.radiusX,h=this.radiusY;return this.setBounds(a-c,b-h,a+c,b+h)},setRadius:function(a,b){a=c(0,parseInt(a)||0);b=void 0===b?a:c(0,parseInt(b)||0);var f=this.originX,h=this.originY;return this.setBounds(f-a,h-b,f+a,h+b)},setBounds:function(a,b,c,h){if(!this._super(a,b,c,h))return!1;a=this.width/2;b=this.height/2;this.originX=this.left+a;this.originY=this.top+b;this.radiusX=a;this.radiusY=b;
return!0}});return a}(Engine.Geometry.Shape,Math.max);Engine.Geometry.Shape.Text=function(b,c,a,d,e){function f(a){this.font=a&&"font"in a?a.font:this.font;this.font=this.font instanceof c?this.font:null;this.textColor=String(a&&"textColor"in a?a.textColor:this.textColor);this.text=String(a&&"text"in a?a.text:this.text);this.minWidth=d(0,parseFloat(a&&"minWidth"in a?a.minWidth:this.minWidth)||0);this.minHeight=d(0,parseFloat(a&&"minHeight"in a?a.minHeight:this.minHeight)||0);this.maxWidth=d(0,parseFloat(a&&"maxWidth"in a?a.maxWidth:this.maxWidth)||0);
this.maxHeight=d(0,parseFloat(a&&"maxHeight"in a?a.maxHeight:this.maxHeight)||0);this.spacing=parseInt(a&&"spacing"in a?a.spacing:this.spacing)||0;this.lineHeight=d(-1,parseInt(a&&"lineHeight"in a?a.lineHeight:this.lineHeight)||0);this.textAlign=String(a&&"textAlign"in a?a.textAlign:this.textAlign);this.textAlign=h.has(this.textAlign)?this.textAlign:h[0];if(a&&"padding"in a){var e=parseInt(a.padding)||0;this.paddingBottom=this.paddingRight=this.paddingTop=this.paddingLeft=e}this.paddingLeft=parseInt(a&&
"paddingLeft"in a?a.paddingLeft:this.paddingLeft)||0;this.paddingTop=parseInt(a&&"paddingTop"in a?a.paddingTop:this.paddingTop)||0;this.paddingRight=parseInt(a&&"paddingRight"in a?a.paddingRight:this.paddingRight)||0;this.paddingBottom=parseInt(a&&"paddingBottom"in a?a.paddingBottom:this.paddingBottom)||0;b.call(this,a)}Class.extend(f,b);f.AUTO=-1;var h=[f.LEFT="left",f.RIGHT="right",f.CENTER="center",f.JUSTIFY="justify",f.PRE="pre"];f.COLOR="black";f.READY="ready";f.property({font:null,textColor:f.COLOR,
text:"",minWidth:0,minHeight:0,maxWidth:Infinity,maxHeight:Infinity,spacing:0,lineHeight:f.AUTO,textAlign:f.LEFT,paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:0});f.method({setFont:function(a){a=a instanceof c?a:null;if(this.font===a)return!1;this.font=a;return!0},setTextColor:function(a){a=String(a);if(this.textColor===a)return!1;this.textColor=a;return!0},setText:function(a){a=String(a);if(this.text===a)return!1;this.text=a;return!0},setSpacing:function(a){a=parseInt(a)||0;if(this.spacing===
a)return!1;this.spacing=a;return!0},setLineHeight:function(a){a=parseInt(a)||0;if(this.lineHeight===a)return!1;this.lineHeight=a;return!0},setTextAlign:function(a){a=String(a);a=h.has(a)?a:h[0];if(this.textAlign===a)return!1;this.textAlign=a;return!0},setPadding:function(a,b,d,c){for(;0<arguments.length&&void 0===arguments[arguments.length-1];)e.call(arguments);switch(arguments.length){case 2:d=a;c=b;break;case 1:c=d=b=a}a=parseInt(a)||0;b=parseInt(b)||0;d=parseInt(d)||0;c=parseInt(c)||0;if(this.paddingLeft===
a&&this.paddingTop===b&&this.paddingRight===d&&this.paddingBottom===c)return!1;this.paddingLeft=a;this.paddingTop=b;this.paddingRight=d;this.paddingBottom=c;return!0},setMinWidth:function(a){a=d(0,parseFloat(a)||0);if(this.minWidth===a)return!1;this.minWidth=a;return!0},setMinHeight:function(a){a=d(0,parseFloat(a)||0);if(this.minHeight===a)return!1;this.minHeight=a;return!0},setMaxWidth:function(a){a=d(0,parseFloat(a)||0);if(this.maxWidth===a)return!1;this.maxWidth=a;return!0},setMaxHeight:function(a){a=
d(0,parseFloat(a)||0);if(this.maxHeight===a)return!1;this.maxHeight=a;return!0}});return f}(Engine.Geometry.Shape,Engine.Font,Math.min,Math.max,Array.prototype.pop);Engine.Image=Engine.Geometry.Image=function(b){function c(a){this.src=a&&"src"in a?String(a.src):String(this.src);this.complete=!1;b.call(this,a)}Class.extend(c,b);c.LOAD="load";c.ERROR="error";c.property({complete:!1,src:""});c.method("setSrc",function(a){a=String(a);if(this.src===a||""===a)return!1;this.complete=!1;this.src=a;return!0});return c}(Engine.Geometry);Engine.Geometry.Image.Sprite=function(b){function c(a){this.offsetx=a&&"offsetx"in a?parseInt(a.offsetx)||0:parseInt(this.offsetx)||0;this.offsety=a&&"offsety"in a?parseInt(a.offsety)||0:parseInt(this.offsety)||0;b.call(this,a)}Class.extend(c,b);c.property({offsetx:0,offsety:0});c.method("setOffset",function(a,b){a=parseInt(a)||0;b=parseInt(b)||0;if(this.offsetx===a&&this.offsety===b)return!1;this.offsetx=a;this.offsety=b;this.redraw();return!0});return c}(Engine.Geometry.Image);Engine.Geometry.Media=function(b,c,a,d,e,f,h,g,k,m,l,n){function r(a){this.ambient=a&&"ambient"in a?Boolean(a.ambient):Boolean(this.ambient);this.loop=a&&"loop"in a?Boolean(a.loop):Boolean(this.loop);this.autoplay=a&&"autoplay"in a?Boolean(a.autoplay):Boolean(this.autoplay);this.volume=a&&"volume"in a?e(0,d(parseFloat(a.volume)||0,1)):e(0,d(parseFloat(this.volume)||0,1));this.src=a&&"src"in a?String(a.src):String(this.src);b.call(this,a);this.autoplay&&this.play()}Class.extend(r,b);r.property({types:[c.MEDIA],
src:"",volume:1,globalVolume:0,balanceRadius:0,balanceAngle:3*l,ambient:!1,loop:!1,playing:!1,autoplay:!1});r.method({setSrc:function(a){a=String(a);if(this.src===a||""===a)return!1;this.src=a;return!0},setVolume:function(a){a=e(d(parseFloat(a)||0,1),0);if(a===this.volume)return!1;this.volume=a;return!0},update:function(a){this._super(a);this.calculateRenderBalance()},calculateRenderBalance:function(){var a=l,b=1;if(this.root instanceof c)if(this.ambient)this.balanceRadius=1-this.volume;else{var a=
this.bb,g=this.root.search(a,c.CAMERA),k=b=0,n=g.length;if(n){for(var r=0,y=0;y<n;y++)var D=g[y],A=D.view,z=D.x,x=D.y,C=a.x,w=a.y,B=a.w,F=a.h,E=A.w,A=A.h,z=z>C&&z<C+B?0:f(C-z)<f(C+B-z)?C-z:C+B-z,x=x>w&&x<w+F?0:f(w-x)<f(w+F-x)?w-x:w+F-x,b=b+z/(E/2),k=k+x/(A/2),r=r+D.volume;r/=n;a=b||k?m(b/h(b*b+k*k)):0;b=d(e(0,e(f(b),f(k))/n),1);b+=(1-b)*(1-r);a=0<k?2*l-a+2*l:a}else a=l,b=1}if(a===this.balanceAngle&&b===this.balanceRadius)return!1;this.balanceAngle=a;this.balanceRadius=b;return!0},play:function(){return this.playing?
!1:this.playing=!0},pause:function(){return this.playing?!1:!(this.playing=!1)},stop:function(){return this.pause()}});return r}(Engine.Geometry,Engine.Scene,Engine.Box,Math.min,Math.max,Math.abs,Math.sqrt,Math.pow,Math.tan,Math.acos,Math.PI/2,2*Math.PI);Engine.Geometry.Sound=Engine.Geometry.Media.Sound=function(b,c,a,d,e,f){function h(a){this.priority=a&&"priority"in a?parseInt(a.priority)||0:parseInt(this.priority)||0;this.radius=a&&"radius"in a?f(0,parseInt(a.radius)||0):f(0,parseInt(this.radius)||0);c.call(this,a);this.setRadius(this.radius)}function g(a){a&&a.component&&(a.pause(),a.component.removeSound(a))}function k(a){if(a._sound)return a;if(""===a.src)return a._sound=null;for(var b,c=0,f=m.length;c<f;c++){var g=m[c++];if(g.src===a.src&&
g.loop===a.loop){b=g;break}}a._sound=new Engine.Sound({refersTo:b,src:a.src,loop:a.loop,volume:a.volume,position:{x:e(a.balanceAngle)*a.balanceRadius,y:d(a.balanceAngle)*a.balanceRadius,z:-0.5}});m.add(a._sound.component);return a}Class.extend(h,c);h.property({_sound:null,filter:void 0,priority:0,radius:1});h.method({setSrc:function(a){if(!this._super(a))return!1;this._sound&&(g(this._sound),this._sound=null);this.src.length&&(k(this),this.playing&&this._sound&&this._sound.play());return!0},destroy:function(){this._super();
this._sound&&(g(this._sound),this._sound=null)},setVolume:function(a){return this._super(a)?(this._sound&&(this._sound.setVolume(this.volume),0===this.volume?this._sound.pause():this.playing&&!this._sound.playing&&this._sound.play()),!0):!1},calculateRenderBalance:function(){return this._super()?(this._sound&&(1===this.balanceRadius?this._sound.pause():(this.playing&&!this._sound.playing&&this._sound.play(),this._sound.setPosition(e(this.balanceAngle)*this.balanceRadius,d(this.balanceAngle)*this.balanceRadius,
-0.5))),!0):!1},setRadius:function(a){a=parseInt(f(a,0))||0;return this.setBounds(-a,-a,a,a)},play:function(a,b){if(!this._super())return!1;!this._sound&&k(this);this._sound&&this._sound.play(!this.loop&&0);return!0},pause:function(){return this._super()?(this._sound&&this._sound.pause(),!0):!1},stop:function(){return this._super()?(this._sound&&this._sound.stop(),!0):!1}});var m=[];return h}(Engine.Geometry,Engine.Geometry.Media,Engine.Scene,Math.sin,Math.cos,Math.max);Engine.Geometry.Media.Video=function(b,c){function a(a){b.call(this,a)}Class.extend(a,b);a.AUTO=1;a.property({autosize:a.AUTO,types:[c.GEOMETRY,c.MEDIA]});return a}(Engine.Geometry.Media,Engine.Scene);Engine.Viewport=function(b,c,a,d){function e(a,b,c,h){if("string"===typeof a)return"number"===typeof b?e.call(this,{id:a,width:b,height:c,cameras:h}):e.call(this,{id:a,cameras:b});this.cameras=[];this.id=String(a&&"id"in a?a.id:this.id);this.width=d(0,parseInt(a&&"width"in a?a.width:this.width)||0);this.height=d(0,parseInt(a&&"height"in a?a.height:this.height)||0);this.background=String(a&&"background"in a?a.background:this.background);this.fullscreen=a&&("width"in a||"height"in a)?!1:Boolean(this.fullscreen);
this.fullscreen=Boolean(a&&"fullscreen"in a?a.fullscreen:this.fullscreen);Model.call(this,a);this.fullscreen&&f(this);if(h=a&&"cameras"in a?a.cameras:null)for(a=0,b=parseInt(h.length)||0;a<b;a++)this.addCamera(h[a])}function f(a){h.add(a);a.setSize(c.screen.innerWidth,c.screen.innerHeight)}Class.extend(e,Model);e.property({id:"",width:0,height:0,background:"rgba(0, 0, 0, 0)",fullscreen:!0});e.method({setSize:function(a,b){a=d(0,parseInt(a)||0);b=d(0,parseInt(b)||0);if(this.width===a&&this.height===
b)return!1;this.width=a;this.height=b;for(var e=0,c=this.cameras,f=c.length;e<f;e++){var h=c[e];h.fullscreen&&h.setSize(a,b)}return!0},setFullscreen:function(a){a=Boolean(a);if(this.fullscreen===a)return!1;(this.fullscreen=a)?f(this):h.remove(this);return!0},setBackground:function(a){a=String(a);if(this.background===a)return!1;this.background=a;return!0},addCamera:function(a){if(a.parent===this)return!1;a.parent&&a.parent.removeCamera(a);this.cameras.add(a);a.parent=this;a.fullscreen&&a.setSize(this.width,
this.height);return!0},removeCamera:function(a){if(a.parent!==this)return!1;this.cameras.remove(a);a.parent=null;return!0},getCameraByPixel:function(){var a=new b(0,0,1,1),e=new b(0,0,0,0);return function(b,d,c){if("number"!==typeof b||"number"!==typeof d)return!1;c=Array.isArray(c)?c:null;a.x=b;a.y=d;for(b=this.cameras.length;b--;)if(d=this.cameras[b],!c||!c.has(d))if(e.x=d.left,e.y=d.top,e.w=d.width,e.h=d.height,a.overlap(e))return d;return null}}()});var h=[];c.addEventListener("resize",function(){for(var a=
c.screen.innerWidth,b=c.screen.innerHeight,d=0;d<h.length;d++)h[d].setSize(a,b)});return e}(Engine.Box,Engine.Device,Math.min,Math.max);Engine.Camera=function(b,c,a,d,e,f){function h(e){this.view=new b(0,0,0,0);this.volume=d(0,a(parseFloat(e&&"volume"in e?e.volume:this.volume),1));this.zoom=d(0,a(parseFloat(e&&"zoom"in e?e.zoom:this.zoom),Infinity));this.fullscreen=e&&("width"in e||"height"in e)?!1:Boolean(this.fullscreen);this.fullscreen=Boolean(e&&"fullscreen"in e?e.fullscreen:this.fullscreen);this.x=parseFloat(e&&"x"in e?e.x:this.x)||0;this.y=parseFloat(e&&"y"in e?e.y:this.y)||0;this.left=parseInt(e&&"left"in e?e.left:this.left)||
0;this.top=parseInt(e&&"top"in e?e.top:this.top)||0;this.width=d(0,parseInt(e&&"width"in e?e.width:this.width));this.height=d(0,parseInt(e&&"height"in e?e.height:this.height));this.lookingAt=e&&"lookAt"in e&&e.lookAt instanceof c?e.lookAt:null;m(this);k(this);l(this,this.view);Model.call(this,e)}function g(a){a.lookingAt&&a.lookingAt.spaceClear(c.CAMERA,a.view,a)}function k(a){a.lookingAt&&a.lookingAt.spaceInsert(c.CAMERA,a.view,a)}function m(a){var b=a.view,d=a.zoom,c=b.w=e(a.width/d),d=b.h=e(a.height/
d);b.x=e(a.x-c/2);b.y=e(a.y-d/2)}function l(a,b){var e=a.lookingAt;if(e)for(var e=e.search(b,c.MEDIA),d=0;d<e.length;d++)e[d].calculateRenderBalance()}Engine.Camera=h;Class.extend(h,Model);h.property({volume:1,lookingAt:null,view:null,x:0,y:0,zoom:1,parent:null,left:0,top:0,width:0,height:0,fullscreen:!0});h.method({setOffset:function(a,b){a=parseInt(a)||0;b=parseInt(b)||0;if(this.left===a&&this.top===b)return!1;this.left=a;this.top=b;return!0},setVolume:function(b){b=d(0,a(parseFloat(b)||0,1));if(b===
this.volume)return!1;this.volume=b;l(this,this.view);return!0},lookAt:function(a){a=a instanceof c?a:null;if(this.lookingAt===a)return!1;this.lookingAt instanceof c&&(g(this),l(this,this.view));this.lookingAt=a;this.lookingAt instanceof c&&(k(this),l(this,this.view));return!0},setFullscreen:function(a){a=Boolean(a);if(this.fullscreen==a)return!1;if(this.fullscreen=a)a=this.parent,this.setSize(a.width,a.height);return!0},setZoom:function(b){b=d(0,a(parseFloat(b)||0,Infinity));if(this.zoom===b)return!1;
this.zoom=b;b=this.view;var e=b.clone();g(this);m(this);k(this);l(this,e);l(this,b);return!0},setSize:function(a,b){a=d(0,parseInt(a)||0);b=d(0,parseInt(b)||0);if(this.width===a&&this.height===b)return!1;this.width=a;this.height=b;var e=this.view,c=e.clone();g(this);m(this);k(this);l(this,c);l(this,e);this.trigger("resize",a,b);return!0},moveTo:function(a,b){a=parseFloat(a)||0;b=parseFloat(b)||0;if(this.x===a&&this.y===b)return!1;this.x=a;this.y=b;var e=this.view,d=e.clone();g(this);m(this);k(this);
l(this,d);l(this,e);this.trigger("move",a,b);return!0},moveBy:function(a,b){a=parseFloat(a)||0;b=parseFloat(b)||0;return this.moveTo(this.x+a,this.y+b)},projectX:function(a){a=parseInt(a)||0;return(a-this.view.x)*this.zoom},projectY:function(a){a=parseInt(a)||0;return(a-this.view.y)*this.zoom},toSceneX:function(a){a=parseInt(a)||0;return a/this.zoom+this.view.x},toSceneY:function(a){a=parseInt(a)||0;return a/this.zoom+this.view.y}});return h}(Engine.Box,Engine.Scene,Math.min,Math.max,Math.round,Math.abs);(function(b){var c=Engine.Renderer=new Model;c.createContext=function(){return b.createElement("canvas").getContext("2d")};c.ctx=c.createContext()})(document);(function(b){b.decorate("initialize",function(b){this.div=document.getElementById(this.id)||document.createElement("div");this.div.setAttribute("style",["width : "+this.width+"px","height : "+this.height+"px","background : "+this.background,"position : relative;margin : 0px;padding : 0px;overflow : hidden"].join(";"));this._super(b)});b.decorate("setSize",function(b,a){if(!this._super(b,a))return!1;var d=this.div.style;d.width=this.width+"px";d.height=this.height+"px";return!0});b.decorate("setBackground",
function(b){if(!this._super(b))return!1;this.div.style.background=this.background;return!0});b.decorate("addCamera",function(b){if(!this._super(b))return!1;this.div.appendChild(b.div);return!0});b.decorate("removeCamera",function(b){if(!this._super(b))return!1;this.div.removeChild(b.div);return!0})})(Engine.Viewport);(function(b,c,a,d,e,f,h,g,k){function m(a,b){for(var e=a.length;0<e--;){var d=a[e];if(d.overlap(b))return b.bound(d),a.splice(e,1),m(a,b)}a.push(b);return a}function l(a,e,c,f,g){e=new d(e,c,f,g);m(a.stack,e);p.add(a);b.addEventListener(b.VSYNC,r);b.request()}function n(a,b,c,f,h,m,n,r,s){if(d.overlap(b,c,f,h,m,n,r,s)){var p=a.canvas,w=g.width=p.width,B=g.height=p.height;w&&B&&k.drawImage(p,0,0);p.width=r;p.height=s;g.width&&g.height&&a.ctx.drawImage(g,b-m,c-n)}var p=b+f,w=c+h,B=m+r,F=n+s;m<b&&l(a,
m,c,e(b-m,r),h);B>p&&l(a,p,c,e(B-(b-f),r),h);n<c&&l(a,m,n,r,e(c-n,s));F>w&&l(a,m,w,r,e(F-w,s))}function r(){for(var e=null,d=null;p.length;)for(e=p.shift(),d=e.stack;d.length;){var c=e,f=d.shift(),g=c.lookingAt instanceof a?c.lookingAt:null;if(g){var h=f.x,k=f.y,m=f.w,l=f.h;if(m&&l){var n=c.ctx,f=g.search(f),s=f.length,B=c.renderview;s&&g.sort(f);n.save();n.translate(-B.x,-B.y);n.clearRect(h,k,m,l);n.beginPath();n.rect(h,k,m,l);n.clip();g.render(n);for(n.closePath();s--;)g=f[s],g.opacity&&(B=g.global,
n.save(),n.transform(B.m11,B.m21,B.m12,B.m22,B.m13,B.m23),n.beginPath(),n.rect(g.left,g.top,g.width,g.height),n.clip(),n.closePath(),n.globalAlpha=g.opacity,g.render(n),n.restore());c.debug&&(n.fillStyle="rgba({}, {}, {}, {})".format(255*Math.random()|0,255*Math.random()|0,255*Math.random()|0,0.2),n.fillRect(h,k,m,l));n.restore()}}}b.removeEventListener(b.VSYNC,r)}c.property({debug:!1,translateX:0,translateY:0});c.decorate("initialize",function(a){this._super(a);this.stack=[];this.canvas=document.createElement("canvas");
this.canvas.setAttribute("style","width:100%;height:100%;");this.canvas.width=this.view.w;this.canvas.height=this.view.h;this.ctx=this.canvas.getContext("2d");this.div=document.createElement("div");this.div.setAttribute("style","position:absolute;left:"+this.left+"px;top:"+this.top+"px;width:"+this.width+"px;height:"+this.height+"px;overflow:hidden;");this.div.appendChild(this.canvas);a=this.renderview=this.view.clone();l(this,a.x,a.y,a.w,a.h)});c.decorate("setOffset",function(a,b){if(!this._super(a,
b))return!1;var e=this.div.style;e.left=this.left+"px";e.top=this.top+"px";return!0});c.decorate("lookAt",function(a){if(!this._super(a))return!1;a=this.renderview;l(this,a.x,a.y,a.w,a.h);return!0});c.decorate("moveTo",function(a,b){var e=this.x,d=this.y;if(this._super(a,b)||this.translateX||this.translateY){if(this._isScrolled){var c=this.zoom,e=parseFloat((this.x-e)*c)||0,d=parseFloat((this.y-d)*c)||0;s(this,this.translateX-e,this.translateY-d)}else{s(this,0,0);var d=this.renderview,c=d.x,e=d.y,
f=d.w,g=d.h;d.copy(this.view);n(this,c,e,f,g,d.x,d.y,f,g)}return!0}return!1});c.decorate("setSize",function(a,b){if(!this._super(a,b))return!1;var e=this.renderview,d=e.x,c=e.y,f=e.w,g=e.h;e.copy(this.view);n(this,d,c,f,g,e.x,e.y,e.w,e.h);e=this.div.style;e.width=this.width+"px";e.height=this.height+"px";return!0});c.decorate("setZoom",function(a){if(this._super(a)){a=this.renderview;var b=a.x,e=a.y,d=a.w,c=a.h;a.copy(this.view);n(this,b,e,d,c,a.x,a.y,a.w,a.h);return!0}return!1});c.method("redraw",
function(a){l(this,a.x,a.y,a.w,a.h)});var s=function(){var a="transform",b="translate({x}px,{y}px)";(function(e){var d=document.createElement("div"),c;for(c in e)if("string"===typeof d.style[c])return a=c,b=e[c],!0})({"-webkit-transform":"translate3d({0}px,{1}px,0px)","-moz-transform":"translate3d({0}px,{1}px,0px)","-o-transform":"translate({0}px,{1}px)","-ms-transform":"translate({0}px,{1}px)",transform:"translate({0}px,{1}px)"});return function(e,d,c){d=parseFloat(d)||0;c=parseFloat(c)||0;if(e.translateX===
d&&e.translateY===c)return!1;e.translateX=d;e.translateY=c;e.canvas.style[a]=b.replace("{0}",h(d)).replace("{1}",h(c));return!0}}(),p=[]})(Engine.Loop,Engine.Camera,Engine.Scene,Engine.Box,Math.min,Math.max,Math.round,Engine.Renderer.ctx.canvas,Engine.Renderer.ctx);Engine.Renderer.Cache=function(b,c){function a(a,d,c){var f=new b;f.addEventListener("load",e);f.addEventListener("error",h);f.addEventListener("load",d);f.addEventListener("error",c);f.src=a;return f}function d(){e.call(this);var a=this.src;if(a=k.hasOwnProperty(a)?k[a]:null)for(var b=0,c=a.length;b<c;b++)a[b].trigger("load");this.removeEventListener("load",d);this.removeEventListener("error",f)}function e(){var a=this.src,a=g.hasOwnProperty(a)?g[a]:g[a]=document.createElement("canvas");a.width=
this.width;a.height=this.height;a.getContext("2d").drawImage(this,0,0)}function f(){h.call(this);var a=this.src;if(a=k.hasOwnProperty(a)?k[a]:null)for(var b=0,e=a.length;b<e;b++)a[b].trigger("error");this.removeEventListener("load",d);this.removeEventListener("error",f)}function h(){var a=this.src,a=g.hasOwnProperty(a)?g[a]:g[a]=document.createElement("canvas");a.width=0;a.height=0}var g={},k={};return{get:function(a){a=String(a);return g.hasOwnProperty(a)?g[a]:null},load:function(b,e,d){b=String(b);
if(""===b)return!1;var c=g.hasOwnProperty(b)?g[b]:null;if(c)return c;e=a(b,e,d);k[e.src]=k[b];return g[b]=g[e.src]=document.createElement("canvas")},set:function(a,b){a=String(a);if(""===a)return!1;var e=g.hasOwnProperty(a)?g[a]:g[a]=c.createElement("canvas");e.width=b.width;e.height=b.height;e.getContext("2d").drawImage(b,0,0);if(e=k.hasOwnProperty(a)?k[a]:null)for(var d=0,f=e.length;d<f;d++)e[d].trigger("load")},bind:function(b,e){b=String(b);if(""===b)return!1;(k.hasOwnProperty(b)?k[b]:k[b]=[]).add(e);
var c=g.hasOwnProperty(b)?g[b]:null;c||(c=a(b,d,f),k[c.src]=k[b],c=g[b]=g[c.src]=document.createElement("canvas"));c.width&&c.height&&e.trigger("load")},unbind:function(a,b){a=String(a);if(""===a)return!1;var e=k.hasOwnProperty(a)?k[a]:null;e&&e.remove(b);return!0},create:a}}(Image,document);Engine.Font.PATH="fonts/";(function(b,c,a,d,e,f,h){var g=b.ctx,k=g.canvas;c.prototype.debug=!1;c.prototype.render=function(a,b,e,d,c){this.debug&&(a.fillStyle="rgba({}, {}, {}, {})".format(255*f()|0,255*f()|0,255*f()|0,0.2),a.fillRect(this.left,this.top,this.width,this.height))};c.prototype.redraw=function(a,b,e,d){arguments.length?(a=parseInt(a)||0,b=parseInt(b)||0,e=h(0,parseInt(e)||0),d=h(0,parseInt(d)||0),m(this,c.toBB(this.left+a,this.top+b,this.left+a+e,this.top+b+d,this.global))):m(this,this.bb)};c.prototype.getPixel=
function(a,b,e){g.save();k.width=1;k.height=1;g.translate(-a,-b);this.render(g,a,b,1,1);g.restore();a=g.getImageData(0,0,1,1).data;e[0]=a[0];e[1]=a[1];e[2]=a[2];e[3]=a[3];return e};var m=b.updateDirtyRectangle=function(a,b){if(!a.types.has(d.GEOMETRY)||!1===a.root instanceof d)return!1;for(var e=a.root.search(b,d.CAMERA),c=e.length;c--;)e[c].redraw(b)}})(Engine.Renderer,Engine.Geometry,Engine.Box,Engine.Scene,Engine.Camera,Math.random,Math.max);(function(b,c,a,d){function e(b){b._pattern=null;var e=b.image;e instanceof d.Image&&a.Cache.unbind(e.src,b)}function f(b){var e=b.image;if(e instanceof d.Image)b instanceof Model||(b=b._image=new Engine.Image({src:e.src})),a.Cache.bind(e.src,b);else if(e instanceof d.Gradient){var c=e.from,f=e.to,l=e.steps;switch(e.type){case "radial":b=b._pattern=a.ctx.createRadialGradient(c.x,c.y,c.r,f.x,f.y,f.r);break;default:b=b._pattern=a.ctx.createLinearGradient(c.x,c.y,f.x,f.y)}e=0;for(c=l.length;e<c;e++)f=
l[e],b.addColorStop(f.stop,f.color)}}b.property({_pattern:null,onload:function(){this._pattern=a.ctx.createPattern(a.Cache.get(this.image.src),this.repeat);this.redraw();return!0}});b.decorate({initialize:function(a){this._super(a);f(this)},setFill:function(a){e(this);this._super(a);f(this)},setImage:function(a){e(this);this._super(a);f(this)},setRepeat:function(a){e(this);this._super(a);f(this)},clearBB:function(b){if(!this._super(b))return!1;a.updateDirtyRectangle(this,this.bb);return!0},insertBB:function(b){if(!this._super(b))return!1;
a.updateDirtyRectangle(this,this.bb);return!0}});a.parseFill=function(a){e(a);f(a)};c.property({_pattern:null,onload:function(){this._pattern=a.ctx.createPattern(a.Cache.get(this.image.src),this.repeat);this.redraw();return!0}});c.decorate({initialize:function(a){this._super(a);f(this)},setFill:function(a){e(this);this._super(a);f(this)},setImage:function(a){e(this);this._super(a);f(this)},setRepeat:function(a){e(this);this._super(a);f(this)},redraw:function(){for(var a=this.search(null,c.CAMERA),
b=0,e=a.length;b<e;b++)a[b].redraw(a[b].view)}});c.method({render:function(a){a.save();a.fillStyle=String(this.color);a.fill();a.fillStyle=this._pattern;a.fill();a.restore()}})})(Engine.Geometry.Shape,Engine.Node.Scene,Engine.Renderer,Engine.Fill);(function(b,c){b.decorate({render:function(a){a.save();a.fillStyle=String(this.color);a.fillRect(this.left,this.top,this.width,this.height);a.fillStyle=this._pattern;a.fillRect(this.left,this.top,this.width,this.height);a.strokeStyle=String(this.stroke);a.strokeRect(this.left+1,this.top+1,this.width-2,this.height-2);a.restore();this._super(a)}})})(Engine.Geometry.Rectangle,Engine.Renderer.updateDirtyRectangle);(function(b){b.decorate("render",function(b){var a=this.points;if(!a||2>a.length)return!1;b.save();b.beginPath();b.moveTo.apply(b,a[0]);for(var d=1,e=a.length;d<e;d++)b.lineTo.apply(b,a[d]);b.lineTo.apply(b,a[0]);b.closePath();b.fillStyle=String(this.color);b.fill();b.fillStyle=this._pattern;b.fill();b.strokeStyle=String(this.stroke);b.stroke();b.restore();this._super(b)})})(Engine.Geometry.Polygon);(function(b){b.decorate({render:function(b){var a=this.originX,d=this.originY,e=this.radiusX-1,f=this.radiusY-1,h=0.5522848*e,g=0.5522848*f,k=a+e,m=d+f,e=a-e,f=d-f;b.beginPath();b.moveTo(e,d);b.bezierCurveTo(e,d-g,a-h,f,a,f);b.bezierCurveTo(a+h,f,k,d-g,k,d);b.bezierCurveTo(k,d+g,a+h,m,a,m);b.bezierCurveTo(a-h,m,e,d+g,e,d);b.closePath();b.fillStyle=String(this.color);b.fill();b.fillStyle=this._pattern;b.fill();b.strokeStyle=String(this.stroke);b.stroke();this._super(b)}})})(Engine.Geometry.Oval);(function(b,c,a,d,e,f){function h(c){var f=b.getFont(c.font,c.textColor);if(!f.ready)return c.setBounds(0,0,0,0);for(var h=f.base,m=f.response,f=m.pages,l=m.common,r=m.chars,A=m.kernings,z=c.paddingLeft,x=c.paddingTop,C=c.paddingRight,w=c.paddingBottom,B=c.spacing,F=c.lineHeight===b.AUTO?parseInt(l.lineHeight):c.lineHeight,E=c.textAlign,K=c.minWidth,N=c.minHeight,H=c.maxWidth,Q=c.maxHeight,l=E!==b.PRE?String(c.text).trim().replace(s,g):String(c.text),M=E!==b.PRE?l.match(s)||[]:[l],G=z,L=x,l=z,m=x,
J=[],I=null,P=0;P<M.length;P++)switch(I=I||[],!0){case M[P]===n:G=z;L+=F;break;default:var O=new k(M[P],r,A,B,F,E===b.PRE?H:Infinity),R=O.x,T=O.y,S=O.w,U=O.h;0<P&&G+R+S>z+H&&(J.add(I),I=[],G=z,L+=F);if(!I.length&&p.test(O.text))continue;O.ox=G;O.oy=L;I.push(O);l=e(z+K+C,d(e(l,G+R+S+C),z+H+C));m=e(z+N+C,d(e(m,L+T+U+w),x+Q+w));G+=R+S;J.add(I)}if(E!==b.PRE)for(r=l,A=0;A<J.length;A++)switch(z=J[A],z.length&&(p.test(z.first().text)&&z.shift(),z.length&&p.test(z.last().text)&&z.pop()),E){case b.RIGHT:x=
z.last();w=r-C;x=w-(x.ox+x.x+x.w);for(w=0;w<z.length;w++)z[w].ox+=x;break;case b.CENTER:x=z.last();w=r-C;x=(w-(x.ox+x.x+x.w))/2;for(w=0;w<z.length;w++)z[w].ox+=x;break;case b.JUSTIFY:if(A===J.length-1)break;x=z.last();w=r-C;x=w-(x.ox+x.x+x.w);for(w=1;w<z.length;w++)z[w].ox+=parseInt(x*(w/(z.length-1)))}C=c._canvas;C.width=l;C.height=m;C=c._ctx;for(E=0;E<J.length;E++)for(r=J[E],A=0;A<r.length;A++)for(z=r[A],x=z.ox,w=z.oy,B=0;B<z.length;B++)G=z[B],F=a.get(h+f[G.page].file),K=x+G.dx,N=w+G.dy,H=G.sx,
Q=G.sy,M=G.sw,G=G.sh,M&&G&&C.drawImage(F,H,Q,M,G,K,N,M,G);c.setSize(l,m)||c.redraw()}function g(a){switch(!0){case a===n:return n;case p.test(a):return l;default:return a}}function k(a,b,c,g,h,k){this.length=this.oy=this.ox=0;this.text=a;var l=0,s=0,p=0,C=0,w=0,B=0,F=0;a=a.split("");for(var E=0,K=a.length;E<K;E++)switch(!0){case a[E]===n:w=0;B+=h;l=d(w,l);s=d(B,s);p=e(p,w);C=e(C,B+h);break;default:var N=a[E].charCodeAt(0),H=b[N]||b[r],Q=parseInt(H.x),M=parseInt(H.y),G=parseInt(H.width),L=parseInt(H.height),
J=parseInt(H.xoffset),I=parseInt(H.yoffset),P=parseInt(H.xadvance),H=parseInt(H.page),F=parseInt(c[[F,N]])||0;w+J+G>k?(w=J,B+=h):w+=J;l=d(w,l);s=d(B,s);p=e(p,w+G);C=e(C,B+I+L);f.call(this,new m(w,B+I,Q,M,G,L,H));w+=P;w+=F;w+=g;F=N}this.x=l;this.y=s;this.w=p-l;this.h=C-s}function m(a,b,e,d,c,f,g){this.dx=a;this.dy=b;this.sx=e;this.sy=d;this.sw=c;this.sh=f;this.page=g}var l=" ",n="\n",r=l.charCodeAt(0);b.property("on"+b.READY,function(){h(this)});b.decorate({initialize:function(a){this._ctx=c.createContext();
this._canvas=this._ctx.canvas;(a=b.getFont(this.font,this.textColor))&&(a.ready?this.trigger(b.READY):this.subscribe(b.READY,a))},setFont:function(a){var e=b.getFont(this.font,this.textColor);if(!this._super(a))return!1;this.unsubscribe(b.READY,e);(a=b.getFont(this.font,this.textColor))&&(a.ready?this.trigger(b.READY):this.subscribe(b.READY,a));return!0},setTextColor:function(a){var e=b.getFont(this.font,this.textColor);if(!this._super(a))return!1;this.unsubscribe(b.READY,e);(a=b.getFont(this.font,
this.textColor))&&(a.ready?this.trigger(b.READY):this.subscribe(b.READY,a));return!0},setText:function(a){if(!this._super(a))return!1;h(this);return!0},setSpacing:function(a){if(!this._super(a))return!1;h(this);return!0},setLineHeight:function(a){if(!this._super(a))return!1;h(this);return!0},setTextAlign:function(a){if(!this._super(a))return!1;h(this);return!0},setPadding:function(a,b,e,d){if(!this._super(a,b,e,d))return!1;h(this);return!0},setMinWidth:function(a){if(!this._super(a))return!1;h(this);
return!0},setMinHeight:function(a){if(!this._super(a))return!1;h(this);return!0},setMaxWidth:function(a){if(!this._super(a))return!1;h(this);return!0},setMaxHeight:function(a){if(!this._super(a))return!1;h(this);return!0},render:function(a){a.save();a.fillStyle=String(this.color);a.fillRect(this.left,this.top,this.width,this.height);a.fillStyle=this._pattern;a.fillRect(this.left,this.top,this.width,this.height);var b=this._canvas;b.width&&b.height&&a.drawImage(b,this.left,this.top);a.strokeStyle=
String(this.stroke);a.strokeRect(this.left+1,this.top+1,this.width-2,this.height-2);a.restore();this._super(a)},setSize:function(a,b){if(!this._super(a,b))return!1;this.redraw();return!0}});var s=/(\n|\s+|\S+)/g,p=/^\s+$/})(Engine.Geometry.Shape.Text,Engine.Renderer,Engine.Renderer.Cache,Math.min,Math.max,Array.prototype.push);(function(b,c,a,d){function e(a){c.call(this,{src:a});this.ready=!1;this.base=String(this.src).replace(k,"");this.pages=[]}function f(a){for(var b={},e=0,d=a.length;e<d;e++){var c=a[e];b[c.id]=c}return b}function h(a){for(var b={},e=0,d=a.length;e<d;e++){var c=a[e];b[[c.first,c.second]]=c.amount}return b}var g={},k=/[^\/]+$/;Class.extend(e,c);e.method({onload:function(e){function d(){if(0<--p)return!1;c.ready=!0;c.trigger(b.READY);return!0}var c=this,g=e.pages,k=this.base,p=g.length;e.chars=f(e.chars["char"]);
e.kernings=e.kernings?h(e.kernings.kerning||[]):{};this._super(e);for(e=0;e<g.length;e++)(function(b){b=k+b.file;if(a.get(b))return d();a.load(b,d)})(g[e])}});b.getFont=function(a,b){var c=d.PATH+"{}/{}/{}/{}/{}".format(a.family,a.weight,a.style,b,a.size)+".json";return""===c?null:g.hasOwnProperty(c)?g[c]:g[c]=new e(c)}})(Engine.Geometry.Shape.Text,Engine.Network.Resource,Engine.Renderer.Cache,Engine.Font);(function(b,c,a,d){b.property({onload:function(){this.complete=!0;var a=this.canvas=c.Cache.get(this.src);a?this.setSize(a.width,a.height):this.setSize(0,0)}});b.decorate({initialize:function(){this.canvas=null;var a=this.src;a&&c.Cache.bind(a,this)},setSrc:function(a){var b=this.src;if(!this._super(a))return!1;a=this.src;b&&c.Cache.unbind(b,this);this.canvas=null;a&&c.Cache.bind(a,this);return!0},render:function(a){var b=this.canvas;b&&b.width&&b.height&&a.drawImage(b,this.left,this.top);this._super(a)},
setBounds:function(a,b,d,c){return this._super(a,b,d,c)?!0:!1},clearBB:function(b){if(!this._super(b))return!1;a(this,this.bb);return!0},insertBB:function(b){if(!this._super(b))return!1;a(this,this.bb);return!0}})})(Engine.Image,Engine.Renderer,Engine.Renderer.updateDirtyRectangle,Engine.Geometry);(function(b,c,a,d,e){c.property({onload:function(){this.complete=!0;this.canvas=b.Cache.get(this.src);this.redraw()}});var f=a.prototype.render;c.decorate("render",function(a){var b=this.canvas;if(!b)return!1;var c=b.width,m=b.height;if(!c||!m)return!1;var l=this.offsetx,n=this.offsety,r=d(e(0,-l),c),s=d(e(0,-n),m),c=d(e(0,-l+this.width),c)-r,m=d(e(0,-n+this.height),m)-s;c&&m&&a.drawImage(b,r,s,c,m,this.left+r+l,this.top+s+n,c,m);f.call(this,a)})})(Engine.Renderer,Engine.Image.Sprite,Engine.Geometry,
Math.min,Math.max);(function(b){function c(a){}var a={loadstart:c,progress:c,suspend:c,stalled:c,durationchange:c,loadedmetadata:c,canplay:c,canplaythrough:c,play:c,playing:function(a){this.playing=!0},seeking:c,seeked:function(a){this.redraw(0,0,this.width,this.height)},loadend:c,timeout:c,emptied:c,pause:function(a){this.playing=!1},stop:c,loadeddata:function(a){switch(this.autosize){case b.AUTO:this.setSize(this.video.videoWidth,this.video.videoHeight)}},waiting:c,timeupdate:function(a){this.redraw(0,0,this.width,
this.height)},ended:function(a){this.playing=!1},ratechange:c,volumechange:c};b.decorate("setSrc",function(b){this.video&&(this.video.pause(),delete this.video,this.setSize(0,0));this._super(b);this.video=document.createElement("video");this.video.loop=this.loop;this.video.src=this.src;for(var e in a)this.video.addEventListener(e,a[e].bind(this))});b.prototype.play=function(){this.video&&(this.video.volume=this.globalVolume,this.video.play())};b.prototype.pause=function(){this.video&&this.video.pause()};
b.prototype.stop=function(){this.video&&(this.video.pause(),this.video.currentTime=0)};b.decorate("render",function(a){this.video&&a.drawImage(this.video,0,0,this.video.videoWidth,this.video.videoHeight,this.left,this.top,this.width,this.height);this._super(a)})})(Engine.Geometry.Media.Video);(function(b,c,a,d,e){function f(c){c=this.self;if(!c.pending||this instanceof a&&this.readyState!==l)return!1;var f=parseInt(this.status)||200;switch(!0){case n.test(f):try{var g=b.parse(c,this);c.trigger(b.LOAD,g)}catch(h){c.trigger(b.ERROR,new e(h.message))}break;case r.test(f):c.trigger(b.ERROR,new d(f))}}function h(a){this.self.trigger(b.PROGRESS,a?a.position||a.loaded:1,a?a.totalSize||a.total:1)}function g(a){this.self.trigger(b.ERROR,a)}function k(a){this.self.trigger(b.ABORT)}var m=b.XHR="_xhr",
l=4,n=/^[23]\d+$/,r=/^[45]\d+$/;b.property(m,null);b.decorate("load",function(){if(!this._super())return!1;var a=this[m]=b.transport(this);a.self=this;a.onload=f;a.onreadystatechange=f;a.onerror=g;a.onprogress=h;a.onabort=k;var e=this.method,d=this.src,l={};switch(e){case b.GET:var n=d.indexOf("?"),r=d.indexOf("#"),n=~n?n+1:d.length,r=~r?r:d.length,l=c.fromQuery(d.slice(n,r).split("&")),l=c.toQuery(Object.merge(l,this.data)),d=d.slice(0,n)+l+d.slice(r);break;case b.POST:l=c.toQuery(this.data)}a.open(e,
d,!0);b.prepare(this,a);a.send(l);return!0});b.decorate("abort",function(){if(!this._super())return!1;this[m]&&this[m].abort();return!0})}).call(this,Engine.Network.Resource,Engine.Network.Url,global.XMLHttpRequest||Engine.NOP,Engine.Network.Resource.Error.Request,Engine.Network.Resource.Error.Parse);(function(b,c,a,d){var e="Internet Explorer"===a.navigator.browser.name,f=parseInt(a.navigator.browser.version),h=c.parse(d);b.transport=function(a){a=c.parse(a.src);return e&&10>f&&a.host&&a.host!==h.host?new XDomainRequest:new XMLHttpRequest}})(Engine.Network.Resource,Engine.Network.Url,Engine.Device,global.location);(function(b,c,a){var d={};d[b.TEXT]="text";d[b.JSON]="json";d[b.DATA]="arraybuffer";d[b.AUTO]="";b.prepare=function(a,f){switch(!0){case f instanceof c:var h=a.headers;if(f.setRequestHeader){if(h)for(var g in h)f.setRequestHeader(g,h[g]);a.method===b.POST&&f.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")}f.responseType=d[a.type]||d[b.AUTO]}}})(Engine.Network.Resource,global.XMLHttpRequest||Engine.NOP,global.XDomainRequest||Engine.NOP);(function(b,c,a,d){function e(a){return"function"===typeof g&&a.response instanceof g?new Uint8Array(a.response):h&&a instanceof XMLHttpRequest?(new VBArray(a.responseBody)).toArray():a.responseText.toByteArray()}function f(a){a=a.response||a.responseText;return"object"===typeof a?a:JSON.parse(a)}var h="Internet Explorer"===c.navigator.browser.name,g=a.ArrayBuffer,k=/text/,m=/json/;b.parse=function(a,c){switch(a.type){case b.DATA:return e(c);case b.JSON:return f(c);case b.TEXT:return c.responseText;
case b.AUTO:var g=String(c instanceof d?c.contentType:c.getResponseHeader("Content-type"));return k.test(g)?c.responseText:m.test(g)?f(c):e(c)}}})(Engine.Network.Resource,Engine.Device,global,global.XDomainRequest||Engine.NOP);(function(b){function c(){this.trigger("open")}function a(a){this.trigger("message",a)}function d(){this.trigger("error")}function e(){this.trigger("close")}b.prototype.sock=null;b.decorate({connect:function(b){if(this.sock)return!1;this.sock=new SockJS(this.src,null,b);this.sock.onopen=c.bind(this);this.sock.onmessage=a.bind(this);this.sock.onclose=e.bind(this);this.sock.onerror=d.bind(this);return!0},send:function(a){this.sock.send(a)},close:function(){this.sock.close();delete this.sock.onopen;
delete this.sock.onmessage;delete this.sock.onclose;delete this.sock.onerror;delete this.sock}})})(Engine.Network.Socket);Engine.I18n=function(b){var c,a,d=new Model({events:[],tr:function(b,d,c){return"undefined"==typeof a?b.replace("%n",c):"undefined"!=typeof c?a.strings[b][a.rulesFunc(c)].replace("%n",c)||b:d?a.strings[b][d]||a.strings[b].__def:a.strings[b]?a.strings[b].__def||a.strings[b]:b},getCurrentLang:function(){return{code:c,def:a}},setLang:function(b){return c==b&&a?!0:d.loadLang(b)},loadLang:function(a){if("undefined"!=typeof a)return new b.Network.Resource({autoload:!0,src:b.config.I18N_PATH+a+".json",onload:function(a){d.loadLangHandler(a,
this.src)}})},loadLangHandler:function(b,f){if(!b)return!1;a=b;c=f.slice(f.lastIndexOf("/")+1,f.lastIndexOf("."));try{eval("rules = "+a.rules)}catch(h){throw"Engine.UI.i18n: Can`t eval language disambiguation rules "+c;}a.rulesFunc=null;d.trigger("languagechanged")}});return d}(Engine);Engine.Input=function(){var b=new Model;b.events={};b.propagateEvent=function(c,a){if(!(c instanceof b.Event))throw new TypeError("Input#propagateEvent: Event to propagate must be a Input#Event instance");if(!a||!a.length||!c.propagate)return c.propagate;for(var d=0,e=a.length,f;d<e;d++)if(f=a[d],c.fire(f),!c.propagate)return f;return c.propagate};return b}();Engine.Input.Event=function(){function b(b){Model.call(this,b);if(!this.type.length)throw new TypeError("Input#Event: type is required");}Class.extend(b,Model);b.property({type:"",propagate:!0,prevent:!1});b.property("toClone",{propagate:b.prototype.propagate,prevent:b.prototype.prevent});b.method({stopPropagation:function(){return this.propagate=!1},preventDefault:function(){return this.prevent=!0},defaultAction:Engine.NOP,fire:function(b){if(!(b instanceof Model))return!1;b.queue(this.type,this);
!this.prevent&&"function"===typeof this.defaultAction&&this.defaultAction(b)}});return b}();Engine.Input.Event.Focus=function(b){function c(a){b.call(this,a)}Class.extend(c,b);c.FOCUS="focus";c.BLUR="blur";c.property("propagate",!1);return c}(Engine.Input.Event);Engine.Input.Event.Mouse=function(b,c,a,d,e,f,h,g){function k(g){b.call(this,g);switch(!0){case this.viewport&&!(this.viewport instanceof c):case this.camera&&!(this.camera instanceof d):case this.scene&&!(this.scene instanceof a):case this.geometry&&!(this.geometry instanceof e):case this.nodes&&!h(this.nodes):case this.parent&&!(this.parent instanceof k):throw new TypeError("Engine.Input.Event.Mouse: invalid config object");}this.timestamp=f()}Class.extend(k,b);k.BUTTON={LEFT:0,MIDDLE:1,RIGHT:2};
k.MOUSEDOWN="mousedown";k.MOUSEUP="mouseup";k.MOUSEMOVE="mousemove";k.property({button:k.BUTTON.LEFT,timestamp:0,x:0,y:0,viewX:0,viewY:0,cameraX:0,cameraY:0,sceneX:0,sceneY:0,parent:null,viewport:null,camera:null,scene:null,nodes:null,geometry:null});k.method({getElements:function(){var a=[];this.geometry&&a.push(this.geometry);this.nodes&&this.nodes.length&&g.apply(a,this.nodes);this.scene&&a.push(this.scene);return a},getModels:function(){var a=this.getElements();this.camera&&a.push(this.camera);
this.viewport&&a.push(this.viewport);return a}});return k}(Engine.Input.Event,Engine.Viewport,Engine.Scene,Engine.Camera,Engine.Geometry,Engine.now,Array.isArray,Array.prototype.push);Engine.Input.Event.Mouse.Drag=function(b){function c(a){b.call(this,a)}Class.extend(c,b);c.DRAGSTART="dragstart";c.DRAGEND="dragend";c.DRAGMOVE="dragmove";return c}(Engine.Input.Event.Mouse);Engine.Input.Event.Keyboard=function(b,c,a){function d(b){c.call(this,b);b=this.keyCode|0;this.key=e[b]||(b?a(b):this.key)}Class.extend(d,c);d.KEYDOWN="keydown";d.KEYPRESS="keypress";d.KEYUP="keyup";d.CTRL_MODIFIER=1;d.ALT_MODIFIER=2;d.SHIFT_MODIFIER=4;var e=d.SPECIAL_KEY_CODES={8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",17:"CTRL",18:"ALT",19:"PAUSE",20:"CAPS_LOCK",27:"ESC",32:"SPACE",33:"PAGE_UP",34:"PAGE_DOWN",35:"END",36:"HOME",37:"ARROW_LEFT",38:"ARROW_UP",39:"ARROW_RIGHT",40:"ARROW_DOWN",45:"INSERT",
46:"DELETE",91:"SUPER_LEFT",92:"SUPER_RIGHT",93:"SELECT",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NUM_LOCK",145:"SCROLL_LOCK"};d.property({key:"",keyCode:0,text:"",modifiers:0});return d}(Engine.Input,Engine.Input.Event,String.fromCharCode);(function(b,c){b.events.mouse=[c.MOUSEDOWN,c.MOUSEUP,c.MOUSEMOVE];b.pressed=null;b.DELTA=10;b.addEventListener(c.MOUSEDOWN,function(a){this.pressed=a});b.addEventListener(c.MOUSEUP,function(a){this.pressed=null});Class.decorate(b,"propagateEvent",function(a,b){a instanceof c&&!b&&(b=a.getModels());return this._super(a,b)})})(Engine.Input,Engine.Input.Event.Mouse);(function(b){b.property({captureTransparent:!0})})(Engine.Camera);(function(b,c){function a(a){null!==d&&null!==e&&(a.movementX=a.x-d,a.movementY=a.y-e)}c.property({movementX:0,movementY:0});var d=null,e=null;b.addEventListener(c.MOUSEDOWN,function(a){d=a.x;e=a.y});b.addEventListener(c.MOUSEUP,function(b){a(b);e=d=null});b.addEventListener(c.MOUSEMOVE,function(b){a(b);d=b.x;e=b.y})})(Engine.Input,Engine.Input.Event.Mouse);(function(b,c,a,d,e){b.dragged=!1;var f=new d(0,0,b.DELTA,b.DELTA),h=new d(0,0,1,1),g=null;b.addEventListener(c.MOUSEDOWN,function(a){f.x=a.x-f.w/2;f.y=a.y-f.h/2;if(a.camera)for(var b=a.getModels(),e=b.length,d;e--;)if(d=b[e],d.selectable||d.scrollable)return g=a});b.addEventListener(c.MOUSEUP,function(d){g=null;if(b.dragged){var c=e(d);c.type=a.DRAGEND;(new a(c)).fire(b.dragged);b.dragged=null;d.stopPropagation()}});b.addEventListener(c.MOUSEMOVE,function(d){if(g||b.dragged){if(b.dragged)return d=
e(d),d.type=a.DRAGMOVE,(new a(d)).fire(b.dragged);h.x=d.x;h.y=d.y;if(!h.overlap(f)){d=[];for(var c=g.getModels(),l=0,n=c.length;l<n;l++)c[l].scrollable&&d.push(c[l]);if(!d.length)return g=null;c=e(g);c.type=a.DRAGSTART;b.dragged=this.propagateEvent(new a(c),d);g=null;if(!(b.dragged instanceof Model))return b.dragged=null}}});Class.decorate(b,"on"+c.MOUSEMOVE,function(a){b.dragged&&a.stopPropagation();this._super(a)})})(Engine.Input,Engine.Input.Event.Mouse,Engine.Input.Event.Mouse.Drag,Engine.Box,
Object.clone);(function(b,c,a,d){function e(a){this._isScrolled=!0;a.stopPropagation()}function f(a){this._isScrolled=!1;this.moveTo(this.x,this.y)}function h(a){var b=this.zoom;this.moveBy(-a.movementX/b,-a.movementY/b)}c.decorate("initialize",function(a){this._super&&this._super(a);this.scrollable&&(this.addEventListener(d.DRAGSTART,e),this.addEventListener(d.DRAGEND,f),this.addEventListener(d.DRAGMOVE,h))});c.property({scrollable:!0,_isScrolled:!1})})(Engine.Input,Engine.Camera,Engine.Input.Event.Mouse,Engine.Input.Event.Mouse.Drag);(function(b,c,a){c.MOUSEOVER="mouseover";c.MOUSEOUT="mouseout";c.MOUSEENTER="mouseenter";c.MOUSELEAVE="mouseleave";var d=null;["on"+c.MOUSEDOWN,"on"+c.MOUSEMOVE].forEach(function(e){Class.decorate(b,e,function(b){this._super(b);if(b.propagate){var e=d&&d.getModels().without(b.getModels()),g=b.getModels().without(d&&d.getModels());if(e&&e.length){var k=a(b);k.type=c.MOUSEOUT;this.propagateEvent(new c(k),d.getModels());k=a(d);k.type=c.MOUSELEAVE;this.propagateEvent(new c(k),e)}g&&g.length&&(e=a(b),
e.type=c.MOUSEOVER,this.propagateEvent(new c(e),b.getModels()),e=a(b),e.type=c.MOUSEENTER,this.propagateEvent(new c(e),g));d=b}})})})(Engine.Input,Engine.Input.Event.Mouse,Object.clone);(function(b,c,a){b.events.mouse.push(c.MOUSECLICK="mouseclick");var d=null;b.addEventListener(c.MOUSEDOWN,function(a){a.propagate&&(d=a)});b.addEventListener(c.MOUSEUP,function(b){b.propagate&&(b=a(b),b.type=c.MOUSECLICK,b.parent=d,(new c(b)).fire(this))})})(Engine.Input,Engine.Input.Event.Mouse,Object.clone);(function(b,c,a){if(!c.MOUSECLICK)throw"Engine.Input: `mousedblclick` requires `mouseclick` event";b.events.mouse.push(c.MOUSEDBLCLICK="mousedblclick");var d=null;b.addEventListener(c.MOUSECLICK,function(b){if(!d||500<b.timestamp-d.timestamp)return d=b;b=a(b);b.type=c.MOUSEDBLCLICK;b.parent=d;(new c(b)).fire(this)})})(Engine.Input,Engine.Input.Event.Mouse,Object.clone);(function(b,c,a,d){function e(){f&&clearTimeout(f);k=f=null}b.events.mouse.push(c.MOUSEHOLD="mousehold");var f=0,h=new a(0,0,b.DELTA,b.DELTA),g=new a(0,0,1,1),k=null;b.addEventListener(c.MOUSEDOWN,function(a){var b=this;f&&clearTimeout(f);f=setTimeout(function(){if(k){var f=d(k);f.type=c.MOUSEHOLD;f.parent=k!==a&&a;(new c(f)).fire(b)}e()},1E3);h.x=a.x-h.w/2;h.y=a.y-h.h/2;k=a});b.addEventListener(c.MOUSEUP,e);b.addEventListener(c.MOUSEMOVE,function(a){k&&(k=a,g.x=a.x,g.y=a.y,g.overlap(h)||e())})})(Engine.Input,
Engine.Input.Event.Mouse,Engine.Box,Object.clone);(function(b,c,a,d){function e(a,b){return a.parent?a[b]===a.parent[b]:!0}function f(a,b){switch(b){case "viewport":a.viewport=null;case "camera":a.camera=null,a.cameraX=a.cameraY=0;case "scene":a.scene=null,a.sceneX=a.sceneY=0;case "geometry":a.geometry=null;case "nodes":a.nodes=null}}function h(b,c){var g=b.viewport;if(!g||!e(b,"viewport"))return"viewport";g=b.camera=b.camera||g.getCameraByPixel(b.viewX,b.viewY,c);if(!g||!e(b,"camera"))return"camera";b.cameraX=b.cameraX||b.viewX-g.left;b.cameraY=
b.cameraY||b.viewY-g.top;var k=b.scene=b.scene||g.lookingAt;if(!k||!e(b,"scene"))return"scene";b.sceneX=b.sceneX||g.toSceneX(b.cameraX);b.sceneY=b.sceneY||g.toSceneY(b.cameraY);if(!((b.geometry=b.geometry||k.captureGeometryByPixel(b.sceneX,b.sceneY))instanceof d&&e(b,"geometry"))){if(g.captureTransparent)return"geometry";c.push(g);f(b,"camera");return h(b,c)}for(g=b.geometry;g&&(g=g.parent)&&!(g instanceof a);){var m=m||[];m.add(g)}b.nodes=m;if(!m||!m.length)return"nodes"}function g(a){k.clear();
f(a,h(a,k));this._super(a)}var k=[];c=b.events.mouse;for(var m=c.length;m--;)Class.decorate(b,"on"+c[m],g)})(Engine.Input,Engine.Input.Event.Mouse,Engine.Scene,Engine.Geometry);(function(b,c,a,d){if(!d.MOUSECLICK)throw"Engine#Input: broken dependencies for select elements on mouse event";})(Engine.Input,Engine.Scene,Engine.Element,Engine.Input.Event.Mouse);(function(b,c,a){function d(a){return a.root.selected.has(a)?!0:(a=a.children)?a.some(d):!1}function e(a){var b=a.scene;b&&null!==b.multiSelect&&(b=this.children,!this.selectable||(this.root.selected.has(this)||b&&b.some(d))||(this.select(),h=a))}function f(a){var b=a.scene;b&&(a.parent!==h&&b.multiSelect)&&(this.root.selected.has(this)&&this.deselect(),h=null)}var h=null;b.decorate("initialize",function(b){this._super(b);this instanceof c||!this.selectable||(this.addEventListener(a.MOUSEDOWN,e),
this.addEventListener(a.MOUSECLICK,f))})})(Engine.Element,Engine.Scene,Engine.Input.Event.Mouse);(function(b,c){function a(e){return e instanceof b?!1:e.selectable?!0:(e=e.children)?e.some(a):!1}function d(b){b.propagate&&(this.selected.length&&!this.multiSelect)&&(b.geometry&&b.getElements().some(a)||this.deselectAll())}b.decorate("initialize",function(a){this._super(a);this.addEventListener(c.MOUSECLICK,d)})})(Engine.Scene,Engine.Input.Event.Mouse);(function(b,c,a,d){b.focused=null;b.getFocusedLeaf=function(){for(var a=this;a.focused||a.lookingAt;)a=a.focused||a.lookingAt;return a};b.setFocusOn=function(){var b={type:""};return function(d){if(null!==d&&!(d instanceof c))throw"Input#setFocusOn: viewport to focus must be a viewport";if(this.focused===d)return!0;this.focused&&(b.type=a.BLUR,(new a(b)).fire(this.focused),this.focused=null);d&&(this.focused=d,b.type=a.FOCUS,(new a(b)).fire(d));return!0}}();b.addEventListener(d.MOUSEDOWN,function(a){var b=
a.camera;if(b)return b.focus();(b=this.focused)&&b.focused&&b.setFocusOn(null);if(a=a.viewport)return a.focus();this.focused&&this.setFocusOn(null)})})(Engine.Input,Engine.Viewport,Engine.Input.Event.Focus,Engine.Input.Event.Mouse);(function(b,c,a){c.property("focusable",!1);c.method({focus:function(){return this.root instanceof a?this.root.setFocusOn(this):!1},blur:function(){return this.root instanceof a&&this.root.focused===this?this.root.setFocusOn(null):!1}});c.decorate("update",function(){var b=this.root;this._super();b instanceof a&&(this.root!==b&&b.focused===this)&&b.setFocusOn(null)})})(Engine.Input,Engine.Element,Engine.Scene);(function(b,c,a,d,e){function f(a){do if(a.focusable&&a.root&&a.focus())return!0;while(a=a.parent);return!1}function h(a){if(a.geometry&&(f(a.geometry)||(a=this.captureGeometryByPixel(a.sceneX,a.sceneY,[a.geometry],f))&&this.setFocusOn(a)))return;this.setFocusOn(null)}c.property({focusable:!0,focused:null});c.method({setFocusOn:function(){var b={type:""};return function(e){if(!this.focusable)return!1;if(null!==e){if(!(e.root&&e instanceof a&&e.root===this))return!1;var c=e;do if(!c.focusable)return!1;
while(c=c.parent);if(this.focused===e)return!0;for(var c=this.space.camera.get_tree().nodes,f=c.length,h;c[--f]&&(h=c[f].leaf)&&(!h.parent||h.parent.focused!==h););if(0>f)return!1}this.focused&&(b.type=d.BLUR,(new d(b)).fire(this.focused),this.focused=null);e&&(this.focused=e,b.type=d.FOCUS,(new d(b)).fire(e));return!0}}(),focus:function(){throw"Scene::focus: Can't focus root element";},blur:function(){throw"Scene::focus: Can't blur root element";}});c.decorate("initialize",function(a){this._super(a);
this.addEventListener(e.MOUSEDOWN,h)})})(Engine.Input,Engine.Scene,Engine.Element,Engine.Input.Event.Focus,Engine.Input.Event.Mouse);(function(b,c,a,d){a.property("focusable",!0);a.method({focus:function(){return this.parent?this.parent.setFocusOn(this):!1},blur:function(){return this.parent&&this.parent.focused===this?this.parent.setFocusOn(null):!1}});a.method("on"+d.BLUR,function(){this.lookingAt&&this.lookingAt.setFocusOn(null)})})(Engine.Input,Engine.Element,Engine.Camera,Engine.Input.Event.Focus);(function(b,c,a,d){c.decorate("initialize",function(a){this._super(a);!b.focus&&this.focus()});c.property({focusable:!0,focused:null});c.method({setFocusOn:function(){var b={type:""};return function(c){if(!this.focusable||!this.focus())return!1;if(null!==c){if(!(c instanceof a)||c.parent!==this)return!1;if(this.focused===c)return!0}this.focused&&(b.type=d.BLUR,(new d(b)).fire(this.focused),this.focused=null);c&&(this.focused=c,b.type=d.FOCUS,(new d(b)).fire(c));return!0}}(),focus:function(){return b.setFocusOn(this)},
blur:function(){return b.focused===this?b.setFocusOn(null):!1}});c.decorate({addCamera:function(a){var b=this._super(a);if(!b)return b;!this.focused&&this.setFocusOn(a);return b},removeCamera:function(a){a=this._super(a);if(!a)return a;this.setFocusOn(null);return a}});c.method("on"+d.BLUR,function(){this.setFocusOn(null)})})(Engine.Input,Engine.Viewport,Engine.Camera,Engine.Input.Event.Focus);(function(b,c){function a(a){var b=a.type===d|0&&m;switch(a.key){case "CTRL":l=h&b;break;case "ALT":n=g&b;break;case "SHIFT":r=k&b}a.modifiers=l|n|r}var d=c.KEYDOWN,e=c.KEYPRESS,f=c.KEYUP,h=c.CTRL_MODIFIER,g=c.ALT_MODIFIER,k=c.SHIFT_MODIFIER,m=h|g|k;b.events.keyboard=[d,e,f];var l=0,n=0,r=0;b["on"+d]=a;b["on"+e]=a;b["on"+f]=a})(Engine.Input,Engine.Input.Event.Keyboard);(function(b,c){function a(a){var b=this.getFocusedLeaf();b!==this&&this.propagateEvent(a,[b])}b.events.keyboard.forEach(function(d){b.addEventListener(d,a)})})(Engine.Input,Engine.Input.Event.Keyboard);(function(b){(function a(d){var e,f;for(f in d)d.hasOwnProperty(f)&&(e=d[f],"object"===typeof e?a(e):b.addEventListener(e,b.propagateEvent))})(b.events)})(Engine.Input);(function(b,c,a){function d(d,f){f.preventDefault();if(h!==f){var l=this instanceof c?this:null;g.type=d;g.button=f.button;g.x=f[e];g.y=f.pageY;g.viewport=l;g.viewX=l&&f[e]-l.div.offsetLeft;g.viewY=l&&f.pageY-l.div.offsetTop;(new a(g)).fire(b);h=f}}if("undefined"===typeof window.ontouchstart){var e="pageX",f=document.documentElement,h=null,g={};c.decorate("initialize",function(b){this._super&&this._super(b);this.div.addEventListener("mousedown",d.bind(this,a.MOUSEDOWN));this.div.addEventListener("mouseup",
d.bind(this,a.MOUSEUP));this.div.addEventListener("mousemove",d.bind(this,a.MOUSEMOVE))});f.addEventListener("mousedown",d.bind(null,a.MOUSEDOWN));f.addEventListener("mouseup",d.bind(null,a.MOUSEUP));f.addEventListener("mousemove",d.bind(null,a.MOUSEMOVE))}})(Engine.Input,Engine.Viewport,Engine.Input.Event.Mouse);(function(b,c,a,d){function e(e,d){if(this instanceof c){var n=d.touches.item(0)||d.changedTouches.item(0);h.x=n[f];h.y=n.pageY;g.x=this.div.offsetLeft;g.y=this.div.offsetTop;g.w=this.div.offsetWidth;g.h=this.div.offsetHeight;var r=h.overlap(g)?this:null;k.type=e;k.x=n[f];k.y=n.pageY;k.viewport=r;k.viewX=r&&n[f]-r.div.offsetLeft;k.viewY=r&&n.pageY-r.div.offsetTop;(new a(k)).fire(b);"touchend"===d.type&&(new a({type:a.MOUSEMOVE,propagate:!1,x:Infinity,y:Infinity})).fire(b)}}if("undefined"!==typeof window.ontouchstart){var f=
"pageX",h=new d(0,0,1,1),g=new d(0,0,0,0),k={};c.decorate("initialize",function(b){this._super&&this._super(b);this.div.addEventListener("touchstart",e.bind(this,a.MOUSEDOWN));this.div.addEventListener("touchend",e.bind(this,a.MOUSEUP));this.div.addEventListener("touchmove",e.bind(this,a.MOUSEMOVE));this.div.addEventListener("touchmove",function(a){a.preventDefault()})})}})(Engine.Input,Engine.Viewport,Engine.Input.Event.Mouse,Engine.Box);(function(b,c,a){function d(a){return(a.keyCode||a.which||a.key&&a.key.toUpperCase().charCodeAt()||0)|0}function e(e,k,m){var n=d(k);if(n){k=e===h;l.type=e;l.keyCode=n;l.text=k?m&&(m["char"]||a(m.charCode)):"";e=new c(l);if(k){l.type=g;var p=new c(l);p.text=""}e.fire(b);p&&f(p,m);return p||e}}function f(e,d){if(!e||!d)return!1;var c=d&&(d["char"]||a(d.charCode));if(e.text===c)return!1;e.text=c;e.fire(b);return!0}var h=c.KEYDOWN,g=c.KEYPRESS,k=c.KEYUP,m=document.documentElement,l={},n=null,r=null,
s={},p=[8,9];m.addEventListener("keydown",function(a){var b=d(a);p.has(b)&&a.preventDefault();r=null;!s[b]&&setTimeout(function(){s[b]=e(h,a,r)},0);n=a});m.addEventListener("keyup",function(a){e(k,a,r);n=0;r=null;s[d(a)]=null});m.addEventListener("keypress",function(a){r=a;var b=s[d(n)];b&&f(b,a)})})(Engine.Input,Engine.Input.Event.Keyboard,String.fromCharCode);Engine.Sound=function(b){function c(a){if(!a||!a.src)throw new TypeError;Model.call(this,a);this.component=null;(this.refersTo=this.refersTo instanceof c.Component?this.refersTo:null)&&!c.Component.compare(this.refersTo,this)&&(this.refersTo=null,Engine.log("Sound can't refers to component with different src, loop or filter; new Component created",Engine.WARN));this.refersTo||(this.refersTo=new c.Component({src:this.src,loop:this.loop,filter:this.filter}));this.refersTo.addSound(this);this.subscribe(c.ENDED,
this.refersTo);this.subscribe(c.LOADED,this.refersTo);this.subscribe(c.LOADERROR,this.refersTo)}Class.extend(c,Model);c._implemented=!1;c.PATH="/sounds/";c.ENDED="ended";c.LOADED="loaded";c.LOADERROR="loaderror";c.property({refersTo:null,component:null,src:"",loop:!1,filter:null,autoload:!0,autoplay:!1,playing:!1});c.now=function(){return b()/1E3};c.method({load:function(a,b){return this.component&&this.component.load(a,b)},play:function(a){!this.component&&this.refersTo.addSound(this);return(this.playing=
!0)&&this.refersTo.play(a)},pause:function(a){this.playing=!1;return this.component&&this.component.pause(a)},stop:function(){this.playing=!1;return this.component&&!1!==this.component.stop()?this.component.removeSound(this):!1},toString:function(){var a="Sound `"+this.src+"`";this.loop&&(a+="; looped");this.filter&&(a+="; with filter `"+this.filter+"`");return a}});return c}(Engine.now);Engine.Sound.Error=function(b){function c(a,b){this.name="Sound"+a;this.message=b}Class.extend(c,Error);c.UNKNOWN_ERROR="UnknownError";c.TYPE_ERROR="TypeError";c.RANGE_ERROR="RangeError";c.REFERENCE_ERROR="ReferenceError";c.REQUEST_ERROR="RequestError";c.NOT_IMPLEMENTED_ERROR="NotImplementedError";c.raise=function(a,d,e){if(1>arguments.length)throw new RangeError;"object"!==typeof a&&(e=d,d=a,a=[]);e||(e=d,d=c.UNKNOWN_ERROR);b.call(a,new c(d,e));return a};c.exists=function(a){if("object"!==typeof a)throw new TypeError;
for(var b=0,e=a.length;b<e;b++)if(a[b]instanceof c)return b;return!1};c.findAll=function(a){if("object"!==typeof a)throw new TypeError;for(var b=null,e=0,f=a.length;e<f;e++)a[e]instanceof c&&(b=b||[],b.push(a[e]));return b};return c}(Array.prototype.push);(function(b,c,a){b.globalVolume=1;b.VOLUME_DEFAULT=1;b.VOLUME_MIN=0;b.VOLUME_MAX=2;b.property("volume",b.VOLUME_DEFAULT);b.setGlobalVolume=function(d){if(1>arguments.length)throw new RangeError;b.globalVolume=c(a(parseFloat(d||0),b.VOLUME_MAX),b.VOLUME_MIN)};b.method("setVolume",function(d){if(1>arguments.length)throw new RangeError;this.volume=c(a(parseFloat(d||0),b.VOLUME_MAX),b.VOLUME_MIN)})})(Engine.Sound,Math.max,Math.min);(function(b,c,a,d,e){var f=b.globalPosition={x:0,y:0,z:0,r:0};b.decorate("initialize",function(a){this._super(a);a=a&&a.position;this.position={x:a&&parseFloat(a.x||0)||0,y:a&&parseFloat(a.x||0)||0,z:a&&parseFloat(a.x||0)||0,r:b.calculateRadius(a)}});b.property("position",null);b.calculateRadius=function(b){return b&&a(c(d(e(parseFloat(b.x||0),2)+e(parseFloat(b.y||0),2)+e(parseFloat(b.z||0),2)),0),1)};b.setGlobalPosition=function(e,d,k){f.x=c(a(parseFloat(e||0),1),-1);f.y=c(a(parseFloat(d||0),1),
-1);f.z=c(a(parseFloat(k||0),1),-1);f.r=b.calculateRadius(f)};b.method("setPosition",function(e,d,f){this.position.x=c(a(parseFloat(e||0),1),-1);this.position.y=c(a(parseFloat(d||0),1),-1);this.position.z=c(a(parseFloat(f||0),1),-1);this.position.r=b.calculateRadius(this.position)})})(Engine.Sound,Math.max,Math.min,Math.sqrt,Math.pow);Engine.Sound.Component=function(b,c){function a(a){Model.call(this,a);this.sounds=[];this.autoload&&this.load()}Class.extend(a,Model);a.property({sounds:null,src:"",loop:!1,filter:null,startTime:0,offset:0,duration:0,loaded:!1,loading:!1,playing:!1,_audio:null,onended:function(){for(var a=0,b=this.sounds,c=b.length;a<c;a++)b[0].stop()}});a.compare=function(a,e){this&&2>arguments.length&&(e=a,a=this);return e instanceof b&&e.src===a.src&&e.loop===a.loop&&e.filter===a.filter};a.method({compare:a.compare,
addSound:function(a){if(!(a instanceof b))throw new TypeError;if(a.refersTo!==this)throw new ReferenceError;if(!this.compare(a))throw new ReferenceError;if(this.sounds.has(a))return!1;var e=this.sounds.push(a);a.component=this;a.autoload&&a.load();a.autoplay&&a.play(0);return e},removeSound:function(a){if(!this.sounds.has(a))return!1;if(a.playing)return a.stop();this.sounds.remove(a);a.component=null;return!0},load:function(a,e){this.loading=!1;this.loaded=!0;a&&a();this.trigger(b.LOADED)},play:function(a){this.startTime=
b.now();return this.playing=!0},pause:function(){this.playing=!1;this.offset+=b.now()-this.startTime;this.offset%=this.duration;this.startTime=0;return!0},stop:function(){this.pause()&&(this.offset=0)},getUri:function(a){"undefined"===typeof a&&(a="");return b.PATH+String(a)}});return a}(Engine.Sound,Engine.Sound.Error);(function(b,c){function a(a){for(var b=a.sounds,c=b.length,h=0,g=0,k=0,m;k<c;k++)m=b[k],m.playing&&(h++,g+=m.volume);h&&a.setVolume(g/h)}b.property("volume",c.VOLUME_DEFAULT);b.method("setVolume",function(a){this.volume=a});b.decorate({addSound:function(b){(b=this._super(b))&&a(this);return b},removeSound:function(b){(b=this._super(b))&&a(this);return b}});c.decorate("setVolume",function(b){this._super(b);this.component&&a(this.component)})})(Engine.Sound.Component,Engine.Sound);(function(b,c){function a(a){function b(a){for(var e=g=0,d=0,k;d<h;d++)k=c[d],k.playing&&(g++,e+=k.position[a]);return e}var c=a.sounds,h=c.length,g=0,k=b("x"),m=b("y"),l=b("z");g&&a.setPosition(k/g,m/g,l/g)}b.property("position",null);b.method("setPosition",function(a,b,f){this.position.x=a;this.position.y=b;this.position.z=f;this.position.r=c.calculateRadius(this.position)});b.decorate({initialize:function(a){this._super(a);this.position={x:0,y:0,z:0,r:0}},addSound:function(b){(b=this._super(b))&&
a(this);return b},removeSound:function(b){(b=this._super(b))&&a(this);return b}});c.decorate("setPosition",function(b,e,c){this._super(b,e,c);this.component&&a(this.component)})})(Engine.Sound.Component,Engine.Sound);(function(b,c,a){var d=a._validator=function(e){return function(){var d="function"===typeof arguments[1]?arguments[1]:null;b._implemented&&b._implemented.methods.has(e)||a.raise(arguments,a.NOT_IMPLEMENTED_ERROR,"This method is not implemented");if(a.exists(arguments)){var c=a.findAll(arguments);d&&d.apply(null,c);(d=b[e.toUpperCase()+"ERROR"])&&this.trigger(d,c);return c}return this._super.apply(this,arguments)}};c.decorate({load:d("load"),play:d("play"),pause:d("pause")})})(Engine.Sound,Engine.Sound.Component,
Engine.Sound.Error);(function(b,c,a){c.decorate("setVolume",a("setVolume"));Class.decorate(b,"setGlobalVolume",a("setGlobalVolume"))})(Engine.Sound,Engine.Sound.Component,Engine.Sound.Error._validator);(function(b,c,a){c.decorate("setPosition",a("setPosition"));Class.decorate(b,"setGlobalPosition",a("setGlobalPosition"))})(Engine.Sound,Engine.Sound.Component,Engine.Sound.Error._validator);(function(b,c){"undefined"!==typeof Audio&&(b.TYPE=function(){var a=new Audio,b={mp3:"audio/mpeg",ogg:'audio/ogg; codecs="vorbis"'},e,c;for(e=1;2>=e;e+=1)for(c in b)if(b.hasOwnProperty(c)){var h=b[c];if(a.canPlayType(h)===(1===e?"probably":"maybe"))return{ext:c,mime:h}}return null}(),b.TYPE&&c.decorate("getUri",function(a){return this._super(a)+"."+b.TYPE.ext}))})(Engine.Sound,Engine.Sound.Component);(function(b,c){if(!b._implemented&&b.TYPE){b.WEBAUDIO_IMPLEMENTATION={name:"WebAudioAPI",methods:["play","pause"]};var a=this.AudioContext||this.webkitAudioContext||this.mozAudioContext;if(a){b._implemented=b.WEBAUDIO_IMPLEMENTATION;var d=b._ctx=new a,e=Object.getPrototypeOf(Object.getPrototypeOf(d.destination)).constructor,a=d.createBufferSource().constructor;e===Object&&(e=null);d.joinNode=function(a,b,e){b.right.disconnect(e);b.right.connect(a);b.right=a;a.connect(e);return a};d.createGain=d.createGain||
d.createGainNode;a.prototype.start||(a.prototype.start=a.prototype.noteOn);a.prototype.stop||(a.prototype.stop=a.prototype.noteOff);c.decorate({load:function(){this._audio.buffer&&(this.duration=this._audio.buffer.duration);this._super.apply(this,arguments)},play:function(){var a=this;this._audio.source.start(d.currentTime,0);this.loop||(this._audio.onend=setTimeout(function(){a.trigger(b.ENDED)},1E3*(this.duration-this.offset)));return this._super.apply(this,arguments)},pause:function(a){function b(){var a=
c.source;if(!d.playing&&a){a.stop(0);clearTimeout(c.onend);for(var f in c)(e?c[f]instanceof e:~c[f].constructor.toString().indexOf("NodeConstructor"))&&delete c[f]}}var d=this,c=this._audio,m=this._super.apply(this,arguments);0<a?setTimeout(b,1E3*a):b();return m}});Class.decorate(b,"now",function(){return d.currentTime})}}}).call(this,Engine.Sound,Engine.Sound.Component);(function(b,c,a,d){b._implemented===b.WEBAUDIO_IMPLEMENTATION&&(b.WEBAUDIO_IMPLEMENTATION.methods.push("load"),c.decorate("load",function(){function e(a,e,c){n++;return new d({src:a,type:"data",on:{load:function(a){b._ctx.decodeAudioData(a.buffer,e,c)},error:c}})}function c(a,b){g._audio[a]=b;++l===n&&k.apply(g,m)}function h(){a.raise(m,a.REQUEST_ERROR,"Can't load sound file");n=-1;k.apply(g,m)}var g=this,k=this._super,m=arguments;this._audio={};for(var l=0,n=0,r=0,s=arguments.length;r<s;r++){var p=
arguments[r];p&&(p.uri&&p.name)&&e(p.uri,c.bind(null,p.name),h)}}))})(Engine.Sound,Engine.Sound.Component,Engine.Sound.Error,Engine.Network.Resource);(function(b,c,a){if(b._implemented===b.WEBAUDIO_IMPLEMENTATION){var d=a.sources=a.createGain();d.right=d;d.connect(a.destination);c.decorate({load:function(){Array.prototype.push.call(arguments,{name:"buffer",uri:this.getUri(this.src)});return this._super.apply(this,arguments)},play:function(){if(!this._audio.source){var b=this._audio.source=a.createBufferSource();b.connect(d);b.right=b;b.loop=this.loop;b.buffer=this._audio.buffer}return this._super.apply(this,arguments)}})}})(Engine.Sound,Engine.Sound.Component,
Engine.Sound._ctx);(function(b,c,a,d,e,f){function h(a,b){a.setPosition(b.x,b.y,b.z);a.refDistance=1-b.r}if(b._implemented===b.WEBAUDIO_IMPLEMENTATION){b.WEBAUDIO_IMPLEMENTATION.methods.push("setPosition","setGlobalPosition");var g=d.joinNode(d.createPanner(),d.sources,d.destination);g.panningModel=g.EQUALPOWER;c.decorate({play:function(){var a=this._super.apply(this,arguments);if(!this._audio.panner){var b=this._audio.panner=d.joinNode(d.createPanner(),this._audio.source,d.sources);b.refDistance=0;h(b,this.position)}return a},
setPosition:function(a,b,e){a=this._super(a,b,e);this._audio&&this._audio.panner&&h(this._audio.panner,this.position);return a}});Class.decorate(b,"setGlobalPosition",function(){var a=this._super.apply(this,arguments);h(g,b.globalPosition);return a});h(g,b.globalPosition)}})(Engine.Sound,Engine.Sound.Component,Engine.Sound.now,Engine.Sound._ctx,Engine.Loop,Math.min);(function(b,c,a){if(b._implemented===b.WEBAUDIO_IMPLEMENTATION){b.WEBAUDIO_IMPLEMENTATION.methods.push("setVolume","setGlobalVolume");var d=a.joinNode(a.createGain(),a.sources,a.destination);c.decorate({play:function(){var b=this._super.apply(this,arguments);this._audio.volume||(this._audio.volume=a.joinNode(a.createGain(),this._audio.source,a.sources),this._audio.volume.gain.setValueAtTime(this.volume,a.currentTime));return b},setVolume:function(b){b=this._super(b);this._audio&&this._audio.volume&&
this._audio.volume.gain.setValueAtTime(this.volume,a.currentTime);return b}});Class.decorate(b,"setGlobalVolume",function(e){e=this._super(e);d.gain.setValueAtTime(b.globalVolume,a.currentTime);return e});d.gain.setValueAtTime(b.globalVolume,a.currentTime)}})(Engine.Sound,Engine.Sound.Component,Engine.Sound._ctx);(function(b,c,a){b._implemented===b.WEBAUDIO_IMPLEMENTATION&&c.decorate({load:function(){this.filter&&Array.prototype.push.call(arguments,{name:"filter",uri:this.getUri(this.filter)});return this._super.apply(this,arguments)},play:function(){var b=this._super.apply(this,arguments);!this._audio.convolver&&this._audio.filter&&((this._audio.convolver=a.joinNode(a.createConvolver(),this._audio.source,a.sources)).buffer=this._audio.filter);return b}})})(Engine.Sound,Engine.Sound.Component,Engine.Sound._ctx);(function(b,c,a){!b._implemented&&b.TYPE&&(b.NODE_IMPLEMENTATION={name:"Node",methods:["load","play","pause"]},b._implemented=b.NODE_IMPLEMENTATION,c.decorate({load:function(){function d(){g.removeEventListener("canplaythrough",d);e.duration=g.duration;c.apply(e,h)}var e=this,c=this._super,h=arguments,g=this._audio=new Audio;g.src=this.getUri(this.src);g.loop=this.loop;g.volume=this.volume;g.addEventListener("ended",this.trigger.bind(this,b.ENDED));g.addEventListener("error",function(){a.raise(h,
a.REQUEST_ERROR,"Can't load sound file");c.apply(e,h)});g.addEventListener("canplaythrough",d)},play:function(){this._audio.currentTime=this.offset;this._audio.play();return this._super.apply(this,arguments)},pause:function(a){function b(){c.playing||c._audio.pause()}var c=this,h=this._super();0<a?setTimeout(b,1E3*a):b();return h}}))})(Engine.Sound,Engine.Sound.Component,Engine.Sound.Error);(function(b,c){function a(a){var d=a.volume*b.globalVolume,d=d*(1-b.globalPosition.r),d=d*(1-a.position.r);a._audio.volume=d}function d(){for(var e=this._super.apply(this,arguments),d=b._instances,c=0,g=d.length;c<g;c++)a(d[c]);return e}b._implemented===b.NODE_IMPLEMENTATION&&(b.NODE_IMPLEMENTATION.methods.push("setVolume","setGlobalVolume"),b.NODE_IMPLEMENTATION.methods.push("setPosition","setGlobalPosition"),c.decorate({play:function(){var b=this._super.apply(this,arguments);a(this);return b},setVolume:function(b){b=
this._super(b);a(this);return b},setPosition:function(b,d,c){b=this._super(b,d,c);a(this);return b}}),Class.decorate(b,{setGlobalVolume:d,setGlobalPosition:d}))})(Engine.Sound,Engine.Sound.Component);(function(b,c,a,d){c.decorate({load:function(a,d){a="function"===typeof a?a:null;d="function"===typeof d?d:null;if(this.loaded)return a&&a();if(this.loading){if(!a&&!d)return;a&&this.addEventListener(b.LOADED,a);return d&&this.addEventListener(b.LOADERROR,d)}this.loading=!0;this._super(a,d)},play:function(a){for(var d=!1,c=0,g=this.sounds,k=g.length;c<k&&!(d=g[c].playing);c++);if(!d)return!1;if("number"!==typeof a||0>a)a=void 0;if("undefined"===typeof a&&this.playing)return!0;"undefined"!==typeof a&&
(this.offset=a%this.duration||0);return this.loaded?this._super(a):this.addEventListener(b.LOADED,this.play.bind(this,a))},pause:function(a){if(this.playing&&this.loaded&&!this.paused){for(var b=!1,d=0,c=this.sounds,k=c.length;d<k&&!(b=c[d].playing);d++);return b?!1:this._super("number"===typeof a&&0<a?a:0)}}})})(Engine.Sound,Engine.Sound.Component,Engine.Sound.Error,Math.max);Engine.Particles=function(){function b(b){Model.call(this,b)}Class.extend(b,Model);return b}();Engine.Particles=function(b,c){function a(a){b.call(this,a);this.timer.set("duration",this.emitDelay)}Class.extend(a,b);a.BEFORE_EMIT="beforeemit";a.EMIT="emit";a.BEFORE_CREATE_PARTICLE="beforecreateparticle";a.CREATE_PARTICLE="createparticle";a.property({amount:10,iterations:Infinity,emitDelay:1E3,emitters:null});var d=[];a.method({onstep:function(){this._super();if(!this.emitters.length&&this.timer.count>=this.iterations)return this.stop()},onplay:function(){this._super();this.emitters=[];this.emit()},
onstop:function(){this._super();this.emitters=a.prototype.emitters},onloop:function(){this._super();this.timer.count<this.iterations&&this.emit()},onemitterdestroyed:function(a){d.push(a);5<d.length&&d.shift()},emit:function(){if(this.timer.playing){this.trigger(a.BEFORE_EMIT);var b=this.amount,c;a:{c=0;for(var h=d.length;c<h;c++)if(d[c].amount===b){c=c===d.length-1?d.pop():d[c]=d.pop();break a}c=void 0}c=c||{amount:b};this.emitters.push(c);this.trigger(a.EMIT,c,this.amount);for(h=0;h<b;h++)this.trigger(a.BEFORE_CREATE_PARTICLE,
h),this.trigger(a.CREATE_PARTICLE,c,h)}}});return a}(Engine.Particles,Engine.now);Engine.Particles=function(b,c){function a(a){var e=function(a,b,e,d){a=d[e]-b;d[e]=0>a?0:a};e.shortcutArguments=["timeleft"];this.funcs.push(e);b.call(this,a)}Class.extend(a,b);a.EMITTER_DESTROYED="emitterdestroyed";a.property({lifetime:5E3});a.method({onemit:function(a,b){this._super(a,b);a.lifetime=a.lifetime||new TypedArray("uint",this.lifetime,b);a.timeleft=a.timeleft||new TypedArray("uint",this.lifetime,b)},oncreateparticle:function(a,b){this._super(a,b);a.lifetime[b]=a.timeleft[b]=c(0,this.lifetime)},
onstep:function(){this._super();var b=0,e=this.emitters,c=e.length;a:for(;b<c;b++){for(var h=0,g=e[b].timeleft,k=g.length;h<k;h++)if(g[h])continue a;h=e[b];b===e.length-1?e.pop():e[b]=e.pop();this.queue(a.EMITTER_DESTROYED,h);b--;c--}}});return a}(Engine.Particles,Math.max);Engine.Particles=function(b){function c(a){b.call(this,a);this.timer.set("delay",this.redrawDelay)}Class.extend(c,b);c.property({geometry:null,redrawDelay:1,parent:null,left:0,top:0,width:1,height:1});c.method({onstep:function(){this._super();this.geometry.redraw()},onplay:function(){this._super();this.geometry=new Engine.Particles.Geometry({emitters:this.emitters,parent:this.parent,left:this.left,top:this.top,width:this.width,height:this.height})},onstop:function(){this._super();this.geometry.destroy()}});
return c}(Engine.Particles);Engine.Particles=function(b,c){function a(a){b.call(this,a)}Class.extend(a,b);a.property({fill:"red 2px 2px",_fills:null});a.method({onemit:function(a,b){this._super(a,b);a.shape=a.shape||Array(b)},onplay:function(){this._fills={};this._super()},onstop:function(){this._super();this._fills=a.prototype._fills},oncreateparticle:function(a,b){this._super(a,b);var f;if(f=this._fills[this.fill])return a.shape[b]=f;var h=a.shape[b]=this._fills[this.fill]=Engine.Particles.Fill.parse(this.fill);c(h);if(f=
h._image){if(f.complete)return h.width=f.width,h.height=f.height;f.addEventListener("load",function(){h._image=this;h.width=this.width;h.height=this.height})}}});return a}(Engine.Particles,Engine.Renderer.parseFill);Engine.Particles=function(b,c,a){function d(a){var d=a&&"dy"in a?a.dy:this.dy;!1!==(a&&"dx"in a?a.dx:this.dx)&&!1!==d&&(d=function(a,b,d,e,c){e&&c&&(d*=2,e[d]+=c[d]*b/1E3,e[d+1]+=c[d+1]*b/1E3)},d.shortcutArguments=["position","move"],this.funcs.push(d));b.call(this,a);this.dx=a&&"undefined"!==typeof a.dx?a.dx:this.dx;this.dy=a&&"undefined"!==typeof a.dy?a.dy:this.dy;this.originX=a&&"number"===typeof a.originX?a.originX:this.width/2;this.originY=a&&"number"===typeof a.originY?a.originY:this.height/
2}Class.extend(d,b);d.property({originX:null,originY:null,dx:100,dy:100});d.method({onemit:function(a,b){this._super(a,b);var d=c(this.width,this.height);a.position=a.position||new TypedArray("float",d,2*b);a.move=a.move||new TypedArray("int",d,2*b)},oncreateparticle:function(a,b){this._super(a,b);b*=2;a.position[b]=this.originX;a.move[b]=this.dx;b++;a.position[b]=this.originY;a.move[b]=this.dy},verifyPosition:function(b,d,c,g){"undefined"===typeof c&&(c=this.dx);"undefined"===typeof g&&(g=this.dy);
return a(c)+(b+1)/2>this.width/2||a(g)+(d+1)/2>this.height/2?!1:!0}});return d}(Engine.Particles,Math.max,Math.abs);Engine.Particles=function(b){function c(a){if(!1!==(a&&"opacity"in a?a.opacity:this.opacity)){var d=function(a,b,d,c,k){c&&(c[d]*=1-b/k[d])};d.shortcutArguments=["opacity","timeleft"];this.funcs.push(d)}b.call(this,a);this.opacity=a&&"undefined"!==typeof a.opacity?a.opacity:this.opacity}Class.extend(c,b);c.property({opacity:1});c.method({onemit:function(a,b){this._super(a,b);!1===this.opacity?a.opacity&&(a.opacity=null):a.opacity=a.opacity||new TypedArray("float",1,b)},oncreateparticle:function(a,
b){this._super(a,b);!1!==this.opacity&&(a.opacity[b]="number"===typeof this.opacity?this.opacity:c.prototype.opacity)}});return c}(Engine.Particles);Engine.Particles=function(b,c){function a(a){var e=Math.PI;if(!1!==(a&&"rotate"in a?a.rotate:this.rotate)){var c=function(a,b,d,c,f){c&&(c[d]+=f[d]*b/1E3,c[d]%=2*e)};c.shortcutArguments=["rotation","rotate"];this.funcs.push(c)}b.call(this,a);this.rotate=a&&"undefined"!==typeof a.rotate?a.rotate:this.rotate}Class.extend(a,b);a.property({rotate:0});a.method({onemit:function(a,b){this._super(a,b);!1===this.rotate?(a.rotate&&(a.rotate=null),a.rotation&&(a.rotation=null)):(a.rotate=a.rotate||new TypedArray("float",
2*c,b),a.rotation=a.rotation||new TypedArray("float",2*c,b))},oncreateparticle:function(a,b){this._super(a,b);a.rotate&&(a.rotate[b]=this.rotate,a.rotation[b]=0)}});return a}(Engine.Particles,Math.PI);Engine.Particles=function(b,c){function a(a){var e=this.timer=new c({type:c.ANIMATION,loop:!0,subscribers:{reset:this,play:this,pause:this,stop:this,step:this,loop:this}});this.reset=e.reset.bind(e);this.play=e.play.bind(e);this.pause=e.pause.bind(e);this.stop=e.stop.bind(e);b.call(this,a)}Class.extend(a,b);a.STEP="step";a.LOOP="loop";a.PLAY="play";a.STOP="stop";a.property({timer:null,autoplay:!0,oninitialize:function(a){this.autoplay&&setTimeout(this.timer.play.bind(this.timer),0)},reset:null,play:null,
pause:null,stop:null});return a}(Engine.Particles,Engine.Timer);Engine.Particles=function(b,c,a){function d(d){this.funcs=[];b.call(this,d);d&&a(d.funcs)&&c.apply(this.funcs,d.funcs)}Class.extend(d,b);d.property({funcs:null});d.method({onstep:function(a){var b=arguments,d=this.funcs,c=d.length;this._super(a);b[1]=a;for(var k=0,m=this.emitters,l=m.length;k<l;k++)for(var n=b[0]=m[k],r=0;r<c;r++){var s=d[r],p=s.shortcutArguments;b.length=3;if(p){b.length=p.length+3;for(var t=0,v=p.length;t<v;t++)b[t+3]=n[p[t]]}p=n.timeleft;t=0;for(v=p.length;t<v;t++)p[t]&&(b[2]=
t,s.apply(null,b))}}});return d}(Engine.Particles,Array.prototype.push,Array.isArray);Engine.Particles.Geometry=function(b){function c(a){b.call(this,a)}Class.extend(c,b);c.property({emitters:null});return c}(Engine.Geometry);Engine.Particles.Fill=function(b){b={parse:b.parse.bind(b)};var c=/\s(\d+)px\s(\d+)px$/;Class.decorate(b,"parse",function(a,b){var e=c.exec(a);e&&(a=a.substring(0,a.length-e[0].length));var f=this._super(a,b);f.image instanceof Engine.Fill.Gradient&&"radial"===f.image.type&&(f.left=0,f.top=0);e&&(f.width=parseInt(e[1]),f.height=parseInt(e[2]));return f});return b}(Engine.Fill);(function(b,c){b.decorate("render",function(a){this._super(a);var b=this.emitters;if(b&&b.length)for(var c=0,f=b.length;c<f;c++)for(var h=b[c],g=h.shape,k=h.opacity,m=h.rotation,l=h.position,h=h.timeleft,n=0,r=h.length,s=0;n<r;s=2*++n)if(h[n]){var p=g[n];a.globalAlpha=k?k[n]:1;var t=this.left+l[s]|0,v=this.top+l[s+1]|0,s=p.width|0,q=p.height|0;s&&q&&(a.save(),a.translate(t,v),m&&a.rotate(m[n]),a.translate(-s/2,-q/2),(t=p._image)?a.drawImage(t.canvas,0,0):(a.fillStyle=p._pattern||p.color+"",a.fillRect(0,
0,s,q)),a.restore())}})})(Engine.Particles.Geometry,Engine.Fill);Engine.Path=function(){var b=new Model;b.Metric={};b.METRIC="euclidean";b.distance=function(c,a,d,e,f){return(f=b.Metric[f]||b.Metric[b.METRIC]||null)?f.distance(c,a,d,e):0};return b}();(function(b){var c=Math.sqrt,a=Math.pow,d=Math.abs;b.Metric.euclidean={directions:[[1,0,1],[0,1,1],[-1,0,1],[0,-1,1],[1,1,Math.SQRT2],[-1,-1,Math.SQRT2],[-1,1,Math.SQRT2],[1,-1,Math.SQRT2]],distance:function(b,d,h,g){return c(a(b-h,2)+a(d-g,2))}};b.Metric.manhattan={directions:[[1,0,1],[0,1,1],[-1,0,1],[0,-1,1]],distance:function(a,b,c,g){return d(a-c)+d(b-g)}}})(Engine.Path);(function(b){function c(a,b){return 1}function a(a,b){return b.h-a.h||b.g-a.g}function d(a,b){b="function"===typeof b?b:f;for(var c=[];a;)c.unshift(b(a)),a=a.parent;return c}function e(a,b,c,d,e,f){this.x=a;this.y=b;this.g=c;this.h=d;this.parent=e;this.cost=f}function f(a){return[a.x,a.y]}b.MAX=500;b.INVALID=-1;b.search=function(f,g,k,m,l,n){if(f===k&&g===m)return[];l="function"===typeof l?l:c;var r=b.Metric[b.METRIC]||null;if(!r)throw'Engine.Path.search: no "'+b.METRIC+'" metric found';var s=r.directions,
p=s.length,r=r.distance,t=Math.max(0,parseFloat(b.MAX)||0),v=b.INVALID,q=0,u=r.call(null,f,g,k,m);f=[new e(f,g,q,u,null,0)];g={};for(var y={},D=f.last();f.length&&0<t--;){var A=f.pop(),z=A.x,x=A.y;D.h>A.h&&(D=A);if(z===k&&x===m)return d(A,n);g[A]=A;for(var C=0;C<p;C++){var w=s[C],q=w[0],u=w[1],B=w[2],w=z+q,F=x+u;if(!g[w+","+F]&&!y[w+","+F]){var E=l.call(this,w,F,q,u);y[w+","+F]=!0;Number(E)!==v&&(q=A.g+E*B,u=r.call(null,w,F,k,m),f.push(new e(w,F,q,u,A,E)))}}f.sort(a)}return d(D,n)};e.prototype.toString=
function(){return this.x+","+this.y}})(Engine.Path);Engine.Isometry=function(b,c){var a={TILE_WIDTH:64,TILE_HEIGHT:40,X:"x",Y:"y",Z:"z",W:"w",H:"h",D:"d",LAYER:"layer",LABEL:"ISOMETRY",project:function(c,e,f,h){c=parseFloat(c)||0;e=parseFloat(e)||0;f=parseFloat(f)||0;h=h||[0,0];h[0]=b(a.TILE_WIDTH/2*c-a.TILE_WIDTH/2*e);h[1]=b(a.TILE_HEIGHT/2*c+a.TILE_HEIGHT/2*e-a.TILE_HEIGHT*f);return h},coords:function(b,c,f){b=parseInt(b)||0;c=parseInt(c)||0;f=f||[0,0,0];f[0]=1/a.TILE_WIDTH*b+1/a.TILE_HEIGHT*c;f[1]=-1/a.TILE_WIDTH*b+1/a.TILE_HEIGHT*c;f[2]=0;return f},
UNIT:{valueOf:function(){return a.TILE_WIDTH/c}}};return a}(Math.round,Math.SQRT2);Engine.Isometry.Node=function(b,c,a,d,e){function f(d){var f=b.X,m=b.Y,l=b.Z,n=b.W,r=b.H,s=b.D,p=b.LAYER,f=this[f]=d&&f in d?parseFloat(d[f])||0:parseFloat(this[f])||0,m=this[m]=d&&m in d?parseFloat(d[m])||0:parseFloat(this[m])||0,t=this[l]=d&&l in d?parseFloat(d[l])||0:parseFloat(this[l])||0,n=this[n]=d&&n in d?e(0,parseFloat(d[n])||0):e(0,parseFloat(this[n])||0),r=this[r]=d&&l in d?e(0,parseFloat(d[l])||0):e(0,parseFloat(this[l])||0);this[s]=d&&l in d?e(0,parseFloat(d[l])||0):e(0,parseFloat(this[l])||
0);this[p]=d&&p in d?parseInt(d[p])||0:parseInt(this[p])||0;this.bb=new a(f,m,n,r);c.call(this,d);b.project(f,m,t,h);this.setTransform(1,0,0,1,h[0],h[1])}var h=[0,0];Class.extend(f,c);f.method({setCube:function(a,c,d,f,n,r){var s=b.X,p=b.Y,t=b.Z,v=b.W,q=b.H,u=b.D;a=parseFloat(a)||0;c=parseFloat(c)||0;d=parseFloat(d)||0;f=e(0,parseFloat(f)||0);n=e(0,parseFloat(n)||0);r=e(0,parseFloat(r)||0);if(a===this[s]&&c===this[p]&&d===this[t]&&f===this[v]&&n===this[q]&&r==this[u])return!1;this[s]=a;this[p]=c;
this[t]=d;this[v]=f;this[q]=n;this[u]=r;b.project(a,c,d,h);this.setTransform(1,0,0,1,h[0],h[1]);return!0},setPosition:function(a,c,d){return this.setCube(a,c,d,this[b.W],this[b.H],this[b.D])},setSize:function(a,c,d){return this.setCube(this[b.X],this[b.Y],this[b.Z],a,c,d)},setLayer:function(a){var c=b.LAYER;a=parseInt(a)||0;if(a===this[c])return!1;this[c]=a;this.update();return!0},update:function(a){var c=b.X,d=b.Y,e=b.W,h=b.H,r=b.LABEL,s=this.bb,p=this.root;p&&p.spaceClear(r,s,this);this._super(a);
a=this.firstParentOfType(f);s.reset(a?a.bb.x+this[c]:this[c],a?a.bb.y+this[d]:this[d],this[e],this[h]);(c=this.root)&&c.spaceInsert(r,s,this)}});return f}(Engine.Isometry,Engine.Transform,Engine.Box,Engine.Scene,Math.max);Engine.Isometry.Scene=function(b,c,a,d){function e(a){c.call(this,a);this.space[b.LABEL]=new RTree(4)}Class.extend(e,c);e.method({sort:function(c){for(var e=0,g=c.length;e<g;e++)for(var k=0;k<g;k++)if(e!==k){var m=c[e],l=c[k],n;n=m;var r=l,s=b.X,p=b.Y,t=b.W,v=b.H,q=b.LAYER,u=n.firstParentOfType(a),y=r.firstParentOfType(a);if(u===y)n=this.compare(n,r);else{var D=u?u[s]:0,A=u?u[p]:0,z=u?u[t]:0,x=u?u[v]:0,s=y?y[s]:0,p=y?y[p]:0,t=y?y[t]:0,v=y?y[v]:0;n=d.call((y?y[q]:0)-(u?u[q]:0)||(D>=s+t&&A+x>p||A>=
p+v&&D+z>s?-1:D+z<=s||A+x<=p||D<s||A<p?1:0)||this.compare(n,r))}~n||(c[e]=l,c[k]=m)}return c}});return e}(Engine.Isometry,Engine.Scene,Engine.Isometry.Node,Number.prototype.sign);Engine.Isometry.Transform=function(b,c,a,d,e){function f(a){var b=this.align=a&&"align"in a?String(a.align):String(this.align);g.has(this.align)||(this.align=g.last());c.call(this,a);h(this,b)}function h(c,f){var h=a.LEFT,n=a.TOP,r=b.TILE_HEIGHT/b.TILE_WIDTH;switch(f){case g[0]:h=a.RIGHT;n=a.BOTTOM;c.setTransform(1,-r,0,1,0,0);c.scale(1/d,r*d);break;case g[1]:h=a.LEFT;n=a.BOTTOM;c.setTransform(1,r,0,1,0,0);c.scale(1/d,r*d);break;case g[2]:h=a.LEFT,n=a.TOP,c.setTransform(1,0,0,r,0,0),c.rotate(e)}c.halign=
h;c.valign=n;for(var r=c.children,s=0;s<r.length;s++){var p=r[s];p instanceof a&&p.setAlign(h,n)}return!0}var g=["x","y","z"];Class.extend(f,c);f.property({align:g.last(),halign:a.LEFT,valign:a.TOP});f.method({setAlign:function(a){a=g.has(a)?a:g.last();if(a===this.align)return!1;this.align=a;h(this,a);return!0},appendChild:function(b){if(!this._super(b))return!1;b instanceof a&&b.setAlign(this.hAlign,this.vAlign);return!0}});f.X=Class.extend(function(a){f.call(this,a)},f);f.X.property("align",g[0]);
f.Y=Class.extend(function(a){f.call(this,a)},f);f.Y.property("align",g[1]);f.Z=Class.extend(function(a){f.call(this,a)},f);f.Z.property("align",g[2]);return f}(Engine.Isometry,Engine.Transform,Engine.Geometry,Math.SQRT2,Math.PI/4);Engine.Isometry.Camera=function(b,c,a,d,e){function f(a){c.call(this,a)}Class.extend(f,c);f.method({getVisibleArea:function(){var c=b.coords(this.toSceneX(0),this.toSceneY(0)),f=b.coords(this.toSceneX(0),this.toSceneY(this.height)),k=b.coords(this.toSceneX(this.width),this.toSceneY(0)),m=b.coords(this.toSceneX(this.width),this.toSceneY(this.height)),l=d(c[0],f[0],k[0],m[0]),n=d(c[1],f[1],k[1],m[1]),r=e(c[0],f[0],k[0],m[0]),c=e(c[1],f[1],k[1],m[1]);return new a(l,n,r-l,c-n)},isAreaVisible:function(c,
f,k,m){c=parseFloat(c)||0;f=parseFloat(f)||0;k=e(0,parseFloat(k)||0);m=e(0,parseFloat(m)||0);var l=b.project(c,f),n=b.project(c,f+m),r=b.project(c+k,f);m=b.project(c+k,f+m);c=d(l[0],n[0],r[0],m[0]);f=d(l[1],n[1],r[1],m[1]);k=e(l[0],n[0],r[0],m[0]);l=e(l[1],n[1],r[1],m[1]);n=this.view;return a.overlap(c,f,k-c,l-f,n.x,n.y,n.w,n.h)}});return f}(Engine.Isometry,Engine.Camera,Engine.Box,Math.min,Math.max);Engine.Cache=function(){var b=new Model;b.TEXT="textType";b.OBJECT="objectType";b.set=function(b,a,d,e,f){f()};b.get=function(b,a,d){d()};b.remove=function(b,a,d){d()};b.clear=function(b,a){b()};return b}();(function(b,c){function a(b,d,e,f,h){var s=arguments;h=h||1;var p=setTimeout(function(){f=e=c;if(1===h)return a(b,d,s[2],s[3],2);s[4]()},700);e=function(){clearTimeout(p);s[2]()};f=function(){clearTimeout(p);s[3]()};g.open("readwrite",function(){g.executeSql("INSERT OR REPLACE INTO {} (key, value) VALUES (?,?)".format(g.STORE_NAME),[b,d],e,f)},f)}function d(a,b,c){g.open("readonly",function(){g.executeSql("SELECT value FROM {} WHERE key=?".format(g.STORE_NAME),[a],function(a,d){if(!d.rows.length)return c();
var e=d.rows.item(0);b(e.value)},c)},c)}function e(a,b,c){g.open("readwrite",function(){g.executeSql("DELETE FROM {} WHERE key=?".format(g.STORE_NAME),[a],b,c)},c)}function f(a,b){g.open("readwrite",function(){g.executeSql("DELETE FROM {}".format(g.STORE_NAME),null,a,b)},b)}var h=this.openDatabase||this.openDatabaseSync;if(h){var g={ASYNC_MODE:!!this.openDatabase,DB_NAME:"SGP_Cache",STORE_NAME:"SGP",sqldb:null,tx:null,open:function(a,b,c){if(this.sqldb)return this.transaction(a,b,c);this.sqldb=h(this.DB_NAME,
"1.0",this.DB_NAME,1048576);this.transaction("readwrite",function(){g.executeSql("CREATE TABLE IF NOT EXISTS "+g.STORE_NAME+" (key TEXT UNIQUE PRIMARY KEY, value TEXT)",null,b,c)},c)},transaction:function(a,b,c){var d=this;this.sqldb["readonly"===a?"readTransaction":"transaction"](function(a){d.tx=a;b()})},executeSql:function(a,b,c,d){b=b||[];if(this.ASYNC_MODE)this.tx.executeSql(a,b,c,d);else try{var e=this.tx.executeSql(a,b);c(this.tx,e)}catch(f){d(f)}}};Class.decorate(b,"set",function(c,d,e,f,
g){if(e!==b.TEXT)return this._super.apply(this,arguments);var h=this._super.apply.bind(this._super,this,arguments);a(c,d,f,h)});Class.decorate(b,"get",function(a,b,c){var e=this._super.apply.bind(this._super,this,arguments);d(a,b,e)});Class.decorate(b,"remove",function(a,b,c){var d=this._super.apply.bind(this._super,this,arguments);e(a,b,d)});Class.decorate(b,"clear",function(a,b){var c=this._super.apply.bind(this._super,this,arguments);f(c,c)})}}).call(this,Engine.Cache,Engine.NOP);(function(b){function c(a,b,c,d){l.open("readwrite",function(e){e=e.put(b,a);e.onerror=d;e.onsuccess=c},d)}function a(a,b,c){l.open("readonly",function(d){d=d.get(a);d.onerror=c;d.onsuccess=function(a){a=a.target.result;if("undefined"===typeof a)return c();b(a)}},c)}function d(a,b,c){l.open("readwrite",function(d){d=d["delete"](a);d.onerror=c;d.onsuccess=b},c)}function e(a,b){l.open("readwrite",function(c){c=c.clear();c.onerror=b;c.onsuccess=a},b)}var f=this.indexedDB||this.webkitIndexedDB||this.mozIndexedDB||
this.msIndexedDB,h=this.IDBTransaction||this.webkitIDBTransaction,g=this.IDBFactory;if(f){var k=h.READ_WRITE||"readwrite",m=h.READ_ONLY||"readonly",l={NEW_API:!(!g||!g.prototype.deleteDatabase),DB_NAME:"SGP_Cache",DB_VERSION:1,STORE_NAME:"SGP",idb:null,open:function(a,b,c){if(this.idb)return this.transaction(a,b,c);var d=this.NEW_API?f.open(this.DB_NAME,this.DB_VERSION):f.open(this.DB_NAME);d.onupgradeneeded=function(a){a.target.result.createObjectStore(l.STORE_NAME)};d.onerror=c;d.onsuccess=function(d){var e=
l.idb=d.target.result;if(l.NEW_API||l.DB_VERSION===parseInt(e.version))return l.transaction(a,b,c);d=e.setVersion(l.DB_VERSION);d.onerror=c;d.onsuccess=function(d){e.createObjectStore(l.STORE_NAME);d.target.transaction.onsuccess=l.transaction.bind(l,a,b,c)}}},transaction:function(a,b,c){if(!this.idb)throw new ReferenceError;a=this.idb.transaction(l.STORE_NAME,"readwrite"===(a||"readwrite")?k:m).objectStore(l.STORE_NAME);b(a)}};Class.decorate(b,"set",function(a,d,e,f,g){if(e!==b.TEXT&&e!==b.OBJECT)return h(a,
d,e,f,g);var h=this._super.apply.bind(this._super,this,arguments);c(a,d,f,h)});Class.decorate(b,"get",function(b,c,d){var e=this._super.apply.bind(this._super,this,arguments);a(b,c,e)});Class.decorate(b,"remove",function(a,b,c){var e=this._super.apply.bind(this._super,this,arguments);d(a,b,e)});Class.decorate(b,"clear",function(a,b){var c=this._super.apply.bind(this._super,this,arguments);e(c,c)})}}).call(this,Engine.Cache);(function(b,c){Class.decorate(b,"set",function(a,d,e,f,h){if("undefined"===typeof a||"undefined"===typeof d)throw new TypeError;"string"!==typeof e&&(h=f,f=e,e=b.TEXT);a&&"object"===typeof a&&(a=JSON.stringify(a));f="function"===typeof f?f:c;h="function"===typeof h?h:c;e===b.TEXT&&"object"===typeof d&&(d=JSON.stringify(d));this._super(a,d,e,f,h)});Class.decorate(b,"get",function(a,b,e){if("undefined"===typeof a)throw new TypeError;a&&"object"===typeof a&&(a=JSON.stringify(a));b="function"===typeof b?
b:c;e="function"===typeof e?e:c;this._super(a,b,e)});Class.decorate(b,"remove",function(a,b,e){if("undefined"===typeof a)throw new TypeError;a&&"object"===typeof a&&(a=JSON.stringify(a));b="function"===typeof b?b:c;e="function"===typeof e?e:c;this._super(a,b,e)});Class.decorate(b,"clear",function(a,b){a="function"===typeof a?a:c;b="function"===typeof b?b:c;this._super(a,b)})})(Engine.Cache,Engine.NOP);(function(b){function c(){this.removeEventListener&&(this.removeEventListener("DOMContentLoaded",c),this.removeEventListener("load",c));b.start()}this.addEventListener("DOMContentLoaded",c);this.addEventListener("load",c,!1)}).call(this,Engine);
